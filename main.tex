\documentclass{article}

\input{Preamble/preamble-articles}

%\includeonly{Algebras/article-models-cat}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{An essentially algebraic formulation of dependent type theory}
\author{Egbert Rijke\\ {\sc Carnegie Mellon University}}
\date{\today}

\begin{document}

\maketitle

\begin{abstract}
We present an algebraic formulation of dependent type theory with
three sorts for contexts, families and terms, with finitely many operations
between them and finitely many equality axioms. Algebras for this theory are
called E-systems. We then show that there is a full and faithful functor
from Voevodsky's B-systems into E-systems, of which the image is the category
of stratified E-systems. 
\end{abstract}

\section{Introduction}


When type theory is regarded as a foundational system for doing mathematics,
we would first of all like it to have finitely many axioms which do not depend
on any presumed mathematical structures. In particular, natural numbers should
not be needed to state what type dependency is. Nevertheless, many modern
accounts on what type theory is, do rely on the existence of the natural
numbers in the meta-theory. The type theory of \cite{TheBook} uses an infinte
hierarchy $\UU_0$, $\UU_1$, $\UU_2$, \ldots of universes, as do the type
type theories of \Coq and \Agda. Likewise, models of type theory considered
by Cartmell, Voevodsky and Garner do rely on the natural numbers. 

That leaves Dybjer's categories with families as 

\subsection*{Existing models of type theory}

\subsection*{Essentially algebraic theories}
An essentially algebraic theory is an equational theory of partial operations
which may be ordered, and of which the domain of each operation is declared by 
equations on the preceeding operations. The concept of essentially algebraic
theories is due to Freyd, who writes that a critical feature of essentially
algebraic theories is that their models are closed under 
colimits \cite{Aspects_of_topoi}. 

In \cite{Adamek_Locally}, Ad\'amek and Rosicky
define an essentially algebraic theory to be a list 
\begin{equation*}
(S,\Sigma,a,d,c,E,\Sigma_t,\mathrm{Def})
\end{equation*} 
consisting of a set $S$ of sorts, a set $\Sigma$ of operation symbols,
an arity function $a:\Sigma\to\mathbf{Set}$ specifying the arity of each operation
symbol, a map $d_\sigma:a(\sigma)\to S$
for each $\sigma\in\Sigma$ specifying the sort of the domain of $\sigma$,
a map $c:\Sigma\to S$ specifying the sort of the codomain of each operation
symbol,
a set $E$ of $\Sigma$-equations, a set $\Sigma_t\subseteq\Sigma$ of total
operation symbols, and a function $\mathrm{Def}$ assigning to each operation
symbol $\sigma:\Pi_{i\in a(\sigma)} s_i\to s$ in $\Sigma-\Sigma_t$ a set
$\mathrm{Def}(\sigma)$ of $\Sigma_t$-equations in the standard variables
$x_i\in V_s$, $i\in a(\sigma)$. Subsequently, they show that a category of models of an
essentially algebraic theory is the same thing as a locally presentable 
category.

Every essentially algebraic theory $\mathbb{T}$ in the sense of Ad\'amek and Rosicky
determines a syntactic category $\mathcal{C}_\mathbb{T}$, which has all finite
limits, and $\mathbb{T}$ can be seen as a presentation of the category
$\mathcal{C}_\mathbb{T}$. Then there is a natural equivalence between the
category of models of $\mathbb{T}$ in a category $\cat{C}$ with finite limits,
and the category of finite limit preserving functors $\mathcal{C}_\mathbb{T}\to
\cat{C}$. Thus, in this sense an essentially algebraic theory \emph{is} just
a category with finite limits. 

Because essentially algebraic theories have a pleasant theory of models, 
phrasing a theory as an essentially algebraic one gives immediate access to
a well-developed toolbox which can be used in its study. Therefore, recognizing
that the theory of type dependency is essentially algebraic is a critical step
in the development of its theory of models.

\subsection*{Logical frameworks}

\subsection*{The essentially algebraic theory of E-systems}

\subsection*{Overview and conventions}
In \autoref{sec:esys_defn}, we give the categorical definition of E-system in 
several stages. First we define weakening systems, then projection systems and
substitution systems, and finally we bundle them together into the definition
of E-systems. The structure of the definition of weakening systems is 
prototypcial: we first define the notion of pre-weakening systems, which are
categories that come with a pre-weakening structure; then we define the notion
of pre-weakening homomorphism, which is a functor preserving the weakening
structure and we note that it makes sense to ask for the property that the
functors of which the weakening system consists, are also pre-weakening
homomorphisms; and finally, adding this requirement will be give the definition
of weakening systems. We go through this process for each of the definitions
of weakening systems, projection systems, substitution systems and E-systems.

Throughout this section, our focus is on (set-valued) models of the essentially algebraic
theory of type dependency, and in fact we shall not give the syntactic
presentation of the theory. A syntactic presentation of type theory in the
usual type theoretic style and models in arbitrary categories with finite limits
have been presented by the author during the Homotopy Type Theory workshop in
Oxford, November 2014%
\footnote{See \url{http://www.qmac.ox.ac.uk/events/Talk\%20slides/Egbert\%20Rijke.pdf}}.

In \autoref{sec:esys_props}, we derive several properties from the axioms of
E-systems. This section is meant to give some insight in what can generally be
done with E-systems, and provide some of the intuition behind the constructions
in \autoref{sec:esys_compared}.

Although we have introduced a notion of E-homomorphism, a better behaved category
of E-systems is the one where E-homomorphisms lift factorizations. The condition
that a functor lifts factorizations is also algebraic, so we still have an
essentially algebraic theory of E-systems if we require this.
In \autoref{sec:esys_compared}, where we introduce the category of E-systems
with E-homomorphisms lifting factorizations, we construct an embedding from Voevodsky's
B-systems into E-systems and prove that its image is the (full) subcategory
of stratified E-systems. 

\begin{rmk}
In the present article we use $\jdeq$ for equality, because the equality we
consider here will interpret the judgmental equality of type theory, 
and we wish to reserve
the more convenient symbol $=$ for the internal equality of E-systems, i.e.~for
the identification types, as in \cite{TheBook}. 
\end{rmk}

\begin{rmk}
Recall that the slice pre-category $\cat{C}/\Gamma/(\Delta,f)$ is isomorphic to the slice pre-category
$\cat{C}/\Delta$, in the essentially algebraic theory of pre-categories. In the following,
we shall usually identify these two categories. Recall also that for every functor
$F:\cat{C}\to\cat{D}$ and every object $\Delta$ of $\cat{C}$, there is a functor
$F/\Delta:\cat{C}/\Delta\to \cat{D}/F(\Delta)$ given by the action on morphisms of $F$. 
\end{rmk}

\begin{rmk}
It will be convenient to denote the objects of the category $\cat{C}$ with capital
greek letters $\Gamma$, $\Delta$, \ldots, and the morphisms by capital latin letters
$A$, $B$, $P$, $Q$, etcetera. When $A$ is a morphism into $\Gamma$, we will denote
its codomain by $\ctxext{\Gamma}{A}$. When $A$ is a morphism into $\Gamma$ and
$P$ is a morphism into $\ctxext{\Gamma}{A}$, it will be convenient to denote the
composition of $P$ with $A$ by $\ctxext{A}{P}$ as well. Note that $\ctxext{A}{P}$
is indeed the domain of $P$ in the slice category $\cat{C}/\Gamma$. Also, objects
of $\cat{C}$ will always have a capital greek letter in their notation, e.g.~as
in $\ctxext{{\Gamma}{A}}{P}$. 
\end{rmk}

\subsection*{Acknowledgements}
Several people have been indispensible throughout the research process.
I would like to thank 
Richard Garner for the early discussions on the inference rules of type 
dependency we had in Barcelona and in Paris; 
Joachim Kock for the many fruitful discussions and for hosting me at the Universitat
Aut\`onoma de Barcelona during the year 2013-2014;
Steve Awodey for sharing many insights and useful advice which lead to the
definition of an E-system in arbitrary categories with finite limits;
and Vladimir Voevodsky for inviting me to present E-systems at the Homotopy Type
Theory workshop in Oxford (November 2014) and to visit the Institute for Advanced 
Study in Princeton (March 2015), where the definition presented here was
discovered.

%\tableofcontents

%\input{Introduction/article-models-intro}

%\part{Type theory}

\begin{comment}
In this part we develop type theory from the ground up. We start with a type
theory without any of the basic constructors. This is the theory of contexts
families and terms which has the basic operations of extension, weakening,
substitution and identity terms. Type theory before type constructors has not
been studied very much. Dependent product types or even universes tend to make
an early appearance in just about any presentation of type theory.
A noteable exception is the theory of categories with families of Dybjer
in \cite{Dybjer1996}, which has been elaborated on further by Dybjer and
Clairambault in \cite{DybjerClairambault2011} and in unpublished work by
Awodey \cite{Awodey2013} on natural models of type theory,
which makes the connection between categories with families and representable
transformations of presheaves. In the way type theory is presented by the
Univalent Foundations Project in \cite{TheBook}, which seems to have won the race of introducing universes
as early as possible hands down, it seems entirely unfeasible to study type
theory without type constructors. Also, the 
proof-assistant \Coq\ {\color{red}(and \Agda too?)} has universes and dependent product and pair types 
built-in, making it impossible to study type theory without type constructors in 
that environment.

Nevertheless, type theory without type constructors has received some attention
contributors to the Univalent Foundations Program recently. We name two
further investigations on this topic, other than the mentioned work by Awodey.
In \cite{Garner2014}, Garner describes the combinatorial structure
of the type operations of the weakening, substitution and projection monads
(their projections are our identity terms) and suggests lots of further research
that can be done on type theory without constructors. Also, Joyal has presented
his theory of tribes, which is a categorical explanation of type theory
without type constructors.

After we have described the E-system, which is the flavor of type theory without
type constructors presented in \autoref{tt}, we will demonstrate in \autoref{ttderived}
that the theory gives rise to a rich categorical structure. The notions and
properties we derive here will be essential for the further work on internal
models for E-systems, presented in \autoref{part:models}.
\end{comment}

\begin{comment}
\section{Introduction}
In this article we define the essentially algebraic objects which correspond to dependent
type theories, which are closely related to Voevodsky's B-systems. This provides
a new axiomatization of dependent type theory, with the following properties:
\begin{itemize}
\item The meta-theory should not require anything more than rules for handling
inferences. In particular, natural numbers, or an infinite set of variables 
should not be required.
\item Finitely many sorts. The basic ingredients are contexts, families and
terms. Thus there will be 3 sorts.
\item The theory is algebraic and the operations on it are homomorphisms. From
the requirement that type theoretic operations must be homomorphisms, we can
read off which judgmental equalities to require require.
\item Finite set of rules.
\item The theory is invariant under slicing in a canonical way.
\end{itemize}

We build
dependent type theory by imposing several structures of increasing complexities
on top of each other. We begin by the theory of extension, which incorporates
a context extension and a family extension operation to the theory which merely
has three sorts. On top of the theory of extension we can formulate the theories
of weakening, substitution and extension-units (i.e.~the empty context and families).
The theory of weakening can be enriched with units playing the role of identity
morphisms, which gives a theory of projections. The three resulting theories
can then be combined into dependent type theory. Thus, the theory of dependent
types is outlined in the following diagram.

\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=0em]
{} \& \textbf{Extension} \ar[very thick,-stealth]{dr} \ar[very thick,-stealth]{d} \ar[very thick,-stealth]{dl}
  \\
\makebox[.7cm]{\textbf{Weakening}} \ar[very thick,-stealth]{d} \& \textbf{Substitution} \ar[very thick,-stealth]{dd} \& \makebox[3cm]{\textbf{Empty context and families}} \ar[very thick,-stealth]{ddl}
\\
\makebox[.7cm]{\textbf{Projection}} \ar[very thick,-stealth]{dr}
\\
{} \& \textbf{Dependent Type Theory}
\end{tikzcd}
\end{equation*}

We give two presentations of the theory simultaneously. First, we directly
define the algebras for the corresponding theories in an arbitrary category
with finite limits and second, we describe the theory in terms of inference
rules.

\subsection{Categories with finite limits}
For the semantics of the theory of E-systems, we will assume that $\cat{C}$ is a 
category with finite limits and
whenever we write a pullback, we assume that it is chosen. Recall that for
any morphism $f:A\to B$ in a category $\cat{C}$ with chosen pullbacks, there
is a functor
\begin{equation*}
f^\ast : \cat{C}/B\to\cat{C}/A.
\end{equation*}
As usual, when $g:X\to B$ is a morphism, we will write $f^\ast(X)$ for the
domain of $f^\ast(g)$. When there is more than one morphism $X\to B$ involved,
as will be the case below, we will write $\pullback{A}{X}{f}{g}$. The projections
will be written as $\pullbackpr{1}{f}{g}$ and $\pullbackpr{2}{f}{g}$. So in this notation, a
typical pullback diagram has the following form:
\begin{equation*}
\begin{tikzcd}[column sep=large]
\pullback{A}{X}{f}{g}
  \ar{r}{\pullbackpr{1}{f}{g}}
  \ar{d}[swap]{\pullbackpr{2}{f}{g}}
  &
A \ar{d}{f}
  \\
X \ar{r}[swap]{g}
  &
B
\end{tikzcd}
\end{equation*}
Furthermore, given $h:Y\to A$ and $k:Y\to B$ such that $h\circ f=g\circ k$, we
denote the arrow $Y\to\pullback{A}{X}{f}{g}$ given by the universal property of
pullbacks, by $[h,k]$. Also, when we have a commutative diagram of the form
\begin{equation*}
\begin{tikzcd}
A \ar{r}{f}
  \ar{d}{a}
  &
X \ar{d}
  & 
B \ar{l}[swap]{g}
  \ar{d}{b}
  \\
A'
  \ar{r}[swap]{f'}
  &
X'
  &
B'
  \ar{l}{g'}
\end{tikzcd}
\end{equation*}
we will denote the unique map from $\pullback{A}{B}{f}{g}$ to $\pullback{A'}{B'}{f'}{g'}$
such that the diagram
\begin{equation*}
\begin{tikzcd}
  {}
  & 
\pullback{A'}{B'}{f'}{g'}
  \ar{dd}
  \ar{rr}
  &
  &
B'
  \ar{dd}{g'}
  \\
\pullback{A}{B}{f}{g}
  \ar{dd}
  \ar[crossing over]{rr}
  \ar[dotted]{ur}{\pullback{a}{b}{f'}{g'}}
  &
  &
B \ar{ur}{b}
  \\
  {}
  &
A'
  \ar{rr}
  &
  &
X'
  \\
A \ar{rr}[swap]{f}
  \ar{ur}{a}
  &
  &
X \ar[crossing over,leftarrow]{uu}[near end,swap]{g}
  \ar{ur}
\end{tikzcd}
\end{equation*}
commutes, by $\pullback{a}{b}{f'}{g'}$. In the current work, we shall
write $A\times B$ for the pullback of $A\rightarrow 1\leftarrow B$, and
$\pi_1$ and $\pi_2$ for its projections (thus, no separate choice of
cartesian products is made).

\subsection{Inference rules}
The syntactic theory of contexts, families and terms shall be described by means
of a declaration of valid inference rules. Although their appearance suggests 
otherwise, the notion of inference rule is ultimately informal, in the sense
that we state the explanations and possibilities with inference rules in
natural language. One may attempt to study systems of inference rules within
other systems to study the applications of the various concepts involved, but
this study will not make the basic notion of inference rules more formal. We do
not see this as a problem, as systems of inference rules have been implemented
in proof assistant software in which one essentially only manipulates
judgments. In this paper we use inference rules as an alternative presentation
of the theory, which some readers may prefer. 

An inference rule is a finite list $\mathcal{H}_1,\ldots,\mathcal{H}_n;
\mathcal{J}$ of expressions called judgments. Usually we represent an inference
rule in the following form
\begin{equation*}
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_n}{\mathcal{J}}
\end{equation*}
The judgments $\mathcal{H}_1$, \ldots, $\mathcal{H}_n$ are called the
hypotheses and the judgment $\mathcal{J}$ is the conclusion of the inference
rule.

An inference rule is called \emph{valid} in either of the following cases:
\begin{description}
\item[(Axiom)] It is declared valid as an axiom;
\item[(Projection)] The inference rule
\begin{equation*}
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_n}{\mathcal{H}_i}
\end{equation*}
is a valid inference rule for any $1\leq i\leq n$;
\item[(Composition)] If
\begin{equation*}
\inference{\mathcal{I}_{1k}\quad\cdots\quad\mathcal{I}_{m_kk}}{\mathcal{H}_k}
\qquad\text{and}\qquad
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_n}{\mathcal{J}}
\end{equation*}
are valid inference rules for $1\leq k\leq n$, then
\begin{equation*}
\inference{\mathcal{I}_{11}\quad\cdots\quad\mathcal{I}_{m_11}\quad\cdots\quad\mathcal{I}_{1n}\quad\cdots\quad\mathcal{I}_{m_nn}}{\mathcal{J}}
\end{equation*}
is also a valid inference rule;
\item[(Cut elimination)] If
\begin{equation*}
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_n}{\mathcal{H}_{n+1}}
\qquad
\text{and}
\qquad
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_{n+m+1}}{\mathcal{J}}
\end{equation*}
are valid inference rules, then
\begin{equation*}
\inference{\mathcal{H}_1\quad\cdots\quad\hat{\mathcal{H}}_{n+1}\quad\cdots\quad\mathcal{H}_{n+m+1}}{\mathcal{J}}
\end{equation*}
where the hypothesis $\mathcal{H}_{n+1}$ is omitted, is a valid inference rule.
\end{description}
In categories with finite limits, valid inference rules will always be 
interpreted by  arrows.

\input{fundamental_structure}

\input{extension}

\input{weakening}

\input{projections}

\input{substitution}

\input{empty}

\input{dependent_type_theory}

\section{The relation between E-systems and B-systems}

In this section we answer the following questions posed by Voevodsky in private
correspondence.
\begin{itemize}
\item Is the construction that takes a (unital) B-system to an E-system a functor?
\item Is this functor fully faithful?
\item Is there a simple way to characterize the E-systems that arise from B-systems (the image of this functor on objects)?
\item Construct an example of an E-system that does not arise from a B-system.
\end{itemize}

\subsection{The functor from B-systems to E-systems}
Consider a B-system $\mathbb{B}$. We will construct an E-system $E(\mathbb{B})$
in the category of sets. This E-systems consists of sets $C(\mathbb{B})$,
$F(\mathbb{B})$ and $T(\mathbb{B})$ for the sorts of contexts, families and
terms respectively, with functions $\eft:F(\mathbb{B})\to C(\mathbb{B})$ and
$\ebd:T(\mathbb{B})\to T(\mathbb{B})$ and the operations of extension,
weakening, units, substitution and empty contexts and families.

The set $C(\mathbb{B})$ consists of pairs $(n,X)$, where $n\in\mathbb{N}$ and
$X\in B_n$. The set $F(\mathbb{B})$ consists of quadruples $(n,X,m,Y)$, where
$n,m\in\mathbb{N}$ such that $n<m$, $X\in B_n$ and $Y\in B_{m}$ such that
$ft^{m-n}:=ft^{n-1}\circ\cdots\circ ft^m(Y)=X$.

%\include{Derivations/article-models-ttderived}

%\part{Internal Models}\label{part:models}

%\include{Internal_models/article-models-ttinternal}

%\part{Type constructors}

%\include{Dependent_function_types/article-models-ttdp}

%\include{Universes/article-models-ttuniverses}

%\include{Junk/article-models-ttind}

%\part{Categorical semantics}

%\input{Algebras/article-models-cat}

\part{The new E-systems}
\end{comment}

\input{weakeningcats}

\bibliographystyle{plain}
%\phantomsection\addcontentsline{toc}{section}{References}
\bibliography{References/refs}

\end{document}
