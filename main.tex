\documentclass{article}

\input{Preamble/preamble-articles}

%\includeonly{Algebras/article-models-cat}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{An essentially algebraic formulation of dependent type theory}
\author{Egbert Rijke\footnote{{\sc Carnegie Mellon University}, department of
philosophy; \url{erijke@andrew.cmu.edu}}}
\date{\today}

\begin{document}

\maketitle

\begin{abstract}
We present an algebraic formulation of dependent type theory with
three sorts for contexts, families and terms, with finitely many operations
between them and finitely many equality axioms. Algebras for this theory are
called E-systems. A distinctive feature of the dependent type theory of
E-systems is that it takes `telescopic families' as the primitive notion of
families.

We then compare Voevodsky's B-systems, Dybjer's categories
with families and Jacob's comprehension categories with E-systems. There is
a full and faithful functor from B-systems to E-systems, of which the image is
the category of stratified E-systems. To have a functor from categories with
families to E-systems, we need to impose an additonal coherence condition, which
makes sure that the substitution operation of a category with families extends 
to telescopic families. 
\end{abstract}

%\tableofcontents

\section{Introduction --- Mathematical languages as designed and maintained languages}
Mathematical research is aided by the development of languages that help 
researchers to investigate their subject efficiently. Such a development is an
ongoing process, both for informal and formal languages, that may have both
mathematical and meta-mathematical aspects. 

There is an amount of attraction and repulsion that works simultaneously
between formal and informal languages for mathematics, which is a driving force
for the development of mathematical languages. The use of
a natural language in mathematical arguments facilitates people to engage
with mathematical constructs at a conceptual level, while a formal mathematical
language aims to encode the intuitive development. At the same time and 
especially nowadays, formal languages aim to possess a high level of rigor and
precision, so that mathematical arguments and constructions can be executed and
verified algorithmically, and informal mathematics is usually not considered
acceptable if it cannot in principle be carried out in a formal system.

It may be the case that formal languages are developed in order to be more
precise and certain about bodies of existing mathematical work, but there are
also cases where the conceptual thinking 

The book on Homotopy Type Theory, \cite{TheBook}, was written in informal
language (maybe `semi-formal' would be a more accurate description), 
partly because it was conceived that the underlying type theory might
not always remain the same, while principles and concepts developed starting
from type theory exist separately from any particular version of type 
theory, though perhaps not completely independent. 

Today, formal languages for mathematics, logic and computer science, are studied
under the name logical frameworks.
Pfenning \cite{PfenningLFintro} defines logical frameworks
to be meta-languages for the formalization of deductive system. Examples of
logical framework therefore include propositional logic, first-order predicate 
logic, Russell's ramified type theory, the lambda-calculus, dependent type 
theory, and so on. By considering models of a logical framework, it becomes
itself the subject of mathematical study. Thus, logical frameworks typically
contain laws for handling logical inferences, the specification of the sorts
and operations of the language or theory, and axioms the operations are required to
satisfy. 

While there are aspects of logical frameworks that are of meta-mathematical 
nature, such as descriptions of handling inference rules, it may be useful to
consider a mathematical language as a mathematical object, especially if one
is interested in models of the theory. For practically any theory there is a
wish to do so, so it may be useful to keep this in mind in the specification
of a logical framework. One way to do this, is to make sure that the theory
belongs to a class of theories of which the model theory is reasonably well-%
understood. Among such classes of theories are algebraic theories and
essentially algebraic theories.

The choices made in the design principles and specification of a logical 
framework, will determine both the subject of study and how effective we can be
in its study. Investigations of logical framework can therefore be seen as
`opening theories for mathematics', in analogy of opening theories for games.
Logical frameworks for mathematics are not set in stone and 
neither to they remain the same once they are declared.

\subsection*{Essentially algebraic theories}
An essentially algebraic theory is an equational theory of partial operations
which may be ordered, and of which the domain of each operation is declared by 
equations on the preceeding operations. The concept of essentially algebraic
theories is due to Freyd, who writes that a critical feature of essentially
algebraic theories is that their models are closed under 
colimits \cite{Aspects_of_topoi}. Many classes of theories have been described
and shown to be equivalent to essentially algebraic theories. Among them are
Partial Horn Logic and quasi-equational theories \cite{Palmgren_Vickers},
cartesian theories \cite{Freyd2002}, finite limit sketches 
\cite{Toposes_triples_theories}, left exact theories
\cite{McLarty1986}, and they can be equivalently represented as locally
presentable categories \cite{Adamek_Locally}.

In \cite{Adamek_Locally}, Ad\'amek and Rosicky
define an essentially algebraic theory to be a list 
\begin{equation*}
(S,\Sigma,a,d,c,E,\Sigma_t,\mathrm{Def})
\end{equation*} 
consisting of a set $S$ of sorts, a set $\Sigma$ of operation symbols,
an arity function $a:\Sigma\to\mathbf{Set}$ specifying the arity of each operation
symbol, a map $d_\sigma:a(\sigma)\to S$
for each $\sigma\in\Sigma$ specifying the sort of the domain of $\sigma$,
a map $c:\Sigma\to S$ specifying the sort of the codomain of each operation
symbol,
a set $E$ of $\Sigma$-equations, a set $\Sigma_t\subseteq\Sigma$ of total
operation symbols, and a function $\mathrm{Def}$ assigning to each operation
symbol $\sigma:\Pi_{i\in a(\sigma)} s_i\to s$ in $\Sigma-\Sigma_t$ a set
$\mathrm{Def}(\sigma)$ of $\Sigma_t$-equations in the standard variables
$x_i\in V_s$, $i\in a(\sigma)$. Subsequently, they show that a category of models of an
essentially algebraic theory is the same thing as a locally presentable 
category.

Every essentially algebraic theory $\mathbb{T}$ in the sense of Ad\'amek and Rosicky
determines a syntactic category $\mathcal{C}_\mathbb{T}$, which has all finite
limits, and $\mathbb{T}$ can be seen as a presentation of the category
$\mathcal{C}_\mathbb{T}$. Then there is a natural equivalence between the
category of models of $\mathbb{T}$ in a category $\cat{C}$ with finite limits,
and the category of finite limit preserving functors $\mathcal{C}_\mathbb{T}\to
\cat{C}$. Thus, in this sense an essentially algebraic theory \emph{is} just
a category with finite limits. 

Because essentially algebraic theories have a pleasant theory of models, 
phrasing a theory as an essentially algebraic one gives immediate access to
a well-developed toolbox which can be used in its study. Therefore, recognizing
that the theory of type dependency is essentially algebraic is a critical step
in the development of its theory of models.

\subsection*{Setting up the essentially algebraic theory of E-systems}
The theory of E-systems we present in the present article is an iteration in the
development of theory of type
dependency. The goal has been to describe an essentially algebraic theory of
type dependency that is in close correspondence to the type theory of
\cite{TheBook}, while at the same time it is as economic as possible in the
demand of external resources (such as the natural numbers). Instead of explaning
what a dependent type is via an infinite hierarchy of universes $\UU_0$,
$\UU_1$, \ldots, we set out to describe type families using only the three sorts
that typically occur in type theoretical expressions: contexts, families and 
terms. Although an infinite hierarchy of universes allows one to consider everything
to be a term (because every type is a term of some specified universe), and 
therefore use the literally same mechanisms for handling type expressions as for
term expressions in the process of compilation and verification of a 
construction, this specific setup requires the natural numbers to exist in the 
meta-theory. 

An E-system is therefore an algebra consisting of three sorts: $C$ for contexts,
$F$ for families, and $T$ for terms. There is a map 
$\eft:F\to C$ which determines for each family, in which context it is a
family; and there is a map $\ebd:T\to F$ which determines for each term, of
which family it is a term. Thus, the backbones of an E-system can be represented
as
\begin{equation*}
\begin{tikzcd}
T \arrow[d,"\ebd"] \\ F \arrow[d,"\eft"] \\ C
\end{tikzcd}
\end{equation*}
When $A$ is a family in context $\Gamma$, there is also a context $\ctxext{\Gamma}{A}$,
called the \emph{context extension of $A$}. Context extension allows us to consider
`families over families', where a family $P$ over $A$ in context $\Gamma$, would
simply be a family $P$ over $\ctxext{\Gamma}{A}$. Context extension is represented
by another function $\cftctxext : F\to C$.

Since we want the rules of
type theory to be valid in any context $\Gamma$, there is also a notion of family
extension. Thus, for any family $P$ over $A$ in context $\Gamma$, there is a
family $\ctxext{A}{P}$ in context $\Gamma$. In other words, we have a function
$\cftfamext : F\times_{\cftctxext,\eft} F\to F$. 

Two associativity laws will require
that context and family extension are compatible with each other: we have
the equality $\ctxext{{\Gamma}{A}}{P}\jdeq\ctxext{\Gamma}{{A}{P}}$ of contexts,
and the equality $\ctxext{{A}{P}}{Q}\jdeq\ctxext{A}{{P}{Q}}$ of families.

Finally, there is an empty context $\emptyc\in C$, and an empty family $\emptyf[\Gamma]$
in context $\Gamma$, for every $\Gamma\in C$. The empty context is such that context extension
restricted to families over the empty context is an isomorphism, and the empty
families are neutral with respect to context and family extension in the sense
that $\ctxext{\Gamma}{\emptyf[\Gamma]}\jdeq\Gamma$, $\ctxext{\emptyf[\Gamma]}{A}
\jdeq A$ and $\ctxext{A}{\emptyf[\ctxext{\Gamma}{A}]}\jdeq A$. 

One may recognize in these ingredients of E-systems a category with a
terminal object, and a set $T(f)$ of terms for every morphism $f$ (satisfying
no further axioms, so far). Ignoring the set of terms for the moment, $C$ is
the set of objects and $F$ is the set of morphisms; $\eft$ assigns the codomain
to each morphism and $\cftctxext$ assigns the domain to each  morphism. The
operation $\cftfamext$ composes two morphisms. The first associativity rule
asserts that the domain of the composition $\ctxext{A}{P}$ is the domain of
$P$, and the second associativity rule asserts that composition is associative
in the usual sense. The empty context satisfies exactly the properties of the
terminal object, and the empty family $\emptyf[\Gamma]$ satisfies the properties
of the identity morphisms. 

Thus, an E-system $\mathbf{E}$ will have an underlying category, which may be called the
category of families of $\mathbf{E}$. The structure of type dependency will by
built on top of this category. This structure will consist of an E-homomorphism
$W_A$ called \emph{weakening by $A$}, for every family $A$ in context $\Gamma$,
an E-homomorphism $S_x$ called \emph{substitution by $x$}, for every term
$x$ of $A$ in context $\Gamma$, and units $\idtm{A}\in T(W_A(A))$ for every
family $A$ in context $\Gamma$, satisfying a handful of further axioms. 
The weakening and substitution homomorphisms
will preserve the extension structure we have discussed above; in other words,
they will be functors preserving the terminal object. 

\subsection*{The pre-categorical nature of E-systems}
Although we start our definition of E-systems with a category with term structure,
we do not set out to have a categorical notion of E-systems, in the sense that the structure of
being an E-system can be transported along equivalences of categories. The goal
in this paper is to describe the algebraic structures belonging to an essentially
algebraic theory of type dependency, and this structure turns out to be pre-categorical
rather than categorical. The fact that we've encountered a category at the outset
of our definition of E-systems is in a sense coincidence, rather than born out
of a desire to do type theory categorically and we would consider E-systems to
be pre-categorical models of type theory rather than categorical models of type
theory. The difference between pre-categories and categories is that equality
of objects in a pre-category is considered to be (strict) equality, whereas
equality of objects in a category is considered to be isomorphism of objects,
and we have chosen to use the former notion of equality.

\subsection*{Existing notions of categorical models of dependent type theory}

When introducing a new notion of model of dependent type theory, one necessarily
faces the task of comparing the new notion with existing notions, and there are
quite a few. 

\begin{itemize}
\item Contextual categories were introduced by Cartmell \cite{Cartmell1986} and were studied
extensively by Voevodsky in \cite{VV_Csys_univ,VV_C-systems_monad,VV_C-systems_quotients}
under the name C-systems.
\item Categories with families, introduced by Dybjer in \cite{Dybjer1996}, model a
theory of type dependency with sorts for contexts, context morphisms, types
and terms. Among the virtues of categories with families are that its theory
is essentially algebraic, and they are relatively simple to work with.

Categories with families are models of a dependent type theory with a
category of contexts, for each context $\Gamma$ a sort $\mathrm{Ty}(\Gamma)$ of
types in context $\Gamma$, and for each type $A\in\mathrm{Ty}(\Gamma)$ a sort
$\mathrm{Tm}(A)$ of terms of type $A$ in context $\Gamma$. We will see that
the sorts $\mathrm{Tm}(A)$ are superfluous, because it will always be 
naturally isomorphic to the set of sections of the projection morphism
$p_A:\ctxext{\Gamma}{A}\to\Gamma$ in the category of contexts. The evident
functor from categories with families to E-systems will forget that the contexts
form a category, and therefore it will not be faithful.
\item Comprehension categories were introduced by Jacobs in \cite{Jacobs1993}, as
a minimal notion of categorical model in type theory, without really making
precise what that means. 
Comprehension categories are models of a dependent type theory with a
category of context, and for each context $\Gamma$ a category of types. 
\end{itemize}

There is a simple test to quickly figure out some basic differences between different
dependent type theories, asking what kind of structure remains if there are no
types at all. In a contextual category, only the terminal object remains.
However, when the presheaf $\mathrm{Ty}$ of a category with families is assumed
to be empty, or when a category $\cat{E}$ fibered over some category is assumed
to be empty, the underlying category of context remains. We shall see that
E-systems are like contextual categories in this respect: only a singleton can
be an E-system with no types. This complicates a thorough comparison between
categories with families and comprehension categories on one side, and E-systems
on the other. We shall construct functors from the categories of categories with
families and comprehension categories directly preserving type dependency, but
these functors will not be faithful. 

Thus, it seems that both categories with families and comprehension categories
have more structure than needed to model dependent type theory.

\subsection*{Overview and conventions}
In \autoref{sec:esys_defn}, we give the categorical definition of E-system in 
several stages. First we define weakening systems, then projection systems and
substitution systems, and finally we bundle them together into the definition
of E-systems. The structure of the definition of weakening systems is 
prototypcial: we first define the notion of pre-weakening systems, which are
categories that come with a pre-weakening structure; then we define the notion
of pre-weakening homomorphism, which is a functor preserving the weakening
structure and we note that it makes sense to ask for the property that the
functors of which the weakening system consists, are also pre-weakening
homomorphisms; and finally, adding this requirement will be give the definition
of weakening systems. We go through this process for each of the definitions
of weakening systems, projection systems, substitution systems and E-systems.

Throughout this section, our focus is on (set-valued) models of the essentially algebraic
theory of type dependency, and in fact we shall not give the syntactic
presentation of the theory. A syntactic presentation of type theory in the
usual type theoretic style and models in arbitrary categories with finite limits
have been presented by the author during the Homotopy Type Theory workshop in
Oxford, November 2014%
\footnote{See \url{http://www.qmac.ox.ac.uk/events/Talk\%20slides/Egbert\%20Rijke.pdf}}.

In \autoref{sec:esys_props}, we introduce the auxiliary notion of E'-system.
An E'-system consists of a pre-category $\cat{C}$ with a sub-pre-category
$\cat{F}$ with the same objects as $\cat{C}$, and a functorial choice of
pullbacks for any morphism $f:\Delta\to\Gamma$ in $\cat{C}$ and any
$A\in\cat{F}/\Gamma$. The goal of this section is to show that 
E'-systems and E-systems are different axiomatizations of the same structures,
and apart from that the goal is to show some equational reasoning in E-systems.
The properties proven in this section also serve to provide some of the 
intuition behind the constructions in \autoref{sec:esys_compared}.

Although we have introduced a notion of E-homomorphism, a better behaved category
of E-systems is the one where E-homomorphisms lift factorizations. The condition
that a functor lifts factorizations is also algebraic, so we still have an
essentially algebraic theory of E-systems if we require this.
In \autoref{sec:esys_compared}, where we introduce the category of E-systems
with E-homomorphisms lifting factorizations, we construct an embedding from Voevodsky's
B-systems into E-systems and prove that its image is the (full) subcategory
of stratified E-systems. 

\begin{rmk}
In the present article we use $\jdeq$ for equality, because the equality we
consider here will interpret the judgmental equality of type theory, 
and we wish to reserve
the more convenient symbol $=$ for the internal equality of E-systems, i.e.~for
the identification types, as in \cite{TheBook}. 
\end{rmk}

\begin{rmk}
Recall that the slice pre-category $\cat{C}/\Gamma/(\Delta,f)$ is isomorphic to the slice pre-category
$\cat{C}/\Delta$, in the essentially algebraic theory of pre-categories. In the following,
we shall usually identify these two categories. Recall also that for every functor
$F:\cat{C}\to\cat{D}$ and every object $\Delta$ of $\cat{C}$, there is a functor
$F/\Delta:\cat{C}/\Delta\to \cat{D}/F(\Delta)$ given by the action on morphisms of $F$. 
\end{rmk}

\begin{rmk}
When we think of a category $\cat{F}$ as a category of fibrations or families
over a context -- which will be the outset of the definition of E-systems --
it will be convenient to denote the objects of the $\cat{F}$ with capital
greek letters $\Gamma$, $\Delta$, \ldots, and the morphisms by capital latin letters
$A$, $B$, $P$, $Q$, \ldots. When $A$ is a morphism into $\Gamma$, we will denote
its domain by $\ctxext{\Gamma}{A}$, so we don't always have to introduce a name
for the domain. When $A$ is a morphism into $\Gamma$ and
$P$ is a morphism into $\ctxext{\Gamma}{A}$, it will also be convenient to denote the
composition of $P$ with $A$ by $\ctxext{A}{P}$. Note that $\ctxext{A}{P}$
is indeed the domain of $P$ in the slice category $\cat{F}/\Gamma$.
\end{rmk}

\begin{rmk}
We have chosen not to use common type theoretical notation involving special
expressions for judgments and for inference rules, because we want to focus
on the algebraic structure of type dependency rather than on its syntax.

We would also like to remark that although it appears that we introduce possibly
large families of operations (a weakening operation $W_A$ for each morphism $A$,
for instance), E-systems can actually be defined with finitely many
operations. This becomes clearer when one defines an E-system in an arbitrary
category with finite limits.
\end{rmk}

\subsection*{Acknowledgements}
Several people have been indispensible throughout the research process.
I would like to thank 
Richard Garner for the early discussions on the inference rules of type 
dependency we had in Barcelona and in Paris; 
Joachim Kock for the many fruitful discussions and for hosting me at the Universitat
Aut\`onoma de Barcelona during the year 2013-2014;
Steve Awodey for sharing many insights and useful advice which lead to the
definition of an E-system in arbitrary categories with finite limits;
and Vladimir Voevodsky for inviting me to present E-systems at the Homotopy Type
Theory workshop in Oxford (November 2014) and to visit the Institute for Advanced 
Study in Princeton (March 2015), where the definition presented here was
discovered.

%\tableofcontents

%\input{Introduction/article-models-intro}

%\part{Type theory}

\begin{comment}
In this part we develop type theory from the ground up. We start with a type
theory without any of the basic constructors. This is the theory of contexts
families and terms which has the basic operations of extension, weakening,
substitution and identity terms. Type theory before type constructors has not
been studied very much. Dependent product types or even universes tend to make
an early appearance in just about any presentation of type theory.
A noteable exception is the theory of categories with families of Dybjer
in \cite{Dybjer1996}, which has been elaborated on further by Dybjer and
Clairambault in \cite{DybjerClairambault2011} and in unpublished work by
Awodey \cite{Awodey2013} on natural models of type theory,
which makes the connection between categories with families and representable
transformations of presheaves. In the way type theory is presented by the
Univalent Foundations Project in \cite{TheBook}, which seems to have won the race of introducing universes
as early as possible hands down, it seems entirely unfeasible to study type
theory without type constructors. Also, the 
proof-assistant \Coq\ {\color{red}(and \Agda too?)} has universes and dependent product and pair types 
built-in, making it impossible to study type theory without type constructors in 
that environment.

Nevertheless, type theory without type constructors has received some attention
contributors to the Univalent Foundations Program recently. We name two
further investigations on this topic, other than the mentioned work by Awodey.
In \cite{Garner2014}, Garner describes the combinatorial structure
of the type operations of the weakening, substitution and projection monads
(their projections are our identity terms) and suggests lots of further research
that can be done on type theory without constructors. Also, Joyal has presented
his theory of tribes, which is a categorical explanation of type theory
without type constructors.

After we have described the E-system, which is the flavor of type theory without
type constructors presented in \autoref{tt}, we will demonstrate in \autoref{ttderived}
that the theory gives rise to a rich categorical structure. The notions and
properties we derive here will be essential for the further work on internal
models for E-systems, presented in \autoref{part:models}.
\end{comment}

\begin{comment}
\section{Introduction}
In this article we define the essentially algebraic objects which correspond to dependent
type theories, which are closely related to Voevodsky's B-systems. This provides
a new axiomatization of dependent type theory, with the following properties:
\begin{itemize}
\item The meta-theory should not require anything more than rules for handling
inferences. In particular, natural numbers, or an infinite set of variables 
should not be required.
\item Finitely many sorts. The basic ingredients are contexts, families and
terms. Thus there will be 3 sorts.
\item The theory is algebraic and the operations on it are homomorphisms. From
the requirement that type theoretic operations must be homomorphisms, we can
read off which judgmental equalities to require require.
\item Finite set of rules.
\item The theory is invariant under slicing in a canonical way.
\end{itemize}

We build
dependent type theory by imposing several structures of increasing complexities
on top of each other. We begin by the theory of extension, which incorporates
a context extension and a family extension operation to the theory which merely
has three sorts. On top of the theory of extension we can formulate the theories
of weakening, substitution and extension-units (i.e.~the empty context and families).
The theory of weakening can be enriched with units playing the role of identity
morphisms, which gives a theory of projections. The three resulting theories
can then be combined into dependent type theory. Thus, the theory of dependent
types is outlined in the following diagram.

\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=0em]
{} \& \textbf{Extension} \ar[very thick,-stealth]{dr} \ar[very thick,-stealth]{d} \ar[very thick,-stealth]{dl}
  \\
\makebox[.7cm]{\textbf{Weakening}} \ar[very thick,-stealth]{d} \& \textbf{Substitution} \ar[very thick,-stealth]{dd} \& \makebox[3cm]{\textbf{Empty context and families}} \ar[very thick,-stealth]{ddl}
\\
\makebox[.7cm]{\textbf{Projection}} \ar[very thick,-stealth]{dr}
\\
{} \& \textbf{Dependent Type Theory}
\end{tikzcd}
\end{equation*}

We give two presentations of the theory simultaneously. First, we directly
define the algebras for the corresponding theories in an arbitrary category
with finite limits and second, we describe the theory in terms of inference
rules.

\subsection{Categories with finite limits}
For the semantics of the theory of E-systems, we will assume that $\cat{C}$ is a 
category with finite limits and
whenever we write a pullback, we assume that it is chosen. Recall that for
any morphism $f:A\to B$ in a category $\cat{C}$ with chosen pullbacks, there
is a functor
\begin{equation*}
f^\ast : \cat{C}/B\to\cat{C}/A.
\end{equation*}
As usual, when $g:X\to B$ is a morphism, we will write $f^\ast(X)$ for the
domain of $f^\ast(g)$. When there is more than one morphism $X\to B$ involved,
as will be the case below, we will write $\pullback{A}{X}{f}{g}$. The projections
will be written as $\pullbackpr{1}{f}{g}$ and $\pullbackpr{2}{f}{g}$. So in this notation, a
typical pullback diagram has the following form:
\begin{equation*}
\begin{tikzcd}[column sep=large]
\pullback{A}{X}{f}{g}
  \ar{r}{\pullbackpr{1}{f}{g}}
  \ar{d}[swap]{\pullbackpr{2}{f}{g}}
  &
A \ar{d}{f}
  \\
X \ar{r}[swap]{g}
  &
B
\end{tikzcd}
\end{equation*}
Furthermore, given $h:Y\to A$ and $k:Y\to B$ such that $h\circ f=g\circ k$, we
denote the arrow $Y\to\pullback{A}{X}{f}{g}$ given by the universal property of
pullbacks, by $[h,k]$. Also, when we have a commutative diagram of the form
\begin{equation*}
\begin{tikzcd}
A \ar{r}{f}
  \ar{d}{a}
  &
X \ar{d}
  & 
B \ar{l}[swap]{g}
  \ar{d}{b}
  \\
A'
  \ar{r}[swap]{f'}
  &
X'
  &
B'
  \ar{l}{g'}
\end{tikzcd}
\end{equation*}
we will denote the unique map from $\pullback{A}{B}{f}{g}$ to $\pullback{A'}{B'}{f'}{g'}$
such that the diagram
\begin{equation*}
\begin{tikzcd}
  {}
  & 
\pullback{A'}{B'}{f'}{g'}
  \ar{dd}
  \ar{rr}
  &
  &
B'
  \ar{dd}{g'}
  \\
\pullback{A}{B}{f}{g}
  \ar{dd}
  \ar[crossing over]{rr}
  \ar[dotted]{ur}{\pullback{a}{b}{f'}{g'}}
  &
  &
B \ar{ur}{b}
  \\
  {}
  &
A'
  \ar{rr}
  &
  &
X'
  \\
A \ar{rr}[swap]{f}
  \ar{ur}{a}
  &
  &
X \ar[crossing over,leftarrow]{uu}[near end,swap]{g}
  \ar{ur}
\end{tikzcd}
\end{equation*}
commutes, by $\pullback{a}{b}{f'}{g'}$. In the current work, we shall
write $A\times B$ for the pullback of $A\rightarrow 1\leftarrow B$, and
$\pi_1$ and $\pi_2$ for its projections (thus, no separate choice of
cartesian products is made).

\subsection{Inference rules}
The syntactic theory of contexts, families and terms shall be described by means
of a declaration of valid inference rules. Although their appearance suggests 
otherwise, the notion of inference rule is ultimately informal, in the sense
that we state the explanations and possibilities with inference rules in
natural language. One may attempt to study systems of inference rules within
other systems to study the applications of the various concepts involved, but
this study will not make the basic notion of inference rules more formal. We do
not see this as a problem, as systems of inference rules have been implemented
in proof assistant software in which one essentially only manipulates
judgments. In this paper we use inference rules as an alternative presentation
of the theory, which some readers may prefer. 

An inference rule is a finite list $\mathcal{H}_1,\ldots,\mathcal{H}_n;
\mathcal{J}$ of expressions called judgments. Usually we represent an inference
rule in the following form
\begin{equation*}
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_n}{\mathcal{J}}
\end{equation*}
The judgments $\mathcal{H}_1$, \ldots, $\mathcal{H}_n$ are called the
hypotheses and the judgment $\mathcal{J}$ is the conclusion of the inference
rule.

An inference rule is called \emph{valid} in either of the following cases:
\begin{description}
\item[(Axiom)] It is declared valid as an axiom;
\item[(Projection)] The inference rule
\begin{equation*}
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_n}{\mathcal{H}_i}
\end{equation*}
is a valid inference rule for any $1\leq i\leq n$;
\item[(Composition)] If
\begin{equation*}
\inference{\mathcal{I}_{1k}\quad\cdots\quad\mathcal{I}_{m_kk}}{\mathcal{H}_k}
\qquad\text{and}\qquad
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_n}{\mathcal{J}}
\end{equation*}
are valid inference rules for $1\leq k\leq n$, then
\begin{equation*}
\inference{\mathcal{I}_{11}\quad\cdots\quad\mathcal{I}_{m_11}\quad\cdots\quad\mathcal{I}_{1n}\quad\cdots\quad\mathcal{I}_{m_nn}}{\mathcal{J}}
\end{equation*}
is also a valid inference rule;
\item[(Cut elimination)] If
\begin{equation*}
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_n}{\mathcal{H}_{n+1}}
\qquad
\text{and}
\qquad
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_{n+m+1}}{\mathcal{J}}
\end{equation*}
are valid inference rules, then
\begin{equation*}
\inference{\mathcal{H}_1\quad\cdots\quad\hat{\mathcal{H}}_{n+1}\quad\cdots\quad\mathcal{H}_{n+m+1}}{\mathcal{J}}
\end{equation*}
where the hypothesis $\mathcal{H}_{n+1}$ is omitted, is a valid inference rule.
\end{description}
In categories with finite limits, valid inference rules will always be 
interpreted by  arrows.

\input{fundamental_structure}

\input{extension}

\input{weakening}

\input{projections}

\input{substitution}

\input{empty}

\input{dependent_type_theory}

\section{The relation between E-systems and B-systems}

In this section we answer the following questions posed by Voevodsky in private
correspondence.
\begin{itemize}
\item Is the construction that takes a (unital) B-system to an E-system a functor?
\item Is this functor fully faithful?
\item Is there a simple way to characterize the E-systems that arise from B-systems (the image of this functor on objects)?
\item Construct an example of an E-system that does not arise from a B-system.
\end{itemize}

\subsection{The functor from B-systems to E-systems}
Consider a B-system $\mathbb{B}$. We will construct an E-system $E(\mathbb{B})$
in the category of sets. This E-systems consists of sets $C(\mathbb{B})$,
$F(\mathbb{B})$ and $T(\mathbb{B})$ for the sorts of contexts, families and
terms respectively, with functions $\eft:F(\mathbb{B})\to C(\mathbb{B})$ and
$\ebd:T(\mathbb{B})\to T(\mathbb{B})$ and the operations of extension,
weakening, units, substitution and empty contexts and families.

The set $C(\mathbb{B})$ consists of pairs $(n,X)$, where $n\in\mathbb{N}$ and
$X\in B_n$. The set $F(\mathbb{B})$ consists of quadruples $(n,X,m,Y)$, where
$n,m\in\mathbb{N}$ such that $n<m$, $X\in B_n$ and $Y\in B_{m}$ such that
$ft^{m-n}:=ft^{n-1}\circ\cdots\circ ft^m(Y)=X$.

%\include{Derivations/article-models-ttderived}

%\part{Internal Models}\label{part:models}

%\include{Internal_models/article-models-ttinternal}

%\part{Type constructors}

%\include{Dependent_function_types/article-models-ttdp}

%\include{Universes/article-models-ttuniverses}

%\include{Junk/article-models-ttind}

%\part{Categorical semantics}

%\input{Algebras/article-models-cat}

\part{The new E-systems}
\end{comment}

\input{e-systems}

\input{internal_homs}

\input{compared}

\section{Type constructors in E-systems}

\begin{defn}
An E-system $\mathbb{E}$ is said to have $\Pi$-types, if 
\begin{enumerate}
\item for any 
$A\in\cat{F}/\Gamma$, there is an E-homomorphism
\begin{equation*}
\Pi_A : \mathbb{E}/\ctxext{\Gamma}{A}\to\mathbb{E}/\Gamma
\end{equation*}
For terms $g:Q$ in context $\ctxext{{\Gamma}{A}}{P}$, we will usually write
$\lambda_{A}(g)$ for the term $\Pi_A(g)$ of $\Pi_A(Q)$ in context
$\ctxext{\Gamma}{\Pi_A(P)}$. Note that when $P$ is empty, then we retrieve the
usual lambda-abstraction.
\item for any $A\in\cat{F}/\Gamma$ and $Q\in\cat{F}/\ctxext{{\Gamma}{A}}{P}$, 
there is a term 
\begin{equation*}
\tfev^{A,Q} : \ctxwk{\Pi_A(Q)}{{\Pi_A(P)}{Q}}
\end{equation*}
in context $\ctxext{{{{\Gamma}{\Pi_A(P)}}{\Pi_A(Q)}}{\ctxwk{\Pi_A(\ctxext{P}{Q})}{A}}}{\ctxwk{\Pi_A(\ctxext{P}{Q})}{P}}$.
Note that for each $g:\Pi_A(Q)$, we obtain a term $\subst{g}{\tfev^{A,Q}}: \ctxwk{\Pi_A(P)}{Q}$ in
context $\ctxext{{\Gamma}{\Pi_A(P)}}{\ctxwk{\Pi_A(P)}{A}}$.
\item for any $A\in\cat{F}/\Gamma$ there is a term
\begin{equation*}
{\tfev^{A,P}} : {\ctxwk{\Pi_A(P)}{P}}
\end{equation*}
in context ${\ctxext{{\Gamma}{\Pi_A(P)}}{\ctxwk{\Pi_A(P)}{A}}}$
\end{enumerate}
satisfying
\begin{enumerate}
\item 
\begin{enumerate}
\item For any $P\in\cat{F}/\ctxext{\Gamma}{A}$ one has
\begin{equation*}
\Pi_{\ctxext{A}{P}} \jdeq \Pi_A\circ \Pi_P
\end{equation*}
\item For any $Q\in\cat{F}/\ctxext{{\Gamma}{A}}{P}$, one has
\begin{equation*}
{\evtm{\ctxext{A}{P}}{Q}}
  \jdeq
{\subst{\evtm{A}{\mprd{P}{Q}}}{\ctxwk{\mprd{A}{\mprd{P}{Q}}}{\evtm{P}{Q}}}}
\end{equation*}
\end{enumerate}
\item 
\begin{enumerate}
\item For any $\Gamma\in\mathbb{E}$, one has
\begin{equation*}
\Pi_{\catid{\Gamma}}\jdeq \catid{\mathbb{E}/\Gamma}.
\end{equation*}
\item For any $A\in\mathbb{F}/\Gamma$, one has
\begin{equation*}
\tfev^{\catid{\Gamma},A} \jdeq \tfid{A}
\end{equation*}
\end{enumerate}
\item for any term $f:P$ in context $\ctxext{\Gamma}{A}$, one has
\begin{equation*}
\subst{\lambda_A(f)}{\tfev^{A,P}}\jdeq f.
\end{equation*}
\end{enumerate}
\end{defn}

\begin{rmk}
The evaluation term determines a term
\begin{equation*}
\tilde\tfev^{A,P} : \thom{\ctxwk{A}{\Pi_A(P)}}{P}
\end{equation*}
\end{rmk}

\begin{defn}
A $\Pi$E-homomorphism from $\mathbb{E}$ to $\mathbb{E}'$ is an E-homomorphism
$H:\mathbb{E}\to\mathbb{E}'$ such that
\begin{enumerate}
\item for any $A\in\cat{F}/\Gamma$, one has
\begin{equation*}
\begin{tikzcd}[column sep=large]
\cat{F}/\ctxext{\Gamma}{A} \arrow[d,swap,"\Pi_A"] \arrow[r,"H/\ctxext{\Gamma}{A}"] & \cat{F}'/\ctxext{H(\Gamma)}{H(A)} \arrow[d,"\Pi_{H(A)}"] \\
\cat{F}/\Gamma \arrow[r,swap,"H/\Gamma"] & \cat{F}'/F(\Gamma)
\end{tikzcd}
\end{equation*}
\item For any $P\in\cat{F}/\ctxext{\Gamma}{A}$, one has
\begin{equation*}
H(\tfev^{A,P})\jdeq \tfev^{H(A),H(P)}
\end{equation*}
\end{enumerate}
\end{defn}

\bibliographystyle{plain}
%\phantomsection\addcontentsline{toc}{section}{References}
\bibliography{References/refs}

\end{document}
