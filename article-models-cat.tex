\section{E-objects in categories with finite limits}
In this section we assume that $\cat{C}$ is a finitely complete category and
whenever we write a pullback, we assume that it is chosen. Recall that for
any morphism $f:A\to B$ in a category $\cat{C}$ with chosen pullbacks, there
is a functor
\begin{equation*}
f^\ast : \cat{C}/B\to\cat{C}/A.
\end{equation*}
As usual, when $g:X\to B$ is a morphism, we will write $f^\ast(X)$ for the
domain of $f^\ast(g)$. When there is more than one morphism $X\to B$ involved,
as will be the case below, we will write $A\times_{f,g}X$. The projections
will be written as $\pi_1^{f,g}$ and $\pi_2^{f,g}$. So in this notation, a
typical pullback diagram has the following form:
\begin{equation*}
\begin{tikzcd}[column sep=large]
\pullback{A}{X}{f}{g}
  \ar{r}{\pullbackpr{1}{f}{g}}
  \ar{d}[swap]{\pullbackpr{2}{f}{g}}
  &
A \ar{d}{f}
  \\
X \ar{r}[swap]{g}
  &
B
\end{tikzcd}
\end{equation*}

\subsection{Extension objects}
\begin{defn}
An extension object $\stesys$ in $\cat{C}$ consists of objects $\esysc{\stesys}$, $\esysf{\stesys}$ and $\esyst{\stesys}$ and the
following morphisms:
\begin{align*}
\eft &:\stesysf \to \stesysc\\
\ebd &:\stesyst\to \stesysf\\
\ectxext &:\stesysf\to \stesysc\\
\efamext & :\stesysff\to \stesysf
\end{align*}
for which the following diagrams commute:
\begin{equation*}
\begin{tikzcd}
\stesysff 
  \ar{r}{\efamext} 
  \ar{d}[swap]{\pullbackpr{1}{\ectxext}{\eft}} 
  & 
\stesysf 
  \ar{d}{\eft}
  \\
\stesysf
  \ar{r}[swap]{\eft} 
  & 
\stesysc
\end{tikzcd}
\end{equation*}
\begin{equation*}
\begin{tikzcd}
\stesysff 
  \ar{d}[swap]{\pullbackpr{2}{\ectxext}{\eft}} 
  \ar{r}{\efamext} 
  & 
\stesysf 
  \ar{d}{\ectxext}
  \\
\stesysf 
  \ar{r}[swap]{\ectxext} 
  & 
\stesysc
\end{tikzcd}
\end{equation*}
\begin{equation*}
\begin{tikzcd}
\pullback{\stesysff}{\stesysff}{\efamext}{\pullbackpr{1}{\ectxext}{\eft}} 
  \ar{d}[swap]{\pullbackpr{2}{\efamext}{\pullbackpr{1}{\ectxext}{\eft}}}
  \ar{r}{\alpha}
  & 
\stesysff 
  \ar{d}{\efamext} 
  \\
\stesysff 
  \ar{r}{\efamext} 
  &
\stesysf
\end{tikzcd}
\end{equation*}
where $\alpha$ is the unique map which fits in the diagram
\begin{equation*}
\begin{tikzcd}
\pullback{\stesysff}{\stesysff}{\efamext}{\pullbackpr{1}{\ectxext}{\eft}}
  \ar[dotted]{dr}{\alpha}
  \ar{rr}{\pullbackpr{2}{\efamext}{\pullbackpr{1}{\ectxext}{\eft}}}
  \ar{dd}[swap]{\pullbackpr{1}{\efamext}{\pullbackpr{1}{\ectxext}{\eft}}}
  & 
  &
\stesysff
  \ar{d}{\efamext}
  \\
  &
\stesysff
  \ar{d}[swap]{\pullbackpr{1}{\ectxext}{\eft}}
  \ar{r}{\pullbackpr{2}{\ectxext}{\eft}}
  &
\stesysf
  \ar{d}{\eft}
  \\
\stesysff
  \ar{r}[swap]{\pullbackpr{1}{\ectxext}{\eft}}
  &
\stesysf
  \ar{r}[swap]{\ectxext}
  &
\stesysc
\end{tikzcd}
\end{equation*}
\end{defn}

\begin{defn}
An extension homomorphism $f:CFT\to CFT'$ consists of
\begin{align*}
f_0 & : C\to C'\\
f_1 & : F\to F'\\
f_2 & : T\to T'\\
\end{align*}
for which the squares
\begin{equation*}
\begin{tikzcd}
F \ar{d}[swap]{\eft} \ar{r}{f_1} & F' \ar{d}{c'}\\
C \ar{r}[swap]{f_0} & C'
\end{tikzcd}
\end{equation*}
\begin{equation*}
\begin{tikzcd}
F \ar{d}[swap]{e_0} \ar{r}{f_1} & F' \ar{d}{e_0'}\\
C \ar{r}[swap]{f_0} & C'
\end{tikzcd}
\end{equation*}
\begin{equation*}
\begin{tikzcd}
F\times_{e_0,c} F \ar{d}[swap]{e_1} \ar{r}{e_0^\ast(f_1)} & F'\times_{e_0',c'}F' \ar{d}{e_1'}\\
F \ar{r}[swap]{f_1} & F'
\end{tikzcd}
\end{equation*}
commute.
\end{defn}

\begin{defn}
Suppose $CFT$ is an extension object of $\cat{C}$. Then we define the extension object
$\mathbf{F}_{CFT}$ to consist of the objects $F$, $F\times_{e_0,c} F$, $F\times_{e_0,t\circ c} T$
with the operations
\begin{align*}
\pi_2^{e_0,c} & : F\times_{e_0,c} F\to F\\
e_0^\ast(t) & : F\times_{e_0,t\circ c} T\to F\times_{e_0,c} F\\
e_1 & : F\times_{e_0,c} F\to F\\
e_0^\ast(e_1) & : F\times_{e_1,\pi_2^{e_0,c}}(F\times_{e_0,c} F)\to F\times_{e_1,\pi_2^{e_0,c}} F
\end{align*}
\end{defn}

It requires proof that this is indeed an extension object of $\cat{C}$. However, the above
construction is a special case of the following construction of new extension objects out
of old ones with $\catid{\eft}:C\rightarrow C\leftarrow F:e_0$. Thus we postpone the proof
that we have an extension object to the more general case. 

\begin{defn}
Suppose $CFT$ is an extension object of $\cat{C}$ and that $f:C\rightarrow X\leftarrow D:g$.
Then we define the extension object $D\times_{g,f} CFT$ to consist of the objects $D\times_{g,f} C$,
$D\times_{g,f\circ c} F$, $D\times_{g,t\circ f\circ c} T$ and the operations
\begin{align*}
g^\ast(c) & : D\times_{g,f\circ c} F\to D\times_{g,f} C\\
g^\ast(t) & : D\times_{g,f\circ c\circ t} T\to D\times_{g,f\circ c} F\\
g^\ast(e_0) & : D\times_{g,f\circ c} F\to D\times_{g,f} C\\
g^\ast(e_1) & : (D\times_{g,f\circ c} F) \times_{g^\ast(e_0),g^\ast(c)} (D\times_{g,f\circ c} F)\to D\times_{g,f\circ c} F.
\end{align*}
The process of obtaining the extension object $D\times_{g,f} CFT$ out of $CFT$
and $g:D\to X$ is also called the \emph{change of base}.
\end{defn}

\begin{proof}
First we need to verify that the square
\begin{equation*}
\begin{tikzcd}
(D\times_{g,f\circ c} F) \times_{g^\ast(e_0),g^\ast(c)} (D\times_{g,f\circ c} F)
  \ar{r}{g^\ast(e_1)} 
  \ar{d}[swap]{(g^\ast(e_0))^\ast(g^\ast(c))} 
  & 
D\times_{g,f\circ c} F
  \ar{d}{g^\ast(c)}
  \\
D\times_{g,f\circ c} F
  \ar{r}[swap]{g^\ast(c)} 
  & 
D\times_{g,f} C
\end{tikzcd}
\end{equation*}
commutes. To see this, note that we have a commutative diagram
\begin{equation*}
\begin{tikzcd}
D\times_{g,f\circ c\circ \pi_2^{e_0,c}}(F\times_{e_0,c} F)  
  \ar[bend right=10]{ddr}[swap]{g^\ast(\pi_2^{e_0,c})}
  \ar[bend left=10]{drr}{g^\ast(e_1)}
  \ar{dr}{\simeq}
  \\
  {}
  &
(D\times_{g,f\circ c} F)\times_{g^\ast(e_0),g^\ast(c)}(D\times_{g,f\circ c} F)
  \ar{r}[swap]{g^\ast(e_1)}
  \ar{d}{(g^\ast(e_0))^\ast(g^\ast(c))}
  &
  D\times_{g,f\circ c} F
  \\
  {}
  &
D\times_{g,f\circ c} F
  &
{}
\end{tikzcd}
\end{equation*}
where the downwards arrow is an isomorphism. Using this observation, we see that
it is equivalent to show that the square
\begin{equation*}
\begin{tikzcd}
D\times_{g,f\circ c\circ \pi_2^{e_0,c}}(F\times_{e_0,c} F)
  \ar{r}{g^\ast(e_1)} 
  \ar{d}[swap]{g^\ast(\pi_2^{e_0,c})} 
  & 
D\times_{g,f\circ c} F
  \ar{d}{g^\ast(c)}
  \\
D\times_{g,f\circ c} F
  \ar{r}[swap]{g^\ast(c)} 
  & 
D\times_{g,f} C
\end{tikzcd}
\end{equation*}
commutes. But this is just a pullback along $g$ of a square which commutes by assumption.
\end{proof}

\subsection{Homomorphisms of extension objects}
\begin{defn}
Let $CFT$ and $CFT'$ be extension algebras. An extension homomorphism from 
$CFT$ to $CFT'$ is a triple $(f_0,f_1,f_2)$ consisting of morphisms
\begin{equation*}
\begin{tikzcd}
T 
  \ar{r}{f_2}
  \ar{d}{t}
  &
T'
  \ar{d}{t'}
  \\
F 
  \ar{r}{f_1}
  \ar{d}{\eft}
  &
F'
  \ar{d}{c'}
  \\
C 
  \ar{r}{f_0}
  &
C'
\end{tikzcd}
\end{equation*}
such that the indicated squares commute, for which furthermore the squares
\begin{equation*}
\begin{tikzcd}
F \ar{r}{f_1}
  \ar{d}[swap]{\epsilon_0}
  &
F'
  \ar{d}{\epsilon_0'}
  \\
C \ar{r}[swap]{f_0}
  &
C'
\end{tikzcd}
\end{equation*}
and
\begin{equation*}
\begin{tikzcd}[column sep=large]
F\times_{\epsilon_0,c} F
  \ar{r}{f_1\times_{\epsilon_0,c} f_1}
  \ar{d}[swap]{\epsilon_1}
  &
F'\times_{\epsilon_0',c'} F'
  \ar{d}{\epsilon_1'}
  \\
F \ar{r}[swap]{f_1}
  &
F'
\end{tikzcd}
\end{equation*}
\end{defn}

\begin{lem}
Suppose $f:CFT\to CFT'$ is an extension morphism and consider a morphism
$C'\to X$ and $g:D\to X$. Then the change of base $g^\ast(f):g^\ast(CFT)\to
g^\ast(CFT')$ is an extension morphism.
\end{lem}

\subsection{Weakening objects}
\begin{defn}
A pre-weakening object $CFT$ in $\cat{C}$ is an extension object $CFT$ with 
an extension homomorphism $\mathbf{w}:F\times\mathbf{F_{CFT}}\to \mathbf{F_{F_{CFT}}}$.
\end{defn}

\begin{comment}
\begin{align*}
w_0 & : F\times F\to F\times_{e_0,c} F\\
w_1 & : F\times(F\times_{e_0,c} F) \to F\times_{e_0,c \circ \pi_2^{e_0,c}} (F\times_{e_0,c}F)\\
w_2 & : F\times(F\times_{e_0,t\circ c} T) \to F\times_{e_0,c}(F\times_{e_0,t\circ c} T)
\end{align*}
for which the following diagrams commute:
\begin{equation*}
\begin{tikzcd}
F\times F \ar{r}{w_0} \ar{dr}[swap]{\pi_1} & F\times_{e_0,c}F \ar{d}{\pi_2^{e_0,c}}\\
& F
\end{tikzcd}
\end{equation*}
\begin{equation*}
\begin{tikzcd}
F\times(F\times_{e_0,c} F) 
  \ar{d}[swap]{\catid{F}\times \pi_2^{e_0,c}}
  \ar{r}{w_1}
  &
F\times_{e_0,c\circ \pi_2^{e_0,c}} (F\times_{e_0,c}F)
  \ar{d}{e_0^\ast(\pi_2^{e_0,c})}
  \\
F\times F
  \ar{r}[swap]{w_0}
  &
F\times_{e_0,c} F
\end{tikzcd}
\end{equation*}
\begin{equation*}
\begin{tikzcd}
F\times(F\times_{e_0,t\circ c} T)
  \ar{r}{w_2}
  \ar{d}[swap]{\catid{F}\times e_0^\ast(t)}
  &
F\times_{e_0,c}(F\times_{e_0,t\circ c} T)
  \ar{d}{e_0^\ast(e_0^\ast(t))}
  \\
F\times(F\times_{e_0,c} F)
  \ar{r}[swap]{w_1}
  &
F\times_{e_0,c\circ \pi_2^{e_0,c}} (F\times_{e_0,c}F)
\end{tikzcd}
\end{equation*}
\end{comment}

\begin{defn}
A pre-weakening morphism between preweakening objects $CFT$ and $CFT'$ is an
extension homomorphism $f:CFT\to CFT'$ such that additionally the diagram
\begin{equation*}
\begin{tikzcd}
F\times \mathbf{F}_{CFT}
  \ar{d}[swap]{\mathbf{w}}
  \ar{r}{f_1\times\mathbf{F}_f}
  &
F'\times\mathbf{F}_{CFT'}
  \ar{d}{\mathbf{w'}}
  \\
\mathbf{F}_{\mathbf{F}_{CFT}}
  \ar{r}[swap]{\mathbf{F}_{\mathbf{F}_f}}
  &
\mathbf{F}_{\mathbf{F}_{CFT'}}
\end{tikzcd}
\end{equation*}
commutes
\end{defn}

\subsection{Projection objects}
\begin{defn}
A pre-projection object is a weakening object $CFT$ for which there is a term
$\mathbf{i}:F\to F\times_{e_0,c}T$ such that the diagram
\begin{equation*}
\begin{tikzcd}
{} & F\times_{e_0,c}T \ar{d}{F\times_{e_0,c}t}\\
F \ar{ur}{\mathbf{i}} \ar{r}[swap]{w_0\circ\Delta} & F\times_{e_0,c}F
\end{tikzcd}
\end{equation*}
commutes. In this diagram $\Delta:F\to F\times F$ is the diagonal.
\end{defn}

\begin{defn}
A pre-projection homomorphism from $CFT$ to $CFT'$ is a weakening homomorphism
$f:CFT\to CFT'$ such that the square
\begin{equation*}
\begin{tikzcd}[column sep=large]
F\times_{e_0,c}T
  \ar{r}{f_1\times_{e_0,c}f_2}
  &
F'\times_{e_0',c'}T'
  \\
F \ar{r}[swap]{f_1}
  \ar{u}{\mathbf{i}}
  &
F'
  \ar{u}[swap]{\mathbf{i}'}
\end{tikzcd}
\end{equation*}
\end{defn}

\begin{lem}
The change of base of a pre-projection object is again a pre-projection object.
\end{lem}

\begin{lem}
If $CFT$ is a pre-projection object, then so is $\mathbf{F}_{CFT}$, where
$\mathbf{F}_{\mathbf{i}}$ is defined to be $F\times_{e_0,c}\mathbf{i}$ is
a pre-projection algebra.
\end{lem}

\begin{defn}
A projection algebra is a pre-projection algebra for which weakening is a
pre-projection homomorphism.
\end{defn}

\begin{cor}
The change of base of a projection object is again a projection object.
\end{cor}

\begin{cor}
If $CFT$ is a projection object, then so is $\mathbf{F}_{CFT}$, where
$\mathbf{F}_{\mathbf{i}}$ is defined to be $F\times_{e_0,c}\mathbf{i}$ is
a projection algebra.
\end{cor}

\subsection{Substitution objects}

\begin{defn}
A pre-substitution object is an extension object for which the is an
extension homomorphism
\begin{equation*}
\mathbf{s}:T\times\mathbf{F}_{\mathbf{F}_{CFT}}\to \mathbf{F}_{CFT}
\end{equation*}
such that the square
\begin{equation*}
\begin{tikzcd}
T\times(F\times_{e_0,c}F)
  \ar{r}{s_0}
  \ar{d}[swap]{\pi_1(e_0,c)\circ\pi_2}
  &
F \ar{d}{\eft}
  \\
F \ar{r}[swap]{\eft}
  &
C
\end{tikzcd}
\end{equation*}
commutes.
\end{defn}

\begin{defn}
A pre-substitution homomorphism is an extension homomorphism $f:CFT\to CFT'$
such that the square
\begin{equation*}
\begin{tikzcd}
T\times\mathbf{F}_{\mathbf{F}_{CFT}}
  \ar{r}{f_2\times\mathbf{F}_{\mathbf{F}_f}}
  \ar{d}[swap]{\mathbf{s}}
  &
T'\times\mathbf{F}_{\mathbf{F}_{CFT'}}
  \ar{d}{\mathbf{s}'}
  \\
\mathbf{F}_{CFT}
  \ar{r}[swap]{\mathbf{F}_f}
  &
\mathbf{F}_{CFT'}
\end{tikzcd}
\end{equation*}
\end{defn}

\begin{lem}
The change of base of a pre-substitution object is again a pre-substitution object.
\end{lem}

\begin{lem}
If $CFT$ is a pre-substitution object, then so is $\mathbf{F}_{CFT}$ with
$\mathbf{F}_{\mathbf{s}}=...$.
\end{lem}

\begin{defn}
A substitution object is a pre-substitution object for which substitution is
a pre-substitution homomorphism.
\end{defn}

\begin{cor}
The change of base of a substitution object is again a substitution object.
\end{cor}

\begin{cor}
If $CFT$ is a substitution object, then so is $\mathbf{F}_{CFT}$.
\end{cor}

\subsection{E-objects}
\begin{defn}
An E-object is an extension object with the structure of a projection object,
the structure of a substitution object and which has an empty context and families,
such that additionally:
\begin{enumerate}
\item substitution is a projection homomorphism
\item weakening is a substitution homomorphism
\item both weakening and substitution are empty-CF homomorphisms.
\item 
\end{enumerate}
\end{defn}
