\documentclass[handout]{beamer}
\setbeamercolor{frametitle}{fg=teal!90!black}
\setbeamercolor{item}{fg=red!90!black}
\setbeamercolor{title}{fg=teal!90!black}
\setbeamercolor{block title}{fg=teal!90!black}

\input{preamble-articles}

\title{\bf An algebraic formulation of dependent type theory}
\author{Egbert Rijke}
\institute{Carnegie Mellon University}
\date{November 7th -- 10th, 2014}

\newcommand\subgoal[1]{\begin{huge}\begin{center}\textbf{Subgoal: {\color{teal!90!black}#1}}\end{center}\end{huge}}
\newcommand\important[1]{\textbf{\color{red!90!black}#1}}

\begin{document}

\begin{frame}
\titlepage
\end{frame}

\begin{frame}
\frametitle{\bf Goal and acknowledgements}
We will give an essentially algebraic theory of type dependency. Thus, we will
do two things:
\begin{itemize}
\item Give a syntactic description of the theory in the usual style of
name-free type theory.
\item Define the corresponding algebraic objects in a category with finite limits.
\end{itemize}
\pause
People unfamiliar with type theory should get out of this presentation 
a sense of what dependent type theory is.
\\[\baselineskip]
\pause
For many insights in the current presentation I am grateful to
\begin{itemize}
\item Vladimir Voevodsky
\item Richard Garner
\item Steve Awodey
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{\bf Desired properties of the algebraic theory}
\begin{itemize}
\item Finitely many sorts. The basic ingredients are contexts, families and
terms. Thus there will be 3 sorts.
\pause
\item The theory is algebraic and the operations on it are homomorphisms. The
wish that operations are homomorphisms tells which judgmental equalities to
require.
\pause
\item Finite set of rules. The theory is invariant under slicing as a consequence, rather than by
convention. There will be no rule schemes.
\pause
\item The theory is capable of interpreting itself. Investigations to internal
models of type theory originally motivated me to write type theory this way.
\pause
\item The meta-theory should not require anything more than rules for handling
inferences. In particular, natural numbers should not be required.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{\bf Overview of the theories}
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=0em]
{} \& \textbf{Extension} \ar[very thick,-stealth]{dr} \ar[very thick,-stealth]{d} \ar[very thick,-stealth]{dl}
  \\
\textbf{Weakening} \ar[very thick,-stealth]{d} \& \textbf{Substitution} \ar[very thick,-stealth]{dd} \& \makebox[3cm]{\textbf{Empty context and families}} \ar[very thick,-stealth]{ddl}
\\
\textbf{Projection} \ar[very thick,-stealth]{dr}
\\
{} \& \textbf{Dependent Type Theory}
\end{tikzcd}
\end{equation*}
\\[2em]
\pause
The theories of weakening (and projections), substitution and the empty context and families are formulated as three independent theories on top of the theory of extension.
\end{frame}

\begin{frame}
\frametitle{\bf The basic judgments}
\begin{align*}
\jalign\jctx{\Gamma} 
& \jalign\jctxeq{\Gamma}{\Gamma'}
  \\
\jalign\jfam{\Gamma}{A} 
& \jalign\jfameq{\Gamma}{A}{B}
  \\
\jalign\jterm{\Gamma}{A}{a} 
& \jalign\jtermeq{\Gamma}{A}{a}{y}.
\end{align*}
\\[\baselineskip]
There are rules expressing that all three kinds of judgmental equality are
convertible equivalence relations.

\pause
An example of a conversion rule:
\begin{align*}
& \inference
  { \jctxeq{\Gamma}{\Delta}
    \jfam{\Gamma}{A}
    }
  { \jfam{\Delta}{A}
    }
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jfameq{\Gamma}{A}{B}
      }
    { \jfameq{\Delta}{A}{B}
      }
\end{align*}
\end{frame}

\begin{comment}
\begin{frame}
\frametitle{\bf Rules: judgmental equality is an equivalence relation}
\begin{footnotesize}
\begin{align*}
& \inference
  { \jctx{\Gamma}
    }
  { \jctxeq{\Gamma}{\Gamma}
    } 
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      }
    { \jctxeq{\Delta}{\Gamma}
      } 
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jctxeq{\Delta}{\greek{E}}
      }
    { \jctxeq{\Gamma}{\greek{E}}
      }
    \\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{A}{A}
    } 
& & \inference
    { \jfameq{\Gamma}{A}{B}
      }
    { \jfameq{\Gamma}{B}{A}
      }
& & \inference
    { \jfameq{\Gamma}{A}{B}
      \jfameq{\Gamma}{B}{C}
      }
    { \jfameq{\Gamma}{A}{C}
      }
    \\
& \inference
  { \jterm{\Gamma}{A}{a}
    }
  { \jtermeq{\Gamma}{A}{a}{a}
    }
& & \inference
    { \jtermeq{\Gamma}{A}{a}{y}
      }
    { \jtermeq{\Gamma}{A}{y}{a}
      }
& & \inference
    { \jtermeq{\Gamma}{A}{a}{y}
      \jtermeq{\Gamma}{A}{y}{z}
      }
    { \jtermeq{\Gamma}{A}{a}{z}
      }
\end{align*}
\begin{align*}
& \inference
  { \jctxeq{\Gamma}{\Delta}
    \jfam{\Gamma}{A}
    }
  { \jfam{\Delta}{A}
    }
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jfameq{\Gamma}{A}{B}
      }
    { \jfameq{\Delta}{A}{B}
      }
    \\
& \inference
  { \jctxeq{\Gamma}{\Delta}
    \jterm{\Gamma}{A}{a}
    }
  { \jterm{\Delta}{A}{a}
    }
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jtermeq{\Gamma}{A}{a}{y}
      }
    { \jtermeq{\Delta}{A}{a}{y}
      }
    \\
& \inference
  { \jfameq{\Gamma}{A}{B}
    \jterm{\Gamma}{A}{a}
    }
  { \jterm{\Gamma}{B}{a}
    }
& & \inference
    { \jfameq{\Gamma}{A}{B}
      \jtermeq{\Gamma}{A}{a}{y}
      }
    { \jtermeq{\Gamma}{B}{a}{y}
      }
\end{align*}
\end{footnotesize}
\end{frame}
\end{comment}

\begin{frame}
\frametitle{\bf The fundamental structure of E-systems}
The \important{fundamental structure of an E-system $\stesys$} in a category with finite limits consists of
\begin{equation*}
\begin{tikzcd}
\stesyst
  \ar{d}{\ebd}
  \\
\stesysf
  \ar{d}{\eft}
  \\
\stesysc
\end{tikzcd}
\end{equation*}
\pause
\begin{itemize}
\item The object $\stesysc$ represents the sort of contexts.
\pause
\item The object $\stesysf$ represents the sort of families.
\pause
\item Every family has a context, this is represented by $\eft:\stesysf\to\stesysc$.
\pause
\item The object $\stesyst$ represents the sort of terms.
\pause
\item Every term has a family associated to it, this is represented by
$\partial:\stesyst\to\stesysf$.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{\bf Rules for extension}
Introduction rules for \important{context extension}:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jctx{\ctxext{\Gamma}{A}}
    }
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jfameq{\Gamma}{A}{B}
      }
    { \jctxeq{\ctxext{\Gamma}{A}}{\ctxext{\Delta}{B}}
      }
\pause
\intertext{%
Introduction rules for \important{family extension}:}
& \inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfam{\Gamma}{\ctxext{A}{P}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{B} 
      \jfameq{{\Gamma}{A}}{P}{Q}
      }
    { \jfameq{\Gamma}{\ctxext{A}{P}}{\ctxext{B}{Q}}
      }
\end{align*}
\pause
\important{Extension is associative}:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{A}}{P}
    }
  { \jctxeq{\ctxext{{\Gamma}{A}}{P}}{\ctxext{\Gamma}{{A}{P}}}
    }
  \\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfameq{\Gamma}{\ctxext{A}{{P}{Q}}}{\ctxext{{A}{P}}{Q}}
    }
\end{align*}
\end{frame}

\begin{frame}
\frametitle{\bf Pre-extension algebras}
A \important{pre-extension algebra $\stesys$} in a category with finite limits consists
\begin{itemize}
\item a fundamental structure $\stesys$, and
\item context extension and family extension operations
\end{itemize}
\begin{align*}
\ectxext% 
  &%
: \stesysf \to \stesysc%
  \\
\efamext% 
  &%
: \stesysff \to \stesysf,%
\end{align*}
implementing the introduction rules
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jctx{\ctxext{\Gamma}{A}}
    }
& & \inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfam{\Gamma}{\ctxext{A}{P}}
    }
\end{align*}
Thus, we will additionally require that we have a commuting diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesysff 
  \ar{r}{\efamext} 
  \ar{d}[swap]{\pullbackpr{1}{\ectxext}{\eft}} 
  \& 
\stesysf 
  \ar{d}{\eft}
  \\
\stesysf
  \ar{r}[swap]{\eft} 
  \& 
\stesysc
\end{tikzcd}
\end{equation*}
\end{frame}

\begin{frame}
\frametitle{\bf Notation for pre-extension algebras}
We introduce the following notation:
\begin{align*}
\stesysf_2 
  & := \stesysff
  \pause
  \\
\eft[2] 
  & := \pullbackpr{1}{\ectxext}{\eft} : \stesysf_2\to\stesysf
  \pause
  \\
\stesysf_3 & := \pullback{\stesysf_2}{\stesysf_2}{\efamext}{\eft[2]}
  \pause
  \\
\eft[3]
  & := \pullbackpr{1}{\efamext}{\eft[2]} : \stesysf_3\to\stesysf_2.
\end{align*}
\pause
Then it follows that the outer square in the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\stesysf_3
  \ar[dotted]{dr}{\eext{2}}
  \ar{rr}{\pullback{\pullbackpr{2}{\ectxext}{\eft}}{\pullbackpr{2}{\ectxext}{\eft}}{\ectxext}{\eft}}
  \ar{dd}[swap]{\eft[3]}
  \& 
  \&
\stesysf_2
  \ar{d}{\efamext}
  \\
  \&
\stesysf_2
  \ar{d}[swap]{\eft[2]}
  \ar{r}{\pullbackpr{2}{\ectxext}{\eft}}
  \&
\stesysf
  \ar{d}{\eft}
  \\
\stesysf_2
  \ar{r}[swap]{\eft[2]}
  \&
\stesysf
  \ar{r}[swap]{\ectxext}
  \&
\stesysc
\end{tikzcd}
\end{equation*}
commutes. \pause
We define \important{$\eext{2}$} to be the unique morphism rendering the above diagram
commutative. 
\end{frame}

\begin{frame}
\frametitle{\bf Extension algebras}
An \important{extension algebra} is a pre-extension algebra $\stesys$ for which 
the diagrams
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesysf_2 
  \ar{d}[swap]{\pullbackpr{2}{\ectxext}{\eft}} 
  \ar{r}{\efamext} 
  \& 
\stesysf 
  \ar{d}{\ectxext}
  \\
\stesysf 
  \ar{r}[swap]{\ectxext} 
  \& 
\stesysc
\end{tikzcd}
\qquad
\begin{tikzcd}[ampersand replacement=\&]
\stesysf_3
  \ar{d}[swap]{\pullbackpr{2}{\efamext}{\eft[2]}}
  \ar{r}{\eext{2}}
  \& 
\stesysf_2 
  \ar{d}{\efamext} 
  \\
\stesysf_2 
  \ar{r}[swap]{\efamext} 
  \&
\stesysf
\end{tikzcd}
\end{equation*}
commute.
\\[\baselineskip]
\begin{itemize}
\item These diagrams implement associativity of extension.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Subgoal: develop properties of extension algebras}
We need to know:
\begin{itemize}
\item What homomorphisms of (pre-)extension algebras are.
\pause
\item That each extension algebra gives locally an extension algebra (stable under slicing).
\pause
\item That the change of base of an extension is an extension algebra. Change of base allows
for \important{`parametrized extension homomorphisms'} of which weakening and substitution
are going to be examples.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{\bf Pre-extension homomorphisms}
\begin{footnotesize}
Let $\stesys$ and $\stesys'$ be pre-extension algebras. A \important{pre-extension 
homomorphism $f$ from $\stesys'$ to $\stesys$} is a triple $(f_0,f_1,f^t)$ 
consisting of morphisms
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesyst' 
  \ar{r}{f^t}
  \ar{d}[swap]{\ebd'}
  \&
\stesyst
  \ar{d}{\ebd}
  \\
\stesysf'
  \ar{r}{f_1}
  \ar{d}[swap]{\eft'}
  \&
\stesysf
  \ar{d}{\eft}
  \\
\stesysc' 
  \ar{r}[swap]{f_0}
  \&
\stesysc
\end{tikzcd}
\end{equation*}
such that the indicated squares commute, for which furthermore the squares
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesysf' 
  \ar{r}{f_1}
  \ar{d}[swap]{\ectxext'}
  \&
\stesysf
  \ar{d}{\ectxext}
  \\
\stesysc'
  \ar{r}[swap]{f_0}
  \&
\stesysc
\end{tikzcd}
\quad
\text{and}
\quad
\begin{tikzcd}[ampersand replacement=\&,column sep=huge]
\stesysf_2'
  \ar{r}{f_1\times_{\ectxext,\eft} f_1}
  \ar{d}[swap]{\efamext'}
  \&
\stesysf_2
  \ar{d}{\efamext}
  \\
\stesysf'
  \ar{r}[swap]{f_1}
  \&
\stesysf
\end{tikzcd}
\end{equation*}
commute.
\end{footnotesize}
\end{frame}

\begin{frame}
\frametitle{Extension homomorphisms}
\begin{definition}
A pre-extension homomorphism between extension algebras is called an \important{extension
homomorphism}.
\end{definition}
\end{frame}

\begin{frame}
\frametitle{\bf Slicing of pre-extension algebras}
Suppose that $\stesys$ is a pre-extension algebra. Then we define
the pre-extension algebra \important{$\famesys{\stesys}$} to consist of the
fundamental structure
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesyst_2
  \ar{d}{\ebd[2]}
  \\
\stesysf_2
  \ar{d}{\eft[2]}
  \\
\stesysf
\end{tikzcd}
\end{equation*}
where
\begin{align*}
\stesyst_2 
  & := \pullback{\stesysf}{\stesyst}{\ectxext}{\eft\circ\ebd},
  &
\ebd[2]
  & := \ectxext^\ast(\ebd),
\end{align*}
with the extension operations
\begin{align*}
\efamext 
  & 
: \stesysf_2\to\stesysf,
  &
\eext{2} 
  & 
: \stesysf_3\to\stesysf_2.
\end{align*}
\end{frame}

\begin{frame}
\frametitle{\bf Local extension algebras}
\begin{theorem}
If $\stesys$ is an extension algebra, then so is $\famesys{\stesys}$.
\end{theorem}

\begin{lemma}
Let $\stesys$ be a pre-extension algebra. Then $\stesys$ is an extension
algebra if and only if we have the extension homomorphisms
$\mathbf{e}_0:\famesys{\stesys}\to\stesys$
and
$\mathbf{e}_1:\famesys{\famesys{\stesys}}\to\famesys{\stesys}$
given by
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=huge]
\stesyst_2
  \ar{r}{\pullbackpr{2}{\ectxext}{\eft\circ\ebd}}
  \ar{d}[swap]{\ebd[2]}
  \&
\stesyst
  \ar{d}{\ebd}
  \\
\stesysf_2
  \ar{r}{\pullbackpr{2}{\ectxext}{\eft}}
  \ar{d}[swap]{\eft[2]}
  \&
\stesysf
  \ar{d}{\eft}
  \\
\stesysf
  \ar{r}[swap]{\ectxext}
  \&
\stesysc
\end{tikzcd}
\qquad\text{and}\qquad
\begin{tikzcd}[ampersand replacement=\&,column sep=huge]
\stesyst_3
  \ar{r}{\pullbackpr{2}{\efamext}{\eft[2]\circ\ebd[2]}}
  \ar{d}[swap]{\ebd[3]}
  \&
\stesyst_2
  \ar{d}{\ebd[2]}
  \\
\stesysf_3
  \ar{r}{\pullbackpr{2}{\efamext}{\eft[2]}}
  \ar{d}[swap]{\eft[3]}
  \&
\stesysf_2
  \ar{d}{\eft[2]}
  \\
\stesysf_2
  \ar{r}[swap]{\efamext}
  \&
\stesysf
\end{tikzcd}
\end{equation*}
\end{lemma}
\end{frame}

\begin{frame}
\frametitle{\bf Mixed commutative diagrams}
Suppose $f:\stesys\to\stesys'$ is a pre-extension homomorphism. We say that
a diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesys
  \ar{r}{f}
  \ar{d}[swap]{p}
  \&
\stesys'
  \ar{d}{p'}
  \\
X \ar{r}[swap]{g}
  \&
Y
\end{tikzcd}
\end{equation*}
commutes if the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesysc
  \ar{r}{f_0}
  \ar{d}[swap]{p}
  \&
\stesysc'
  \ar{d}{p'}
  \\
X \ar{r}[swap]{g}
  \&
Y
\end{tikzcd}
\end{equation*}
commutes.
\end{frame}

\begin{frame}
\frametitle{\bf Change of base of pre-extension algebras}
Let $\stesys$ be a pre-extension algebra and consider $p:\stesysc\rightarrow X\leftarrow Y:g$.
Then there is a pre-extension algebra \important{$\cobesys{Y}{\stesys}{g}{p}$} with projections, such that for every diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\stesys'
  \ar[bend right=10]{ddr}[swap]{p'}
  \ar[bend left=10]{rrd}{f}
  \ar[dotted]{dr}[near end]{[p',f]}
  \\
  {}\&
\cobesys{Y}{\stesys}{g}{p}
  \ar{d}{\pullbackpr{1}{g}{p}}
  \ar{r}[swap]{\pullbackpr{2}{g}{p}}
  \&
\stesys
  \ar{d}{p}
  \\
  {}\&
Y \ar{r}[swap]{g}
  \&
X
\end{tikzcd}
\end{equation*}
of which the outer square commutes, the pre-extension homomorphism \important{$[p',f]$} exists
and is unique with the property that it renders the diagram commutative.
\end{frame}

\begin{frame}
\frametitle{\bf Change of base of extension algebras}
\begin{theorem}
The change of base of an extension algebra is again an extension algebra.
\end{theorem}

\begin{theorem}
Let $\stesys$ be a pre-extension algebra. Then
\begin{equation*}
\famesys{\famesys{\stesys}} \simeq \cobesys{\stesysf}{\famesys{\stesys}}{\ectxext}{\eft}.
\end{equation*}
\end{theorem}

\begin{theorem}
Let $\stesys$ be a pre-extension algebra and consider $p:\stesysc\rightarrow
X\leftarrow Y:g$. Then
\begin{equation*}
\famesys{\cobesys{Y}{\stesys}{g}{p}}\simeq
\cobesys{Y}{\famesys{\stesys}}{g}{p\circ\eft}.
\end{equation*}
\end{theorem}
\end{frame}

\begin{frame}
\frametitle{\bf Overview of the theory of weakening}
\begin{itemize}
\item In the syntax, we will introduce an operation for weakening which acts at the three
levels of fundamental structures (contexts, families and terms). \pause
\important{When $B$ is weakened by $A$, we denote this by $\ctxwk{A}{B}$.}
  \pause
\item Weakening will preserve extension, so it will be implemented as an extension
homomorphism.
  \pause
\item There will be a notion of \important{`Currying for weakening'}, which explains
what happens when something is weakened by an extended object.
  \pause
\item Pre-weakening algebras will be extension algebras with a weakening operation
satisfying an implementation of the currying condition. \pause Pre-weakening homomorphisms
will preserve this structure.
  \pause
\item Weakening will preserve itself, so weakening we will require that weakening is
a pre-weakening homomorphism.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{\bf Rules for the theory of weakening}
\begin{footnotesize}
The introduction rules for weakening:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    }
  { \jfam{{\Gamma}{A}}{\ctxwk{A}{B}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{A'}
      \jfameq{\Gamma}{B}{B'}
      }
    { \jfameq{{\Gamma}{A}}{\ctxwk{A}{B}}{\ctxwk{A'}{B'}}
      }
  \pause
  \\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    }
  { \jfam{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{A'}
      \jfameq{{\Gamma}{B}}{Q}{Q'}
      }
    { \jfameq
        {{{\Gamma}{A}}{\ctxwk{A}{B}}}
        {\ctxwk{A}{Q}}
        {\ctxwk{A'}{Q'}}
      }
    \\
& \inference
  { \jfam{\Gamma}{A}
    \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jterm{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}{\ctxwk{A}{g}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{A'}
      \jtermeq{{\Gamma}{B}}{Q}{g}{g'}
      }
    { \jtermeq
        {{{\Gamma}{A}}{\ctxwk{A}{B}}}
        {\ctxwk{A}{Q}}
        {\ctxwk{A}{g}}
        {\ctxwk{A'}{g'}}
      }
\end{align*}
\pause
Weakening preserves extension:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    }
  { \jfameq
      {\ctxext{\Gamma}{A}}
      {\ctxwk{A}{\ctxext{B}{Q}}}
      {\ctxext{\ctxwk{A}{B}}{\ctxwk{A}{Q}}}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{{\Gamma}{B}}{Q}}{R}
    }
  { \jfameq
      {\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}
      {\ctxwk{A}{\ctxext{Q}{R}}}
      {\ctxext{\ctxwk{A}{Q}}{\ctxwk{A}{R}}}
    }
\end{align*}
\end{footnotesize}
\end{frame}

\begin{frame}
\frametitle{\bf The weakening operation}
Let $\stesys$ be an extension algebra. A \important{weakening operation
on $\stesys$} is an extension homomorphism 
\begin{equation*}
\mathbf{w}(\stesys)
    :
  \cobesys{\stesysf}{\famesys{\stesys}}{\eft}{\eft}
    \to
  \famesys{\famesys{\stesys}}
\end{equation*}
for which the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\cobesys{\stesysf}{\famesys{\stesys}}{\eft}{\eft}
  \ar{r}{\mathbf{w}(\stesys)}
  \ar{dr}[swap]{\pullbackpr{1}{\eft}{\eft}}
  \&
\famesys{\famesys{\stesys}}
  \ar{d}{\eft[2]}
  \\
  {}\& 
\stesysf
\end{tikzcd}
\end{equation*}
commutes.
\end{frame}

\begin{frame}
\frametitle{\bf Rules for weakening: Currying}
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{A}}{P}
    \jfam{\Gamma}{B}
    }
  { \jfameq
      {{{\Gamma}{A}}{P}}
      {\ctxwk{\ctxext{A}{P}}{B}}
      {\ctxwk{P}{{A}{B}}}
    }
  \pause
\\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{A}}{P}
    \jfam{{\Gamma}{B}}{Q}
    }
  { \jfameq
      {{{{\Gamma}{A}}{P}}{\ctxwk{P}{{A}{B}}}}
      {\ctxwk{\ctxext{A}{P}}{Q}}
      {\ctxwk{P}{{A}{Q}}}
    }
\\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{A}}{P}
    \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jtermeq
      {{{{\Gamma}{A}}{P}}{\ctxwk{P}{{A}{B}}}}
      {\ctxwk{P}{{A}{Q}}}
      {\ctxwk{\ctxext{A}{P}}{g}}
      {\ctxwk{P}{{A}{g}}}
    } 
\end{align*}
\\[\baselineskip]
\pause
To express these rules algebraically, we need to define a weakening operation on
$\famesys{\stesys}$, provided we have one on $\stesys$.
\end{frame}

\begin{frame}
\frametitle{\bf Weakening for the families algebra}
Let $\stesys$ be an extension algebra with weakening operation
$\mathbf{w}(\stesys)$. Then $\famesys{\stesys}$ has the weakening operation
$\mathbf{w}(\famesys{\stesys})$ which is uniquely determined by rendering the
diagram
\begin{small}
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\cobesys{\stesysf_2}{\famesys{\famesys{\stesys}}}{\eft[2]}{\eft[2]}
  \ar{rr}{%
      \pullback{\beta_1}{\boldsymbol{\beta}}{\eft}{\eft}
    }
  \ar[bend right]{ddr}[swap]{\pullbackpr{1}{\eft[2]}{\eft[2]}}
  \ar[dotted]{dr}{\important{$\mathbf{w}(\famesys{\stesys})$}}
  \&
  {}\&
\cobesys{\stesysf}{\famesys{\stesys}}{\eft}{\eft}
  \ar{r}{\important{$\mathbf{w}(\stesys)$}}
  \&
\famesys{\famesys{\stesys}}
  \ar{d}{\boldsymbol{\beta}}
  \\
  {}\&
\famesys{\famesys{\famesys{\stesys}}}
  \ar{r}{\boldsymbol{\beta}_\mathbf{2}}
  \ar{d}[swap]{\eft[3]}
  \&
\famesys{\famesys{\stesys}}
  \ar{d}{\eft[2]}
  \ar{r}{\boldsymbol{\beta}}
  \&
\famesys{\stesys}
  \ar{d}{\eft}
  \\
  {}\&
\stesysf_2
  \ar{r}[swap]{\efamext}
  \&
\stesysf
  \ar{r}[swap]{\ectxext}
  \&
\stesysc
\end{tikzcd}
\end{equation*}
\end{small}
commutative.
\end{frame}

\begin{frame}
\frametitle{\bf Pre-weakening algebras}
A \important{pre-weakening algebra} is an extension algebra $\stesys$ 
with a weakening operation 
$ \mathbf{w}(\stesys)
    :
  \cobesys{\stesysf}{\famesys{\stesys}}{\eft}{\eft}
    \to
  \famesys{\famesys{\stesys}}$
for which the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=15em]
\cobesys{\stesysf_2}{\famesys{\stesys}}{\eft\circ\eft[2]}{\eft}
  \ar[bend right=10]{dr}[swap]%
    { [ \pullbackpr{1}{\eft\circ\eft[2]}{\eft},%
        \important{$
        \mathbf{w}(\stesys)%
          \circ%
        (\pullback{\efamext}{\catid{\famesys{\stesys}}}{\eft}{\eft})$}%
        ]%
      }
  \ar{r}{
    [ \pullbackpr{1}{\eft\circ\eft[2]}{\eft},%
      \important{$\mathbf{w}(\stesys)$}%
        \circ%
      (\pullback{\eft[2]}{\catid{\famesys{\stesys}}}{\eft}{\eft})%
      ]}%
  \&
\cobesys{\stesysf_2}{\famesys{\famesys{\stesys}}}{\eft[2]}{\eft[2]}
  \ar{d}{\important{$\mathbf{w}(\famesys{\stesys})$}}
  \\
  {}\&
\famesys{\famesys{\famesys{\stesys}}}
\end{tikzcd}
\end{equation*}
commutes (implementing currying for weakening).
\end{frame}

\begin{frame}
\frametitle{\bf Pre-weakening homomorphisms}
A \important{pre-weakening homomorphism} between pre-weakening algebras $\stesys'$ and $\stesys$ is an
extension homomorphism $f:\stesys'\to \stesys$ such that additionally the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\cobesys{\stesysf'}{\famesys{\stesys'}}{\eft'}{\eft'}
  \ar{d}[swap]{\mathbf{w}(\stesys')}
  \ar{r}{\pullback{f_1}{\famehom{f}}{\eft}{\eft}}
  \&
\cobesys{\stesysf}{\famesys{\stesys}}{\eft}{\eft}
  \ar{d}{\mathbf{w}(\stesys)}
  \\
\famesys{\famesys{\stesys'}}
  \ar{r}[swap]{\famehom{\famehom{f}}}
  \&
\famesys{\famesys{\stesys}}
\end{tikzcd}
\end{equation*}
commutes.
\end{frame}

\begin{frame}
\frametitle{\bf Change of base of pre-weakening algebras}
Let $\stesys$ be a pre-weakening algebra and consider $p:\stesysc\rightarrow X\leftarrow Y:g$.
Then we define
\begin{equation*}
\mathbf{w}(\cobesys{Y}{\stesys}{g}{p})
  :
\cobesys
  { (\pullback{Y}{\stesysf}{g}{p\circ\eft})}
  { \famesys{\cobesys{Y}{\stesys}{g}{p}}}
  { g^\ast(\eft)}
  { g^\ast(\eft)}
  \to
\famesys{\famesys{\cobesys{Y}{\stesys}{g}{p}}}
\end{equation*}
to be the unique extension homomorphism rendering the diagram
\begin{scriptsize}
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\cobesys
  { \pullback{Y}{\stesysf}{g}{p\circ\eft}}
  { \famesys{\cobesys{Y}{\stesys}{g}{p}}}
  { g^\ast(\eft)}
  { g^\ast(\eft)}
  \ar[bend right]{ddr}[swap]{\pullbackpr{1}{g^\ast(\eft)}{g^\ast(\eft)}}
  \ar{rr}{%
    \pullback
      { \pullbackpr{2}{g}{p\circ\eft}}
      { \boldsymbol{\pi}_\mathbf{2}(g,p\circ\eft)}
      { \eft}
      { \eft}
    }
  \ar[dotted]{dr}{\mathbf{w}(\cobesys{Y}{\stesys}{g}{p})}
  \&
  {}\&
\cobesys{\stesysf}{\famesys{\stesys}}{\eft}{\eft}
  \ar{r}{\mathbf{w}(\stesys)}
  \&
\famesys{\famesys{\stesys}}
  \ar{d}{\boldsymbol{\beta}}
  \\
  {}\&
\famesys{\famesys{\cobesys{Y}{\stesys}{g}{p}}}
  \ar{r}{\beta}
  \ar{d}{g^\ast(\eft)_2}
  \&
\famesys{\cobesys{Y}{\stesys}{g}{p}}
  \ar{r}{\boldsymbol{\pi}_2(g,p\circ\eft)}
  \ar{d}{g^\ast(\eft)}
  \&
\famesys{\stesys}
  \ar{d}{\eft}
  \\
  {}\&
\pullback{Y}{\stesysf}{g}{p\circ\eft}
  \ar{r}[swap]{\cobesys{Y}{\ectxext}{g}{p}}
  \&
\pullback{Y}{\stesysc}{g}{p}
  \ar{r}[swap]{\pullbackpr{2}{g}{p}}
  \&
\stesysc
\end{tikzcd}
\end{equation*}
\end{scriptsize}
commutative.
\end{frame}

\begin{frame}
\frametitle{\bf Properties of pre-weakening algebras}
\begin{theorem}
If $\stesys$ is a pre-weakening algebra and $p:\stesysc\rightarrow X\leftarrow Y:g$,
then $\cobesys{Y}{\stesys}{g}{p}$ is also a pre-weakening algebra.
\end{theorem}
\pause
\begin{theorem}
If $\stesys$ is a pre-weakening algebra, then so is $\famesys{\stesys}$. 
\end{theorem}
\end{frame}

\begin{frame}
\frametitle{\bf Weakening algebras}
Thus, it makes sense to require that the weakening operation itself is a
pre-weakening homomorphism.
\begin{definition}
A \important{weakening algebra} is a pre-weakening algebra $\stesys$ with the property that
$\mathbf{w}(\stesys)$ is a pre-weakening homomorphism.
\end{definition}
\pause
\begin{theorem}
If $\stesys$ is a weakening algebra and $p:\stesysc\rightarrow X\leftarrow Y:g$,
then $\cobesys{Y}{\stesys}{g}{p}$ is also a weakening algebra.
\end{theorem}
\pause
\begin{theorem}
If $\stesys$ is a weakening algebra, then so is $\famesys{\stesys}$. 
\end{theorem}
\end{frame}

\begin{frame}
\frametitle{\bf Rules for weakening: weakening preserves itself}
The requirement that weakening is itself a pre-weakening homomorphism
is represented by the following inference rules which we impose on
weakening:
\begin{small}
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    \jfam{{\Gamma}{B}}{R}
    }
  { \jfameq
      {{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}}
      {\ctxwk{A}{{Q}{R}}}
      {\ctxwk{{A}{Q}}{{A}{R}}}
    }
\\
\pause
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    \jfam{{{\Gamma}{B}}{R}}{S}
    }
  { \jfameq
      {{{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}}{\ctxwk{A}{{Q}{R}}}}
      {\ctxwk{A}{{Q}{S}}}
      {\ctxwk{{A}{Q}}{{A}{S}}}
    }
\\
\pause
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    \jterm{{{\Gamma}{B}}{R}}{S}{k}
    }
  { \jtermeq
      {{{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}}{\ctxwk{A}{{Q}{R}}}}
      {\ctxwk{A}{{Q}{S}}}
      {\ctxwk{A}{{Q}{k}}}
      {\ctxwk{{A}{Q}}{{A}{k}}}
    }
\end{align*}
\end{small}
\end{frame}

\begin{frame}
\frametitle{\bf Overview of the theory of projections}
\begin{itemize}
\item In the theory of projections, we will introduce units, which will eventually behave
like \important{fiberwise identity morphisms of families}.
  \pause
\item Together with weakening, units will induce all the \important{projections}.
  \pause
\item \important{Pre-projection algebras} will be weakening algebras with units.
  \pause
\item \important{Projection algebras} will be pre-projection algebras for which
weakening is a pre-projection homomorphism.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{\bf Rules for the theory of projections}
Introduction rules for units:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \unfoldall{\jhom{\Gamma}{A}{A}{\idtm{A}}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{A'}
      }
    { \unfoldall{\jhomeq{\Gamma}{A}{A}{\idtm{A}}{\idtm{A'}}}
      }
\end{align*}
Weakening preserves the unit:
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    }
  { \unfoldall{\jhomeq
      {{{\Gamma}{A}}{\ctxwk{A}{B}}}
      {\ctxwk{A}{Q}}
      {\ctxwk{A}{Q}}
      {\ctxwk{A}{\idtm{Q}}}
      {\idtm{\ctxwk{A}{Q}}}
      }
    }
\end{equation*}
\end{frame}

\begin{frame}
\frametitle{\bf Pre-projection algebras}
A \important{pre-projection algebra} is a weakening algebra $\stesys$ for which there is a term
$\mathbf{i}(\stesys):\stesysf\to \stesyst_2$ such that the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\stesysf 
  \ar{r}{\mathbf{i}(\stesys)} 
  \ar{d}[swap]{\Delta_{\eft}} 
  \& 
\stesyst_2 
  \ar{d}{\ebd[2]}\\
\pullback{\stesysf}{\stesysf}{\eft}{\eft} 
  \ar{r}[swap]{w(\stesys)_0} 
  \& 
\stesysf_2
\end{tikzcd}
\end{equation*}
commutes. In this diagram, $\Delta_{\eft}:\stesysf\to \pullback{\stesysf}{\stesysf}{\eft}{\eft}$ is the diagonal.
\end{frame}

\begin{frame}
\frametitle{\bf Pre-projection homomorphisms}
A \important{pre-projection homomorphism from $\stesys$ to $\stesys'$} is a weakening homomorphism
$f:\stesys'\to \stesys$ such that the square
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\stesyst_2'
  \ar{r}{f^t_2}
  \&
\stesyst_2
  \\
\stesysf' 
  \ar{r}[swap]{f_1}
  \ar{u}{\mathbf{i}(\stesys')}
  \&
\stesysf
  \ar{u}[swap]{\mathbf{i}(\stesys)}
\end{tikzcd}
\end{equation*}
commutes.
\end{frame}

\begin{frame}
\frametitle{\bf Projection algebras}
\begin{definition}
A \important{projection algebra} is a pre-projection algebra for which the weakening operation
is a pre-projection homomorphism.
\end{definition}
\pause
\begin{definition}
A \important{projection homomorphism} is a pre-projection homomorphism between projection
algebras.
\end{definition}
\pause
\begin{theorem}
If $\stesys$ is a projection algebra and $p:\stesysc\rightarrow X\leftarrow Y:g$,
then $\cobesys{Y}{\stesys}{g}{p}$ is also a projection algebra.
\end{theorem}
\pause
\begin{theorem}
If $\stesys$ is a projection algebra, then so is $\famesys{\stesys}$. 
\end{theorem}
\end{frame}

\begin{frame}
\frametitle{\bf Overview of the theory of substitution}
\begin{itemize}
\item We will introduce an operation for substitution by a term, this allows us
to consider \important{fibers of families}. The substitution of $P$ by $a$ will
be denoted by $\subst{a}{P}$.
  \pause
\item Substitution will be compatible with extension, thus it will be implemented
as an extension homomorphism.
  \pause
\item \important{Pre-substitution algebras} will be extension algebras with a substitution
operation. \important{Pre-substitution homomorphisms} will preserve this structure.
  \pause
\item \important{Substitution algebras} will be pre-substitution algebras for which
the substitution operation itself is a pre-substitution homomorphism.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{\bf Rules for the theory of substitution}
\begin{footnotesize}
Introduction rules for substitution:
\begin{align*}
& \inference
  { \jterm{\Gamma}{A}{a}
    \jfam{{\Gamma}{A}}{P}
    }
  { \jfam{\Gamma}{\subst{a}{P}}
    }
& & \inference
    { \jtermeq{\Gamma}{A}{a}{a'}
      \jfameq{{\Gamma}{A}}{P}{P'}
      }
    { \jfameq{\Gamma}{\subst{a}{P}}{\subst{a'}{P'}}
      }
    \\
& \inference
  { \jterm{\Gamma}{A}{a}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfam{{\Gamma}{\subst{a}{P}}}{\subst{a}{Q}}
    }
& & \inference
    { \jtermeq{\Gamma}{A}{a}{a'}
      \jfameq{{{\Gamma}{A}}{P}}{Q}{Q'}
      }
    { \jfameq{{\Gamma}{\subst{a}{P}}}{\subst{a}{Q}}{\subst{a'}{Q'}}
      }
    \\
& \inference
  { \jterm{\Gamma}{A}{a}
    \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    }
  { \jterm{{\Gamma}{\subst{a}{P}}}{\subst{a}{Q}}{\subst{a}{g}}
    }
& & \inference
    { \jtermeq{\Gamma}{A}{a}{a'}
      \jtermeq{{{\Gamma}{A}}{P}}{Q}{g}{g'}
      }
    { \jtermeq
        {{\Gamma}{\subst{a}{P}}}
        {\subst{a}{Q}}
        {\subst{a}{g}}
        {\subst{a'}{g'}}
      }
\end{align*}
\pause
Substitution is compatible with extension:
\begin{align*}
& \inference
  { \jterm{\Gamma}{A}{a}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfameq
      {\Gamma}
      {\subst{a}{\ctxext{P}{Q}}}
      {\ctxext{\subst{a}{P}}{\subst{a}{Q}}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{a}
    \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \jfameq
      {{\Gamma}{\subst{a}{P}}}
      {\subst{a}{\ctxext{Q}{R}}}
      {\ctxext{\subst{a}{Q}}{\subst{a}{R}}}
    }
\end{align*}
\end{footnotesize}
\end{frame}

\begin{frame}
\frametitle{\bf Pre-substitution algebras}
A \important{pre-substitution} for an extension algebra $\stesys$ is an
extension homomorphism
\begin{equation*}
\mathbf{s}(\stesys):\cobesys{\stesyst}{\famesys{\famesys{\stesys}}}{\ebd}{\eft[2]}\to \famesys{\stesys}
\end{equation*}
for which the square
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\pullback{\stesyst}{\stesysf_2}{\ebd}{\eft[2]}
  \ar{r}{s(\stesys)_0}
  \ar{d}[swap]{\ebd\circ\pullbackpr{1}{\ebd}{\eft[2]}}
  \&
\stesysf 
  \ar{d}{\eft}
  \\
\stesysf 
  \ar{r}[swap]{\eft}
  \&
\stesysc
\end{tikzcd}
\end{equation*}
commutes.\\
\pause
A \important{pre-substitution algebra} is an extension algebra
together with a pre-substitution.
\end{frame}

\begin{frame}
\frametitle{\bf Pre-substitution homomorphisms}
A \important{pre-substitution homomorphism} is an extension homomorphism $f:\stesys'\to \stesys$
for which the square
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=huge]
\cobesys{\stesyst'}{\famesys{\famesys{\stesys'}}}{\ebd'}{\eft[2]'}
  \ar{r}{\pullback{f^t}{\famehom{\famehom{f}}}{\ebd}{\eft[2]}}
  \ar{d}[swap]{\mathbf{s}(\stesys')}
  \&
\cobesys{\stesyst}{\famesys{\famesys{\stesys}}}{\ebd}{\eft[2]}
  \ar{d}{\mathbf{s}(\stesys)}
  \\
\famesys{\stesys'}
  \ar{r}[swap]{\famehom{f}}
  \&
\famesys{\stesys}
\end{tikzcd}
\end{equation*}
commutes.
\end{frame}

\begin{frame}
\frametitle{\bf The family pre-substitution algebra}
\begin{theorem}
If $\stesys$ is a pre-substitution algebra, then so is $\famesys{\stesys}$\pause~with
$\mathbf{s}(\famesys{\stesys})$ defined to be the unique extension homomorphism
rendering the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\cobesys{\stesyst_2}{\famesys{\famesys{\famesys{\stesys}}}}{\ebd[2]}{\eft[3]}
  \ar[dotted]{dr}{\mathbf{s}(\famesys{\stesys})}
  \ar{rr}{\pullback{\pullbackpr{2}{\ectxext}{\eft\circ\ebd}}{\boldsymbol{\beta}_\mathbf{2}}{\ebd}{\eft[2]}}
  \ar{dd}[swap]{\ebd[2]\circ\pullbackpr{1}{\ebd[2]}{\eft[3]}}
  \&
  {}\&
\cobesys{\stesyst}{\famesys{\famesys{\stesys}}}{\ebd}{\eft[2]}
  \ar{d}{\mathbf{s}(\stesys)}
  \\
  {}\&
\famesys{\famesys{\stesys}}
  \ar{r}{\boldsymbol{\beta}}
  \ar{d}{\eft[2]}
  \&
\famesys{\stesys}
  \ar{d}{\eft}
  \\
\stesysf_2
  \ar{r}[swap]{\eft[2]}
  \&
\stesysf
  \ar{r}[swap]{\ectxext}
  \&
\stesysc
\end{tikzcd}
\end{equation*}
commutative.
\end{theorem}
\end{frame}

\begin{frame}
\frametitle{\bf Change of base of pre-substitution algebras}
\begin{theorem}
Let $\stesys$ be a pre-substitution algebra and consider
$p:\stesysc\rightarrow X\leftarrow Y:g$. Then
$\cobesys{Y}{\stesys}{g}{p}$ is a pre-substitution algebra
\pause~with $\mathbf{s}(\cobesys{Y}{\stesys}{g}{p})$ defined
to be the unique extension homomorphism rendering the diagram
\begin{footnotesize}
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\cobesys
  {\pullback{Y}{\stesyst}{g}{p\circ\eft\circ\ebd}}
  {\famesys{\famesys{\cobesys{Y}{\stesys}{g}{p}}}}
  {g^\ast(\ebd)}{g^\ast(\eft[2])}
  \ar[dotted]{dr}{\mathbf{s}(\cobesys{Y}{\stesys}{g}{p})}
  \ar{rr}
  \ar[bend right]{ddr}[swap]%
    { \pullbackpr{1}{g}{p\circ\eft\circ\ebd}%
        \circ%
      \pullbackpr{1}{g^\ast(\ebd)}{g^\ast(\eft[2])}%
      }
  \&
  {}\&
\cobesys{\stesyst}{\famesys{\famesys{\stesys}}}{\ebd}{\eft[2]}
  \ar{d}{\mathbf{s}(\stesys)}
  \\
  {}\&
\famesys{\cobesys{Y}{\stesys}{g}{p}}
  \ar{r}
  \ar{d}{\pullbackpr{1}{g}{p\circ\eft}}
  \&
\famesys{\stesys}
  \ar{d}{p\circ\eft}
  \\
  {}\&
Y
  \ar{r}[swap]{g}
  \&
X
\end{tikzcd}
\end{equation*}
\end{footnotesize}
commutative. 
\end{theorem}
\end{frame}

\begin{frame}
\frametitle{\bf Substitution algebras}
Thus, it makes sense to require that the pre-substitution operation itself is a
pre-substitution homomorphism.
\begin{definition}
A \important{substitution algebra} is a pre-substitution algebra $\stesys$ with the property that
$\mathbf{S}(\stesys)$ is a pre-substitution morphism.
\end{definition}
\pause
\begin{definition}
A \important{substitution homomorphism} is a pre-substitution homomorphism between substitution
algebras.
\end{definition}
\pause
\begin{theorem}
If $\stesys$ is a substitution algebra and $p:\stesysc\rightarrow X\leftarrow Y:g$,
then $\cobesys{Y}{\stesys}{g}{p}$ is also a substitution algebra.
\end{theorem}
\pause
\begin{theorem}
If $\stesys$ is a substitution algebra, then so is $\famesys{\stesys}$. 
\end{theorem}
\end{frame}

\begin{frame}
\frametitle{\bf Rules for substitution: substitution is compatible with itself}
\begin{align*}
& \inference
  { \jterm{\Gamma}{A}{a}
    \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \jfameq
      {{{\Gamma}{\subst{a}{P}}}{\subst{a}{Q}}}
      {\subst{a}{{g}{R}}}
      {\subst{{a}{g}}{{a}{R}}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{a}
    \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    \jfam{{{{{\Gamma}{A}}{P}}{Q}}{R}}{S}
    }
  { \jfameq
      {{{{\Gamma}{\subst{a}{P}}}{\subst{a}{Q}}}{\subst{a}{{g}{R}}}}
      {\subst{a}{{g}{S}}}
      {\subst{{a}{g}}{{a}{S}}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{a}
    \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    \jterm{{{{{\Gamma}{A}}{P}}{Q}}{R}}{S}{k}
    }
  { \jtermeq
      {{{{\Gamma}{\subst{a}{P}}}{\subst{a}{Q}}}{\subst{a}{{g}{R}}}}
      {\subst{a}{{g}{S}}}
      {\subst{a}{{g}{k}}}
      {\subst{{a}{g}}{{a}{k}}}
    }
\end{align*}
\end{frame}

\begin{frame}
\frametitle{\bf Joining the theories of projections and substitution}
To join the two theories we have formulated on top of the theory of extension,
we need to provide rules describing:
\begin{itemize}
\item that weakening preserves substitution (weakening is a substitution homomorphism);\pause
\item that substitution preserves weakening (substitution is a weakening homomorphism);\pause
\item that substitution preserves units (substitution is a projection homomorphism);\pause
\item that weakenings are constant families;\pause
\item everything is invariant with respect to precomposition with units.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{\bf Pre-E-systems}
A \important{pre-E-system} is an extension algebra $\stesys$ with a
weakening operation $\mathbf{w}(\stesys)$, units
$\mathbf{i}(\stesys)$ and a substitution operation
$\mathbf{s}(\stesys)$ giving it both the structure of
a projection algebra and a substitution algebra, such
that in addition
\begin{itemize}
\item Weakening is a substitution homomorphism;
\item Substitution is a projection homomorphism.
\end{itemize}
\important{Pre-E-homomorphisms} are extension homomorphisms which
are both projection homomorphisms and substitution
homomorphisms.
\end{frame}

\begin{frame}
\frametitle{\bf Rules: Weakened families are constant families}
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    \jterm{\Gamma}{A}{a}
    }
  { \jfameq
      {\Gamma}
      {\subst{a}{\ctxwk{A}{B}}}
      {B}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    \jterm{\Gamma}{A}{a}
    }
  { \jfameq{{\Gamma}{B}}{\subst{a}{\ctxwk{A}{Q}}}{Q}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{a}
    \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jtermeq{{\Gamma}{B}}{Q}{\subst{a}{\ctxwk{A}{g}}}{g}
    }
\end{align*}
\end{frame}

\begin{frame}
\frametitle{\bf Weakened families are constant families}
In a pre-E-system, we say that \important{weakened families are 
constant families} if the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=12em]
\cobesys{\stesyst}{\famesys{\stesys}}{\eft\circ\ebd}{\eft}
  \ar{r}{ [ \catid{\stesyst},
            \mathbf{w}(\stesys)
              \circ
            (\pullback{\ebd}{\catid{\famesys{\stesys}}}{\eft}{\eft})
            ]
          }
  \ar{dr}[swap]{\pullbackpr{2}{\eft\circ\ebd}{\eft}}
  \&
\cobesys
  { \stesyst}
  { \famesys{\famesys{\stesys}}
    }
  { \ebd}
  { \eft[2]}
  \ar{d}{\mathbf{s}(\stesys)}
  \\
  {}\&
\famesys{\stesys}
\end{tikzcd}
\end{equation*}
commutes.
\end{frame}

\begin{frame}
\frametitle{\bf Rules: precomposition with a unit has no effect}
\begin{align*}
& \inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq{{\Gamma}{A}}{\subst{\idtm{A}}{\ctxwk{A}{P}}}{P}
    }
  \\
& \inference
  { \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfameq{{{\Gamma}{A}}{P}}{\subst{\idtm{A}}{\ctxwk{A}{Q}}}{Q}
    }
  \\
& \inference
  { \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    }
  { \jtermeq
      {{{\Gamma}{A}}{P}}
      {Q}
      {\subst{\idtm{A}}{\ctxwk{A}{g}}}
      {g}
    }
\end{align*}
\end{frame}

\begin{frame}
\frametitle{\bf Invariance with respect to precomposition with units}
In a pre-E-system $\stesys$ we say that \important{everything is invariant
with respect to precomposition with units} if the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\famesys{\famesys{\stesys}}
  \ar{r}
  \ar[equals]{ddrr}
  \&
\famesys{\cobesys{\stesysf}{\famesys{\stesys}}{\eft}{\eft}}
  \ar{r}[yshift=1ex]{[\pullbackpr{1}{\eft}{\eft}\circ\eft^\ast(\eft[2]),\famehom{\mathbf{w}(\stesys)}]}
  \&
\cobesys
  {\stesysf}
  {\famesys{\famesys{\famesys{\stesys}}}}
  {w(\stesys)_0\circ\Delta_{\eft}}
  {\eft[3]}
  \ar{d}{\pullback{\mathbf{i}(\stesys)}{\catid{\famesys{\famesys{\stesys}}}]}{\ebd[2]}{\eft[3]}}
  \\
  {}\&
  {}\&
\cobesys{\stesyst_2}{\famesys{\famesys{\famesys{\stesys}}}}{\ebd[2]}{\eft[3]}
  \ar{d}{\mathbf{s}(\famesys{\stesys})}
  \\
  {}\&
  {}\&
\famesys{\famesys{\stesys}}
\end{tikzcd}
\end{equation*}
commutes.
\end{frame}

\begin{frame}
\frametitle{\bf E-systems}
An \emph{E-system} is an extension algebra with
\begin{itemize}
\item a weakening operation and units, giving it the structure of a projection algebra;
\item a substitution operation, giving it the structure of a substitution algebra
\item (an empty context and empty families);
\end{itemize}
such that
\begin{itemize}
\item Weakening is a substitution homomorphism;
\item Substitution is a projection homomorphism;
\item Weakened families are constant families;
\item Precomposition with identity functions leaves everything invariant.
\item (The requirements regarding the empty context and families according to their rules)
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{\bf The end}
\begin{center}
Thank you for your attention
\end{center}
\end{frame}

\begin{frame}
\frametitle{\bf Appendix: weakening and substitution preserve each other}
\begin{footnotesize}
Weakening preserves substitution:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jterm{{\Gamma}{B}}{Q}{g}
    \jfam{{{\Gamma}{B}}{Q}}{R}
    }
  { \jfameq
      {{{\Gamma}{A}}{\ctxwk{A}{B}}}
      {\ctxwk{A}{\subst{g}{R}}}
      {\subst{\ctxwk{A}{g}}{\ctxwk{A}{R}}}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    \jterm{{\Gamma}{B}}{Q}{g}
    \jfam{{{{\Gamma}{B}}{Q}}{R}}{S}
    }
  { \jfameq
      {{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{\subst{g}{R}}}}
      {\ctxwk{A}{\subst{g}{S}}}
      {\subst{\ctxwk{A}{g}}{\ctxwk{A}{S}}}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    \jterm{{\Gamma}{B}}{Q}{g}
    \jterm{{{{\Gamma}{B}}{Q}}{R}}{S}{k}
    }
  { \jtermeq
      {{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{\subst{g}{R}}}}
      {\ctxwk{A}{\subst{g}{S}}}
      {\ctxwk{A}{\subst{g}{k}}}
      {\subst{\ctxwk{A}{g}}{\ctxwk{A}{k}}}
    }
\end{align*}
\pause
Substitution preserves weakening:
\begin{align*}
& \inference
  { \jterm{\Gamma}{A}{a}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    \jfam{{{\Gamma}{A}}{P}}{R}
    }
  { \jfameq
      {{{\Gamma}{\subst{a}{P}}}{\subst{a}{Q}}}
      {\subst{a}{\ctxwk{Q}{R}}}
      {\ctxwk{\subst{a}{Q}}{\subst{a}{R}}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{a}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    \jfam{{{{\Gamma}{A}}{P}}{R}}{S}
    }
  { \jfameq
      {{{{\Gamma}{\subst{a}{P}}}{\subst{a}{Q}}}{\subst{a}{\ctxwk{Q}{R}}}}
      {\subst{a}{\ctxwk{Q}{S}}}
      {\ctxwk{\subst{a}{Q}}{\subst{a}{S}}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{a}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    \jterm{{{{\Gamma}{A}}{P}}{R}}{S}{k}
    }
  { \jtermeq
      {{{{\Gamma}{\subst{a}{P}}}{\subst{a}{Q}}}{\subst{a}{\ctxwk{Q}{R}}}}
      {\subst{a}{\ctxwk{Q}{S}}}
      {\subst{a}{\ctxwk{Q}{k}}}
      {\ctxwk{\subst{a}{Q}}{\subst{a}{k}}}
    }
\end{align*}
\end{footnotesize}
\end{frame}

\begin{frame}
\frametitle{\bf Appendix: substitution preserves units}
\begin{equation*}
\inference
  { \jterm{\Gamma}{A}{a}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \unfoldall{\jhomeq
      {{\Gamma}{\subst{a}{P}}}
      {\subst{a}{Q}}
      {\subst{a}{Q}}
      {\subst{a}{\idtm{Q}}}
      {\idtm{\subst{a}{Q}}}
    }}
\end{equation*}
\end{frame}

\begin{frame}
\frametitle{\bf Appendix: the empty context and family}
\begin{small}
Introduction rules for the empty context and family:
\begin{equation*}
\inference
  { }
  { \jctx{\emptyc}
    }
\qquad
\inference
  { \jctx{\Gamma}
    }
  { \jfam{\Gamma}{\emptyf[\Gamma]}
    }
\qquad
\inference
  { \jctxeq{\Gamma}{\Gamma'}
    }
  { \jfameq{\Gamma}{\emptyf[\Gamma]}{\emptyf[\Gamma']}
    }
\end{equation*}
\pause
Every context induces a family in the empty context:
\begin{align*}
& \inference
  { \jctx{\Gamma}
    }
  { \jfam{\emptyc}{i(\Gamma)}
    } 
  &
& \inference
  { \jctxeq{\Gamma}{\Delta}
    }
  { \jfameq{\emptyc}{i(\Gamma)}{i(\Delta)}
    }
\end{align*}
\pause
Compatibility rules for empty context and family with extension:
\begin{align*}
& \inference
  { \jctx{\Gamma}
    }
  { \jctxeq{\ctxext{\emptyc}{i(\Gamma)}}{\Gamma}
    }
& 
& \inference
  { \jctx{\Gamma}
    }
  { \jctxeq{\ctxext{\Gamma}{\emptyf}}{\Gamma}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{\ctxext{\emptyf}{A}}{A}
    }
&
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{{A}{\emptyf}}{A}
    }
  \\
& \inference
  { \jfam{\emptyc}{A}
    }
  { \jfameq{\emptyc}{i(\ctxext{\emptyc}{A})}{A}
    }
\end{align*}
\pause
and finally
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jctxeq{\ctxext{\Gamma}{A}}{\ctxext{i(\Gamma)}{A}}
    }
& &
\inference
  { }
  { \jfameq{\emptyc}{i(\emptyc)}{\emptyf[\emptyc]}}
\end{align*}
\end{small}
\end{frame}

\begin{frame}
\frametitle{\bf Appendix: weakening and the empty families}
Weakening by the empty family:
\begin{align*}
& \inference
  { \jfam{\Gamma}{B}
    }
  { \jfameq{\Gamma}{\ctxwk{\emptyf}{B}}{B}
    }
  \\
& \inference
  { \jfam{{\Gamma}{B}}{Q}
    }
  { \jfameq{{\Gamma}{B}}{\ctxwk{\emptyf}{Q}}{Q}
    }
  \\
& \inference
  { \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jtermeq{{\Gamma}{B}}{Q}{\ctxwk{\emptyf}{g}}{g}
    }
\end{align*}
\pause
Weakening of the empty family:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{{\Gamma}{A}}{\ctxwk{A}{\emptyf}}{\emptyf}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    }
  { \jfameq
    {{{\Gamma}{A}}{\ctxwk{A}{B}}}
    {\ctxwk{A}{\emptyf}}
    {\emptyf}
    }
\end{align*}
\pause
Compatibility of weakening of a family with weakening of a context:
\begin{equation*}
\inference
{ \jfam{\Gamma}{A}
  \jfam{\Gamma}{B}
  }
{ \jfameq{{\Gamma}{A}}{\ctxwk{A}{B}}{\ctxwk{A}{B}}
  }
\end{equation*}
\end{frame}

\begin{frame}
\frametitle{\bf Appendix: substitution of an empty family}
\begin{align*}
& \inference
  { \jterm{\Gamma}{A}{a}
    }
  { \jfameq{\Gamma}{\subst{a}{\emptyf}}{\emptyf}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{a}
    \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq
      {{\Gamma}{\subst{a}{P}}}
      {\subst{a}{\emptyf}}
      {\emptyf}
    }
\end{align*}
Compatibility of substitution of a family with substitution of a context:
\begin{equation*}
\inference
{ \jfam{{\Gamma}{A}}{P}
  }
{ \jfameq{\Gamma}{\subst{a}{P}}{\subst{a}{P}}
  }
\end{equation*}
\end{frame}

\begin{frame}
\frametitle{\bf Appendix: units act as identity functions}
\begin{equation*}
\inference
  { \jterm{\Gamma}{A}{a}
    }
  { \jtermeq{\Gamma}{A}{\subst{a}{\idtm{A}}}{a}
    }
\end{equation*}
\\[\baselineskip]
Note that the empty family is needed to have this rule.
\end{frame}
\end{document}
