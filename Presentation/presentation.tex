\documentclass[handout]{beamer}

\input{preamble-articles}

\title{An algebraic formulation of dependent type theory}
\author{Egbert Rijke}
\institute{Carnegie Mellon University}
\date{November 7th -- 10th, 2014}

\begin{document}

\begin{frame}
\titlepage
\end{frame}

\begin{frame}
\frametitle{Desired properties of the algebraic theory}
\begin{itemize}
\item Finitely many sorts. The basic ingredients are contexts, families and
terms. Thus there will be 3 sorts.
\pause
\item The theory is algebraic and the operations on it are homomorphisms. The
wish that operations are homomorphisms tells which judgmental equalities to
require.
\pause
\item Finite set of rules. The theory is invariant under slicing as a consequence, rather than by
convention. There will be no rule schemes.
\pause
\item The theory is capable of interpreting itself. Investigations to internal
models of type theory originally motivated me to write type theory this way.
\pause
\item The meta-theory should not require anything more than rules for handling
inferences. In particular, natural numbers should not be required.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Overview of the theories}
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=tiny]
{} \& \text{Extension} \ar{dr} \ar{d} \ar{dl}
  \\
\text{Weakening} \ar{d} \& \text{Substitution} \ar{dd} \& \text{Empty context} \ar{ddl}
\\
\text{Projection} \ar{dr}
\\
{} \& \text{Dependent Type Theory}
\end{tikzcd}
\end{equation*}
\end{frame}

\begin{frame}
\frametitle{The basic judgments}
\begin{align*}
\jalign\jctx{\Gamma} 
& \jalign\jctxeq{\Gamma}{\Gamma'}
  \\
\jalign\jfam{\Gamma}{A} 
& \jalign\jfameq{\Gamma}{A}{B}
  \\
\jalign\jterm{\Gamma}{A}{x} 
& \jalign\jtermeq{\Gamma}{A}{x}{y}.
\end{align*}
\end{frame}

\begin{frame}
\frametitle{Judgmental equality is an equivalence relation}
\begin{footnotesize}
\begin{align*}
& \inference
  { \jctx{\Gamma}
    }
  { \jctxeq{\Gamma}{\Gamma}
    } 
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      }
    { \jctxeq{\Delta}{\Gamma}
      } 
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jctxeq{\Delta}{\greek{E}}
      }
    { \jctxeq{\Gamma}{\greek{E}}
      }
    \\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{A}{A}
    } 
& & \inference
    { \jfameq{\Gamma}{A}{B}
      }
    { \jfameq{\Gamma}{B}{A}
      }
& & \inference
    { \jfameq{\Gamma}{A}{B}
      \jfameq{\Gamma}{B}{C}
      }
    { \jfameq{\Gamma}{A}{C}
      }
    \\
& \inference
  { \jterm{\Gamma}{A}{x}
    }
  { \jtermeq{\Gamma}{A}{x}{x}
    }
& & \inference
    { \jtermeq{\Gamma}{A}{x}{y}
      }
    { \jtermeq{\Gamma}{A}{y}{x}
      }
& & \inference
    { \jtermeq{\Gamma}{A}{x}{y}
      \jtermeq{\Gamma}{A}{y}{z}
      }
    { \jtermeq{\Gamma}{A}{x}{z}
      }
\end{align*}
\begin{align*}
& \inference
  { \jctxeq{\Gamma}{\Delta}
    \jfam{\Gamma}{A}
    }
  { \jfam{\Delta}{A}
    }
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jfameq{\Gamma}{A}{B}
      }
    { \jfameq{\Delta}{A}{B}
      }
    \\
& \inference
  { \jctxeq{\Gamma}{\Delta}
    \jterm{\Gamma}{A}{x}
    }
  { \jterm{\Delta}{A}{x}
    }
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jtermeq{\Gamma}{A}{x}{y}
      }
    { \jtermeq{\Delta}{A}{x}{y}
      }
    \\
& \inference
  { \jfameq{\Gamma}{A}{B}
    \jterm{\Gamma}{A}{x}
    }
  { \jterm{\Gamma}{B}{x}
    }
& & \inference
    { \jfameq{\Gamma}{A}{B}
      \jtermeq{\Gamma}{A}{x}{y}
      }
    { \jtermeq{\Gamma}{B}{x}{y}
      }
\end{align*}
\end{footnotesize}
\end{frame}

\begin{frame}
\frametitle{The fundamental structure of E-systems}
The fundamental structure of an E-system $\stesys$ in a category
$\cat{C}$ with finite limits consists of
\begin{equation*}
\begin{tikzcd}
\stesyst
  \ar{d}{\ebd}
  \\
\stesysf
  \ar{d}{\eft}
  \\
\stesysc
\end{tikzcd}
\end{equation*}
The inferences of judgmental equality are automatically taken
care of by the equality the ambient category
\end{frame}

\begin{frame}
\frametitle{Extension}
Introduction rules for extension:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jctx{\ctxext{\Gamma}{A}}
    }
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jfameq{\Gamma}{A}{B}
      }
    { \jctxeq{\ctxext{\Gamma}{A}}{\ctxext{\Delta}{B}}
      }
    \\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfam{\Gamma}{\ctxext{A}{P}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{B} 
      \jfameq{{\Gamma}{A}}{P}{Q}
      }
    { \jfameq{\Gamma}{\ctxext{A}{P}}{\ctxext{B}{Q}}
      }
\end{align*}
\pause
Extension is associative:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{A}}{P}
    }
  { \jctxeq{\ctxext{{\Gamma}{A}}{P}}{\ctxext{\Gamma}{{A}{P}}}
    }
  \\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfameq{\Gamma}{\ctxext{A}{{P}{Q}}}{\ctxext{{A}{P}}{Q}}
    }
\end{align*}
\end{frame}


\begin{frame}
\frametitle{Pre-extension algebras}
A \emph{pre-extension object $\stesys$ in $\cat{C}$} consists of a \emph{fundamental structure}
in $\cat{C}$ together with the \emph{context extension} and \emph{family extension} operations
\begin{align*}
\ectxext% 
  &%
: \stesysf \to \stesysc%
  \\
\efamext% 
  &%
: \stesysff \to \stesysf,%
\end{align*}
respectively, such that the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesysff 
  \ar{r}{\efamext} 
  \ar{d}[swap]{\pullbackpr{1}{\ectxext}{\eft}} 
  \& 
\stesysf 
  \ar{d}{\eft}
  \\
\stesysf
  \ar{r}[swap]{\eft} 
  \& 
\stesysc
\end{tikzcd}
\end{equation*}
commutes.
\end{frame}

\begin{frame}
\frametitle{Notation for pre-extension algebras}
We introduce the following notation:
\begin{align*}
\stesysf_2 
  & := \stesysff
  \\
\eft[2] 
  & := \pullbackpr{1}{\ectxext}{\eft} : \stesysf_2\to\stesysf
  \\
\stesysf_3 & := \pullback{\stesysf_2}{\stesysf_2}{\efamext}{\eft[2]}
  \\
\eft[3]
  & := \pullbackpr{1}{\efamext}{\eft[2]} : \stesysf_3\to\stesysf_2.
\end{align*}
Then it follows that the outer square in the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\stesysf_3
  \ar[dotted]{dr}{\eext{2}}
  \ar{rr}{\pullback{\pullbackpr{2}{\ectxext}{\eft}}{\pullbackpr{2}{\ectxext}{\eft}}{\ectxext}{\eft}}
  \ar{dd}[swap]{\eft[3]}
  \& 
  \&
\stesysf_2
  \ar{d}{\efamext}
  \\
  \&
\stesysf_2
  \ar{d}[swap]{\eft[2]}
  \ar{r}{\pullbackpr{2}{\ectxext}{\eft}}
  \&
\stesysf
  \ar{d}{\eft}
  \\
\stesysf_2
  \ar{r}[swap]{\eft[2]}
  \&
\stesysf
  \ar{r}[swap]{\ectxext}
  \&
\stesysc
\end{tikzcd}
\end{equation*}
commutes. We define $\eext{2}$ to be the unique morphism rendering the above diagram
commutative. 
\end{frame}

\begin{frame}
\frametitle{Notation for extension algebras (continued)}
Now we may continue to define
\begin{align*}
\stesysf_4 
  & := 
\pullback{\stesysf_3}{\stesysf_3}{\eext{2}}{\eft[3]}
  \\
\eft[4] 
  & := 
\pullbackpr{1}{\eext{2}}{\eft[3]}.
\end{align*}
Then we see that the outer square of the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\stesysf_4
  \ar[dotted]{dr}{\eext{3}}
  \ar{rr}{\pullback{\pullbackpr{2}{\efamext}{\eft[2]}}{\pullbackpr{2}{\efamext}{\eft[2]}}{\efamext}{\eft[2]}}
  \ar{dd}[swap]{\eft[4]}
  \& 
  \&
\stesysf_3
  \ar{d}{\eext{2}}
  \\
  \&
\stesysf_3
  \ar{d}[swap]{\eft[3]}
  \ar{r}{\pullbackpr{2}{\efamext}{\eft[2]}}
  \&
\stesysf_2
  \ar{d}{\eft[2]}
  \\
\stesysf_3
  \ar{r}[swap]{\eft[3]}
  \&
\stesysf_2
  \ar{r}[swap]{\efamext}
  \&
\stesysf
\end{tikzcd}
\end{equation*}
commutes,
so we may define $\eext{3}$ to be the unique map which renders the diagram commutative.
\end{frame}

\begin{frame}
\frametitle{Extension algebras}
An extension object is a pre-extension object $\stesys$ for which 
the diagrams
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesysf_2 
  \ar{d}[swap]{\pullbackpr{2}{\ectxext}{\eft}} 
  \ar{r}{\efamext} 
  \& 
\stesysf 
  \ar{d}{\ectxext}
  \\
\stesysf 
  \ar{r}[swap]{\ectxext} 
  \& 
\stesysc
\end{tikzcd}
\qquad
\begin{tikzcd}[ampersand replacement=\&]
\stesysf_3
  \ar{d}[swap]{\pullbackpr{2}{\efamext}{\eft[2]}}
  \ar{r}{\eext{2}}
  \& 
\stesysf_2 
  \ar{d}{\efamext} 
  \\
\stesysf_2 
  \ar{r}[swap]{\efamext} 
  \&
\stesysf
\end{tikzcd}
\end{equation*}
commute.
\end{frame}

\begin{frame}
\frametitle{Local pre-extension algebras}
Suppose that $\stesys$ is a pre-extension algebra. Then we define
the pre-extension algebra $\famesys{\stesys}$ to consist of the
fundamental structure
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesyst_2
  \ar{d}{\ebd[2]}
  \\
\stesysf_2
  \ar{d}{\eft[2]}
  \\
\stesysf
\end{tikzcd}
\end{equation*}
where
\begin{align*}
\stesyst_2 
  & := \pullback{\stesysf}{\stesyst}{\ectxext}{\eft\circ\ebd},
  &
\ebd[2]
  & := \ectxext^\ast(\ebd),
\end{align*}
with the extension operations
\begin{align*}
\efamext 
  & 
: \stesysf_2\to\stesysf,
  &
\eext{2} 
  & 
: \stesysf_3\to\stesysf_2.
\end{align*}
\end{frame}

\begin{frame}
\frametitle{Local extension algebras}
\begin{theorem}
If $\stesys$ is an extension algebra, then so is $\famesys{\stesys}$.
\end{theorem}
\end{frame}

\begin{frame}
\frametitle{Pre-extension homomorphisms}
\begin{footnotesize}
Let $\stesys$ and $\stesys'$ be pre-extension algebras. A \emph{pre-extension 
homomorphism $f$ from $\stesys'$ to $\stesys$} is a triple $(f_0,f_1,f^t)$ 
consisting of morphisms
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesyst' 
  \ar{r}{f^t}
  \ar{d}[swap]{\ebd'}
  \&
\stesyst
  \ar{d}{\ebd}
  \\
\stesysf'
  \ar{r}{f_1}
  \ar{d}[swap]{\eft'}
  \&
\stesysf
  \ar{d}{\eft}
  \\
\stesysc' 
  \ar{r}[swap]{f_0}
  \&
\stesysc
\end{tikzcd}
\end{equation*}
such that the indicated squares commute, for which furthermore the squares
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesysf' 
  \ar{r}{f_1}
  \ar{d}[swap]{\ectxext'}
  \&
\stesysf
  \ar{d}{\ectxext}
  \\
\stesysc'
  \ar{r}[swap]{f_0}
  \&
\stesysc
\end{tikzcd}
\quad
\text{and}
\quad
\begin{tikzcd}[ampersand replacement=\&,column sep=huge]
\stesysf_2'
  \ar{r}{f_1\times_{\ectxext,\eft} f_1}
  \ar{d}[swap]{\efamext'}
  \&
\stesysf_2
  \ar{d}{\efamext}
  \\
\stesysf'
  \ar{r}[swap]{f_1}
  \&
\stesysf
\end{tikzcd}
\end{equation*}
commute. Composition and the identity homomorphism are defined in the expected way.
\end{footnotesize}
\end{frame}

\begin{frame}
\begin{definition}
A pre-extension homomorphism between extension objects is called an extension
homomorphism.
\end{definition}

\begin{lemma}
Let $\stesys$ be a pre-extension algebra. Then $\stesys$ is an extension
algebra if and only if we have the extension homomorphisms
$\mathbf{e}_0:\famesys{\stesys}\to\stesys$
and
$\mathbf{e}_1:\famesys{\famesys{\stesys}}\to\famesys{\stesys}$
given by
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=huge]
\stesyst_2
  \ar{r}{\pullbackpr{2}{\ectxext}{\eft\circ\ebd}}
  \ar{d}[swap]{\ebd[2]}
  \&
\stesyst
  \ar{d}{\ebd}
  \\
\stesysf_2
  \ar{r}{\pullbackpr{2}{\ectxext}{\eft}}
  \ar{d}[swap]{\eft[2]}
  \&
\stesysf
  \ar{d}{\eft}
  \\
\stesysf
  \ar{r}[swap]{\ectxext}
  \&
\stesysc
\end{tikzcd}
\qquad\text{and}\qquad
\begin{tikzcd}[ampersand replacement=\&,column sep=huge]
\stesyst_3
  \ar{r}{\pullbackpr{2}{\efamext}{\eft[2]\circ\ebd[2]}}
  \ar{d}[swap]{\ebd[3]}
  \&
\stesyst_2
  \ar{d}{\ebd[2]}
  \\
\stesysf_3
  \ar{r}{\pullbackpr{2}{\efamext}{\eft[2]}}
  \ar{d}[swap]{\eft[3]}
  \&
\stesysf_2
  \ar{d}{\eft[2]}
  \\
\stesysf_2
  \ar{r}[swap]{\efamext}
  \&
\stesysf
\end{tikzcd}
\end{equation*}
\end{lemma}
\end{frame}

\begin{frame}
\frametitle{Mixed commutative diagrams}
Suppose $f:\stesys\to\stesys'$ is a pre-extension homomorphism. We say that
a diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesys
  \ar{r}{f}
  \ar{d}[swap]{p}
  \&
\stesys'
  \ar{d}{p'}
  \\
X \ar{r}[swap]{g}
  \&
Y
\end{tikzcd}
\end{equation*}
commutes if the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&]
\stesysc
  \ar{r}{f_0}
  \ar{d}[swap]{p}
  \&
\stesysc'
  \ar{d}{p'}
  \\
X \ar{r}[swap]{g}
  \&
Y
\end{tikzcd}
\end{equation*}
commutes.
\end{frame}

\begin{frame}
\frametitle{Change of base of pre-extension algebras}
Let $\stesys$ be a pre-extension algebra and consider $p:\stesysc\rightarrow X\leftarrow Y:g$.
Then there is a pre-extension algebra $\cobesys{Y}{\stesys}{g}{p}$ with projections, such that for every diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\stesys'
  \ar[bend right=10]{ddr}[swap]{p'}
  \ar[bend left=10]{rrd}{f}
  \ar[dotted]{dr}[near end]{[p',f]}
  \\
  {}\&
\cobesys{Y}{\stesys}{g}{p}
  \ar{d}{\pullbackpr{1}{g}{p}}
  \ar{r}[swap]{\pullbackpr{2}{g}{p}}
  \&
\stesys
  \ar{d}{p}
  \\
  {}\&
Y \ar{r}[swap]{g}
  \&
X
\end{tikzcd}
\end{equation*}
of which the outer square commutes, the pre-extension homomorphism $[p',f]$ exists
and is unique with the property that it renders the diagram commutative.
\end{frame}

\begin{frame}
\frametitle{Change of base of extension algebras}
\begin{theorem}
The change of base of an extension algebra is again an extension algebra
\end{theorem}

\begin{theorem}
Let $\stesys$ be a pre-extension algebra. Then
\begin{equation*}
\famesys{\famesys{\stesys}} \simeq \cobesys{\stesysf}{\famesys{\stesys}}{\ectxext}{\eft}.
\end{equation*}
\end{theorem}

\begin{theorem}
Let $\stesys$ be a pre-extension algebra and consider $p:\stesysc\rightarrow
X\leftarrow Y:g$. Then
\begin{equation*}
\famesys{\cobesys{Y}{\stesys}{g}{p}}\simeq
\cobesys{Y}{\famesys{\stesys}}{g}{p\circ\eft}.
\end{equation*}
\end{theorem}
\end{frame}

\begin{frame}
\frametitle{Introduction to the theory of weakening}
\begin{itemize}
\item We will introduce an operation for weakening which acts at the three
levels of fundamental structures (contexts, families and terms).
  \pause
\item It will preserve extension, so it will be implemented as an extension
homomorphism.
  \pause
\item It will preserve itself, so weakening will also be a weakening
homomorphism.
  \pause
\item There will be a notion of `Currying for weakening', which explains
what happens when something is weakened by an extended object.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{The theory of weakening}
\begin{footnotesize}
The introduction rules for weakening:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    }
  { \jfam{{\Gamma}{A}}{\ctxwk{A}{B}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{A'}
      \jfameq{\Gamma}{B}{B'}
      }
    { \jfameq{{\Gamma}{A}}{\ctxwk{A}{B}}{\ctxwk{A'}{B'}}
      }
    \\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    }
  { \jfam{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk[\famsym]{A}{Q}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{A'}
      \jfameq{{\Gamma}{B}}{Q}{Q'}
      }
    { \jfameq
        {{{\Gamma}{A}}{\ctxwk{A}{B}}}
        {\ctxwk[\famsym]{A}{Q}}
        {\ctxwk[\famsym]{A'}{Q'}}
      }
    \\
& \inference
  { \jfam{\Gamma}{A}
    \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jterm{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk[\famsym]{A}{Q}}{\ctxwk[\tmsym]{A}{g}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{A'}
      \jtermeq{{\Gamma}{B}}{Q}{g}{g'}
      }
    { \jtermeq
        {{{\Gamma}{A}}{\ctxwk{A}{B}}}
        {\ctxwk[\famsym]{A}{Q}}
        {\ctxwk[\tmsym]{A}{g}}
        {\ctxwk[\tmsym]{A'}{g'}}
      }
\end{align*}
\pause
Weakening preserves extension:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    }
  { \jfameq
      {\ctxext{\Gamma}{A}}
      {\ctxwk{A}{\ctxext{B}{Q}}}
      {\ctxext{\ctxwk{A}{B}}{\ctxwk{A}{Q}}}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{{\Gamma}{B}}{Q}}{R}
    }
  { \jfameq
      {\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}
      {\ctxwk{A}{\ctxext{Q}{R}}}
      {\ctxext{\ctxwk{A}{Q}}{\ctxwk{A}{R}}}
    }
\end{align*}
\end{footnotesize}
\end{frame}

\begin{frame}
\frametitle{Pre-weakening}
Let $\stesys$ be an extension algebra in $\cat{C}$. A pre-weakening operation
on $\stesys$ is an extension homomorphism 
$ \mathbf{w}(\stesys)
    :
  \cobesys{\stesysf}{\famesys{\stesys}}{\eft}{\eft}
    \to
  \famesys{\famesys{\stesys}}$
for which the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\cobesys{\stesysf}{\famesys{\stesys}}{\eft}{\eft}
  \ar{r}{\mathbf{w}(\stesys)}
  \ar{dr}[swap]{\pullbackpr{1}{\eft}{\eft}}
  \&
\famesys{\famesys{\stesys}}
  \ar{d}{\eft[2]}
  \\
  {}\& 
\stesysf
\end{tikzcd}
\end{equation*}
commutes.
\end{frame}

\begin{frame}
Let $\stesys$ be an extension algebra with pre-weakening operation
$\mathbf{w}(\stesys)$. Then $\famesys{\stesys}$ has the pre-weakening operation
$\mathbf{w}(\famesys{\stesys})$ which is uniquely determined by rendering the
diagram
\begin{small}
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=large]
\cobesys{\stesysf_2}{\famesys{\famesys{\stesys}}}{\eft[2]}{\eft[2]}
  \ar{rr}{%
      \pullback{\beta_1}{\boldsymbol{\beta}}{\eft}{\eft}
    }
  \ar[bend right]{ddr}[swap]{\pullbackpr{1}{\eft[2]}{\eft[2]}}
  \ar[dotted]{dr}{\mathbf{w}(\famesys{\stesys})}
  \&
  {}\&
\cobesys{\stesysf}{\famesys{\stesys}}{\eft}{\eft}
  \ar{r}{\mathbf{w}(\stesys)}
  \&
\famesys{\famesys{\stesys}}
  \ar{d}{\boldsymbol{\beta}}
  \\
  {}\&
\famesys{\famesys{\famesys{\stesys}}}
  \ar{r}{\boldsymbol{\beta}_\mathbf{2}}
  \ar{d}[swap]{\eft[3]}
  \&
\famesys{\famesys{\stesys}}
  \ar{d}{\eft[2]}
  \ar{r}{\boldsymbol{\beta}}
  \&
\famesys{\stesys}
  \ar{d}{\eft}
  \\
  {}\&
\stesysf_2
  \ar{r}[swap]{\efamext}
  \&
\stesysf
  \ar{r}[swap]{\ectxext}
  \&
\stesysc
\end{tikzcd}
\end{equation*}
\end{small}
commutative.
\end{frame}

\begin{frame}
\frametitle{The theory of weakening (Currying)}
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{A}}{P}
    \jfam{\Gamma}{B}
    }
  { \jfameq
      {{{\Gamma}{A}}{P}}
      {\ctxwk{\ctxext{A}{P}}{B}}
      {\ctxwk{P}{{A}{B}}}
    }
\\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{A}}{P}
    \jfam{{\Gamma}{B}}{Q}
    }
  { \jfameq
      {{{{\Gamma}{A}}{P}}{\ctxwk{P}{{A}{B}}}}
      {\ctxwk{\ctxext{A}{P}}{Q}}
      {\ctxwk{P}{{A}{Q}}}
    }
\\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{A}}{P}
    \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jtermeq
      {{{{\Gamma}{A}}{P}}{\ctxwk{P}{{A}{B}}}}
      {\ctxwk{P}{{A}{Q}}}
      {\ctxwk{\ctxext{A}{P}}{g}}
      {\ctxwk{P}{{A}{g}}}
    } 
\end{align*}
\end{frame}

\begin{frame}
\frametitle{Pre-weakening algebras}
A pre-weakening algebra $\stesys$ in $\cat{C}$ is an extension algebra $\stesys$ 
with a pre-weakening operation 
$ \mathbf{w}(\stesys)
    :
  \cobesys{\stesysf}{\famesys{\stesys}}{\eft}{\eft}
    \to
  \famesys{\famesys{\stesys}}$
for which the diagram
\begin{equation*}
\begin{tikzcd}[ampersand replacement=\&,column sep=15em]
\cobesys{\stesysf_2}{\famesys{\stesys}}{\eft\circ\eft[2]}{\eft}
  \ar[bend right=10]{dr}[swap]%
    { [ \pullbackpr{1}{\eft\circ\eft[2]}{\eft},%
        \mathbf{w}(\stesys)%
          \circ%
        (\pullback{\efamext}{\catid{\famesys{\stesys}}}{\eft}{\eft})%
        ]%
      }
  \ar{r}{
    [ \pullbackpr{1}{\eft\circ\eft[2]}{\eft},%
      \mathbf{w}(\stesys)%
        \circ%
      (\pullback{\eft[2]}{\catid{\famesys{\stesys}}}{\eft}{\eft})%
      ]}%
  \&
\cobesys{\stesysf_2}{\famesys{\famesys{\stesys}}}{\eft[2]}{\eft[2]}
  \ar{d}{\mathbf{w}(\famesys{\stesys})}
  \\
  {}\&
\famesys{\famesys{\famesys{\stesys}}}
\end{tikzcd}
\end{equation*}
commutes.
\end{frame}

\begin{frame}
\frametitle{The theory of weakening (Weakening preserves itself)}
\begin{small}
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    \jfam{{\Gamma}{B}}{R}
    }
  { \jfameq
      {{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}}
      {\ctxwk{A}{{Q}{R}}}
      {\ctxwk{{A}{Q}}{{A}{R}}}
    }
\\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    \jfam{{{\Gamma}{B}}{R}}{S}
    }
  { \jfameq
      {{{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}}{\ctxwk{A}{{Q}{R}}}}
      {\ctxwk{A}{{Q}{S}}}
      {\ctxwk{{A}{Q}}{{A}{S}}}
    }
\\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    \jterm{{{\Gamma}{B}}{R}}{S}{k}
    }
  { \jtermeq
      {{{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}}{\ctxwk{A}{{Q}{R}}}}
      {\ctxwk{A}{{Q}{S}}}
      {\ctxwk{A}{{Q}{k}}}
      {\ctxwk{{A}{Q}}{{A}{k}}}
    }
\end{align*}
\end{small}
\end{frame}

\begin{frame}
\frametitle{The theory of projections}
Introduction rules for identity morphisms:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \unfoldall{\jhom{\Gamma}{A}{A}{\idtm{A}}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{A'}
      }
    { \unfoldall{\jhomeq{\Gamma}{A}{A}{\idtm{A}}{\idtm{A'}}}
      }
\end{align*}
Weakening preserves the identity morphism:
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    }
  { \unfoldall{\jhomeq
      {{{\Gamma}{A}}{\ctxwk{A}{B}}}
      {\ctxwk{A}{Q}}
      {\ctxwk{A}{Q}}
      {\ctxwk{A}{\idtm{Q}}}
      {\idtm{\ctxwk{A}{Q}}}
      }
    }
\end{equation*}
\end{frame}

\begin{frame}
\frametitle{The theory of substitution}
\begin{footnotesize}
Introduction rules for substitution:
\begin{align*}
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{\Gamma}{A}}{P}
    }
  { \jfam{\Gamma}{\subst{x}{P}}
    }
& & \inference
    { \jtermeq{\Gamma}{A}{x}{x'}
      \jfameq{{\Gamma}{A}}{P}{P'}
      }
    { \jfameq{\Gamma}{\subst{x}{P}}{\subst{x'}{P'}}
      }
    \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfam{{\Gamma}{\subst{x}{P}}}{\subst[\famsym]{x}{Q}}
    }
& & \inference
    { \jtermeq{\Gamma}{A}{x}{x'}
      \jfameq{{{\Gamma}{A}}{P}}{Q}{Q'}
      }
    { \jfameq{{\Gamma}{\subst{x}{P}}}{\subst[\famsym]{x}{Q}}{\subst[\famsym]{x'}{Q'}}
      }
    \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    }
  { \jterm{{\Gamma}{\subst{x}{P}}}{\subst[\famsym]{x}{Q}}{\subst[\tmsym]{x}{g}}
    }
& & \inference
    { \jtermeq{\Gamma}{A}{x}{x'}
      \jtermeq{{{\Gamma}{A}}{P}}{Q}{g}{g'}
      }
    { \jtermeq
        {{\Gamma}{\subst{x}{P}}}
        {\subst[\famsym]{x}{Q}}
        {\subst[\tmsym]{x}{g}}
        {\subst[\tmsym]{x'}{g'}}
      }
\end{align*}
\end{footnotesize}
\end{frame}

\begin{frame}
\frametitle{The theory of substitution (continued)}
Substitution is compatible with extension:
\begin{align*}
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfameq
      {\Gamma}
      {\subst{x}{\ctxext{P}{Q}}}
      {\ctxext{\subst{x}{P}}{\subst{x}{Q}}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \jfameq
      {{\Gamma}{\subst{x}{P}}}
      {\subst{x}{\ctxext{Q}{R}}}
      {\ctxext{\subst{x}{Q}}{\subst{x}{R}}}
    }
\end{align*}
\pause
Substitution is compatible with itself:
\begin{align*}
& \inference
  { \jterm{\Gamma}{A}{x}
    \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \jfameq
      {{{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}}
      {\subst{x}{{g}{R}}}
      {\subst{{x}{g}}{{x}{R}}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    \jfam{{{{{\Gamma}{A}}{P}}{Q}}{R}}{S}
    }
  { \jfameq
      {{{{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}}{\subst{x}{{g}{R}}}}
      {\subst{x}{{g}{S}}}
      {\subst{{x}{g}}{{x}{S}}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    \jterm{{{{{\Gamma}{A}}{P}}{Q}}{R}}{S}{k}
    }
  { \jtermeq
      {{{{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}}{\subst{x}{{g}{R}}}}
      {\subst{x}{{g}{S}}}
      {\subst{x}{{g}{k}}}
      {\subst{{x}{g}}{{x}{k}}}
    }
\end{align*}
\end{frame}

\begin{frame}
\frametitle{The empty context and family}
\begin{small}
Introduction rules for the empty context and family:
\begin{align*}
& \inference
  { }
  { \jctx{\emptyc}
    }
& & \inference
  { \jctx{\Gamma}
    }
  { \jfam{\Gamma}{\emptyf[\Gamma]}
    }
& & \inference
  { \jctxeq{\Gamma}{\Gamma'}
    }
  { \jfameq{\Gamma}{\emptyf[\Gamma]}{\emptyf[\Gamma']}
    }
\end{align*}
\pause
Compatibility rules for families and contexts:
\begin{align*}
& \inference
  { \jctx{\Gamma}
    }
  { \jfam{\emptyc}{\Gamma}
    } 
& & \inference
    { \jfam{\emptyc}{\Gamma}
      }
    { \jctx{\Gamma}
      }
    \\
& \inference
  { \jctxeq{\Gamma}{\Delta}
    }
  { \jfameq{\emptyc}{\Gamma}{\Delta}
    }
& & \inference
    { \jfameq{\emptyc}{\Gamma}{\Delta}
      }
    { \jctxeq{\Gamma}{\Delta}
      }
\end{align*}
\pause
Compatibility rules for extension and the empty families:
\begin{align*}
& \inference
  { \jctx{\Gamma}
    }
  { \jctxeq{\ctxext{\emptyc}{\Gamma}}{\Gamma}
    }
& & \inference
  { \jctx{\Gamma}
    }
  { \jctxeq{\ctxext{\Gamma}{\emptyf}}{\Gamma}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{\ctxext{\emptyf}{A}}{A}
    }
& & \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{{A}{\emptyf}}{A}
    }
\end{align*}
Compatibility of context extension and family extension:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jctxeq{(\ctxext{\Gamma}{A})^c}{(\ctxext{\Gamma}{A})^\famsym}
    }
\end{align*}
\end{small}
\end{frame}

\begin{frame}
\frametitle{Joining the theories of projections, substitution and the empty context}
To join the three theories we have formulated on top of the theory of extension,
we need to provide rules describing:
\begin{itemize}
\item what happens when something is weakened by the empty family;\pause
\item that weakening preserves the empty context and family;\pause
\item that substitution preserves the empty context and family;\pause
\item that weakening preserves substitution;\pause
\item that substitution preserves weakening;\pause
\item that weakenings are constant families;\pause
\item that substitution preserves the identity morphisms;\pause
\item that identity morphisms act as identity functions;\pause
\item that pullback along the identity morphism has no effect.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Compatibility rules}
Weakening by the empty family:
\begin{align*}
& \inference
  { \jfam{\Gamma}{B}
    }
  { \jfameq{\Gamma}{\ctxwk{\emptyf}{B}}{B}
    }
  \\
& \inference
  { \jfam{{\Gamma}{B}}{Q}
    }
  { \jfameq{{\Gamma}{B}}{\ctxwk{\emptyf}{Q}}{Q}
    }
  \\
& \inference
  { \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jtermeq{{\Gamma}{B}}{Q}{\ctxwk{\emptyf}{g}}{g}
    }
\end{align*}
\pause
Weakening of the empty family:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{{\Gamma}{A}}{\ctxwk{A}{\emptyf}}{\emptyf}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    }
  { \jfameq
    {{{\Gamma}{A}}{\ctxwk{A}{B}}}
    {\ctxwk[\famsym]{A}{\emptyf}}
    {\emptyf}
    }
\end{align*}
\pause
Compatibility of weakening of a family with weakening of a context:
\begin{equation*}
\inference
{ \jfam{\Gamma}{A}
  \jfam{\Gamma}{B}
  }
{ \jfameq{{\Gamma}{A}}{\ctxwk[\famsym]{A}{B}}{\ctxwk{A}{B}}
  }
\end{equation*}
\end{frame}

\begin{frame}
\frametitle{Compatibility rules (continued)}
Substitution of an empty family
\begin{align*}
& \inference
  { \jterm{\Gamma}{A}{x}
    }
  { \jfameq{\Gamma}{\subst{x}{\emptyf}}{\emptyf}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq
      {{\Gamma}{\subst{x}{P}}}
      {\subst{x}{\emptyf}}
      {\emptyf}
    }
\end{align*}
Compatibility of substitution of a family with substitution of a context:
\begin{equation*}
\inference
{ \jfam{{\Gamma}{A}}{P}
  }
{ \jfameq{\Gamma}{\subst[\famsym]{x}{P}}{\subst{x}{P}}
  }
\end{equation*}
\end{frame}

\begin{frame}
\frametitle{Compatibility rules (continued)}
\begin{footnotesize}
Weakening preserves substitution:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jterm{{\Gamma}{B}}{Q}{g}
    \jfam{{{\Gamma}{B}}{Q}}{R}
    }
  { \jfameq
      {{{\Gamma}{A}}{\ctxwk{A}{B}}}
      {\ctxwk{A}{\subst{g}{R}}}
      {\subst{\ctxwk{A}{g}}{\ctxwk{A}{R}}}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    \jterm{{\Gamma}{B}}{Q}{g}
    \jfam{{{{\Gamma}{B}}{Q}}{R}}{S}
    }
  { \jfameq
      {{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{\subst{g}{R}}}}
      {\ctxwk{A}{\subst{g}{S}}}
      {\subst{\ctxwk{A}{g}}{\ctxwk{A}{S}}}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    \jterm{{\Gamma}{B}}{Q}{g}
    \jterm{{{{\Gamma}{B}}{Q}}{R}}{S}{k}
    }
  { \jtermeq
      {{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{\subst{g}{R}}}}
      {\ctxwk{A}{\subst{g}{S}}}
      {\ctxwk{A}{\subst{g}{k}}}
      {\subst{\ctxwk{A}{g}}{\ctxwk{A}{k}}}
    }
\end{align*}
\pause
Substitution preserves weakening:
\begin{align*}
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    \jfam{{{\Gamma}{A}}{P}}{R}
    }
  { \jfameq
      {{{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}}
      {\subst{x}{\ctxwk{Q}{R}}}
      {\ctxwk{\subst{x}{Q}}{\subst{x}{R}}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    \jfam{{{{\Gamma}{A}}{P}}{R}}{S}
    }
  { \jfameq
      {{{{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}}{\subst{x}{\ctxwk{Q}{R}}}}
      {\subst{x}{\ctxwk{Q}{S}}}
      {\ctxwk{\subst{x}{Q}}{\subst{x}{S}}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    \jterm{{{{\Gamma}{A}}{P}}{R}}{S}{k}
    }
  { \jtermeq
      {{{{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}}{\subst{x}{\ctxwk{Q}{R}}}}
      {\subst{x}{\ctxwk{Q}{S}}}
      {\subst{x}{\ctxwk{Q}{k}}}
      {\ctxwk{\subst{x}{Q}}{\subst{x}{k}}}
    }
\end{align*}
\end{footnotesize}
\end{frame}

\begin{frame}
\frametitle{Compatibility rules (continued)}
Weakened families are constant:
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    \jterm{\Gamma}{A}{x}
    }
  { \jfameq
      {\Gamma}
      {\subst{x}{\ctxwk{A}{B}}}
      {B}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    \jterm{\Gamma}{A}{x}
    }
  { \jfameq{{\Gamma}{B}}{\subst{x}{\ctxwk{A}{Q}}}{Q}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jtermeq{{\Gamma}{B}}{Q}{\subst{x}{\ctxwk{A}{g}}}{g}
    }
\end{align*}
\pause
Substitution preserves the identity morphisms
\begin{equation*}
\inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \unfoldall{\jhomeq
      {{\Gamma}{\subst{x}{P}}}
      {\subst{x}{Q}}
      {\subst{x}{Q}}
      {\subst{x}{\idtm{Q}}}
      {\idtm{\subst{x}{Q}}}
    }}
\end{equation*}
\pause
Identity morphisms act as identity functions:
\begin{equation*}
\inference
  { \jterm{\Gamma}{A}{x}
    }
  { \jtermeq{\Gamma}{A}{\subst{x}{\idtm{A}}}{x}
    }
\end{equation*}
\end{frame}

\begin{frame}
\frametitle{Compatibility rules (continued)}
Pullback along identity morphisms has no effect:
\begin{align*}
& \inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq{{\Gamma}{A}}{\subst{\idtm{A}}{\ctxwk{A}{P}}}{P}
    }
  \\
& \inference
  { \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfameq{{{\Gamma}{A}}{P}}{\subst{\idtm{A}}{\ctxwk{A}{Q}}}{Q}
    }
  \\
& \inference
  { \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    }
  { \jtermeq
      {{{\Gamma}{A}}{P}}
      {Q}
      {\subst{\idtm{A}}{\ctxwk{A}{g}}}
      {g}
    }
\end{align*}
\end{frame}
\end{document}
