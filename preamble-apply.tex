%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%% THE APPLY MACRO
%%%%
%%%% The apply macro is used in front of a command which are applicable. Here,
%%%% applicable means that there is a version \macro@apply of \macro. The
%%%% apply macro is mainly used in the macros for article-models-ttinternal.tex
%%%% where there appear abstracted versions of the type theoretical operations.
%%%% Those are operations with possibly many arguments, which are rendered
%%%% invisible for the internalization. When one does want to apply the 
%%%% arguments, the apply macro provides a clean syntax compared to using
%%%% \subst directly.

\makeatletter
\newcommand{\apply}[1]{%
\apply@#1%
}

\newcommand*{\apply@}[1]{%
  \@ifundefined{apply@@\detokenize{#1}}{#1}{%
    \csname apply@@\detokenize{#1}\endcsname
  }%
}

\newcommand*{\apply@def}[1]{%
  \expandafter\def\csname apply@@\detokenize{#1}\expandafter\endcsname
  \expandafter{%
    \csname\expandafter\@gobble\string#1@apply\endcsname
  }%
}

%%%% Now we make @apply versions of various macros

\newcommand{\cftctxext@apply}[3][]{\subst{#3}{{#2}{\cftctxext[#1]}}}
\apply@def\cftctxext

\newcommand{\cftfamext@apply}[4][]{\subst{#4}{{#3}{{#2}{\cftfamext[#1]}}}}
\apply@def\cftfamext

\makeatother
