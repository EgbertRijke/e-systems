\section{Identity types}
The identity types may now be formulated just as in ordinary Martin\nobreakdash-L\"of
type theory. However, since all model categories have path objects, we will also
introduce identity types for contexts.

We will use the symbol $\reflsym$ slightly different than the book does. For us,
$\refl{A}$ is a term of $\subst{\idfunc[A]}{\idtypevar{A}}$ in context
$\ctxext{\Gamma}{A}$ and we will write $\subst{x}{\refl{A}}$ for the reflexivity
path at $x$ (which would have been denoted by $\refl{x}$ in the book).

A notable difference in the formulation of identity types is that in our current
setting we must state the elimination rule not only for families $P$ in context
$\ctxext{{\Gamma}{\ctxwk{\Gamma}{\Gamma}}}{\idtypevar{\Gamma}}$,
but also for families $Q$ in context 
$\ctxext{{{\Gamma}{\ctxwk{\Gamma}{\Gamma}}}{\idtypevar{\Gamma}}}{P}$. The reason
is that all operations have to be closed under slicing: everything may happen
in a context. Secretly, a reason is that we don't have dependent function types.
We wouldn't even be able to find the transport maps if we didn't state the
identity elimination in an extended context.

\begin{align}
& \inference{\jctx{\Gamma}}{\jtype{\ctxext{\Gamma}{\ctxwk{\Gamma}{\Gamma}}}{\idtypevar{\Gamma}}}\\
& \inference{\jctx{\Gamma}}{\jterm{\Gamma}{\subst{\idfunc[\Gamma]}{\idtypevar{\Gamma}}}{\refl{\Gamma}}}\\
& \inference{\jtype{\ctxext{{\Gamma}{\ctxwk{\Gamma}{\Gamma}}}{\idtypevar{\Gamma}}}{P}
           \qquad
           \jterm{\Gamma}{\subst{\refl{\Gamma}}{{\idfunc[\Gamma]}{P}}}{d}}
           {\jterm{\ctxext{{\Gamma}{\ctxwk{\Gamma}{\Gamma}}}{\idtypevar{\Gamma}}}{P}{\tfJ(d)}}\\
& \inference{\jtype{\ctxext{{\Gamma}{\ctxwk{\Gamma}{\Gamma}}}{\idtypevar{\Gamma}}}{P}\qquad
\jterm{\Gamma}{\subst{\refl{\Gamma}}{{\idfunc[\Gamma]}{P}}}{d}}
{\jtermeq
  {\ctxext{{\Gamma}{\ctxwk{\Gamma}{\Gamma}}}{\idtypevar{\Gamma}}}
  {\subst{\refl{\Gamma}}{{\idfunc[\Gamma]}{P}}}
  {\subst{\refl{\Gamma}}{{\idfunc[\Gamma]}{\tfJ(d)}}}
  {d}}\\
& \inference{\jtype{\ctxext{{{\Gamma}{\ctxwk{\Gamma}{\Gamma}}}{\idtypevar{\Gamma}}}{P}}{Q}
           \qquad
           \jterm{\ctxext{\Gamma}{\subst{\refl{\Gamma}}{{\idfunc[\Gamma]}{P}}}}{\subst{\refl{\Gamma}}{{\idfunc[\Gamma]}{Q}}}{d}}
           {\jterm{\ctxext{{{\Gamma}{\ctxwk{\Gamma}{\Gamma}}}{\idtypevar{\Gamma}}}{P}}{Q}{\tfJ(d)}}\\
& \inference
  {\jtype
    {\ctxext{{{\Gamma}{\ctxwk{\Gamma}{\Gamma}}}{\idtypevar{\Gamma}}}{P}}
    {Q}
  \qquad
  \jterm
    {\ctxext{\Gamma}{\subst{\refl{\Gamma}}{{\idfunc[\Gamma]}{P}}}}
    {\subst{\refl{\Gamma}}{{\idfunc[\Gamma]}{Q}}}
    {d}}
  {\jtermeq
    {\ctxext{{{\Gamma}{\ctxwk{\Gamma}{\Gamma}}}{\idtypevar{\Gamma}}}{P}}
    {\subst{\refl{\Gamma}}{{\idfunc[\Gamma]}{Q}}}
    {\subst{\refl{\Gamma}}{{\idfunc[\Gamma]}{\tfJ(d)}}}
    {d}}
\end{align}

Likewise, we introduce identity types in a context.

\begin{align}
& \inference{\jtype{\Gamma}{A}}{\jtype{\ctxext{{\Gamma}{A}}{\ctxwk{A}{A}}}{\idtypevar{A}}}\\
& \inference{\jtype{\Gamma}{A}}{\jterm{\ctxext{\Gamma}{A}}{\subst{\idfunc[A]}{\idtypevar{A}}}{\refl{A}}}\\
& \inference{\jtype{\ctxext{{{\Gamma}{A}}{\ctxwk{A}{A}}}{\idtypevar{A}}}{P}\qquad
\jterm{\ctxext{\Gamma}{A}}{\subst{\refl{A}}{{\idfunc[A]}{P}}}{d}}
{\jterm{\ctxext{{{\Gamma}{A}}{\ctxwk{A}{A}}}{\idtypevar{A}}}{P}{\tfJ(d)}}\\
& \inference{\jtype{\ctxext{{{\Gamma}{A}}{\ctxwk{A}{A}}}{\idtypevar{A}}}{P}\qquad
\jterm{\ctxext{\Gamma}{A}}{\subst{\refl{A}}{{\idfunc[A]}{P}}}{d}}
{\jtermeq
  {\ctxext{{{\Gamma}{A}}{\ctxwk{A}{A}}}{\idtypevar{A}}}
  {\subst{\refl{A}}{{\idfunc[A]}{P}}}
  {\subst{\refl{A}}{{\idfunc[A]}{\tfJ(d)}}}
  {d}}
\end{align}

Suppose we have terms $\jterm{\Gamma}{A}{x}$ and $\jterm{\Gamma}{A}{y}$. Then
we may define $\id[A]{x}{y}\defeq\subst{y}{{x}{\idtypevar{A}}}$. A term
$\jterm{\Gamma}{\id[A]{x}{y}}{p}$ is called an identification of $x$ and $y$.

\subsubsection{Basic properties of identity types}
In this subsubsection we prove some basic properties of identity types, just to
know whether we got the type theory right.

Suppose we have a family $\jtype{\ctxext{\Gamma}{A}}{P}$. Then we can consider
the family $\jtype{\ctxext{{\Gamma}{A}}{\ctxwk{A}{A}}}{\ctxwk{A}{P}}$, which has the role of the family $\jtype{\Gamma,\,x,y:A}{P(y)}$
of ordinary Martin-L\"of type theory. We may also consider the family
$\jtype{\ctxext{{\Gamma}{A}}{\ctxwk{A}{A}}}{\ctxwk{{A}{A}}{P}}$; this one has the
role of the family $\jtype{\Gamma,\,x,y:A}{P(x)}$. Those are families in the
same context, so we have
\begin{equation*}
\jtype{\ctxext{{{\Gamma}{A}}{\ctxwk{A}{A}}}{\ctxwk{{A}{A}}{P}}}{\ctxwk{\ctxwk{{A}{A}}{P}}{{A}{P}}}
\end{equation*}

\begin{lem}
There is a term
\begin{equation*}
\jterm{\ctxext{{{{\Gamma}{A}}{\ctxwk{A}{A}}}{\idtypevar{A}}}{\ctxwk{\idtypevar{A}}{{{A}{A}}{P}}}}{\ctxwk{\idtypevar{A}}{{{{A}{A}}{P}}{{A}{P}}}}{\transfibf{P}}
\end{equation*}
\end{lem}

\begin{proof}
By identity elimination it suffices to find a term
\begin{equation*}
\jterm{\ctxext{\Gamma}{A}}{\subst{\refl{A}}{{\idfunc[A]}{\ctxwk{\idtypevar{A}}{{{{A}{A}}{P}}{{A}{P}}}}}}{t}
\end{equation*}
By the judgmental equality $\jtypeeq{\Gamma}{\subst{{x}{f}}{{x}{Q}}}{\subst{x}{{f}{Q}}}$
it follows that we have the judgmental equalities
\begin{align*}
& \subst{\refl{A}}{{\idfunc[A]}{\ctxwk{\idtypevar{A}}{{{{A}{A}}{P}}{{A}{P}}}}}\\
& \qquad \jdeq \subst{\idfunc[A]}{{\ctxwk{{A}{A}}{\refl{A}}}{\ctxwk{\idtypevar{A}}{{{{A}{A}}{P}}{{A}{P}}}}}\\
& \qquad \jdeq \subst{\idfunc[A]}{\ctxwk{{{A}{A}}{P}}{{A}{P}}}\\
& \qquad \jdeq \ctxwk{\subst{\idfunc[A]}{\ctxwk{{A}{A}}{P}}}{\subst{\idfunc[A]}{\ctxwk{A}{P}}}\\
& \qquad \jdeq \ctxwk{P}{P}
\end{align*}
in context $\ctxext{{\Gamma}{A}}{P}$. We have the term $\jterm{\ctxext{{\Gamma}{A}}{P}}{\ctxwk{P}{P}}{\idfunc[P]}$.
\end{proof}

Suppose we have a term $\jterm{\ctxext{\Gamma}{A}}{P}{f}$. 

Using identity types, we can assert that a function $\jhom{\Gamma}{\Delta}{f}$ has
a left inverse $\jhom{\Delta}{\Gamma}{g}$ by asserting that there is an identification
\begin{equation*}
..
\end{equation*}

\subsubsection{Compatibility of identity types with extension}

\subsubsection{Compatibility of identity types with weakening}
Suppose $A$ and $B$ are types in context $\Gamma$. Then we can consider the types
\begin{align*}
\jtype*{\ctxext{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{{B}{B}}}}{\ctxwk{A}{\idtypevar{B}}}\\
\jtype*{\ctxext{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{{A}{B}}{{A}{B}}}}{\idtypevar{\ctxwk{A}{B}}}
\end{align*}
Note that we have the judgmental equality
\begin{equation*}
\jtypeeq
  {\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}
  {\ctxwk{A}{{B}{B}}}
  {\ctxwk{{A}{B}}{{A}{B}}}
\end{equation*}
so $\ctxwk{A}{\idtypevar{B}}$ and $\idtypevar{\ctxwk{A}{B}}$ are types in the
same context. 

\begin{lem}
There is a term of type
\begin{equation*}
\jterm
  {\ctxext{{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{{A}{B}}{{A}{B}}}}{\idtypevar{\ctxwk{A}{B}}}}
  {\ctxwk{\idtypevar{\ctxwk{A}{B}}}{\ctxwk{A}{\idtypevar{B}}}}
  {\typefont{idwktowkid}}
\end{equation*}
\end{lem}

\begin{proof}
By the identity elimination rule it suffices to find a term
\begin{equation*}
\jterm
  {\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}
  {\subst{\refl{\ctxwk{A}{B}}}{{\idfunc[\ctxwk{A}{B}]}{\ctxwk{\idtypevar{\ctxwk{A}{B}}}{\ctxwk{A}{\idtypevar{B}}}}}}
  {i}
\end{equation*}
We may simplify the type $\subst{\refl{\ctxwk{A}{B}}}{{\idfunc[\ctxwk{A}{B}]}{\ctxwk{\idtypevar{\ctxwk{A}{B}}}{\ctxwk{A}{\idtypevar{B}}}}}$ as follows:
\begin{align*}
& \subst{\refl{\ctxwk{A}{B}}}{{\idfunc[\ctxwk{A}{B}]}{\ctxwk{\idtypevar{\ctxwk{A}{B}}}{\ctxwk{A}{\idtypevar{B}}}}}\\
& \qquad\jdeq \subst{\idfunc[\ctxwk{A}{B}]}{{\ctxwk{..}{\refl{\ctxwk{A}{B}}}}{\ctxwk{\idtypevar{\ctxwk{A}{B}}}{\ctxwk{A}{\idtypevar{B}}}}}
\end{align*}
\end{proof}

\subsubsection{Compatibility of identity types with substitution}

\subsection{Generalized identity types}

\begin{infarray}{c}
\inference{\jterm{\Gamma}{A}{x}}{\jtype{\ctxext{\Gamma}{A}}{\eqtype{x}}}\\
\inference{\jterm{\Gamma}{A}{x}}{\jterm{\Gamma}{\subst{x}{\eqtype{x}}}{\refl{x}}}\\
\inference{\jtype{\ctxext{{\Gamma}{A}}{\eqtype{x}}}{P}\qquad\jterm{\Gamma}{\subst{\refl{x}}{{x}{P}}}{d}}
          {\jterm{\ctxext{{\Gamma}{A}}{\eqtype{x}}}{P}{\ind{\eqtype{x}}(d)}}\\
\inference{\jtype{\ctxext{{\Gamma}{A}}{\eqtype{x}}}{P}\qquad\jterm{\Gamma}{\subst{\refl{x}}{{x}{P}}}{d}}
          {\jtermeq{\ctxext{{\Gamma}{A}}{\eqtype{x}}}{\subst{\refl{x}}{{x}{P}}}{\subst{\refl{x}}{{x}{\ind{\eqtype{x}}(d)}}}{d}}
\end{infarray}

We get something that looks like Paulin-Mohring equality. But we should be able to use it to
show that every $\jterm{\Gamma}{\ctxwk{\Gamma}{\Delta}}{f}$ is a trivial cofibration.

For the following conjecture, note that if we have $\jterm{\Gamma}{\ctxwk{\Gamma}{\Delta}}{f}$
Then we may consider the type $\jtype{\ctxext{{\Gamma}{\ctxwk{\Gamma}{\Delta}}}{\ctxwk{\Gamma}{{\Delta}{\Delta}}}}
{\ctxwk{\Gamma}{\idtypevar{\Delta}}}$ and we may substitute $f$ to obtain the type
\begin{equation*}
\jtype{\ctxext{\Gamma}{\subst{f}{\ctxwk{\Gamma}{{\Delta}{\Delta}}}}}
{\subst{f}{\ctxwk{\Gamma}{\idtypevar{\Delta}}}}
\end{equation*}
Note that we have the judgmental equality
\begin{equation*}
\jtypeeq{\Gamma}{\subst{f}{\ctxwk{\Gamma}{{\Delta}{\Delta}}}}{\ctxwk{\Gamma}{\Delta}}
\end{equation*}
so we obtain the type
\begin{equation*}
\jtype{\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}}
{\subst{f}{\ctxwk{\Gamma}{\idtypevar{\Delta}}}}
\end{equation*}
We also have $\jtype{\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}}{\eqtype{f}}$, so we
may ask for a term of type $\ctxwk{\eqtype{f}}{\subst{f}{\ctxwk{\Gamma}{\idtypevar{\Delta}}}}$
in context $\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}$ and we can ask ourselves the question
whether this is a trivial cofibration. This is the content of the following conjecture.

\begin{conj}
There is a term
\begin{equation*}
\jterm{\ctxext{{\Gamma}{\ctxwk{\Gamma}{\Delta}}}{\eqtype{f}}}{\ctxwk{\eqtype{f}}{\subst{f}{\ctxwk{\Gamma}{\idtypevar{\Delta}}}}}{\eqtoid{f}}
\end{equation*}
Moreover, $\eqtoid{f}$ is a trivial cofibration.
\end{conj}

\begin{proof}
We use the induction principle of $\eqtype{f}$ to construct $\eqtoid{f}$. Thus, we
have to find a term
\begin{equation*}
\jterm
  {\Gamma}
  {\subst{\refl{f}}{{f}{\ctxwk{\eqtype{f}}{\subst{f}{\ctxwk{\Gamma}{\idtypevar{\Delta}}}}}}}
  {\subst{\refl{f}}{{f}{\eqtoid{f}}}}
\end{equation*}
Note that we have the judgmental equalities
\begin{align*}
\subst{\refl{f}}{{f}{\ctxwk{\eqtype{f}}{\subst{f}{\ctxwk{\Gamma}{\idtypevar{\Delta}}}}}}
& \jdeq \subst{f}{{\ctxwk{{\Gamma}{\Delta}}{\refl{f}}}{\ctxwk{\eqtype{f}}{\subst{f}{\ctxwk{\Gamma}{\idtypevar{\Delta}}}}}} \\
& \jdeq \subst{f}{\ctxwk{\Gamma}{\subst{f}{\ctxwk{\Gamma}{\idtypevar{\Delta}}}}}
\end{align*}
where we find the term $\subst{f}{\ctxwk{\Gamma}{\subst{f}{\ctxwk{\Gamma}{\refl{\Delta}}}}}$.
\end{proof}

\begin{conj}
Suppose we have a type $\eqtype{x}$ for every term $\jterm{\Gamma}{A}{x}$. Then
every term $\jterm{\Gamma}{\ctxwk{\Gamma}{\Delta}}{f}$ is a trivial cofibration.
\end{conj}

\begin{proof}
Suppose that $Q$ is a type in context $\Delta$. We want to show that
\begin{equation*}
\inference{\jterm{\Gamma}{\subst{f}{\ctxwk{\Gamma}{Q}}}{g}}{\jterm{\Delta}{Q}{\tilde{g}}}
\end{equation*}
Let $g$ be a term of $\subst{f}{\ctxwk{\Gamma}{Q}}$ in context $\Gamma$. We get
the term
\begin{equation*}
\jterm{\Gamma}{\subst{\refl{f}}{{f}{\ctxwk{\eqtype{f}}{{\Gamma}{Q}}}}}{\subst{\refl{f}}{\ctxwk{\eqtype{f}}{g}}}
\end{equation*}
which is judgmentally equal to $g$; the types

For any term $\jterm{\Gamma}{\subst{f}{\ctxwk{\Gamma}{Q}}}{g}$ we get a term 
$\jterm{\Gamma}{\subst{\refl{x}}{{x}{P}}}{d}$.

$\jterm{\ctxext{{\Gamma}{\ctxwk{\Gamma}{\Delta}}}{\eqtype{f}}}{\ctxwk{\Gamma}{Q}}{\ind{\eqtype{f}}(d)}$.
\end{proof}

However, we could take other classes of terms, such as the projections
$\proj1:\ctxwk{\ctxext{\Gamma}{A}}{\Gamma}$. Let's see how that goes:

\begin{infarray}{c}
\inference{\jtype{\Gamma}{A}}{\jtype{\ctxext{{\Gamma}{A}}{\ctxwk{\ctxext{\Gamma}{A}}{\Gamma}}}{\eqtype{\proj1^A}}}\\
\inference{\jtype{\Gamma}{A}}{\jterm{\ctxext{\Gamma}{A}}{\subst{\proj1^A}{\eqtype{\proj1^A}}}{\refl{\proj1^A}}}
\end{infarray}

