\section{Internalizing the theory of contexts families and terms}
One of the guiding ideas behind the design of the theory of contexts, families
and terms was that it would have to be possible to consider internal versions
of the theory. In this section we aim for this internalization. We stress that
we shall not make any further assumptions in this section, and thus that
it is \emph{by default} possible to consider internal models of the theory
of contexts, families and terms in itself. In particular, we do not assume that
there are universes; this is the subject of a later section in this part.

It would be interesting to write out a weak version of pre-universes, internal
to Martin-L\"of type theory with the function extensionality principle. 
To do this, the empty context needs to
be replaced by a contractible type, extension by dependent pair types,
judgmental equalities of terms by identifications and judgmental equalities
of families by equivalences of types. We conjecture that it is possible to
carry this out (in particular to make sure that all the constructions 
type-check). This could serve as a starting point for investigating internal
models without truncatedness assumptions and for investigating internal higher
categories. 
Moreover, one could then extend the notion of `weak' pre-universes
with the requirement that every internal morphism is weakly anodyne. This
could give an internal theory of weak higher groupoids.

\subsection{Extension algebras}\label{sec:extension-algebras}
In this subsection our goal is to define the notion of extension algebras,
which are internal versions of the extension operation of the theory of
contexts, families and terms. In this article, their use will be mainly in
universes. The theory of extension algebras requires the full power (i.e.~all
of the ingredients) of the theory of contexts, families and terms in its
formulation and it is (perhaps surprisingly) quite involved to formulate it.
The definition of extension algebras is given in \autoref{defn:extension-algebras}.

Let $P$ be a family over an extended context $\ctxext{\Gamma}{A}$. We could
mimic extension by requiring to have terms
\begin{align*}
\jhom*{\Gamma}{{A}{P}}{A}{e_0}\\
\jhom*{{\Gamma}{A}}{{P}{\jcomp{}{e_0}{P}}}{P}{e_1}.
\end{align*}

\begin{rmk}
Instead of looking at $e_1$ as a context morphism from $\ctxext{P}{\jcomp{}{e_0}{P}}$
to $P$, one could also look at $e_1$ as a morphism \emph{over $\cprojfstf{A}{P}$},
as indicated in the following diagram:
\begin{equation*}
\begin{tikzcd}
P
  \ar[fib]{d}
& \jcomp{}{e_0}{P}
  \ar[fib]{d}
  \ar{l}[swap]{e_1}
  \ar{r}
& P
  \ar[fib]{d}
  \\
A
& \ctxext{A}{P}
  \ar{l}{\cprojfstf{A}{P}}
  \ar{r}[swap]{e_0}
& A
\end{tikzcd}
\end{equation*}
This makes it clear that $e_1$ takes a family over an extended context as an
argument. The extended context consists of a `base part' and a `family part'. 
The output of $e_1$ is a new (extended) family over that base part. Forgetting 
the family part is what the projection takes care of.
\end{rmk}

Extension also satisfies the properties explained in \autoref{comp-ee}, so we
must find the two judgmental equalities for $e_0$ and $e_1$ mimicing those. 
The first of these judgmental equalities is easy to give: it says that the
following diagram commutes:
\begin{equation}\label{eq:extalg-eq1}
\begin{tikzcd}[column sep=huge]
\ctxext{A}{{P}{\jcomp{}{e_0}{P}}} 
  \ar{d}[swap]{\jvcomp{}{e_0}{\idtm{\jcomp{}{e_0}{P}}}
    } 
  \ar{r}{\jvcomp{}{\idtm{A}}{e_1}
    } 
  & \ctxext{A}{P} \ar{d}{e_0}\\
\ctxext{A}{P} \ar{r}[swap]{e_0} & A
\end{tikzcd}
\end{equation}

The second of the judgmental equalities is harder to describe, however. We need
to consider `higher' families, i.e.~families over families over families, and
thus we need to look at the family $\jcomp{}{e_0}{\jcomp{}{e_0}{P}}$ and find the
two dotted morphisms in the diagram
\begin{equation*}
\begin{tikzcd}
\ctxext{P}{{\jcomp{}{e_0}{P}}{\jcomp{}{e_0}{\jcomp{}{e_0}{P}}}}
  \ar[densely dotted]{d}
  \ar[densely dotted]{r}
& \ctxext{P}{\jcomp{}{e_0}{P}} \ar{d}{e_1}\\
\ctxext{P}{\jcomp{}{e_0}{P}} \ar{r}{e_1} & P
\end{tikzcd}
\end{equation*}
The first is easy to find. Note that we have the judgmental equality
\begin{equation*}
\ctxext{\jcomp{}{e_0}{P}}{\jcomp{}{e_0}{\jcomp{}{e_0}{P}}}
  \jdeq
  \jcomp{}{e_0}{\ctxext{P}{\jcomp{}{e_0}{P}}}
\end{equation*}
and therefore we may just take the morphism
\begin{equation*}
\jhom
  {{\Gamma}{A}}
  {{P}{{\jcomp{}{e_0}{P}}{\jcomp{}{e_0}{\jcomp{}{e_0}{P}}}}}
  {{P}{\jcomp{}{e_0}{P}}}
  {\jvcomp{}{\idtm{P}}{\jcomp{}{e_0}{e_1}}}.
\end{equation*}
For the other morphism we need to look at the family
$\ctxext{P}{{\jcomp{}{e_0}{P}}{\jcomp{}{e_0}{\jcomp{}{e_0}{P}}}}$ differently. We do
that in the following lemma.

\begin{lem}\label{lem:extalg-twins}
Suppose we have $A$, $P$, $e_0$ and $e_1$ satisfying \autoref{eq:extalg-eq1}. Then
the inference rules
\begin{align*}
& \inference
  { \jfam{{\Gamma}{A}}{Q}
    }
  { \jfameq
      {{{{\Gamma}{A}}{P}}{\jcomp{}{e_0}{P}}}
      {\jcomp{}{e_0}{\jcomp{}{e_0}{Q}}}
      {\jcomp{}{e_1}{\jcomp{}{e_0}{Q}}}
    }
  \\
& \inference
  { \jfam{{{\Gamma}{A}}{Q}}{R}
    }
  { \jfameq
      {{{{{\Gamma}{A}}{P}}{\jcomp{}{e_0}{P}}}
        {\jcomp{}{e_0}{\jcomp{}{e_0}{Q}}}}
      {\jcomp{}{e_0}{\jcomp{}{e_0}{R}}}
      {\jcomp{}{e_1}{\jcomp{}{e_0}{R}}}
    }
  \\
& \inference
  { \jterm{{{\Gamma}{A}}{Q}}{R}{h}
    }
  { \jtermeq
      {{{{{\Gamma}{A}}{P}}{\jcomp{}{e_0}{P}}}
        {\jcomp{}{e_0}{\jcomp{}{e_0}{Q}}}}
      {\jcomp{}{e_0}{\jcomp{}{e_0}{R}}}
      {\jcomp{}{e_0}{\jcomp{}{e_0}{h}}}
      {\jcomp{}{e_1}{\jcomp{}{e_0}{h}}}
    }
\end{align*}
are valid.
\end{lem}

\begin{proof}
We only prove the first inference rule. Let $\jfam{{\Gamma}{A}}{Q}$ be a family.
Then we have the judgmental equalities
\begin{align*}
\jcomp{}{e_0}{\jcomp{}{e_0}{Q}}
& \jdeq
  \jcomp{}{\idtm{\jcomp{}{e_0}{P}}}{\jcomp{}{e_0}{\jcomp{}{e_0}{Q}}}
  \tag{by \autoref{precomp-idtm-f}}
  \\
& \jdeq
  \jcomp{}{\jvcomp{}{e_0}{\idtm{\jcomp{}{e_0}{P}}}}{\jcomp{}{e_0}{Q}}
  \tag{by \autoref{lem:composition-threesome}}
  \\
& \jdeq
  \jcomp{}{\jcomp{}{\jvcomp{}{e_0}{\idtm{\jcomp{}{e_0}{P}}}}{e_0}}{Q}
  \tag{by \autoref{lem:jcomp-jcomp}}
  \\
& \jdeq
  \jcomp{}{\jcomp{}{\jvcomp{}{\idtm{A}}{e_1}}{e_0}}{Q}
  \tag{by \autoref{eq:extalg-eq1}}
  \\
& \jdeq
  \jcomp{}{\jvcomp{}{\idtm{A}}{e_1}}{\jcomp{}{e_0}{Q}}
  \tag{by \autoref{lem:jcomp-jcomp}}
  \\
& \jdeq
  \jcomp{}{e_1}{\jcomp{}{\idtm{A}}{\jcomp{}{e_0}{Q}}}
  \tag{by \autoref{lem:composition-threesome}}
  \\
& \jdeq
  \jcomp{}{e_1}{\jcomp{}{e_0}{Q}}.
  \tag{by \autoref{precomp-idtm-f}}
\end{align*}
\end{proof}

Now we see that we can use the morphism
\begin{equation*}
\jhom
  {{\Gamma}{A}}
  {{P}{{\jcomp{}{e_0}{P}}{\jcomp{}{e_1}{{}{e_0}{P}}}}}
  {{P}{\jcomp{}{e_0}{P}}}
  {\jvcomp{}{e_1}{\idtm{\jcomp{}{e_1}{{}{e_0}{P}}}}}.
\end{equation*}
Thus, the second judgmental equality we will need is that the diagram
\begin{equation}\label{eq:extalg-eq2}
\begin{tikzcd}[column sep=huge]
\ctxext{P}{{\jcomp{}{e_0}{P}}{\jcomp{}{e_0}{{}{e_0}{P}}}} 
  \ar{r}{\jvcomp{}{\idtm{P}}{\jcomp{}{e_0}{e_1}}}
  \ar{d}[swap]{
    \jvcomp{}{e_1}{\idtm{\jcomp{}{e_1}{{}{e_0}{P}}}}
    }
& \ctxext{P}{\jcomp{}{e_0}{P}} \ar{d}{e_1}\\
\ctxext{P}{\jcomp{}{e_0}{P}} \ar{r}[swap]{e_1} & P
\end{tikzcd}
\end{equation}
commutes judgmentally. Now we can confidently formulate the definition of
extension algebras.

\begin{defn}\label{defn:extension-algebras}
We define the judgment
\begin{equation*}
\jextalg{\Gamma}{A}
\end{equation*}
asserting that $\extalg{A}$ is an \emph{extension algebra in context $\Gamma$}
to be the conjunction of the following seven judmgents:
\begin{align*}
\jextalgctx*{\Gamma}{A}
  \\
\jextalgfam*{\Gamma}{A}
  \\
\jextalgtm*{\Gamma}{A}
  \\
\jextalgctxext*{\Gamma}{A}
  \\
\jextalgfamext*{\Gamma}{A}
  \\
\jhomeq*
  { \Gamma}
  { {\cftalgc{\cftalg{A}}}
    { {\cftalgf{\cftalg{A}}}
      {\jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}
      }
    }
  { \cftalgc{\cftalg{A}}}
  { \jcomp{}
      { \jvcomp{}
          {\cftctxext[\cftalg{A}]}
          {\idtm{\jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}}
        }
      { \cftctxext[\cftalg{A}]}
    }
  { \jcomp{}
      { \jvcomp{}
          {\idtm{\cftalgc{\cftalg{A}}}}
          {\cftfamext[\cftalg{A}]}
        }
      { \cftctxext[\cftalg{A}]}
    }
  \\
\jhomeq*
  { {\Gamma}{\cftalgc{\cftalg{A}}}}
  { { \cftalgf{\cftalg{A}}}
    { { \jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}
      { \jcomp{}
          {\cftctxext[\cftalg{A}]}
          {{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}
        }
      }
    }
  { \cftalgf{\cftalg{A}}}
  { \jcomp{}
      { \cftfamext[\cftalg{A}]}
      { \jvcomp{}
          {\cftfamext[\cftalg{A}]}
          {\idtm{\jcomp{}{\cftfamext[\cftalg{A}]}{{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}}}}
    }
  { \jcomp{}
      { \cftfamext[\cftalg{A}]}
      { \jvcomp{}
          {\idtm{\cftalgf{\cftalg{A}}}}
          {\jcomp{}{\cftctxext[\cftalg{A}]}{\cftfamext[\cftalg{A}]}}
        }
    }
\end{align*}
In other words, an extension algebra $\extalg{A}$ in context $\Gamma$
is a quintuple $\unfold{\extalg{A}}$ 
satisfying the judgmental equalities displayed in the diagrams in
\autoref{eq:extalg-eq1,eq:extalg-eq2}. Extension algebras are judgmentally
equal if they are componentwise judgmentally equal.

When $\extalg{A}$ is an extension algebra in context $\Gamma$, we also refer to
$\cftctxext[\cftalg{A}]$ as the \emph{context extension of $\extalg{A}$} and to
$\cftfamext[\cftalg{A}]$ as the \emph{family extension of $\extalg{A}$}.
\end{defn}

The following lemma both provides intuition behind the judgmental equalities
we have required for context and family extension and it proves that context 
and family extension in fact satisfy the compatibility rules stated in 
\autoref{comp-ee}. 

\begin{lem}
Let $\extalg{A}$ be an extension algebra in context $\Gamma$.
Then $\cftctxext[\extalg{A}]$ and $\cftfamext[\extalg{A}]$ 
correctly interpret the rules for context
extension and family extension. 

More precisely, for $x_0:\cftalgc{\cftalg{A}}$, 
$x_1:\subst{x_0}{\cftalgf{\cftalg{A}}}$ and 
$x_2:\subst{{x_1}{{x_0}{\cftctxext[\extalg{A}]}}}{\cftalgf{\cftalg{A}}}$ 
we have the judgmental equality
\begin{align*}
\subst{{x_2}{{x_1}{\cftfamext[\extalg{A}]}}}{{x_0}{\cftctxext[\extalg{A}]}}
& \jdeq
  \subst
    {x_2}
    {{{x_1}{{x_0}{\cftctxext[\extalg{A}]}}}{\cftctxext[\extalg{A}]}}.
  \intertext{%
and for $y_0:\cftalgf{\extalg{A}}$, 
$y_1:\subst{y_0}{\jcomp{}{\cftfamext[\extalg{A}]}{\cftalgf{\extalg{A}}}}$ and 
$y_2:
  \subst
    {y_1}
    { {y_0}
      { \jcomp
          {}
          {\cftfamext[\extalg{A}]}
          {\jcomp{}{\cftfamext[\extalg{A}]}{\cftalgf{\extalg{A}}}}
        }
      }
$
we have the judgmental equality}
\subst
  {{y_2}{{y_1}{\jcomp{}{\cftfamext[\extalg{A}]}{\cftfamext[\extalg{A}]}}}}
  {{y_0}{\cftfamext[\extalg{A}]}}
& \jdeq
  \subst{y_2}{{{y_1}{{y_0}{\cftfamext[\extalg{A}]}}}{\cftfamext[\extalg{A}]}}.
\end{align*}
\end{lem}

\begin{proof}
Both proofs are simple calculations. For the first judgmental equality we have
\begin{align*}
\subst{{x_2}{{x_1}{\cftfamext[\cftalg{A}]}}}{{x_0}{\cftctxext[\cftalg{A}]}}
& \jdeq
  \subst{\tmext{x_0}{\subst{x_2}{{x_1}{\cftfamext[\cftalg{A}]}}}}{\cftctxext[\cftalg{A}]}
  \\
& \jdeq 
  \subst{{x_2}{{x_1}{{x_0}{\jvcomp{}{\idtm{\cftalgc{\cftalg{A}}}}{\cftfamext[\cftalg{A}]}}}}}{\cftctxext[\cftalg{A}]}
  \\
& \jdeq
  \subst{x_2}{{x_1}{{x_0}{\jcomp{}{\jvcomp{}{\idtm{\cftalgc{\cftalg{A}}}}{\cftfamext[\cftalg{A}]}}{\cftctxext[\cftalg{A}]}}}}
  \\
& \jdeq
  \subst{x_2}{{x_1}{{x_0}{\jcomp{}{\jvcomp{}{\cftctxext[\cftalg{A}]}{\idtm{\jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}}}{\cftctxext[\cftalg{A}]}}}}
  \\
& \jdeq 
  \subst{{x_2}{{x_1}{{x_0}{\jvcomp{}{\cftctxext[\cftalg{A}]}{\idtm{\jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}}}}}}{\cftctxext[\cftalg{A}]}
  \\
& \jdeq
  \subst{\tmext{\subst{x_1}{{x_0}{\cftctxext[\cftalg{A}]}}}{x_2}}{\cftctxext[\cftalg{A}]}
  \\
& \jdeq
  \subst{x_2}{{{x_1}{{x_0}{\cftctxext[\cftalg{A}]}}}{\cftctxext[\cftalg{A}]}}.
\end{align*}
and to prove the second judgmental equality we calculate
\begin{align*}
\subst{{y_2}{{y_1}{\jcomp{}{\cftctxext[\cftalg{A}]}{\cftfamext[\cftalg{A}]}}}}{{y_0}{\cftfamext[\cftalg{A}]}}
& \jdeq
  \subst{\tmext{y_0}{\subst{y_2}{{y_1}{\jcomp{}{\cftctxext[\cftalg{A}]}{\cftfamext[\cftalg{A}]}}}}}{\cftfamext[\cftalg{A}]}
  \\
& \jdeq
  \subst{{y_2}{{y_1}{{y_0}{\jvcomp{}{\idtm{P}}{\jcomp{}{\cftctxext[\cftalg{A}]}{\cftfamext[\cftalg{A}]}}}}}}{\cftfamext[\cftalg{A}]}
  \\
& \jdeq
  \subst
    {y_2}
    { {y_1}
      { {y_0}
        {\jcomp{}{\jvcomp{}{\idtm{P}}{\jcomp{}{\cftctxext[\cftalg{A}]}{\cftfamext[\cftalg{A}]}}}{\cftfamext[\cftalg{A}]}}
        }
      }
  \\
& \jdeq
  \subst
    {y_2}
    { {y_1}
      { {y_0}
        {\jcomp{}{\jvcomp{}{\cftfamext[\cftalg{A}]}{\idtm{\jcomp{}{\cftfamext[\cftalg{A}]}{{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}}}}{\cftfamext[\cftalg{A}]}}
        }
      }
  \\
& \jdeq
  \subst{{y_2}{{y_1}{{y_0}{\jvcomp{}{\cftfamext[\cftalg{A}]}{\idtm{\jcomp{}{\cftfamext[\cftalg{A}]}{{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}}}}}}}{\cftfamext[\cftalg{A}]}
  \\
& \jdeq
  \subst{\tmext{\subst{y_1}{{y_0}{\cftfamext[\cftalg{A}]}}}{y_2}}{\cftfamext[\cftalg{A}]}
  \\
& \jdeq
  \subst{y_2}{{{y_1}{{y_0}{\cftfamext[\cftalg{A}]}}}{\cftfamext[\cftalg{A}]}}.\qedhere
\end{align*}
\end{proof}

There is a trivial class of examples of extension algebras we can give right
away. More examples will be introduced by universes, later on.

\begin{eg}
Let $A$ be a family in context $\Gamma$. Then the quadruple
\begin{equation*}
(A,\emptyf,\emptyf,\idtm{A},\emptytm)
\end{equation*}
is an extension algebra in context $\Gamma$, as is the quadruple
\begin{equation*}
(\emptyf,A,\emptyf,\emptytm,\idtm{A}).
\end{equation*}
Also, the quadruple
\begin{equation*}
(A,\ctxwk{A}{A},\emptyf,\cprojfstf{A}{\ctxwk{A}{A}},\cprojfstf{\ctxwk{A}}{\ctxwk{A}{{A}{A}}})
\end{equation*}
is an extension algebra in context $\Gamma$.
\end{eg}

As a consequence of the following theorem, every extension algebra gives rise
to infinitely many extension algebras by constructing the extension algebra
of families of $\cftalg{A}$ for each extension algebra $\cftalg{A}$. Notice
that this also explains that the family $\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}$
over $\ctxext{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}$ is the family
of families over families. Likewise, higher families are obtained by pulling
back more times along $\cftctxext[\cftalg{A}]$.

\begin{thm}\label{thm:extalg-fam}
Suppose that $\extalg{A}$ is an extension algebra in context
$\Gamma$. Then 
\begin{equation*}
\cftalg{F_A}
\defeq
( \cftalgf{\cftalg{A}},
  \jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}},
  \jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgt{\cftalg{A}}},
  \cftfamext,
  \jcomp{}{\cftctxext[\cftalg{A}]}{\cftfamext})
\end{equation*}
is an extension algebra in context $\ctxext{\Gamma}{\cftalgc{\cftalg{A}}}$.
\end{thm}

\begin{proof}
In this proof, we shall use the short-hand notations $\cftctxext$ and $\cftfamext$
only to refer to $\cftctxext[\cftalg{A}]$ and $\cftfamext[\cftalg{A}]$, respectively,
and not to $\cftctxext[\cftalg{F_A}]$ or $\cftfamext[\cftalg{F_A}]$.

We first need to verify that the domain of the morphism 
$\jcomp{}{\cftctxext}{\cftfamext}$ is indeed
$\ctxext{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}{\jcomp{}{\cftfamext}{{}{\cftctxext}{\cftalgf{\cftalg{A}}}}}$. 
This follows from the judgmental equality
$\jcomp{}{\cftfamext}{{}{\cftctxext}{\cftalgf{\cftalg{A}}}}\jdeq
\jcomp{}{\cftctxext}{{}{\cftctxext}{\cftalgf{\cftalg{A}}}}$, which we have proved in
\autoref{lem:extalg-twins}. Notice how the diagram in \autoref{eq:extalg-eq2} is
of exactly the right sort, so the quadruple
$(\cftalgf{\cftalg{A}},\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}},\cftfamext,\jcomp{}{\cftctxext}{\cftfamext})$
satisfies its version of \autoref{eq:extalg-eq1}. It is left to verify that the diagram
\begin{small}
\begin{equation*}
\begin{tikzcd}[column sep=huge]
\ctxext
  { \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
    }
  { { \jcomp{}{\cftfamext}{%
        \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
        }
      }
    { \jcomp{}{\cftfamext}{%
        \jcomp{}{\cftfamext}{%
          \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
          }
        }
      }
    } 
  \ar{r}
    { \jvcomp{}{\idtm{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}}{%
        \jcomp{}{\cftfamext}{%
          \jcomp{}{\cftctxext}{\cftfamext}}}}
  \ar{d}[swap]{
    \jvcomp{}{\jcomp{}{\cftctxext}{\cftfamext}}{%
      \idtm{
        \jcomp{}{\jcomp{}{\cftctxext}{\cftfamext}}{%
          \jcomp{}{\cftfamext}{%
            \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
            }
          }
        }
      }
    }
& \ctxext
    {\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}
    {\jcomp{}{\cftfamext}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}} 
  \ar{d}{\jcomp{}{\cftctxext}{\cftfamext}}
  \\
\ctxext
  {\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}
  {\jcomp{}{\cftfamext}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}} 
  \ar{r}[swap]{\jcomp{}{\cftctxext}{\cftfamext}} 
& \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
\end{tikzcd}
\end{equation*}
\end{small}%
commutes judgmentally; this diagram is the version of \autoref{eq:extalg-eq2}
for the quadruple
$(\cftalgf{\cftalg{A}},\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}},\cftfamext,\jcomp{}{\cftctxext}{\cftfamext})$. Note
that this follows from \autoref{eq:extalg-eq2} provided that we can show that
\begin{align}
\jvcomp{}{\idtm{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}}{%
  \jcomp{}{\cftfamext}{%
    \jcomp{}{\cftctxext}{\cftfamext}}}
& \jdeq
  \jcomp{}{\cftctxext}{%
    \jvcomp{}{\idtm{\cftalgf{\cftalg{A}}}}{\jcomp{}{\cftctxext}{\cftfamext}}
    }
  \label{eq:extalg-infty1}
  \\
\jvcomp{}{\jcomp{}{\cftctxext}{\cftfamext}}{%
  \idtm{
    \jcomp{}{\jcomp{}{\cftctxext}{\cftfamext}}{%
      \jcomp{}{\cftfamext}{%
        \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
        }
      }
    }
  }
& \jdeq
\jcomp{}{\cftctxext}{%
  \jvcomp{}{\cftfamext}{%
    \idtm{
      \jcomp{}{\cftfamext}{%
        \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
        }
      }
    }
  }
  \label{eq:extalg-infty2}
\end{align}
Note that \autoref{eq:extalg-infty1} follows if we can show that
\begin{equation*}
\jcomp{}{\cftfamext}{\jcomp{}{\cftctxext}{\cftfamext}}
  \jdeq
  \jcomp{}{\cftctxext}{\jcomp{}{\cftctxext}{\cftfamext}}.
\end{equation*}
This is a special case of \autoref{lem:extalg-twins}. The second judgmental
equality, \autoref{eq:extalg-infty2}, is trivial.
\end{proof}

\begin{thm}
Let $\extalg{Q}$ be an extension algebra in context $\ctxext{\Gamma}{B}$ and let
$\jfam{\Gamma}{A}$ be a family of contexts. Then the quintuple
\begin{equation*}
\ctxwk{A}{\extalg{Q}}
  \defeq
  ( \ctxwk{A}{\cftalgc{\cftalg{Q}}},
    \ctxwk{A}{\cftalgf{\cftalg{Q}}},
    \ctxwk{A}{\cftalgt{\cftalg{Q}}},
    \ctxwk{A}{\cftctxext[\cftalg{Q}]},
    \ctxwk{A}{\cftfamext[\cftalg{Q}]})
\end{equation*}
is an extension algebra in context $\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}$.
\end{thm}

\begin{proof}
The proof follows from the fact that weakening by $A$ is compatible with all
the involved operations.
\end{proof}

\begin{thm}
Let $\extalg{Q}$ be an extension algebra in context $\ctxext{{\Gamma}{A}}{P}$
and let $\jterm{\Gamma}{A}{x}$ be a term. Then the quintuple
\begin{equation*}
\subst{x}{\cftalg{Q}}
  \defeq
  ( \subst{x}{\cftalgc{\cftalg{Q}}},
    \subst{x}{\cftalgf{\cftalg{Q}}},
    \subst{x}{\cftalgt{\cftalg{Q}}},
    \subst{x}{\cftctxext[\cftalg{Q}]},
    \subst{x}{\cftfamext[\cftalg{Q}]})
\end{equation*}
is an extension algebra in context $\ctxext{\Gamma}{\subst{x}{P}}$.
\end{thm}

\begin{proof}
The proof follows from the fact that substitution with $x$ is compatible with
all the involved operations.
\end{proof}

\begin{cor}
Let $\extalg{Q}$ be an extension algebra in context $\ctxext{\Gamma}{B}$
and let $\jhom{\Gamma}{A}{B}{f}$. Then the quintuple
\begin{equation*}
\jcomp{A}{f}{\extalg{Q}}
  \defeq
  ( \jcomp{A}{f}{\cftalgc{\cftalg{Q}}},
    \jcomp{A}{f}{\cftalgf{\cftalg{Q}}},
    \jcomp{A}{f}{\cftalgt{\cftalg{Q}}},
    \jcomp{A}{f}{\cftctxext[\cftalg{Q}]},
    \jcomp{A}{f}{\cftfamext[\cftalg{Q}]})
\end{equation*}
is an extension algebra in context $\ctxext{\Gamma}{A}$.
\end{cor}

\begin{cor}
Let $\extalg{A}$ be an extension algebra in context $\Gamma$. Then
$\extalg{F_{F_A}}$ and $\jcomp{}{\cftctxext[\extalg{A}]}{\extalg{F_A}}$ are
judgmentally equal extension algebras in context $\ctxext{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}$.
\end{cor}

\subsection{Extension homomorphisms}

\begin{defn}
An \emph{extension homomorphism $\cfthom{f}$ from $\extalg{A}$ to
$\extalg{B}$ in context $\Gamma$} is a triple $\unfold{\cfthom{f}}$ consisting of
\begin{align*}
\jhom*
  {\Gamma}
  {\cftalgc{\cftalg{A}}}
  {\cftalgc{\cftalg{B}}}
  {\cfthomc{\cfthom{f}}}
  \\
\jfhom*
  {\Gamma}
  {\cftalgc{\cftalg{A}}}
  {\cftalgc{\cftalg{B}}}
  {\cfthomc{\cfthom{f}}}
  {\cftalgf{\cftalg{A}}}
  {\cftalgf{\cftalg{B}}}
  {\cfthomf{\cfthom{f}}}
  \\
\jfhom*
  {\Gamma}
  {{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}
  {{\cftalgc{\cftalg{B}}}{\cftalgf{\cftalg{B}}}}
  {\jvcomp{}{\cfthomc{\cfthom{f}}}{\cfthomf{\cfthom{f}}}}
  {\cftalgt{\cftalg{A}}}
  {\cftalgt{\cftalg{B}}}
  {\cfthomt{\cfthom{f}}}
\end{align*}
for which the diagrams
\begin{equation}\label{eq:exthom1}
\begin{tikzcd}
\ctxext{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}
  \ar{r}{\jvcomp{}{\cfthomc{\cfthom{f}}}{\cfthomf{\cfthom{f}}}}
  \ar{d}[swap]{\cftctxext[\cftalg{A}]}
& \ctxext{\cftalgc{\cftalg{B}}}{\cftalgf{\cftalg{B}}}
  \ar{d}{\cftctxext[\cftalg{B}]}
  \\
\cftalgc{\cftalg{A}}
  \ar{r}[swap]{\cfthomc{\cfthom{f}}}
& \cftalgc{\cftalg{A}}
\end{tikzcd}
\end{equation}
and
\begin{equation}\label{eq:exthom2}
\begin{tikzcd}[column sep=huge]
\ctxext{\cftalgf{\cftalg{A}}}{\jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}
  \ar{r}{\jvcomp{}{\cfthomf{\cfthom{f}}}{\jcomp{}{\cftctxext[\cftalg{A}]}{\cfthomf{\cfthom{f}}}}}
  \ar{d}[swap]{\cftfamext[\cftalg{A}]}
& \jcomp{}{\cfthomc{\cfthom{f}}}{\ctxext{\cftalgf{\cftalg{B}}}{\jcomp{}{\cftctxext[\cftalg{B}]}{\cftalgf{\cftalg{B}}}}}
  \ar{d}{\jcomp{}{\cfthomc{\cfthom{f}}}{\cftfamext[\cftalg{B}]}}
  \\
\cftalgf{\cftalg{A}}
  \ar{r}[swap]{\cfthomf{\cfthom{f}}}
& \jcomp{}{\cfthomc{\cfthom{f}}}{\cftalgf{\cftalg{B}}}
\end{tikzcd}
\end{equation}
commute judgmentally.
\end{defn}

\begin{rmk}
To see that the upper morphism in the diagram of \autoref{eq:exthom2} has
indeed the indicated codomain provided that the diagram of \autoref{eq:exthom1}
commutes judgmentally, note that we have the judgmental equalities
\begin{align*}
\jcomp{}{\cfthomf{\cfthom{f}}}{\jcomp{}{\cfthomc{\cfthom{f}}}{\jcomp{}{\cftctxext[\cftalg{B}]}{\cftalgf{\cftalg{B}}}}}
& \jdeq 
  \jcomp{}{\jvcomp{}{\cfthomc{\cfthom{f}}}{\cfthomf{\cfthom{f}}}}{\jcomp{}{\cftctxext[\cftalg{B}]}{\cftalgf{\cftalg{B}}}}
  \tag{by \autoref{lem:composition-threesome}}
  \\
& \jdeq
  \jcomp{}{\jcomp{}{\jvcomp{}{\cfthomc{\cfthom{f}}}{\cfthomf{\cfthom{f}}}}{\cftctxext[\cftalg{B}]}}{\cftalgf{\cftalg{B}}}
  \tag{by \autoref{lem:jcomp-jcomp}}
  \\
& \jdeq
  \jcomp{}{\jcomp{}{\cftctxext[\cftalg{A}]}{\cfthomc{\cfthom{f}}}}{\cftalgf{\cftalg{B}}}
  \tag{by \autoref{eq:exthom1}}
  \\
& \jdeq
  \jcomp{}{\cftctxext[\cftalg{A}]}{\jcomp{}{\cfthomc{\cfthom{f}}}{\cftalgf{\cftalg{B}}}}.
  \tag{by \autoref{lem:jcomp-jcomp}}
\end{align*}
and we indeed have the morphism $\jcomp{}{\cftctxext[\cftalg{A}]}{\cfthomf{\cfthom{f}}}$ from 
$\jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}$ to $\jcomp{}{\cftctxext[\cftalg{A}]}{\jcomp{}{\cfthomc{\cfthom{f}}}{\cftalgf{\cftalg{B}}}}$.
\end{rmk}

\begin{thm}
Let $\cfthom{f}$ be an extension homomorphism from $\cftalg{A}$ to $\cftalg{B}$
in context $\Gamma$. Then
\begin{equation*}
\boldsymbol{\mathcal{F}}_\cfthom{f}
  \defeq
  ( \cfthomf{\cfthom{f}},
    \jcomp{}{\cftctxext[\cftalg{A}]}{\cfthomf{\cfthom{f}}},
    \jcomp{}{\cftctxext[\cftalg{A}]}{\cfthomt{\cfthom{f}}})
\end{equation*}
is an extension homomorphism from $\cftalg{F_A}$ to $\jcomp{}{\cfthomc{\cfthom{f}}}{\cftalg{F_B}}$
in context $\ctxext{\Gamma}{\cftalgc{\cftalg{A}}}$. 
\end{thm}

\begin{proof}
We have to verify that the diagrams in \autoref{eq:exthom1,eq:exthom2}
commute for $\cfthom{F_f}$. Unfolding the ingredients of \autoref{eq:exthom1}
for $\cfthom{F_f}$ gives us quite directly \autoref{eq:exthom2}. The
diagram in \autoref{eq:exthom2} for $\cfthom{F_f}$ is judgmentally equal
to the pullback of everything in the diagram in \autoref{eq:exthom2} for
$\cfthom{f}$ by $\epsilon_0$, and therefore it commutes too.
\end{proof}

\begin{defn}
Let $\cfthom{f}$ and $\cfthom{g}$ be extension homomorphisms from
$\extalg{A}$ to $\extalg{B}$ and from $\extalg{B}$ to $\extalg{C}$, respectively.
We define the composition
\begin{equation*}
\cfthomcomp{\cfthom{f}}{\cfthom{g}}
  \defeq
  \unfold{\cfthomcomp{\cfthom{f}}{\cfthom{g}}}.
\end{equation*}
In other words, extension homomorphisms are composed by taking the horizontal 
rectangles in the diagram
\begin{equation*}
\begin{tikzcd}
\extalgt{\extalg{A}} 
  \ar[fib]{d}
  \ar{r}{\cfthomt{\cfthom{f}}}
& \extalgt{\extalg{B}} 
  \ar[fib]{d}
  \ar{r}{\cfthomt{\cfthom{g}}}
& \extalgt{\extalg{C}}
  \ar[fib]{d}
  \\
\extalgf{\extalg{A}} 
  \ar[fib]{d}
  \ar{r}{\cfthomf{\cfthom{f}}}
& \extalgf{\extalg{B}} 
  \ar[fib]{d}
  \ar{r}{\cfthomf{\cfthom{g}}}
& \extalgf{\extalg{C}}
  \ar[fib]{d}
  \\
\extalgc{\extalg{A}}
  \ar{r}{\cfthomc{\cfthom{f}}}
& \extalgc{\extalg{B}}
  \ar{r}{\cfthomc{\cfthom{g}}}
& \extalgc{\extalg{C}}
\end{tikzcd}
\end{equation*}
\end{defn}

\begin{rmk}
It follows from \autoref{lem:jcomp-jcomp,lem:jfcomp-jfcomp} that composition
of extension homomorphisms is associative.
\end{rmk}

\begin{thm}
Let $\cfthom{f}$ and $\cfthom{g}$ be extension homomorphisms from
$\extalg{A}$ to $\extalg{B}$ and from $\extalg{B}$ to $\extalg{C}$, respectively.
Then $\cfthomcomp{\cfthom{f}}{\cfthom{g}}$ is an extension homomorphism from
$\extalg{A}$ to $\extalg{C}$. 
\end{thm}

\begin{proof}
Both judgmental equalities are applications of the interchange law for composition,
\autoref{lem:composition-interchange}. 
\end{proof}

The following theorem explains how context extension can be seen as an extension
homomorphism. Note that in combination with \autoref{thm:extalg-fam}, this also
explains how family extension can be seen as an extension homomorphism.

\begin{thm}
Let $\extalg{A}$ be an extension algebra in context $\Gamma$. Then
\begin{align*}
& ( \ctxext{\extalgc{\extalg{A}}}{\extalgf{\extalg{A}}},
    \jcomp{}{\cftctxext}{\extalgf{\extalg{A}}},
    \jvcomp{}{\ctxwk{\extalgf{\extalg{A}}}{\idtm{\extalgc{\extalg{A}}}}}{\cftfamext},
    \jcomp{}{\cftctxext}{\cftfamext}
    )
\intertext{and}
& ( \ctxext{\extalgc{\extalg{A}}}{\extalgf{\extalg{A}}},
    \jcomp{}{\cftctxext}{\extalgf{\extalg{A}}},
    \jvcomp{}{\cftctxext}{\idtm{\jcomp{}{\cftctxext}{\extalgf{\extalg{A}}}}},
    \jcomp{}{\cftctxext}{\cftfamext}
    )
\end{align*}
are extension algebras in context $\Gamma$ and
\begin{equation*}
\boldsymbol{\cftctxext}\defeq ( \cftctxext,
  \idtm{\jcomp{}{\cftctxext}{\extalgf{\extalg{A}}}}
  )
\end{equation*}
is an extension homomorphism from both of them to $\extalg{A}$. 
\end{thm}

\begin{comment}
\begin{rmk}
I suspect that if we copy this theory of extension algebras to Martin-L\"of
type theory, with the judgmental equalities replaced by identifications, with
dependent pair types rather than those strict extensions, etcetera, then
the type of $f_1$ for which these two diagrams commute is a mere proposition.

With this notion of morphism, a term of an extension
algebra $(A,P,\epsilon_0,\epsilon_1)$ is a pair $(x_0,x_1)$ such that
$\subst{x_1}{{x_0}{\epsilon_0}}\jdeq x_0$.
\end{rmk}
\end{comment}

\begin{comment}
Extension algebras don't come in isolation. There are also extension algebra
families and extension algebra terms. We now aim to define these and to
establish various constructions of new extension algebras out of old ones:
the empty extension algebra, and extensions, weakenings and substitutions
of extension algebras and of course the identity term as an extension algebra
term. We start with extension algebra families.

\begin{defn}
Consider an extension algebra $\mathcal{A}\defeq(A,P,e,f)$. 
An extension algebra family over $\mathcal{A}$ is likewise a quadruple
$\mathcal{B}\defeq(B,Q,g,h)$. Here we have a family $\jfam{{\Gamma}{A}}{B}$, a
family $\jfam{{{{\Gamma}{A}}{P}}{\ctxwk{P}{B}}}{Q}$ and
\begin{align*}
\jhom*{{{\Gamma}{A}}{P}}{\ctxext{\ctxwk{P}{B}}{Q}}{\jcomp{}{\epsilon_0}{B}}{g}\\
\jhom*{{{{\Gamma}{A}}{P}}{\ctxwk{P}{B}}}{\ctxext{Q}{\jcomp{}{g}{Q}}}{Q}{h}.
\end{align*}
The quadruple $(\jcomp{}{\epsilon_0}{B},Q,g,h)$ is required to be an extension algebra
in context $\ctxext{{\Gamma}{A}}{P}$.
\end{defn}

\begin{defn}
Suppose $\mathcal{A}$ is an extension algebra and $\mathcal{B}$ is an extension
algebra family over $\mathcal{A}$. A term of $\mathcal{B}$ is a pair $(x,y)$
consisting of
\begin{align*}
\jterm*{{\Gamma}{A}}{B}{x}\\
\jterm*{{{\Gamma}{A}}{P}}{\subst{\jcomp{}{\epsilon_0}{x}}{Q}}{y}
\end{align*}
such that the diagrams
\begin{equation*}
\begin{tikzcd}
\ctxext{\jcomp{}{\epsilon_0}{B}}{Q} 
  \ar{r}{g} 
  \ar[shift right=.7ex,fib]{d}
& B 
  \ar[shift right=.7ex,fib]{d} 
  \\
\ctxext{A}{P} 
  \ar[shift right=.7ex,dotted]{u}[swap]{\tmext{\jcomp{}{\epsilon_0}{x}}{y}}
  \ar{r}{e}
& A
  \ar[shift right=.7ex,dotted]{u}[swap]{x}
\end{tikzcd}
\end{equation*}
and
\begin{equation*}
\begin{tikzcd}
\jcomp{}{f}{\ctxext{Q}{\jcomp{}{g}{Q}}}
  \ar{r}{\jcomp{}{f}{h}}
  \ar[shift right=.7ex,fib]{d}
& Q
  \ar[shift right=.7ex,fib]{d}
  \\
\jcomp{}{f}{\jcomp{}{\epsilon_0}{B}}
  \ar{r}{\idtm{\jcomp{}{f}{\jcomp{}{\epsilon_0}{B}}}}
  \ar[shift right=.7ex,fib]{d}
  \ar[shift right=.7ex,dotted,mapsto]{u}[swap]{\jcomp{}{f}{y}}
& \jcomp{}{\epsilon_0}{B}
  \ar[shift right=.7ex,fib]{d}
  \ar[shift right=.7ex,dotted,mapsto]{u}[swap]{y}
  \\
\ctxext{P}{\jcomp{}{\epsilon_0}{P}}
  \ar{r}[swap]{f}
  \ar[shift right=.7ex,dotted]{u}[swap]{\jcomp{}{f}{\jcomp{}{\epsilon_0}{x}}}
& P
  \ar[shift right=.7ex,dotted]{u}[swap]{\jcomp{}{\epsilon_0}{x}}
\end{tikzcd}
\end{equation*}
commute.
\end{defn}

\begin{defn}
Suppose $\mathcal{A}$ and $\mathcal{B}$ are extension algebras in context
$\Gamma$. We define the extension algebra $\ctxwk{\mathcal{A}}{\mathcal{B}}$
to be the quadruple
\begin{equation*}
(\ctxwk{A}{B},\ctxwk{\ctxext{A}{P}}{Q},\ctxwk{\ctxext{A}{P}}{g},\ctxwk{\ctxext{A}{P}}{h}).
\end{equation*}
Note that $\ctxwk{\ctxext{A}{P}}{Q}$ is a family over $\ctxwk{\ctxext{A}{P}}{B}$,
whereas it should be a family over $\jcomp{}{\epsilon_0}{\ctxwk{A}{B}}$. These are the
same by \autoref{lem:prehom}.
\end{defn}

\begin{rmk}
Before we continue, let us explore what it means to be an extension algebra
term of the extension algebra $\ctxwk{\mathcal{A}}{\mathcal{B}}$. Such an
extension algebra term $(x,y)$ would consist of
\begin{align*}
\jterm*{{\Gamma}{A}}{\ctxwk{A}{B}}{x}\\
\jterm*{{{\Gamma}{A}}{P}}{\subst{\jcomp{}{\epsilon_0}{x}}{\ctxwk{\ctxext{A}{P}}{Q}}}{y}.
\end{align*}
Thus, $x$ is a context morphism from $A$ to $B$ and $y$ is nothing but a term
of $\jcomp{}{\jcomp{}{\epsilon_0}{x}}{Q}$. For $x$, we see that the diagram
\begin{equation*}
\begin{tikzcd}
\ctxext{B}{Q} 
  \ar{r}{g} 
& B 
  \\
\ctxext{A}{P} 
  \ar{u}{\jvcomp{}{x}{y}}
  \ar{r}{e}
& A
  \ar{u}[swap]{x}
\end{tikzcd}
\end{equation*}
commutes.
\end{rmk}
\end{comment}

\subsection{Term-algebras}
In studying extension algebras we had no need to consider terms. However, we
do need to consider terms if we want a full interpretation of the theory of
contexts, families and terms. Therefore, we shall now consider algebras where
we have a further family 
$\jfam{{{\Gamma}{A}}{\cftalgf{\cftalg{A}}}}{\cftalgt{\cftalg{A}}}$, assigning
terms to families of $\cftalg{A}$. The notion of term-algebras that we will
study in this subsection will also have an empty object $(\cftempc{\cftalg{A}},
\cftempf{\cftalg{A}})$ and guarantiees that families over the empty object
are just the terms of the underlying family $\cftalgc{\cftalg{A}}$ of contexts
of the term-algebra $\cftalg{A}$. As with the theory of contexts, families and
terms, this enables us to speak of terms of contexts of $\cftalg{A}$, and this
will provide the categorical structure for $\cftalg{A}$ when we also consider
internal weakening, substitution and identity terms.

\begin{defn}
A quintuple $(\cftalgc{\cftalg{A}},\cftalgf{\cftalg{A}},\cftalgt{\cftalg{A}},
\cftempc{\cftalg{A}},\cftempf{\cftalg{A}})$ consisting of
\begin{enumerate}
\item A family $\cftalgc{\cftalg{A}}$ in context $\Gamma$,
\item A family $\cftalgf{\cftalg{A}}$ in context $\ctxext{\Gamma}{\cftalgc{\cftalg{A}}}$,
\item A family $\cftalgt{\cftalg{A}}$ in context $\ctxext{{\Gamma}{A}}{\cftalgf{\cftalg{A}}}$,
\item A term $\cftempc{\cftalg{A}}$ of $\cftalgc{\cftalg{A}}$ in context $\Gamma$,
\item A term $\cftempf{\cftalg{A}}$ of $\cftalgf{\cftalg{A}}$ in context $\ctxext{\Gamma}{\cftalgc{\cftalg{A}}}$,
\end{enumerate}
is said to be an \emph{empty-object algebra in context $\Gamma$} if additionally
the following judgmental equalities hold:
\begin{align}
\jfameq*{\Gamma}{\subst{\cftempc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}{\cftalgc{\cftalg{A}}}
  \label{empalg-eq1}
  \\
\jtermeq*{\Gamma}{\cftalgc{\cftalg{A}}}{\subst{\cftempc{\cftalg{A}}}{\cftempf{\cftalg{A}}}}{\cftempc{\cftalg{A}}}.
  \label{empalg-eq2}
%  \\
%\jfameq*{{\Gamma}{\cftalgc{\cftalg{A}}}}{\subst{\cftempf{\cftalg{A}}}{\cftalgt{\cftalg{A}}}}{\emptyf}
\end{align}
When $(\cftalgc{\cftalg{A}},\cftalgf{\cftalg{A}},\cftalgt{\cftalg{A}},
\cftempc{\cftalg{A}},\cftempf{\cftalg{A}})$ is an empty-object algebra
in context $\Gamma$, we will
also refer to the pair $(\cftempc{\cftalg{A}},\cftempf{\cftalg{A}})$ as the
\emph{empty object of $\cftalg{A}$}.
\end{defn}

Below, we give the definition of empty-object homomorphisms. They have, like
extension homomorphisms, an action on contexts and an action on families and
in addition they have an action on terms. Thus, we can picture a term
homomorphism as follows:
\begin{equation*}
\begin{tikzcd}
\cftalgt{\cftalg{A}}
  \ar[fib]{d}
  \ar{r}{\cfthomt{\cfthom{f}}}
& \cftalgt{\cftalg{B}}
  \ar[fib]{d}
  \\
\cftalgf{\cftalg{A}}
  \ar[fib]{d}
  \ar{r}{\cfthomf{\cfthom{f}}}
& \cftalgf{\cftalg{B}}
  \ar[fib]{d}
  \\
\cftalgc{\cftalg{A}}
  \ar{r}[swap]{\cfthomc{\cfthom{f}}}
& \cftalgc{\cftalg{B}}
\end{tikzcd}
\end{equation*}

\begin{defn}
Let $\cftalg{A}$ and $\cftalg{B}$ be term algebras in context $\Gamma$.
An \emph{empty-object homomorphism $\cfthom{f}$ from $\cftalg{A}$ to $\cftalg{B}$
in context $\Gamma$} is a triple 
$(\cfthomc{\cfthom{f}},\cfthomf{\cfthom{f}},\cfthomt{\cfthom{f}})$ consisting of
\begin{align*}
\jhom*
  {\Gamma}
  {\cftalgc{\cftalg{A}}}
  {\cftalgc{\cftalg{B}}}
  {\cfthomc{\cfthom{f}}}\\
\jfhom*
  {\Gamma}
  {\cftalgc{\cftalg{A}}}
  {\cftalgc{\cftalg{B}}}
  {\cfthomc{\cfthom{f}}}
  {\cftalgf{\cftalg{A}}}
  {\cftalgf{\cftalg{B}}}
  {\cfthomf{\cfthom{f}}}\\
\jfhom*
  {\Gamma}
  {{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}
  {{\cftalgc{\cftalg{B}}}{\cftalgf{\cftalg{B}}}}
  {\jvcomp{\cftalgf{\cftalg{A}}}{\cfthomc{\cfthom{f}}}{\cfthomf{\cfthom{f}}}}
  {\cftalgt{\cftalg{A}}}
  {\cftalgt{\cftalg{B}}}
  {\cfthomt{\cfthom{f}}}
\end{align*}
satisfying the judgmental equalities
\begin{align*}
\jtermeq*
  {\Gamma}
  {\cftalgc{\cftalg{B}}}
  {\subst{\cftempc{\cftalg{A}}}{\cfthomc{\cfthom{f}}}}
  {\cftempc{\cftalg{B}}}
  \\
\jhomeq*
  {\Gamma}
  {\cftalgc{\cftalg{A}}}
  {\cftalgc{\cftalg{B}}}
  {\subst{\cftempc{\cftalg{A}}}{\cfthomf{\cfthom{f}}}}
  {\cfthomc{\cfthom{f}}}
  \\
\jtermeq*
  {{\Gamma}{\cftalgc{\cftalg{A}}}}
  {\jcomp{\cftalgc{\cftalg{A}}}{\cfthomc{\cfthom{f}}}{\cftalgf{\cftalg{B}}}}
  {\subst{\cftempf{\cftalg{A}}}{\cfthomf{\cfthom{f}}}}
  {\jcomp{\cftalgc{\cftalg{A}}}{\cfthomc{\cfthom{f}}}{\cftempf{\cftalg{B}}}}.
\end{align*}
\end{defn}

The following lemma presents a property of empty-object algebras that will get
a lot of use.

\begin{lem}\label{lem:empalg-mor}
Consider a family $\jfam{\Gamma}{A}$ with a term $\jterm{\Gamma}{A}{x}$ and 
a family $\jfam{{\Gamma}{A}}{P}$ with a term $\jterm{{\Gamma}{A}}{P}{y}$
satisfying the judgmental equalities 
\begin{align}
\jfameq*{\Gamma}{\subst{x}{P}}{A}
  \label{eq1:empalg-mor}
  \\
\jtermeq*{\Gamma}{A}{\subst{x}{y}}{x}.
  \label{eq2:empalg-mor}
\end{align}
Consider also a morphism
\begin{equation*}
\jhom{\Gamma}{{A}{P}}{B}{f}.
\end{equation*}
Then $\subst{\xi}{f}$ is a morphism from $A$ to $B$ 
in context $\Gamma$ and the following inference rules are valid for $\xi$ being 
$x$ or $y$:
\begin{align*}
& \inference
  { \jfam{{\Gamma}{B}}{Q}
    }
  { \jfameq
      {{\Gamma}{A}}
      {\subst{\xi}{\jcomp{}{f}{Q}}}
      {\jcomp{}{\subst{\xi}{f}}{Q}}
    }
  \\
& \inference
  { \jfam{{{\Gamma}{B}}{Q}}{R}
    }
  { \jfameq
      {{{\Gamma}{A}}{\jcomp{}{\subst{\xi}{f}}{Q}}}
      {\subst{\xi}{\jcomp{}{f}{R}}}
      {\jcomp{}{\subst{\xi}{f}}{R}}
    }
  \\
& \inference
  { \jterm{{{\Gamma}{B}}{Q}}{R}{h}
    }
  { \jtermeq
      {{{\Gamma}{A}}{\jcomp{}{\subst{\xi}{f}}{Q}}}
      {\jcomp{}{\subst{\xi}{f}}{R}}
      {\subst{\xi}{\jcomp{}{f}{h}}}
      {\jcomp{}{\subst{\xi}{f}}{h}}
    }
\end{align*}
\end{lem}

\begin{proof}
We only prove the first inference rule in both cases.
Let $Q$ be a family over $\ctxext{\Gamma}{\cftalgc{\cftalg{A}}}$. In the case 
$i=\mathsf{c}$ we have the judgmental equalities
\begin{align*}
\subst{x}{\jcomp{}{f}{Q}}
& \jdeq
  \subst
    {x}
    {{f}{\ctxwk{\ctxext{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}{Q}}}
  \tag{by definition}
  \\
& \jdeq
  \subst
    { {x}{f}
      }
    { {x}
      {\ctxwk{\ctxext{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}{Q}}
      }
  \tag{by \autoref{comp-ss-f}}
  \\
& \jdeq
  \subst
    { {x}{f}
      }
    { {x}
      {\ctxwk{\cftalgf{\cftalg{A}}}{{\cftalgc{\cftalg{A}}}{Q}}}
      }
  \tag{by \autoref{comp-ew-f}}
  \\
& \jdeq
  \subst
    { {x}{f}
      }
    { \ctxwk
        {\subst{x}{\cftalgf{\cftalg{A}}}}
        {\subst{x}{\ctxwk{\cftalgc{\cftalg{A}}}{Q}}}
      }
  \tag{by \autoref{comp-sw-f}}
  \\
& \jdeq
  \subst
    { {x}{f}
      }
    { \ctxwk
        {\subst{x}{\cftalgf{\cftalg{A}}}}
        {Q}
      }
  \tag{by \autoref{cancellation-ws-f}}
  \\
& \jdeq
  \subst{{x}{f}}{\ctxwk{\cftalgc{\cftalg{A}}}{Q}}
  \tag{by \autoref{eq1:empalg-mor}}
  \\
& \jdeq
  \jcomp{}{\subst{x}{f}}{Q}.
  \tag{by definition}
\end{align*}
In the case $i=\mathsf{f}$ we have the judgmental equalities
\begin{align*}
\subst{y}{\jcomp{}{f}{Q}}
& \jdeq
  \subst
    { y
      }
    { {f}
      {\ctxwk{\ctxext{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}{Q}}
      }
  \tag{by definition}
  \\
& \jdeq
  \subst
    { {y}{f}
      }
    { {y}
      {\ctxwk{\ctxext{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}{Q}}
      }
  \tag{by \autoref{comp-ss-f}}
  \\
& \jdeq
  \subst
    { {y}{f}
      }
    { {y}
      {\ctxwk{\cftalgf{\cftalg{A}}}{{\cftalgc{\cftalg{A}}}{Q}}}
      }
  \tag{by \autoref{comp-ew-f}}
  \\
& \jdeq
  \subst
    { {y}{f}
      }
    { \ctxwk{\cftalgc{\cftalg{A}}}{Q}
      }
  \tag{by \autoref{cancellation-ws-f}}
  \\
& \jdeq
  \jcomp{}{\subst{y}{f}}{Q}.
  \tag{by definition}
\end{align*}
\end{proof}

A term-algebra $\cftalg{A}$ in context $\Gamma$ is going to be a septuple
\begin{equation*}
(\cftalgc{\cftalg{A}},\cftalgf{\cftalg{A}},\cftalgt{\cftalg{A}},
\cftctxext[\cftalg{A}],\cftfamext[\cftalg{A}],\cftempc{\cftalg{A}},
\cftempf{\cftalg{A}})
\end{equation*}
for which 
the quadruple $\unfold{\extalg{A}}$ is an extension algebra in context 
$\Gamma$, the quintuple $\unfold{\empalg{A}}$ is an empty-object algebra in context
$\Gamma$, satisfying additional judgmental equalities expressing the 
compatibility of $\cftctxext[\cftalg{A}]$ and $\cftfamext[\cftalg{A}]$ with 
$\cftempc{\cftalg{A}}$ and $\cftempf{\cftalg{A}}$.
There will be five such judgmental equalities. Four of them will express that
extension acts as the identity term when applied to the empty object in one of
its arguments. The other expresses that family extension restricted to
families above the empty object is the same as context extension. To be able
to state these, we need to know that $\unfold{\empalg{A}}$ is an empty-object
algebra. In the following, we verify step-by-step that we can indeed make the
suggested requirements.
\begin{enumerate}
\item The type of $\subst{\cftempc{\cftalg{A}}}{\cftctxext[\cftalg{A}]}$ is
$\subst
  { \cftempc{\cftalg{A}}
    }
  { \ctxwk
      {\ctxext{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}
      {\cftalgc{\cftalg{A}}}
    }$.
We have the judgmental equalities
\begin{align*}
\subst
  { \cftempc{\cftalg{A}}
    }
  { \ctxwk
      {\ctxext{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}
      {\cftalgc{\cftalg{A}}}
    }
& \jdeq
  \subst
    { \cftempc{\cftalg{A}}
      }
    { \ctxwk
        { \cftalgf{\cftalg{A}}
          }
        { {\cftalgc{\cftalg{A}}}
          {\cftalgc{\cftalg{A}}}
          }
      }
  \tag{by \autoref{comp-ew-f}}
  \\
& \jdeq
  \ctxwk
    { \subst{\cftempc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}
      }
    { \subst{\cftempc{\cftalg{A}}}{\ctxwk{\cftalgc{\cftalg{A}}}{\cftalgc{\cftalg{A}}}}
      }
  \tag{by \autoref{comp-sw-f}}
  \\
& \jdeq
  \ctxwk
    { \subst{\cftempc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}
      }
    { A
      }
  \tag{by \autoref{cancellation-ws-f}}
  \\
& \jdeq
  \ctxwk{A}{A}
  \tag{by \autoref{empalg-eq2}}
\end{align*}
Thus, we require that
\begin{equation}
\jtermeq{{\Gamma}{\cftalgc{\cftalg{A}}}}{\ctxwk{\cftalgc{\cftalg{A}}}{\cftalgc{\cftalg{A}}}}{\subst{\cftempc{\cftalg{A}}}{\cftctxext[\cftalg{A}]}}{\idtm{\cftalgc{\cftalg{A}}}}
  \label{extempalg-eq1}
\end{equation}
\end{enumerate}

We can immediately state the first two:
\begin{align}
\jtermeq*{{\Gamma}{\cftalgc{\cftalg{A}}}}{\ctxwk{\cftalgc{\cftalg{A}}}{\cftalgc{\cftalg{A}}}}{\subst{\cftempc{\cftalg{A}}}{\cftctxext[\cftalg{A}]}}{\idtm{\cftalgc{\cftalg{A}}}}
  \label{extempalg-eq1}
  \\
\jtermeq*{{\Gamma}{\cftalgc{\cftalg{A}}}}{\ctxwk{\cftalgc{\cftalg{A}}}{\cftalgc{\cftalg{A}}}}{\subst{\cftempf{\cftalg{A}}}{\cftctxext[\cftalg{A}]}}{\idtm{\cftalgc{\cftalg{A}}}}
  \label{extempalg-eq2}
\end{align}
To see what $\subst{\phi_0}{\epsilon_1}$ can be, we must know its type first.
It is a morphism from $\subst{\phi_0}{\ctxext{P}{\jcomp{}{\epsilon_0}{P}}}$ to
$\subst{\phi_0}{P}$. We already know that $\subst{\phi_0}{P}\jdeq A$ by
\autoref{empalg-eq1} and to compute $\subst{\phi_0}{\jcomp{}{\epsilon_0}{P}}$
we use \autoref{lem:empalg-mor}. Note that in combination with 
\autoref{extempalg-eq1} and \autoref{extempalg-eq2} we get the judgmental
equalities
\begin{equation}\label{cor:empalg-mor}
\jfameq{{\Gamma}{A}}{\subst{\phi_i}{\jcomp{}{\epsilon_0}{P}}}{P}
\end{equation}
for $i$ being $\mathsf{c}$ or $\mathsf{f}$. Consequently, 
$\subst{\phi_0}{\epsilon_1}$ is a morphism from $\ctxext{A}{P}$ to $A$, so we 
can require that
\begin{equation}\label{extempalg-eq3}
\jhomeq{\Gamma}{{A}{P}}{A}{\subst{\phi_0}{\epsilon_1}}{\epsilon_0}.
\end{equation}
This judgmental equality expresses that family extension restricted to the empty object
$\phi_0$ is context extension. We also have two judgmental
equalities expressing that $\epsilon_1$ restricted to $\phi_1$ and
$\jcomp{}{\epsilon_0}{\phi_1}$ are both the identity term on $P$. Note that
the term $\jcomp{}{\epsilon_0}{\phi_1}$ serves as the empty family of families,
being a term of $\jcomp{}{\epsilon_0}{P}$.

Before we can require that $\subst{\phi_1}{\epsilon_1}\jdeq\idtm{P}$, we need
to compute the family
\begin{equation*}
\jfam
  {{{\Gamma}{A}}{\subst{\phi_1}{\jcomp{}{\epsilon_0}{P}}}}
  {\subst{\phi_1}{\ctxwk{\ctxext{P}{\jcomp{}{\epsilon_0}{P}}}{P}}}.
\end{equation*}
of which $\subst{\phi_1}{\epsilon_1}$ is a term.
We have already established that $\subst{\phi_1}{\jcomp{}{\epsilon_0}{P}}\jdeq
P$. We also see that 
\begin{align*}
\subst{\phi_1}{\ctxwk{\ctxext{P}{\jcomp{}{\epsilon_0}{P}}}{P}}
& \jdeq
  \subst{\phi_1}{\ctxwk{\jcomp{}{\epsilon_0}{P}}{{P}{P}}}
  \tag{by \autoref{comp-ew-f}}
  \\
& \jdeq
  \ctxwk{\subst{\phi_1}{\jcomp{}{\epsilon_0}{P}}}{\subst{\phi_1}{\ctxwk{P}{P}}}
  \tag{by \autoref{comp-sw-f}}
  \\
& \jdeq
  \ctxwk{P}{\subst{\phi_1}{\ctxwk{P}{P}}}
  \tag{by \autoref{cor:empalg-mor}}
  \\
& \jdeq
  \ctxwk{P}{P},
  \tag{by \autoref{cancellation-ws-f}}
\end{align*}
so we see that it indeed makes sense to require that
\begin{equation}\label{extempalg-eq4}
\jtermeq{{{\Gamma}{A}}{P}}{\ctxwk{P}{P}}{\subst{\phi_1}{\epsilon_1}}{\idtm{P}}.
\end{equation}
For the last judgmental equality, we need to compute the family
\begin{equation*}
\jfam
  {{{\Gamma}{A}}{\subst{\phi_1}{\jcomp{}{\epsilon_0}{P}}}}
  {\subst{\jcomp{}{\epsilon_0}{\phi_1}}{\ctxwk{\ctxext{P}{\jcomp{}{\epsilon_0}{P}}}{P}}}.
\end{equation*}
This is easy:
\begin{align*}
\subst{\jcomp{}{\epsilon_0}{\phi_1}}{\ctxwk{\ctxext{P}{\jcomp{}{\epsilon_0}{P}}}{P}}
& \jdeq
  \subst{\jcomp{}{\epsilon_0}{\phi_1}}{\ctxwk{\jcomp{}{\epsilon_0}{P}}{{P}{P}}}
  \\
& \jdeq
  \ctxwk{P}{P}.
\end{align*}
Thus we are allowed to require that
\begin{equation}\label{extempalg-eq5}
\subst{\jcomp{}{\epsilon_0}{\phi_1}}{\epsilon_1}.
\end{equation}

We bring all this together in the definition of extension-empty algebras:

\begin{defn}
An \emph{extension-empty algebra in context $\Gamma$} 
is a sextuple $(A,P,\epsilon_0,\epsilon_1,\phi_0,\phi_1)$ for which 
the quadruple $(A,P,\epsilon_0,\epsilon_1)$ is an extension algebra in context 
$\Gamma$, the quadruple $(A,P,\phi_0,\phi_1)$ is an empty algebra in context
$\Gamma$, satisfying the judgmental equalities 
\autoref{extempalg-eq1,extempalg-eq2,extempalg-eq3,extempalg-eq4,extempalg-eq5}.
\end{defn}

\begin{thm}
Let $(A,P,\epsilon_0,\epsilon_1,\phi_0,\phi_1)$ be an extension-empty algebra
in context $\Gamma$. Then the sextuple
\begin{equation*}
(P,\jcomp{}{\epsilon_0}{P},\epsilon_1,\jcomp{}{\epsilon_0}{\epsilon_1},\phi_1,
\jcomp{}{\epsilon_0}{\phi_1})
\end{equation*}
is an extension-empty algebra in context $\ctxext{\Gamma}{A}$. 
\end{thm}

\begin{proof}
We first check whether the quadruple $(P,\jcomp{}{\epsilon_0}{P},\phi_1,\jcomp{}{\epsilon_0}{\phi_1})$
is an empty algebra in context $\ctxext{\Gamma}{A}$. Thus we need to verify
that $\subst{\phi_1}{\jcomp{}{\epsilon_0}{P}}\jdeq P$ and that
$\subst{\phi_1}{\jcomp{}{\epsilon_0}{\phi_1}}\jdeq\phi_1$. Both these judgmental
equalities follow from \autoref{lem:empalg-mor}.

To complete the proof, we need to verify that
\autoref{extempalg-eq1,extempalg-eq2,extempalg-eq3,extempalg-eq4,extempalg-eq5} hold in our
current setting. More precisely, we have to verify that
\begin{align*}
\subst{\phi_1}{\epsilon_1}
& \jdeq 
  \idtm{P}
  \\
\subst{\jcomp{}{\epsilon_0}{\phi_1}}{\epsilon_1}
& \jdeq 
  \idtm{P}
  \\
\subst{\phi_1}{\jcomp{}{\epsilon_0}{\epsilon_1}}
& \jdeq
  \epsilon_1
  \\
\subst{\jcomp{}{\epsilon_0}{\phi_1}}{\jcomp{}{\epsilon_0}{\epsilon_1}}
& \jdeq
  \idtm{\jcomp{}{\epsilon_0}{P}}
  \\
\subst{\jcomp{}{\epsilon_0}{\jcomp{}{\epsilon_0}{\phi_1}}}{\jcomp{}{\epsilon_0}{\epsilon_1}}
& \jdeq
  \idtm{\jcomp{}{\epsilon_0}{P}}
\end{align*}
None of these present any difficulties.
\end{proof}

\subsection{Homorphisms of term-algebras}
\begin{defn}
A homomorphism of term algebras $\cfthom{f}$ from $\cftalg{A}$ to $\cftalg{B}$
consists of a triple $(\cfthomc{\cfthom{f}},\cfthomf{\cfthom{f}},\cfthomt{\cfthom{f}})$
such that $(\cfthomc{\cfthom{f}},\cfthomf{\cfthom{f}})$ is an extension homomorphism
\end{defn}

\subsection{Term-algebras and term-operations}
Until now we had no need to consider term-algebras. Extension is an operation
letting contexts and families interact and the empty object is a term which
requires that contexts and families are compatible. However, to model the
theory of contexts, families and terms we do need to take terms into account.

\begin{defn}
A term-algebra $\cftalg{A}$ in context $\Gamma$ is a septuple 
\begin{equation*}
\unfold{\cftalg{A}}
\end{equation*}
such that the quadruple
$\unfold{\extalg}{A}$ is an extension algebra in context $\Gamma$, 
the quadruple $\unfold{\empalg{A}}$ is an empty algebra in context $\Gamma$,
for which we additionally have the following judgmental equality:
\begin{align*}
\jfameq*{{\Gamma}{\cftalgc{\cftalg{A}}}}{\subst{\cftempf{\cftalg{A}}}{\cftalgt{\cftalg{A}}}}{\emptyf}.
\end{align*}
\end{defn}

\begin{thm}
Let $\mathcal{A}\defeq(A,P,T,\epsilon_0,\epsilon_1,\phi_0,\phi_1)$ be a term-algebra in context
$\Gamma$. Then the septuple
\begin{equation*}
\mathcal{F}_{\mathcal{A}}\defeq(P,\jcomp{}{\epsilon_0}{P},\jcomp{}{\epsilon_0}{T},\epsilon_1,\jcomp{}{\epsilon_0}{\epsilon_1},\phi_1,\jcomp{}{\epsilon_0}{\phi_1})
\end{equation*}
is a term-algebra in context $\ctxext{\Gamma}{A}$, called the family term-algebra
of $\mathcal{A}$.
\end{thm}

\begin{thm}
Let $\mathcal{A}\defeq(A,P,T,\epsilon_0,\epsilon_1,\phi_0,\phi_1)$ be a term-algebra in context
$\Gamma$ and let $X$ be a family in context $\Gamma$. Then
\begin{equation*}
\ctxwk{X}{\mathcal{A}}\defeq(\ctxwk{X}{A},\ctxwk{X}{P},\ctxwk{X}{T},\ctxwk{X}{\epsilon_0},\ctxwk{X}{\epsilon_1},\ctxwk{X}{\phi_0},\ctxwk{X}{\phi_1})
\end{equation*}
is a term-algebra in context $\ctxext{\Gamma}{X}$.
\end{thm}

\begin{thm}
Let $\mathcal{A}\defeq(A,P,T,\epsilon_0,\epsilon_1,\phi_0,\phi_1)$ be a term-algebra in context
$\ctxext{\Gamma}{X}$ and let $\jterm{\Gamma}{X}{x}$. Then
\begin{equation*}
\subst{x}{\mathcal{A}}\defeq
(\subst{x}{A},\subst{x}{P},\subst{x}{T},\subst{x}{\epsilon_0},\subst{x}{\epsilon_1},
\subst{x}{\phi_0},\subst{x}{\phi_1})
\end{equation*}
is a term-algebra in context $\Gamma$.
\end{thm}

\begin{defn}
Let $\cftalg{A}$ and $\cftalg{B}$ be term-algebras in context $\Gamma$. 
A term-operation $\cfthom{f}$ from $\cftalg{A}$ to $\cftalg{B}$ in context
$\Gamma$ is a triple $(\cfthomc{\cfthom{f}},\cfthomf{\cfthom{f}},\cfthomt{\cfthom{f}})$
consisting of
\begin{align*}
\jhom*{\Gamma}{\cftalgc{\cftalg{A}}}{\cftalgc{\cftalg{B}}}{\cfthomc{\cfthom{f}}}
  \\
\jfhom*
  {\Gamma}
  {\cftalgc{\cftalg{A}}}
  {\cftalgc{\cftalg{B}}}
  {\cfthomc{\cfthom{f}}}
  {\cftalgf{\cftalg{A}}}
  {\cftalgf{\cftalg{B}}}
  {\cfthomf{\cfthom{f}}}
  \\
\jfhom*
  {\Gamma}
  {{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}
  {{\cftalgc{\cftalg{B}}}{\cftalgf{\cftalg{B}}}}
  {\jvcomp{\cftalgf{\cftalg{A}}}{\cfthomc{\cfthom{f}}}{\cfthomf{\cfthom{f}}}}
  {\cftalgt{\cftalg{A}}}
  {\cftalgt{\cftalg{B}}}
  {\cfthomt{\cfthom{f}}}
\end{align*}
such that the pair $(\cfthomc{\cfthom{f}},\cfthomf{\cfthom{f}})$ is both an 
extension homomorphism from
$(\cftalgc{\cftalg{A}},\cftalgf{\cftalg{A}},\cftctxext[\cftalg{A}],\cftfamext[\cftalg{A}])$ 
to 
$(\cftalgc{\cftalg{B}},\cftalgf{\cftalg{B}},\cftfamext[\cftalg{B}],\cftfamext[\cftalg{B}])$ 
in context $\Gamma$
and an empty homomorphism from 
$(\cftalgc{\cftalg{A}},\cftalgf{\cftalg{A}},\cftempc{\cftalg{A}},\cftempf{\cftalg{A}})$
to
$(\cftalgc{\cftalg{B}},\cftalgf{\cftalg{B}},\cftempc{\cftalg{B}},\cftempf{\cftalg{B}})$
in context $\Gamma$.
\end{defn}

Thus, when $\cfthom{f}$ is a term-operation from $\cftalg{A}$ to $\cftalg{B}$, we are
in the situation of the following judgmentally commutative diagram:
\begin{equation*}
\begin{tikzcd}
\cftalgt{\cftalg{A}}
  \ar[fib]{d}
  \ar{r}{\cfthomt{\cfthom{f}}}
& \cftalgt{\cftalg{B}}
  \ar[fib]{d}
  \\
\cftalgf{\cftalg{A}}
  \ar[fib]{d}
  \ar{r}{\cfthomf{\cfthom{f}}}
& \cftalgf{\cftalg{B}}
  \ar[fib]{d}
  \\
\cftalgc{\cftalg{A}}
  \ar{r}{\cfthomc{\cfthom{f}}}
& \cftalgc{\cftalg{B}}
\end{tikzcd}
\end{equation*}

\subsection{Weakening algebras}
Weakening algebras will be term-algebras with certain added structure.
Although strictly speaking one could formulate a notion of weakening algebra
which only depends on extension algebras and which omits both empty objects
and terms, we shall not do so here.

Let $\cftalg{A}$ be a term-algebra in context $\Gamma$. Weakening will be a
homomorphism
\begin{equation}\label{cftwk}
\jhom
  {{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}
  {\ctxwk{\cftalgf{\cftalg{A}}}{\cftalg{F_A}}}
  {\cftalg{F_{F_A}}}
  {\cftwk{\cftalg{A}}}
\end{equation}
satisfying judgmental equalities which express the compatibility with extension,
the empty object and itself. Thus, the rules we interpret for weakening are
the rules in sections \autoref{comp-we,comp-w0,comp-ww,comp-ew,comp-0w}. The
definition of weakening algebras can be found in \autoref{sec:cftwkalg-defn}.

We begin with some trivial remarks to familiarize ourselves with the situation.
The morphism $\cftwk{\cftalg{A}}$ of \autoref{cftwk} is a triple
$(\cftwkc{\cftalg{A}},\cftwkf{\cftalg{A}},\cftwkt{\cftalg{A}})$ consisting of
the morphisms displayed in the following diagram:
\begin{equation*}
\begin{tikzcd}
\ctxwk{\cftalgf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftalgt{\cftalg{A}}}}
  \ar[fib]{d}
  \ar{r}{\cftwkt{\cftalg{A}}}
& \jcomp{}{\cftctxext}{\jcomp{}{\cftctxext}{\cftalgt{\cftalg{A}}}}
  \ar[fib]{d}
  \\
\ctxwk{\cftalgf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}
  \ar[fib]{d}
  \ar{r}{\cftwkf{\cftalg{A}}}
& \jcomp{}{\cftctxext}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}
  \ar[fib]{d}
  \\
\ctxwk{\cftalgf{\cftalg{A}}}{\cftalgf{\cftalg{A}}}
  \ar{r}[swap]{\cftwkc{\cftalg{A}}}
& \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
\end{tikzcd}
\end{equation*}

\begin{rmk}
Let $\cftalg{A}$ be a term-algebra and let $\cftwk{\cftalg{A}}$ be as in
\autoref{cftwk}. Then we have
\begin{equation*}
\jterm
  {\Gamma}
  {\subst{{a}{{\gamma}{\cftctxext}}}{\cftalgf{\cftalg{A}}}}
  {\subst{b}{{a}{{\gamma}{\cftwkc{\cftalg{A}}}}}}
\end{equation*}
for $\gamma:A$ and $a,b:\subst{\gamma}{\cftalgf{\cftalg{A}}}$. We have
\begin{equation*}
\jterm
  {\Gamma}
  {\subst{{{b}{{a}{{\gamma}{\cftwkc{\cftalg{A}}}}}}{{{a}{{\gamma}{\cftctxext}}}{\cftctxext}}}{\cftalgf{\cftalg{A}}}}
  {\subst{q}{{b}{{a}{{\gamma}{\cftwkf{\cftalg{A}}}}}}}
\end{equation*}
for $\gamma:A$, $a,b:\subst{\gamma}{\cftalgf{\cftalg{A}}}$ and
$q:\subst{{b}{{\gamma}{\cftctxext}}}{\cftalgf{\cftalg{A}}}$. Finally, we have
\begin{equation*}
\jterm
  {\Gamma}
  {\subst{{q}{{b}{{a}{{\gamma}{\cftwkf{\cftalg{A}}}}}}}{{{{b}{{a}{{\gamma}{\cftwkc{\cftalg{A}}}}}}{{{a}{{\gamma}{\cftctxext}}}{\cftctxext}}}{\cftalgt{\cftalg{A}}}}}
  {\subst{g}{{q}{{b}{{a}{{\gamma}{\cftwkt{\cftalg{A}}}}}}}}
\end{equation*}
for $\gamma:A$, $a,b:\subst{\gamma}{\cftalgf{\cftalg{A}}}$,
$q:\subst{{b}{{\gamma}{\cftctxext}}}{\cftalgf{\cftalg{A}}}$ and
$g:\subst{q}{{{b}{{\gamma}{\cftctxext}}}{\cftalgt{\cftalg{A}}}}$.
These observations show that the weakening morphism $\cftwk{\cftalg{A}}$ is
indeed an abstraction of the introduction rules for the weakening operation.
\end{rmk}

\subsubsection{Weakening preserves itself}
The following diagram displays the compatibility of weakening with itself:
\begin{equation*}\label{diag:cftwk-cftwk}
\begin{tikzcd}[column sep=huge]
\ctxwk{\cftalgf{\cftalg{A}}}{{\cftalgf{\cftalg{F_A}}}{\cftalg{F_{F_A}}}}
  \ar{d}
    [swap]{ \ctxwk
        {{\cftalgf{\cftalg{A}}}{\cftalgf{\cftalg{F_A}}}}
        {\boldsymbol{\mathcal{F}}_{\cftwk{\cftalg{A}}}}
      }
  \ar{r}{\ctxwk{\cftalgf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftwk{\cftalg{A}}}}}
& \ctxwk{\cftalgf{\cftalg{A}}}{\cftalg{F_{F_{F_A}}}}
  \ar{d}{\jcomp{}{\cftctxext}{\boldsymbol{\mathcal{F}}_{\cftwk{\cftalg{A}}}}}
  \\
\ctxwk{{\cftalgf{\cftalg{A}}}{\cftalgf{\cftalg{F_A}}}}{\jcomp{}{\cftwkc{A}}{\cftalg{F_{F_{F_A}}}}}
  \ar{r}[swap]{\jcomp{}{\cftwkc{A}}{\jcomp{}{\cftctxext}{\cftwk{A}}}}
& \jcomp{}{\cftwkc{A}}{\cftalg{F_{F_{F_{F_A}}}}}
\end{tikzcd}
\end{equation*}
This is a complicated diagram and it is not immediately clear that all of it
makes sense. Therefore we examine its ingredients in more detail.

The morphisms on the top and on the right are fine as they are displayed

\begin{lem}
Let $\cftalg{A}$ be a term-algebra in context $\Gamma$ and let
\begin{equation*}
\jhom
  {{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}
  {\ctxwk{\cftalgf{\cftalg{A}}}{\cftalg{F_A}}}
  {\jcomp{}{\cftctxext}{\cftalg{F_A}}}
  {\cftwk{\cftalg{A}}}
\end{equation*}
be a homomorphism of term-algebras satisfying \autoref{diag:cftwk-cftwk}. Then
we have the judgmental equality
\begin{equation*}
\jtermeq
  {}
  {}
  {}
  {}
\end{equation*}
for $\gamma:A$, $x:\cftalgf{\cftalg{A}}$, $y_0:\cftalgf{\cftalg{A}}$ and
$y_1:\cftalgf{\cftalg{F_A}}$.
\end{lem}

\subsubsection{Currying for weakening}
\begin{equation*}
\jhomeq
  { {{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}
    {\cftalgf{\cftalg{F_A}}}
    }
  { \ctxwk
      {\cftalgf{\cftalg{F_A}}}
      {\cftalg{F_{F_A}}}
    }
  { \cftalg{F_{F_{F_A}}}
    }
  { \jcomp{}{\cftfamext}{\cftwk{\cftalg{A}}}
    }
  { \jcomp{}{\cftwk{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftwk{\cftalg{A}}}}
    }
\end{equation*}

\subsubsection{Weakening by the empty family}
\begin{equation*}
\jhomeq
  { {\Gamma}{\cftalgc{\cftalg{A}}}
    }
  { \cftalg{F_A}
    }
  { \cftalg{F_A}
    }
  { \subst{\cftempf{\cftalg{A}}}{\cftwk{\cftalg{A}}}
    }
  { id_{\cftalg{F_A}}
    }
\end{equation*}

\subsubsection{The definition of weakening algebras}\label{sec:cftwkalg-defn}

\subsubsection{Derivable properties of weakening algebras}
We should theoremize the following statements:
\begin{enumerate}
\item If $\cftalg{A}$ is a weakening algebra, then so is $\cftalg{F_A}$ if we take
$\jcomp{}{\cftctxext}{\cftwk{\cftalg{A}}}$ as its weakening.
\end{enumerate}

\begin{comment}
Because the pair $(\omega_0,\omega_1)$ is required to be an extension homomorphism,
the diagrams
\begin{equation}\label{wkalg-exteq1}
\begin{tikzcd}[column sep=large]
\ctxwk{P}{\ctxext{P}{\jcomp{}{\epsilon_0}{P}}}
  \ar{r}{\jvcomp{}{\omega_0}{\omega_1}}
  \ar{d}[swap]{\ctxwk{P}{\epsilon_1}}
& \ctxext
    {\jcomp{}{\epsilon_0}{P}}
    {\jcomp{}{\epsilon_0}{\jcomp{}{\epsilon_0}{P}}}
  \ar{d}{\jcomp{}{\epsilon_0}{\epsilon_1}}
  \\
\ctxwk{P}{P}
  \ar{r}[swap]{\omega_0}
& \jcomp{}{\epsilon_0}{P}
\end{tikzcd}
\end{equation}
in context $\ctxext{{\Gamma}{A}}{P}$, and
\begin{equation}\label{wkalg-exteq2}
\begin{tikzcd}[column sep=huge]
\ctxwk
  {P}
  { \ctxext
      {\jcomp{}{\epsilon_0}{P}}
      {\jcomp{}{\epsilon_0}{\jcomp{}{\epsilon_0}{P}}}
    }
  \ar{r}{\jvcomp{}{\omega_1}{\jcomp{}{\ctxwk{P}{\epsilon_1}}{\omega_1}}}
  \ar{d}[swap]{\ctxwk{P}{\jcomp{}{\epsilon_0}{\epsilon_1}}}
& \jcomp{}{\omega_0}{%
    \jcomp{}{\epsilon_0}{%
      \jcomp{}{\epsilon_0}{%
        \ctxext{P}{\jcomp{}{\epsilon_0}{P}}
        }
      }
    }
  \ar{d}{ \jcomp{}{\omega_0}{%
            \jcomp{}{\epsilon_0}{%
              \jcomp{}{\epsilon_0}{\epsilon_1}
              }
            }
          }
  \\
\ctxwk{P}{\jcomp{}{\epsilon_0}{P}}
  \ar{r}[swap]{\omega_1}
& \jcomp{}{\omega_0}{%
    \jcomp{}{\epsilon_0}{%
      \jcomp{}{\epsilon_0}{P}
      }
    }
\end{tikzcd}
\end{equation}
in context $\ctxext{{{\Gamma}{A}}{P}}{\ctxwk{P}{P}}$, commute judgmentally.
To see that the morphism $\jvcomp{}{\omega_1}{\jcomp{}{\ctxwk{P}{\epsilon_0}}{\omega_1}}$
indeed has the suggested codomain, we have the following lemma:

\begin{lem}
Let $(A,P,\epsilon_0,\epsilon_1)$ be an extension algebra and let
\begin{align*}
\jhom*
  {{{\Gamma}{A}}{P}}
  {\ctxwk{P}{P}}
  {\jcomp{}{\epsilon_0}{P}}
  {\omega_0}
  \\
\jfhom*
  {{{\Gamma}{A}}{P}}
  {\ctxwk{P}{P}}
  {\jcomp{}{\epsilon_0}{P}}
  {\omega_0}
  {\ctxwk{P}{\jcomp{}{\epsilon_0}{P}}}
  {\jcomp{}{\epsilon_0}{\jcomp{}{\epsilon_0}{P}}}
  {\omega_1}
\end{align*}
be morphisms satisfying \autoref{wkalg-exteq1}. Then the inference rules
\begin{align*}
& \inference
  { \jfam{{\Gamma}{A}}{Q}
    }
  { \jfameq
      {\blank}
      { \jcomp{}{\omega_1}{%
          \jcomp{}{\omega_0}{%
            \jcomp{}{\epsilon_0}{%
              \jcomp{}{\epsilon_0}{%
                \jcomp{}{\epsilon_0}{Q}
                }
              }
            }
          } 
        }
      { \jcomp{}{\ctxwk{P}{\epsilon_0}}{%
          \jcomp{}{\omega_0}{%
            \jcomp{}{\epsilon_0}{%
              \jcomp{}{\epsilon_0}{%
                Q
                }
              }
            }
          }
        }
      }
\end{align*}
are valid.
\end{lem}

\begin{proof}
We have the judgmental equalities
\begin{align*}
& \jcomp{}{\omega_1}{%
          \jcomp{}{\omega_0}{%
            \jcomp{}{\epsilon_0}{%
              \jcomp{}{\epsilon_0}{%
                \jcomp{}{\epsilon_0}{Q}
                }
              }
            }
          } 
  \\
& \jdeq
  \jcomp{}{\jvcomp{}{\omega_0}{\omega_1}}{%
            \jcomp{}{\epsilon_0}{%
              \jcomp{}{\epsilon_0}{%
                \jcomp{}{\epsilon_0}{Q}
                }
              }
            }
  \tag{by \autoref{lem:composition-threesome}}
  \\
& \jdeq
  \jcomp{}{\jvcomp{}{\omega_0}{\omega_1}}{%
            \jcomp{}{\epsilon_0}{%
              \jcomp{}{\epsilon_1}{%
                \jcomp{}{\epsilon_0}{Q}
                }
              }
            }
  \tag{by \autoref{lem:extalg-twins}}
  \\
& \jdeq
  \jcomp{}{\jvcomp{}{\omega_0}{\omega_1}}{%
            \jcomp{}{\jcomp{}{\epsilon_0}{\epsilon_1}}{%
              \jcomp{}{\epsilon_0}{%
                \jcomp{}{\epsilon_0}{Q}
                }
              }
            }
   \tag{by \autoref{lem:jcomp-higherjcomp}}
   \\
& \jdeq
  \jcomp{}{\jcomp{}{%
             \jvcomp{}{\omega_0}{\omega_1}}{%
               \jcomp{}{\epsilon_0}{\epsilon_1}}}{%
              \jcomp{}{\epsilon_0}{%
                \jcomp{}{\epsilon_0}{Q}
                }
              }
  \tag{by \autoref{lem:jcomp-jcomp}}
  \\
& \jdeq
  \jcomp{}{\jcomp{}{\ctxwk{P}{\epsilon_0}}{\omega_0}}{%
              \jcomp{}{\epsilon_0}{%
                \jcomp{}{\epsilon_0}{Q}
                }
              }
  \tag{by \autoref{wkalg-exteq1}}
  \\
& \jdeq
  \jcomp{}{\ctxwk{P}{\epsilon_0}}{%
    \jcomp{}{\omega_0}{%
      \jcomp{}{\epsilon_0}{%
        \jcomp{}{\epsilon_0}{%
          Q
          }
        }
      }
    }
  \tag{by \autoref{lem:jcomp-jcomp}}
\end{align*}
\end{proof}

\subsubsection{The compatibility of weakening with the empty context and family}
The first two judgmental equalities expressing that $\omega_0$ and $\omega_1$
are compatible with $\phi_1$ are easy to state:
\begin{align}
\jhomeq*{{\Gamma}{A}}{P}{P}{\subst{\phi_1}{\omega_0}}{\idtm{P}}\\
\jhomeq*{{\Gamma}{A}}{P}{P}{\subst{\phi_1}{\omega_1}}{\idtm{P}}
\end{align}

\subsubsection{The compatibility of weakening with itself}
To express the compatibility of weakening with itself, we must fill in the
following diagram:
\begin{equation*}
\begin{tikzcd}
\ctxwk{P}{{P}{P}}
  \ar{r}{\ctxwk{P}{\omega_0}}
  \ar{d}[swap]{\ctxwk{{P}{P}}{\omega_0}}
& \ctxwk{P}{\jcomp{}{\epsilon_0}{P}}
  \ar{d}{\omega_1}
  \\
\ctxwk{{P}{P}}{\jcomp{}{\epsilon_0}{P}}
  \ar[densely dotted]{r}
& \jcomp{}{\omega_0}{\jcomp{}{\epsilon_0}{\jcomp{}{\epsilon_0}{P}}}
\end{tikzcd}
\end{equation*}
\end{comment}

\subsection{Projection algebras}

\subsection{Substitution algebras}

Let $(A,P,T,\epsilon_0,\epsilon_1,\phi_0,\phi_1)$ be a term-algebra. To define
substitution algebras, we will consider
\begin{align*}
\jhom*
  {{{{\Gamma}{A}}{P}}{T}}
  {\ctxwk{T}{\jcomp{}{\epsilon_0}{P}}}
  {P}
  {\sigma_0}
  \\
\jfhom*
  {{{{\Gamma}{A}}{P}}{T}}
  {\ctxwk{T}{\jcomp{}{\epsilon_0}{P}}}
  {P}
  {\sigma_0}
  {\ctxwk{T}{\jcomp{}{\epsilon_0}{\jcomp{}{\epsilon_0}{P}}}}
  {\jcomp{}{\epsilon_0}{P}}
  {\sigma_1}
  \\
\jfhom*
  {{{{\Gamma}{A}}{P}}{T}}
  { \ctxext
      {\ctxwk{T}{\jcomp{}{\epsilon_0}{P}}}
      {\ctxwk{T}{\jcomp{}{\epsilon_0}{\jcomp{}{\epsilon_0}{P}}}}
    }
  {\ctxext{P}{\jcomp{}{\epsilon_0}{P}}}
  {\jvcomp{}{\sigma_0}{\sigma_1}}
  {\ctxwk{T}{\jcomp{}{\epsilon_0}{\jcomp{}{\epsilon_0}{T}}}}
  {\jcomp{}{\epsilon_0}{T}}
  {\sigma_2}
\end{align*}
for which the pair $(\sigma_0,\sigma_1)$ is required to be an extension
homomorphism and the triple $(\sigma_0,\sigma_1,\sigma_2)$ is required to
be an empty term-homomorphism.

\subsection{E-algebras}

\subsection{Pre-universes}
Pre-universes are internal versions of the theory of contexts, families and
terms. They interpret extension, the empty context, weakening, substitution
and identity terms all at once in a compatible way. Besides the compatibility
properties there will be judgmental equalities analoguous to the cancellation
properties of \autoref{cancellation-ws,cancellation-i}. Pre-universes are to
the theory of contexts, families and terms what internal categories to a
category.
