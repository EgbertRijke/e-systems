\section{Internalizing the theory of contexts families and terms}
One of the guiding ideas behind the design of the theory of contexts, families
and terms was that it would have to be possible to consider internal versions
of the theory. In this section we aim for this internalization. We stress that
we shall not make any further assumptions in this section, and thus that
it is \emph{by default} possible to consider internal models of the theory
of contexts, families and terms in itself. In particular, we do not assume that
there are universes; this is the subject of a later section in this part.

It would be interesting to write out a weak version of pre-universes, internal
to Martin-L\"of type theory with the function extensionality principle. 
To do this, the empty context needs to
be replaced by a contractible type, extension by dependent pair types,
judgmental equalities of terms by identifications and judgmental equalities
of families by equivalences of types. We conjecture that it is possible to
carry this out (in particular to make sure that all the constructions 
type-check). This could serve as a starting point for investigating internal
models without truncatedness assumptions and for investigating internal higher
categories. 
Moreover, one could then extend the notion of `weak' pre-universes
with the requirement that every internal morphism is weakly anodyne. This
could give an internal theory of weak higher groupoids.

\subsection{Extension algebras}\label{sec:extension-algebras}
In this subsection our goal is to define the notion of extension algebras,
which are internal versions of the extension operation of the theory of
contexts, families and terms. In this article, their use will be mainly in
universes. The theory of extension algebras requires the full power (i.e.~all
of the ingredients) of the theory of contexts, families and terms in its
formulation and it is (perhaps surprisingly) quite involved to formulate it.
The definition of extension algebras is given in \autoref{defn:extension-algebras}.

Let $P$ be a family over an extended context $\ctxext{\Gamma}{A}$. We could
mimic extension by requiring to have terms
\begin{align*}
\jhom*{\Gamma}{{A}{P}}{A}{e_0}\\
\jhom*{{\Gamma}{A}}{{P}{\jcomp{}{e_0}{P}}}{P}{e_1}.
\end{align*}

\begin{rmk}
Instead of looking at $e_1$ as a context morphism from $\ctxext{P}{\jcomp{}{e_0}{P}}$
to $P$, one could also look at $e_1$ as a morphism \emph{over $\cprojfstf{A}{P}$},
as indicated in the following diagram:
\begin{equation*}
\begin{tikzcd}
P
  \ar[fib]{d}
& \jcomp{}{e_0}{P}
  \ar[fib]{d}
  \ar{l}[swap]{e_1}
  \ar{r}
& P
  \ar[fib]{d}
  \\
A
& \ctxext{A}{P}
  \ar{l}{\cprojfstf{A}{P}}
  \ar{r}[swap]{e_0}
& A
\end{tikzcd}
\end{equation*}
This makes it clear that $e_1$ takes a family over an extended context as an
argument. The extended context consists of a `base part' and a `family part'. 
The output of $e_1$ is a new (extended) family over that base part. Forgetting 
the family part is what the projection takes care of.
\end{rmk}

Extension also satisfies the properties explained in \autoref{comp-ee}, so we
must find the two judgmental equalities for $e_0$ and $e_1$ mimicing those. 
The first of these judgmental equalities is easy to give: it says that the
following diagram commutes:
\begin{equation}\label{eq:extalg-eq1}
\begin{tikzcd}[column sep=huge]
\ctxext{A}{{P}{\jcomp{}{e_0}{P}}} 
  \ar{d}[swap]{\jvcomp{}{e_0}{\idtm{\jcomp{}{e_0}{P}}}
    } 
  \ar{r}{\jvcomp{}{\idtm{A}}{e_1}
    } 
  & \ctxext{A}{P} \ar{d}{e_0}\\
\ctxext{A}{P} \ar{r}[swap]{e_0} & A
\end{tikzcd}
\end{equation}

The second of the judgmental equalities is harder to describe, however. We need
to consider `higher' families, i.e.~families over families over families, and
thus we need to look at the family $\jcomp{}{e_0}{\jcomp{}{e_0}{P}}$ and find the
two dotted morphisms in the diagram
\begin{equation*}
\begin{tikzcd}
\ctxext{P}{{\jcomp{}{e_0}{P}}{\jcomp{}{e_0}{\jcomp{}{e_0}{P}}}}
  \ar[densely dotted]{d}
  \ar[densely dotted]{r}
& \ctxext{P}{\jcomp{}{e_0}{P}} \ar{d}{e_1}\\
\ctxext{P}{\jcomp{}{e_0}{P}} \ar{r}{e_1} & P
\end{tikzcd}
\end{equation*}
The first is easy to find. Note that we have the judgmental equality
\begin{equation*}
\ctxext{\jcomp{}{e_0}{P}}{\jcomp{}{e_0}{\jcomp{}{e_0}{P}}}
  \jdeq
  \jcomp{}{e_0}{\ctxext{P}{\jcomp{}{e_0}{P}}}
\end{equation*}
and therefore we may just take the morphism
\begin{equation*}
\jhom
  {{\Gamma}{A}}
  {{P}{{\jcomp{}{e_0}{P}}{\jcomp{}{e_0}{\jcomp{}{e_0}{P}}}}}
  {{P}{\jcomp{}{e_0}{P}}}
  {\jvcomp{}{\idtm{P}}{\jcomp{}{e_0}{e_1}}}.
\end{equation*}
For the other morphism we need to look at the family
$\ctxext{P}{{\jcomp{}{e_0}{P}}{\jcomp{}{e_0}{\jcomp{}{e_0}{P}}}}$ differently. We do
that in the following lemma.

\begin{lem}\label{lem:extalg-twins}
Suppose we have $A$, $P$, $e_0$ and $e_1$ satisfying \autoref{eq:extalg-eq1}. Then
the inference rules
\begin{align*}
& \inference
  { \jfam{{\Gamma}{A}}{Q}
    }
  { \jfameq
      {{{{\Gamma}{A}}{P}}{\jcomp{}{e_0}{P}}}
      {\jcomp{}{e_0}{\jcomp{}{e_0}{Q}}}
      {\jcomp{}{e_1}{\jcomp{}{e_0}{Q}}}
    }
  \\
& \inference
  { \jfam{{{\Gamma}{A}}{Q}}{R}
    }
  { \jfameq
      {{{{{\Gamma}{A}}{P}}{\jcomp{}{e_0}{P}}}
        {\jcomp{}{e_0}{\jcomp{}{e_0}{Q}}}}
      {\jcomp{}{e_0}{\jcomp{}{e_0}{R}}}
      {\jcomp{}{e_1}{\jcomp{}{e_0}{R}}}
    }
  \\
& \inference
  { \jterm{{{\Gamma}{A}}{Q}}{R}{h}
    }
  { \jtermeq
      {{{{{\Gamma}{A}}{P}}{\jcomp{}{e_0}{P}}}
        {\jcomp{}{e_0}{\jcomp{}{e_0}{Q}}}}
      {\jcomp{}{e_0}{\jcomp{}{e_0}{R}}}
      {\jcomp{}{e_0}{\jcomp{}{e_0}{h}}}
      {\jcomp{}{e_1}{\jcomp{}{e_0}{h}}}
    }
\end{align*}
are valid.
\end{lem}

\begin{proof}
We only prove the first inference rule. Let $\jfam{{\Gamma}{A}}{Q}$ be a family.
Then we have the judgmental equalities
\begin{align*}
\jcomp{}{e_0}{\jcomp{}{e_0}{Q}}
& \jdeq
  \jcomp{}{\idtm{\jcomp{}{e_0}{P}}}{\jcomp{}{e_0}{\jcomp{}{e_0}{Q}}}
  \tag{by \autoref{precomp-idtm-f}}
  \\
& \jdeq
  \jcomp{}{\jvcomp{}{e_0}{\idtm{\jcomp{}{e_0}{P}}}}{\jcomp{}{e_0}{Q}}
  \tag{by \autoref{lem:composition-threesome}}
  \\
& \jdeq
  \jcomp{}{\jcomp{}{\jvcomp{}{e_0}{\idtm{\jcomp{}{e_0}{P}}}}{e_0}}{Q}
  \tag{by \autoref{lem:jcomp-jcomp}}
  \\
& \jdeq
  \jcomp{}{\jcomp{}{\jvcomp{}{\idtm{A}}{e_1}}{e_0}}{Q}
  \tag{by \autoref{eq:extalg-eq1}}
  \\
& \jdeq
  \jcomp{}{\jvcomp{}{\idtm{A}}{e_1}}{\jcomp{}{e_0}{Q}}
  \tag{by \autoref{lem:jcomp-jcomp}}
  \\
& \jdeq
  \jcomp{}{e_1}{\jcomp{}{\idtm{A}}{\jcomp{}{e_0}{Q}}}
  \tag{by \autoref{lem:composition-threesome}}
  \\
& \jdeq
  \jcomp{}{e_1}{\jcomp{}{e_0}{Q}}.
  \tag{by \autoref{precomp-idtm-f}}
\end{align*}
\end{proof}

Now we see that we can use the morphism
\begin{equation*}
\jhom
  {{\Gamma}{A}}
  {{P}{{\jcomp{}{e_0}{P}}{\jcomp{}{e_1}{{}{e_0}{P}}}}}
  {{P}{\jcomp{}{e_0}{P}}}
  {\jvcomp{}{e_1}{\idtm{\jcomp{}{e_1}{{}{e_0}{P}}}}}.
\end{equation*}
Thus, the second judgmental equality we will need is that the diagram
\begin{equation}\label{eq:extalg-eq2}
\begin{tikzcd}[column sep=huge]
\ctxext{P}{{\jcomp{}{e_0}{P}}{\jcomp{}{e_0}{{}{e_0}{P}}}} 
  \ar{r}{\jvcomp{}{\idtm{P}}{\jcomp{}{e_0}{e_1}}}
  \ar{d}[swap]{
    \jvcomp{}{e_1}{\idtm{\jcomp{}{e_1}{{}{e_0}{P}}}}
    }
& \ctxext{P}{\jcomp{}{e_0}{P}} \ar{d}{e_1}\\
\ctxext{P}{\jcomp{}{e_0}{P}} \ar{r}[swap]{e_1} & P
\end{tikzcd}
\end{equation}
commutes judgmentally. Now we can confidently formulate the definition of
extension algebras.

\begin{defn}\label{defn:extension-algebras}
We define the judgment
\begin{equation*}
\jextalg{\Gamma}{A}
\end{equation*}
asserting that $\extalg{A}$ is an \emph{extension algebra in context $\Gamma$}
to be the conjunction of the following seven judmgents:
\begin{align*}
\jextalgctx*{\Gamma}{A}
  \\
\jextalgfam*{\Gamma}{A}
  \\
\jextalgtm*{\Gamma}{A}
  \\
\jextalgctxext*{\Gamma}{A}
  \\
\jextalgfamext*{\Gamma}{A}
  \\
\jhomeq*
  { \Gamma}
  { {\cftalgc{\cftalg{A}}}
    { {\cftalgf{\cftalg{A}}}
      {\jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}
      }
    }
  { \cftalgc{\cftalg{A}}}
  { \jcomp{}
      { \jvcomp{}
          {\cftctxext[\cftalg{A}]}
          {\idtm{\jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}}
        }
      { \cftctxext[\cftalg{A}]}
    }
  { \jcomp{}
      { \jvcomp{}
          {\idtm{\cftalgc{\cftalg{A}}}}
          {\cftfamext[\cftalg{A}]}
        }
      { \cftctxext[\cftalg{A}]}
    }
  \\
\jhomeq*
  { {\Gamma}{\cftalgc{\cftalg{A}}}}
  { { \cftalgf{\cftalg{A}}}
    { { \jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}
      { \jcomp{}
          {\cftctxext[\cftalg{A}]}
          {{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}
        }
      }
    }
  { \cftalgf{\cftalg{A}}}
  { \jcomp{}
      { \cftfamext[\cftalg{A}]}
      { \jvcomp{}
          {\cftfamext[\cftalg{A}]}
          {\idtm{\jcomp{}{\cftfamext[\cftalg{A}]}{{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}}}}
    }
  { \jcomp{}
      { \cftfamext[\cftalg{A}]}
      { \jvcomp{}
          {\idtm{\cftalgf{\cftalg{A}}}}
          {\jcomp{}{\cftctxext[\cftalg{A}]}{\cftfamext[\cftalg{A}]}}
        }
    }
\end{align*}
In other words, an extension algebra $\extalg{A}$ in context $\Gamma$
is a quintuple $\unfold{\extalg{A}}$ 
satisfying the judgmental equalities displayed in the diagrams in
\autoref{eq:extalg-eq1,eq:extalg-eq2}. Extension algebras are judgmentally
equal if they are componentwise judgmentally equal.

When $\extalg{A}$ is an extension algebra in context $\Gamma$, we also refer to
$\cftctxext[\cftalg{A}]$ as the \emph{context extension of $\extalg{A}$} and to
$\cftfamext[\cftalg{A}]$ as the \emph{family extension of $\extalg{A}$}.
\end{defn}

The following lemma both provides intuition behind the judgmental equalities
we have required for context and family extension and it proves that context 
and family extension in fact satisfy the compatibility rules stated in 
\autoref{comp-ee}. 

\begin{lem}
For $\gamma:\cftalgc{\cftalg{A}}$, 
$a:\subst{\gamma}{\cftalgf{\cftalg{A}}}$ and 
$p:\subst{\apply\cftctxext[\extalg{A}]{\gamma}{a}}{\cftalgf{\cftalg{A}}}$ 
we have the judgmental equality
\begin{align*}
\apply\cftctxext[\extalg{A}]{\gamma}{\apply\cftfamext[\extalg{A}]{\gamma}{a}{p}}
& \jdeq
  \apply\cftctxext[\extalg{A}]{\apply\cftctxext[\extalg{A}]{\gamma}{a}}{p}.
  \intertext{%
and when we also have 
$q: \subst
      {\apply\cftctxext[\extalg{A}]{\apply\cftctxext[\extalg{A}]{\gamma}{a}}{p}}
      {\cftalgf{\extalg{A}}}$, %
we have the judgmental equality}
\apply\cftfamext[\extalg{A}]{\gamma}{a}{%
  \apply\cftfamext[\extalg{A}]{\apply\cftctxext[\extalg{A}]{\gamma}{a}}{p}{q}}
& \jdeq
  \apply\cftfamext[\extalg{A}]{\gamma}{%
    \apply\cftfamext[\extalg{A}]{\gamma}{a}{p}}{q}.
\end{align*}
\end{lem}

\begin{proof}
Both proofs are simple calculations. For the first judgmental equality we have
\begin{align*}
\apply\cftctxext[\extalg{A}]{\gamma}{\apply\cftfamext[\extalg{A}]{\gamma}{a}{p}}
& \jdeq
  \subst
    {\tmext{\gamma}{\apply\cftfamext[\extalg{A}]{\gamma}{a}{p}}}
    {\cftctxext[\cftalg{A}]}
  \\
& \jdeq 
  \subst
    { {p}
      { {a}
        { {\gamma}
          {\jvcomp{}{\idtm{\cftalgc{\cftalg{A}}}}{\cftfamext[\cftalg{A}]}}
          }
        }
      }
    { \cftctxext[\cftalg{A}]}
  \\
& \jdeq
  \subst{p}{{a}{{\gamma}{\jcomp{}{\jvcomp{}{\idtm{\cftalgc{\cftalg{A}}}}{\cftfamext[\cftalg{A}]}}{\cftctxext[\cftalg{A}]}}}}
  \\
& \jdeq
  \subst{p}{{a}{{\gamma}{\jcomp{}{\jvcomp{}{\cftctxext[\cftalg{A}]}{\idtm{\jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}}}{\cftctxext[\cftalg{A}]}}}}
  \\
& \jdeq 
  \subst{{p}{{a}{{\gamma}{\jvcomp{}{\cftctxext[\cftalg{A}]}{\idtm{\jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}}}}}}{\cftctxext[\cftalg{A}]}
  \\
& \jdeq
  \subst
    {\tmext{\apply\cftctxext[\extalg{A}]{\gamma}{a}}{p}}
    {\cftctxext[\cftalg{A}]}
  \\
& \jdeq
  \apply\cftctxext[\extalg{A}]{\apply\cftctxext[\extalg{A}]{\gamma}{a}}{p}.
\end{align*}
and to prove the second judgmental equality we calculate
\begin{align*}
\apply\cftfamext[\extalg{A}]{\gamma}{a}{%
  \apply\cftfamext[\extalg{A}]{\apply\cftctxext[\extalg{A}]{\gamma}{a}}{p}{q}}
& \jdeq
  \apply\cftfamext[\extalg{A}]{\gamma}{%
    \apply\cftfamext[\extalg{A}]{\gamma}{a}{p}}{q}.\qedhere
\end{align*}
\end{proof}

There is a trivial class of examples of extension algebras we can give right
away. More examples will be introduced by universes, later on.

\begin{eg}
Let $A$ be a family in context $\Gamma$. Then the quadruple
\begin{equation*}
(A,\emptyf,\emptyf,\idtm{A},\emptytm)
\end{equation*}
is an extension algebra in context $\Gamma$, as is the quadruple
\begin{equation*}
(\emptyf,A,\emptyf,\emptytm,\idtm{A}).
\end{equation*}
Also, the quadruple
\begin{equation*}
(A,\ctxwk{A}{A},\emptyf,\cprojfstf{A}{\ctxwk{A}{A}},\cprojfstf{\ctxwk{A}}{\ctxwk{A}{{A}{A}}})
\end{equation*}
is an extension algebra in context $\Gamma$.
\end{eg}

As a consequence of the following theorem, every extension algebra gives rise
to infinitely many extension algebras by constructing the extension algebra
of families of $\cftalg{A}$ for each extension algebra $\cftalg{A}$. Notice
that this also explains that the family $\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}$
over $\ctxext{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}$ is the family
of families over families. Likewise, higher families are obtained by pulling
back more times along $\cftctxext[\cftalg{A}]$.

\begin{thm}\label{thm:extalg-fam}
Suppose that $\extalg{A}$ is an extension algebra in context
$\Gamma$. Then 
\begin{equation*}
\cftalg{F_A}
\defeq
( \cftalgf{\cftalg{A}},
  \jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}},
  \jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgt{\cftalg{A}}},
  \cftfamext,
  \jcomp{}{\cftctxext[\cftalg{A}]}{\cftfamext})
\end{equation*}
is an extension algebra in context $\ctxext{\Gamma}{\cftalgc{\cftalg{A}}}$.
\end{thm}

\begin{proof}
In this proof, we shall use the short-hand notations $\cftctxext$ and $\cftfamext$
only to refer to $\cftctxext[\cftalg{A}]$ and $\cftfamext[\cftalg{A}]$, respectively,
and not to $\cftctxext[\cftalg{F_A}]$ or $\cftfamext[\cftalg{F_A}]$.

We first need to verify that the domain of the morphism 
$\jcomp{}{\cftctxext}{\cftfamext}$ is indeed
$\ctxext{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}{\jcomp{}{\cftfamext}{{}{\cftctxext}{\cftalgf{\cftalg{A}}}}}$. 
This follows from the judgmental equality
$\jcomp{}{\cftfamext}{{}{\cftctxext}{\cftalgf{\cftalg{A}}}}\jdeq
\jcomp{}{\cftctxext}{{}{\cftctxext}{\cftalgf{\cftalg{A}}}}$, which we have proved in
\autoref{lem:extalg-twins}. Notice how the diagram in \autoref{eq:extalg-eq2} is
of exactly the right sort, so the quadruple
$(\cftalgf{\cftalg{A}},\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}},\cftfamext,\jcomp{}{\cftctxext}{\cftfamext})$
satisfies its version of \autoref{eq:extalg-eq1}. It is left to verify that the diagram
\begin{small}
\begin{equation*}
\begin{tikzcd}[column sep=huge]
\ctxext
  { \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
    }
  { { \jcomp{}{\cftfamext}{%
        \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
        }
      }
    { \jcomp{}{\cftfamext}{%
        \jcomp{}{\cftfamext}{%
          \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
          }
        }
      }
    } 
  \ar{r}
    { \jvcomp{}{\idtm{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}}{%
        \jcomp{}{\cftfamext}{%
          \jcomp{}{\cftctxext}{\cftfamext}}}}
  \ar{d}[swap]{
    \jvcomp{}{\jcomp{}{\cftctxext}{\cftfamext}}{%
      \idtm{
        \jcomp{}{\jcomp{}{\cftctxext}{\cftfamext}}{%
          \jcomp{}{\cftfamext}{%
            \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
            }
          }
        }
      }
    }
& \ctxext
    {\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}
    {\jcomp{}{\cftfamext}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}} 
  \ar{d}{\jcomp{}{\cftctxext}{\cftfamext}}
  \\
\ctxext
  {\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}
  {\jcomp{}{\cftfamext}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}} 
  \ar{r}[swap]{\jcomp{}{\cftctxext}{\cftfamext}} 
& \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
\end{tikzcd}
\end{equation*}
\end{small}%
commutes judgmentally; this diagram is the version of \autoref{eq:extalg-eq2}
for the quadruple
$(\cftalgf{\cftalg{A}},\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}},\cftfamext,\jcomp{}{\cftctxext}{\cftfamext})$. Note
that this follows from \autoref{eq:extalg-eq2} provided that we can show that
\begin{align}
\jvcomp{}{\idtm{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}}{%
  \jcomp{}{\cftfamext}{%
    \jcomp{}{\cftctxext}{\cftfamext}}}
& \jdeq
  \jcomp{}{\cftctxext}{%
    \jvcomp{}{\idtm{\cftalgf{\cftalg{A}}}}{\jcomp{}{\cftctxext}{\cftfamext}}
    }
  \label{eq:extalg-infty1}
  \\
\jvcomp{}{\jcomp{}{\cftctxext}{\cftfamext}}{%
  \idtm{
    \jcomp{}{\jcomp{}{\cftctxext}{\cftfamext}}{%
      \jcomp{}{\cftfamext}{%
        \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
        }
      }
    }
  }
& \jdeq
\jcomp{}{\cftctxext}{%
  \jvcomp{}{\cftfamext}{%
    \idtm{
      \jcomp{}{\cftfamext}{%
        \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
        }
      }
    }
  }
  \label{eq:extalg-infty2}
\end{align}
Note that \autoref{eq:extalg-infty1} follows if we can show that
\begin{equation*}
\jcomp{}{\cftfamext}{\jcomp{}{\cftctxext}{\cftfamext}}
  \jdeq
  \jcomp{}{\cftctxext}{\jcomp{}{\cftctxext}{\cftfamext}}.
\end{equation*}
This is a special case of \autoref{lem:extalg-twins}. The second judgmental
equality, \autoref{eq:extalg-infty2}, is trivial.
\end{proof}

\begin{thm}\label{thm:extalg-wk}
Let $\extalg{Q}$ be an extension algebra in context $\ctxext{\Gamma}{B}$ and let
$\jfam{\Gamma}{A}$ be a family of contexts. Then the quintuple
\begin{equation*}
\ctxwk{A}{\extalg{Q}}
  \defeq
  ( \ctxwk{A}{\cftalgc{\cftalg{Q}}},
    \ctxwk{A}{\cftalgf{\cftalg{Q}}},
    \ctxwk{A}{\cftalgt{\cftalg{Q}}},
    \ctxwk{A}{\cftctxext[\cftalg{Q}]},
    \ctxwk{A}{\cftfamext[\cftalg{Q}]})
\end{equation*}
is an extension algebra in context $\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}$.
\end{thm}

\begin{proof}
The proof follows from the fact that weakening by $A$ is compatible with all
the involved operations.
\end{proof}

\begin{thm}\label{thm:extalg-subst}
Let $\extalg{Q}$ be an extension algebra in context $\ctxext{{\Gamma}{A}}{P}$
and let $\jterm{\Gamma}{A}{x}$ be a term. Then the quintuple
\begin{equation*}
\subst{x}{\cftalg{Q}}
  \defeq
  ( \subst{x}{\cftalgc{\cftalg{Q}}},
    \subst{x}{\cftalgf{\cftalg{Q}}},
    \subst{x}{\cftalgt{\cftalg{Q}}},
    \subst{x}{\cftctxext[\cftalg{Q}]},
    \subst{x}{\cftfamext[\cftalg{Q}]})
\end{equation*}
is an extension algebra in context $\ctxext{\Gamma}{\subst{x}{P}}$.
\end{thm}

\begin{proof}
The proof follows from the fact that substitution with $x$ is compatible with
all the involved operations.
\end{proof}

\begin{cor}
Let $\extalg{Q}$ be an extension algebra in context $\ctxext{\Gamma}{B}$
and let $\jhom{\Gamma}{A}{B}{f}$. Then the quintuple
\begin{equation*}
\jcomp{A}{f}{\extalg{Q}}
  \defeq
  ( \jcomp{A}{f}{\cftalgc{\cftalg{Q}}},
    \jcomp{A}{f}{\cftalgf{\cftalg{Q}}},
    \jcomp{A}{f}{\cftalgt{\cftalg{Q}}},
    \jcomp{A}{f}{\cftctxext[\cftalg{Q}]},
    \jcomp{A}{f}{\cftfamext[\cftalg{Q}]})
\end{equation*}
is an extension algebra in context $\ctxext{\Gamma}{A}$.
\end{cor}

\begin{cor}
Let $\extalg{A}$ be an extension algebra in context $\Gamma$. Then
$\extalg{F_{F_A}}$ and $\jcomp{}{\cftctxext[\extalg{A}]}{\extalg{F_A}}$ are
judgmentally equal extension algebras in context $\ctxext{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}$.
\end{cor}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Extension homomorphisms}

\begin{defn}
An \emph{extension homomorphism $\cfthom{f}$ from $\extalg{A}$ to
$\extalg{B}$ in context $\Gamma$} is a triple $\unfold{\cfthom{f}}$ consisting of
\begin{align*}
\jhom*
  {\Gamma}
  {\cftalgc{\cftalg{A}}}
  {\cftalgc{\cftalg{B}}}
  {\cfthomc{\cfthom{f}}}
  \\
\jfhom*
  {\Gamma}
  {\cftalgc{\cftalg{A}}}
  {\cftalgc{\cftalg{B}}}
  {\cfthomc{\cfthom{f}}}
  {\cftalgf{\cftalg{A}}}
  {\cftalgf{\cftalg{B}}}
  {\cfthomf{\cfthom{f}}}
  \\
\jfhom*
  {\Gamma}
  {{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}
  {{\cftalgc{\cftalg{B}}}{\cftalgf{\cftalg{B}}}}
  {\jvcomp{}{\cfthomc{\cfthom{f}}}{\cfthomf{\cfthom{f}}}}
  {\cftalgt{\cftalg{A}}}
  {\cftalgt{\cftalg{B}}}
  {\cfthomt{\cfthom{f}}}
\end{align*}
for which the diagrams
\begin{equation}\label{eq:exthom1}
\begin{tikzcd}
\ctxext{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}
  \ar{r}{\jvcomp{}{\cfthomc{\cfthom{f}}}{\cfthomf{\cfthom{f}}}}
  \ar{d}[swap]{\cftctxext[\cftalg{A}]}
& \ctxext{\cftalgc{\cftalg{B}}}{\cftalgf{\cftalg{B}}}
  \ar{d}{\cftctxext[\cftalg{B}]}
  \\
\cftalgc{\cftalg{A}}
  \ar{r}[swap]{\cfthomc{\cfthom{f}}}
& \cftalgc{\cftalg{A}}
\end{tikzcd}
\end{equation}
and
\begin{equation}\label{eq:exthom2}
\begin{tikzcd}[column sep=huge]
\ctxext{\cftalgf{\cftalg{A}}}{\jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}}
  \ar{r}{\jvcomp{}{\cfthomf{\cfthom{f}}}{\jcomp{}{\cftctxext[\cftalg{A}]}{\cfthomf{\cfthom{f}}}}}
  \ar{d}[swap]{\cftfamext[\cftalg{A}]}
& \jcomp{}{\cfthomc{\cfthom{f}}}{\ctxext{\cftalgf{\cftalg{B}}}{\jcomp{}{\cftctxext[\cftalg{B}]}{\cftalgf{\cftalg{B}}}}}
  \ar{d}{\jcomp{}{\cfthomc{\cfthom{f}}}{\cftfamext[\cftalg{B}]}}
  \\
\cftalgf{\cftalg{A}}
  \ar{r}[swap]{\cfthomf{\cfthom{f}}}
& \jcomp{}{\cfthomc{\cfthom{f}}}{\cftalgf{\cftalg{B}}}
\end{tikzcd}
\end{equation}
commute judgmentally.
\end{defn}

\begin{rmk}
To see that the upper morphism in the diagram of \autoref{eq:exthom2} has
indeed the indicated codomain provided that the diagram of \autoref{eq:exthom1}
commutes judgmentally, note that we have the judgmental equalities
\begin{align*}
\jcomp{}{\cfthomf{\cfthom{f}}}{\jcomp{}{\cfthomc{\cfthom{f}}}{\jcomp{}{\cftctxext[\cftalg{B}]}{\cftalgf{\cftalg{B}}}}}
& \jdeq 
  \jcomp{}{\jvcomp{}{\cfthomc{\cfthom{f}}}{\cfthomf{\cfthom{f}}}}{\jcomp{}{\cftctxext[\cftalg{B}]}{\cftalgf{\cftalg{B}}}}
  \tag{by \autoref{lem:composition-threesome}}
  \\
& \jdeq
  \jcomp{}{\jcomp{}{\jvcomp{}{\cfthomc{\cfthom{f}}}{\cfthomf{\cfthom{f}}}}{\cftctxext[\cftalg{B}]}}{\cftalgf{\cftalg{B}}}
  \tag{by \autoref{lem:jcomp-jcomp}}
  \\
& \jdeq
  \jcomp{}{\jcomp{}{\cftctxext[\cftalg{A}]}{\cfthomc{\cfthom{f}}}}{\cftalgf{\cftalg{B}}}
  \tag{by \autoref{eq:exthom1}}
  \\
& \jdeq
  \jcomp{}{\cftctxext[\cftalg{A}]}{\jcomp{}{\cfthomc{\cfthom{f}}}{\cftalgf{\cftalg{B}}}}.
  \tag{by \autoref{lem:jcomp-jcomp}}
\end{align*}
and we indeed have the morphism $\jcomp{}{\cftctxext[\cftalg{A}]}{\cfthomf{\cfthom{f}}}$ from 
$\jcomp{}{\cftctxext[\cftalg{A}]}{\cftalgf{\cftalg{A}}}$ to $\jcomp{}{\cftctxext[\cftalg{A}]}{\jcomp{}{\cfthomc{\cfthom{f}}}{\cftalgf{\cftalg{B}}}}$.
\end{rmk}

\begin{thm}
Let $\cfthom{f}$ be an extension homomorphism from $\cftalg{A}$ to $\cftalg{B}$
in context $\Gamma$. Then
\begin{equation*}
\boldsymbol{\mathcal{F}}_\cfthom{f}
  \defeq
  ( \cfthomf{\cfthom{f}},
    \jcomp{}{\cftctxext[\cftalg{A}]}{\cfthomf{\cfthom{f}}},
    \jcomp{}{\cftctxext[\cftalg{A}]}{\cfthomt{\cfthom{f}}})
\end{equation*}
is an extension homomorphism from $\cftalg{F_A}$ to $\jcomp{}{\cfthomc{\cfthom{f}}}{\cftalg{F_B}}$
in context $\ctxext{\Gamma}{\cftalgc{\cftalg{A}}}$. 
\end{thm}

\begin{proof}
We have to verify that the diagrams in \autoref{eq:exthom1,eq:exthom2}
commute for $\cfthom{F_f}$. Unfolding the ingredients of \autoref{eq:exthom1}
for $\cfthom{F_f}$ gives us quite directly \autoref{eq:exthom2}. The
diagram in \autoref{eq:exthom2} for $\cfthom{F_f}$ is judgmentally equal
to the pullback of everything in the diagram in \autoref{eq:exthom2} for
$\cfthom{f}$ by $\epsilon_0$, and therefore it commutes too.
\end{proof}

\begin{defn}
Let $\cfthom{f}$ and $\cfthom{g}$ be extension homomorphisms from
$\extalg{A}$ to $\extalg{B}$ and from $\extalg{B}$ to $\extalg{C}$, respectively.
We define the composition
\begin{equation*}
\cfthomcomp{\cfthom{f}}{\cfthom{g}}
  \defeq
  \unfold{\cfthomcomp{\cfthom{f}}{\cfthom{g}}}.
\end{equation*}
In other words, extension homomorphisms are composed by taking the horizontal 
rectangles in the diagram
\begin{equation*}
\begin{tikzcd}
\extalgt{\extalg{A}} 
  \ar[fib]{d}
  \ar{r}{\cfthomt{\cfthom{f}}}
& \extalgt{\extalg{B}} 
  \ar[fib]{d}
  \ar{r}{\cfthomt{\cfthom{g}}}
& \extalgt{\extalg{C}}
  \ar[fib]{d}
  \\
\extalgf{\extalg{A}} 
  \ar[fib]{d}
  \ar{r}{\cfthomf{\cfthom{f}}}
& \extalgf{\extalg{B}} 
  \ar[fib]{d}
  \ar{r}{\cfthomf{\cfthom{g}}}
& \extalgf{\extalg{C}}
  \ar[fib]{d}
  \\
\extalgc{\extalg{A}}
  \ar{r}{\cfthomc{\cfthom{f}}}
& \extalgc{\extalg{B}}
  \ar{r}{\cfthomc{\cfthom{g}}}
& \extalgc{\extalg{C}}
\end{tikzcd}
\end{equation*}
\end{defn}

\begin{rmk}
It follows from \autoref{lem:jcomp-jcomp,lem:jfcomp-jfcomp} that composition
of extension homomorphisms is associative.
\end{rmk}

\begin{thm}
Let $\cfthom{f}$ and $\cfthom{g}$ be extension homomorphisms from
$\extalg{A}$ to $\extalg{B}$ and from $\extalg{B}$ to $\extalg{C}$, respectively.
Then $\cfthomcomp{\cfthom{f}}{\cfthom{g}}$ is an extension homomorphism from
$\extalg{A}$ to $\extalg{C}$. 
\end{thm}

\begin{proof}
Both judgmental equalities are applications of the interchange law for composition,
\autoref{lem:composition-interchange}. 
\end{proof}

The following theorem explains how context extension can be seen as an extension
homomorphism. Note that in combination with \autoref{thm:extalg-fam}, this also
explains how family extension can be seen as an extension homomorphism.

\begin{thm}
Let $\extalg{A}$ be an extension algebra in context $\Gamma$. Then
\begin{align*}
& ( \ctxext{\extalgc{\extalg{A}}}{\extalgf{\extalg{A}}},
    \jcomp{}{\cftctxext}{\extalgf{\extalg{A}}},
    \jvcomp{}{\ctxwk{\extalgf{\extalg{A}}}{\idtm{\extalgc{\extalg{A}}}}}{\cftfamext},
    \jcomp{}{\cftctxext}{\cftfamext}
    )
\intertext{and}
& ( \ctxext{\extalgc{\extalg{A}}}{\extalgf{\extalg{A}}},
    \jcomp{}{\cftctxext}{\extalgf{\extalg{A}}},
    \jvcomp{}{\cftctxext}{\idtm{\jcomp{}{\cftctxext}{\extalgf{\extalg{A}}}}},
    \jcomp{}{\cftctxext}{\cftfamext}
    )
\end{align*}
are extension algebras in context $\Gamma$ and
\begin{equation*}
\boldsymbol{\cftctxext}\defeq ( \cftctxext,
  \idtm{\jcomp{}{\cftctxext}{\extalgf{\extalg{A}}}}
  )
\end{equation*}
is an extension homomorphism from both of them to $\extalg{A}$. 
\end{thm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{CFT-algebras}
The notion of CFT-algebras that we will
study in this subsection will be extension algebras which also have an empty 
context $\cftempc{\cftalg{A}}$ and an empty family $\cftempf{\cftalg{A}}$ 
satisfying (among other conditions) that families over the empty context in
$\cftalg{A}$ are just the contexts of $\cftalg{A}$. We will begin with an 
auxilary lemma which will help us dealing with the internal empty contexts:

\begin{lem}\label{lem:empalg-mor}
Consider a family $\jfam{\Gamma}{A}$ with a term $\jterm{\Gamma}{A}{x}$ and 
a family $\jfam{{\Gamma}{A}}{P}$ % with a term $\jterm{{\Gamma}{A}}{P}{y}$
satisfying the judgmental equality
\begin{align}
\jfameq*{\Gamma}{\subst{x}{P}}{A}
  \label{eq1:empalg-mor}
%  \\
%\jtermeq*{\Gamma}{A}{\subst{x}{y}}{x}.
%  \label{eq2:empalg-mor}
\end{align}
Consider also a morphism
\begin{equation*}
\jhom{\Gamma}{{A}{P}}{B}{f}.
\end{equation*}
Then $\subst{\xi}{f}$ is a morphism from $A$ to $B$ 
in context $\Gamma$ and the following inference rules are valid for $\xi$ being 
$x$ or $y$:
\begin{align*}
& \inference
  { \jfam{{\Gamma}{B}}{Q}
    }
  { \jfameq
      {{\Gamma}{A}}
      {\subst{\xi}{\jcomp{}{f}{Q}}}
      {\jcomp{}{\subst{\xi}{f}}{Q}}
    }
  \\
& \inference
  { \jfam{{{\Gamma}{B}}{Q}}{R}
    }
  { \jfameq
      {{{\Gamma}{A}}{\jcomp{}{\subst{\xi}{f}}{Q}}}
      {\subst{\xi}{\jcomp{}{f}{R}}}
      {\jcomp{}{\subst{\xi}{f}}{R}}
    }
  \\
& \inference
  { \jterm{{{\Gamma}{B}}{Q}}{R}{h}
    }
  { \jtermeq
      {{{\Gamma}{A}}{\jcomp{}{\subst{\xi}{f}}{Q}}}
      {\jcomp{}{\subst{\xi}{f}}{R}}
      {\subst{\xi}{\jcomp{}{f}{h}}}
      {\jcomp{}{\subst{\xi}{f}}{h}}
    }
\end{align*}
\end{lem}

\begin{proof}
We only prove the first inference rule in both cases.
Let $Q$ be a family over $\ctxext{\Gamma}{\cftalgc{\cftalg{A}}}$. In the case 
where $\xi$ is $x$ we have the judgmental equalities
\begin{align*}
\subst{x}{\jcomp{}{f}{Q}}
& \jdeq
  \subst
    {x}
    {{f}{\ctxwk{\ctxext{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}{Q}}}
  \tag{by definition}
  \\
& \jdeq
  \subst
    { {x}{f}
      }
    { {x}
      {\ctxwk{\ctxext{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}{Q}}
      }
  \tag{by \autoref{comp-ss-f}}
  \\
& \jdeq
  \subst
    { {x}{f}
      }
    { {x}
      {\ctxwk{\cftalgf{\cftalg{A}}}{{\cftalgc{\cftalg{A}}}{Q}}}
      }
  \tag{by \autoref{comp-ew-f}}
  \\
& \jdeq
  \subst
    { {x}{f}
      }
    { \ctxwk
        {\subst{x}{\cftalgf{\cftalg{A}}}}
        {\subst{x}{\ctxwk{\cftalgc{\cftalg{A}}}{Q}}}
      }
  \tag{by \autoref{comp-sw-f}}
  \\
& \jdeq
  \subst
    { {x}{f}
      }
    { \ctxwk
        {\subst{x}{\cftalgf{\cftalg{A}}}}
        {Q}
      }
  \tag{by \autoref{cancellation-ws-f}}
  \\
& \jdeq
  \subst{{x}{f}}{\ctxwk{\cftalgc{\cftalg{A}}}{Q}}
  \tag{by \autoref{eq1:empalg-mor}}
  \\
& \jdeq
  \jcomp{}{\subst{x}{f}}{Q}.
  \tag{by definition}
\end{align*}
In the case where $\xi$ is $y$ we have the judgmental equalities
\begin{align*}
\subst{y}{\jcomp{}{f}{Q}}
& \jdeq
  \subst
    { y
      }
    { {f}
      {\ctxwk{\ctxext{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}{Q}}
      }
  \tag{by definition}
  \\
& \jdeq
  \subst
    { {y}{f}
      }
    { {y}
      {\ctxwk{\ctxext{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}{Q}}
      }
  \tag{by \autoref{comp-ss-f}}
  \\
& \jdeq
  \subst
    { {y}{f}
      }
    { {y}
      {\ctxwk{\cftalgf{\cftalg{A}}}{{\cftalgc{\cftalg{A}}}{Q}}}
      }
  \tag{by \autoref{comp-ew-f}}
  \\
& \jdeq
  \subst
    { {y}{f}
      }
    { \ctxwk{\cftalgc{\cftalg{A}}}{Q}
      }
  \tag{by \autoref{cancellation-ws-f}}
  \\
& \jdeq
  \jcomp{}{\subst{y}{f}}{Q}.
  \tag{by definition}
\end{align*}
\end{proof}

\begin{defn}
A \emph{CFT-algebra $\cftalg{A}$ in context $\Gamma$} is a septuple
\begin{equation*}
\unfold{\cftalg{A}}
\end{equation*}
where the quintuple $\unfold{\extalg{A}}$ is an extension
algebra in context $\Gamma$, and where
\begin{align*}
\jterm*{\Gamma}{\cftalgc{\cftalg{A}}}{\cftempc{\cftalg{A}}}
  \\
\jterm*{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}{\cftempf{\cftalg{A}}}
\end{align*}
which satisfy the following judgmental equalities
\begin{enumerate}
\item Families over the empty context in $\cftalg{A}$ are contexts of $\cftalg{A}$:
\begin{align}
\jfameq*
  {\Gamma}
  {\subst{\cftempc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}
  {\cftalgc{\cftalg{A}}}
  \label{empalg-eq1}
\end{align}
\item The empty family over the empty context of $\cftalg{A}$ is the empty context of $\cftalg{A}$:
\begin{align}
\jtermeq*
  {\Gamma}
  {\cftalgc{\cftalg{A}}}
  {\subst{\cftempc{\cftalg{A}}}{\cftempf{\cftalg{A}}}}
  {\cftempc{\cftalg{A}}}.
  \label{empalg-eq2}
\end{align}
\item Context extension of $\cftalg{A}$ is compatible with the empty context and
family of $\cftalg{A}$:
\begin{align}
\jtermeq*
  {{\Gamma}{\cftalgc{\cftalg{A}}}}
  {\ctxwk{\cftalgc{\cftalg{A}}}{\cftalgc{\cftalg{A}}}}
  {\subst{\cftempc{\cftalg{A}}}{\cftctxext[\cftalg{A}]}}
  {\idtm{\cftalgc{\cftalg{A}}}}
  \label{cftalg-eq1}
  \\
\jtermeq*
  {{\Gamma}{\cftalgc{\cftalg{A}}}}
  {\ctxwk{\cftalgc{\cftalg{A}}}{\cftalgc{\cftalg{A}}}}
  {\subst{\cftempf{\cftalg{A}}}{\cftctxext[\cftalg{A}]}}
  {\idtm{\cftalgc{\cftalg{A}}}}
  \label{cftalg-eq2}
\end{align}
\item Family extension of $\cftalg{A}$ is compatible with the empty family and the empty family
over families of $\cftalg{A}$:
\begin{align}
\jtermeq*
  {{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}
  {\ctxwk{\cftalgf{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}
  {\subst{\cftempf{\cftalg{A}}}{\cftfamext}}
  {\idtm{\cftalgf{\cftalg{A}}}}
  \label{cftalg-eq3}
  \\
\jtermeq*
  {{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}
  {\ctxwk{\cftalgf{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}
  {\subst{\jcomp{}{\cftctxext}{\cftempf{\cftalg{A}}}}{\cftfamext}}
  {\idtm{\cftalgf{\cftalg{A}}}}
  \label{cftalg-eq4}
\end{align}
\item Family extension over the empty context of $\cftalg{A}$ is context extension
of $\cftalg{A}$:
\begin{align}
\jhomeq*
  {\Gamma}
  {{\cftalgc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}
  {\cftalgc{\cftalg{A}}}
  {\subst{\cftempc{\cftalg{A}}}{\cftfamext}}
  {\cftctxext}
  \label{cftalg-eq5}
\end{align}
\end{enumerate}
\end{defn}

\begin{rmk}\label{rmk:cftalg-defn}
We need to verify that the judgmental equalities
\autoref{cftalg-eq1,cftalg-eq2,cftalg-eq3,cftalg-eq4,cftalg-eq5}
are indeed well-typed (i.e.~compare two terms of the same type).
\begin{enumerate}
\item \autoref{lem:empalg-mor} implies that the morphisms 
$\subst{\cftempc{\cftalg{A}}}{\cftctxext}$ and
$\subst{\cftempf{\cftalg{A}}}{\cftctxext}$ both go from $\cftalgc{\cftalg{A}}$ 
to $\cftalgc{\cftalg{A}}$.
\item \label{rmkenum:famfamempf-jdeq-fam}
Now we have the judgmental equalities
\begin{align*}
\subst{\cftempf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}
& \jdeq
  \jcomp{}{\subst{\cftempf{\cftalg{A}}}{\cftctxext}}{\cftalgf{\cftalg{A}}}
  \tag{by \autoref{lem:empalg-mor}}
  \\
& \jdeq
  \jcomp{}{\idtm{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}
  \tag{by \autoref{cftalg-eq1}}
  \\
& \jdeq
  \cftalgf{\cftalg{A}}
  \tag{by \autoref{precomp-idtm-c}}
\end{align*}
Therefore we can apply \autoref{lem:empalg-mor} with the triple
$(\cftalgf{\cftalg{A}},\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}},
\cftempf{\cftalg{A}})$ and the morphism $\cftfamext$ to see that both 
$\subst{\cftempf{\cftalg{A}}}{\cftfamext}$ and
$\subst{\jcomp{}{\cftctxext}{\cftempf{\cftalg{A}}}}{\cftfamext}$
are morphisms from $\cftalgf{\cftalg{A}}$ to $\cftalgf{\cftalg{A}}$.
\item The morphism $\subst{\cftempc{\cftalg{A}}}{\cftfamext}$ goes from
$ \subst
    {\cftempc{\cftalg{A}}}
    {\ctxext{\cftalgf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}}
  $
to $\subst{\cftempc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}$. For the domain we
have the judgmental equalities
\begin{align*}
  \subst
    {\cftempc{\cftalg{A}}}
    {\ctxext{\cftalgf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}}
& \jdeq
  \ctxext
    {\subst{\cftempc{\cftalg{A}}}{\cftalgf{\cftalg{A}}}}
    {\subst{\cftempc{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}}
  \tag{by \autoref{comp-se-c}}
  \\
& \jdeq
  \ctxext
    {\cftalgc{\cftalg{A}}}
    {\subst{\cftempc{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}}
  \tag{by \autoref{empalg-eq1}}
  \\
& \jdeq
  \ctxext
    {\cftalgc{\cftalg{A}}}
    {\cftalgf{\cftalg{A}}}
  \tag{by \autoref{rmkenum:famfamempf-jdeq-fam} above}
\end{align*}
The codomain of $\subst{\cftempc{\cftalg{A}}}{\cftfamext}$
is judgmentally equal to $\cftalgc{\cftalg{A}}$ by
\autoref{empalg-eq1}.
\end{enumerate}
\end{rmk}

We can extend the results of 
\autoref{thm:extalg-fam,thm:extalg-wk,thm:extalg-subst} to CFT-algebras.

\begin{thm}\label{thm:cftalg-fam}
Let $\cftalg{A}$ be a CFT-algebra
in context $\Gamma$. Then the septuple
\begin{equation*}
\cftalg{F_A}
  \defeq
  ( \cftalgf{\cftalg{A}},
    \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}},
    \jcomp{}{\cftctxext}{\cftalgt{\cftalg{A}}},
    \cftfamext,
    \jcomp{}{\cftctxext}{\cftfamext},
    \cftempf{\cftalg{A}},
    \jcomp{}{\cftctxext}{\cftempf{\cftalg{A}}})
\end{equation*}
is a CFT-algebra in context $\ctxext{\Gamma}{\cftalgc{\cftalg{A}}}$. 
\end{thm}

\begin{proof}
\begin{enumerate}
\item The judgmental equality
\begin{equation*}
\jfameq{{\Gamma}{\cftalgc{\cftalg{A}}}}{\subst{\cftempf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}}{\cftalgf{\cftalg{A}}}
\end{equation*}
was verified in \autoref{rmkenum:famfamempf-jdeq-fam} of \autoref{rmk:cftalg-defn}.
\item Now we verify the judgmental equality
\begin{equation*}
\jtermeq
  {{\Gamma}{\cftalgc{\cftalg{A}}}}
  {\cftalgf{\cftalg{A}}}
  {\subst{\cftempf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftempf{\cftalg{A}}}}}
  {\cftempf{\cftalg{A}}}.
\end{equation*}
Note that we can apply \autoref{lem:empalg-mor}, so we get the judgmental
equalities
\begin{align*}
\subst{\cftempf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftempf{\cftalg{A}}}}
& \jdeq
  \jcomp{}{\subst{\cftempf{\cftalg{A}}}{\cftctxext}}{\cftempf{\cftalg{A}}}
  \tag{by \autoref{lem:empalg-mor}}
  \\
& \jdeq
  \jcomp{}{\idtm{\cftalgf{\cftalg{A}}}}{\cftempf{\cftalg{A}}}
  \tag{by \autoref{cftalg-eq3}}
  \\
& \jdeq
  \cftempf{\cftalg{A}}.
  \tag{by \autoref{precomp-idtm-t}}
\end{align*}
\item The judgmental equalities
\begin{align*}
\subst{\cftempf{\cftalg{A}}}{\cftfamext}
& \jdeq 
  \idtm{\cftalgf{\cftalg{A}}}
  \\
\subst{\jcomp{}{\cftctxext}{\cftempf{\cftalg{A}}}}{\cftfamext}
& \jdeq 
  \idtm{\cftalgf{\cftalg{A}}}
\end{align*}
are given by assumption.
\item The judgmental equalities
\begin{align*}
\subst{\jcomp{}{\cftctxext}{\cftempf{\cftalg{A}}}}{\jcomp{}{\cftctxext}{\cftfamext}}
& \jdeq
  \idtm{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}
  \\
\subst{\jcomp{}{\cftfamext}{\jcomp{}{\cftctxext}{\cftempf{\cftalg{A}}}}}{\jcomp{}{\cftctxext}{\cftfamext}}
& \jdeq
  \idtm{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}
\end{align*}
follow from the judgmental equalities
\begin{align*}
\subst{\jcomp{}{\cftctxext}{\cftempf{\cftalg{A}}}}{\jcomp{}{\cftctxext}{\cftfamext}}
& \jdeq
  \jcomp{}{\cftctxext}{\subst{\cftempf{\cftalg{A}}}{\cftfamext}}
  \tag{by \autoref{lem:jcomp-subst}}
  \\
& \jdeq
  \jcomp{}{\cftctxext}{\idtm{\cftalgf{\cftalg{A}}}}
  \tag{by \autoref{cftalg-eq3}}
  \\
& \jdeq
  \idtm{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}
  \tag{by \autoref{comp-wi-t}}
\end{align*}
and
\begin{align*}
\subst
  {\jcomp{}{\cftfamext}{\jcomp{}{\cftctxext}{\cftempf{\cftalg{A}}}}}
  {\jcomp{}{\cftctxext}{\cftfamext}}
& \jdeq
  \subst
    {\jcomp{}{\cftctxext}{\jcomp{}{\cftctxext}{\cftempf{\cftalg{A}}}}}
    {\jcomp{}{\cftctxext}{\cftfamext}}
  \tag{by \autoref{lem:extalg-twins}}
  \\
& \jdeq
  \jcomp
    {}
    {\cftctxext}
    {\subst{\jcomp{}{\cftctxext}{\cftempf{\cftalg{A}}}}{\cftfamext}}
  \tag{by \autoref{comp-sw-t}}
  \\
& \jdeq
  \jcomp
    {}
    {\cftctxext}
    {\idtm{\cftalgf{\cftalg{A}}}}
  \tag{by \autoref{cftalg-eq4}}
  \\
& \jdeq
  \idtm{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}.
  \tag{by \autoref{comp-wi-t}}
\end{align*}
\item Finally, the judgmental equality
\begin{equation*}
\subst{\cftempf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftfamext}}
  \jdeq
  \cftfamext
\end{equation*}
is verified as follows:
\begin{align*}
\subst{\cftempf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftfamext}}
& \jdeq
  \jcomp{}{\subst{\cftempf{\cftalg{A}}}{\cftctxext}}{\cftfamext}
  \tag{by \autoref{lem:empalg-mor}}
  \\
& \jdeq
  \jcomp{}{\idtm{\cftalgc{\cftalg{A}}}}{\cftfamext}
  \tag{by \autoref{cftalg-eq1}}
  \\
& \jdeq
  \cftfamext.
  \tag{by \autoref{precomp-idtm-t}}
\end{align*}
\end{enumerate}
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{CFT-homomorphisms}
\begin{defn}
A homomorphism of term algebras $\cfthom{f}$ from $\cftalg{A}$ to $\cftalg{B}$
consists of a triple $(\cfthomc{\cfthom{f}},\cfthomf{\cfthom{f}},\cfthomt{\cfthom{f}})$
such that $(\cfthomc{\cfthom{f}},\cfthomf{\cfthom{f}})$ is an extension homomorphism
\end{defn}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Weakening algebras}
Weakening algebras will be CFT-algebras with certain added structure.
Although strictly speaking one could formulate a notion of weakening algebra
which only depends on extension algebras and which omits both empty objects
and terms, we shall not do so here.

Let $\cftalg{A}$ be a CFT-algebra in context $\Gamma$. Weakening will be a
CFT-homomorphism
\begin{equation}\label{cftwk}
\jhom
  {{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}
  {\ctxwk{\cftalgf{\cftalg{A}}}{\cftalg{F_A}}}
  {\cftalg{F_{F_A}}}
  {\cftwk{\cftalg{A}}}
\end{equation}
satisfying judgmental equalities which express abstracted analogues of
the rules in sections \autoref{comp-ww,comp-ew,comp-0w}. The
definition of weakening algebras can be found in \autoref{sec:cftwkalg-defn}.

We begin with some trivial remarks to familiarize ourselves with the situation.
The morphism $\cftwk{\cftalg{A}}$ of \autoref{cftwk} is a triple
$(\cftwkc{\cftalg{A}},\cftwkf{\cftalg{A}},\cftwkt{\cftalg{A}})$ consisting of
the morphisms displayed in the following diagram:
\begin{equation*}
\begin{tikzcd}
\ctxwk{\cftalgf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftalgt{\cftalg{A}}}}
  \ar[fib]{d}
  \ar{r}{\cftwkt{\cftalg{A}}}
& \jcomp{}{\cftctxext}{\jcomp{}{\cftctxext}{\cftalgt{\cftalg{A}}}}
  \ar[fib]{d}
  \\
\ctxwk{\cftalgf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}
  \ar[fib]{d}
  \ar{r}{\cftwkf{\cftalg{A}}}
& \jcomp{}{\cftctxext}{\jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}}
  \ar[fib]{d}
  \\
\ctxwk{\cftalgf{\cftalg{A}}}{\cftalgf{\cftalg{A}}}
  \ar{r}[swap]{\cftwkc{\cftalg{A}}}
& \jcomp{}{\cftctxext}{\cftalgf{\cftalg{A}}}
\end{tikzcd}
\end{equation*}

\begin{rmk}
Let $\cftalg{A}$ be a CFT-algebra and let $\cftwk{\cftalg{A}}$ be as in
\autoref{cftwk}. Then we have
\begin{equation*}
\jterm
  {\Gamma}
  {\subst{\apply\cftctxext{\gamma}{a}}{\cftalgf{\cftalg{A}}}}
  {\subst{b}{{a}{{\gamma}{\cftwkc{\cftalg{A}}}}}}
\end{equation*}
for $\gamma:A$ and $a,b:\subst{\gamma}{\cftalgf{\cftalg{A}}}$. We have
\begin{equation*}
\jterm
  { \Gamma}
  { \subst
      { \apply\cftctxext
          {\apply\cftctxext{\gamma}{a}}
          {\subst{b}{{a}{{\gamma}{\cftwkc{\cftalg{A}}}}}}
        }
      { \cftalgf{\cftalg{A}}}}
  { \subst{q}{{b}{{a}{{\gamma}{\cftwkf{\cftalg{A}}}}}}}
\end{equation*}
for $\gamma:A$, $a,b:\subst{\gamma}{\cftalgf{\cftalg{A}}}$ and
$q:\subst{\apply\cftctxext{\gamma}{b}}{\cftalgf{\cftalg{A}}}$. Finally, we have
\begin{equation*}
\jterm
  { \Gamma}
  { \subst
      { {q}{{b}{{a}{{\gamma}{\cftwkf{\cftalg{A}}}}}}}
      { { \apply\cftctxext
            {\apply\cftctxext{\gamma}{a}}
            {{b}{{a}{{\gamma}{\cftwkc{\cftalg{A}}}}}}
          }
        {\cftalgt{\cftalg{A}}}
        }
    }
  {\subst{g}{{q}{{b}{{a}{{\gamma}{\cftwkt{\cftalg{A}}}}}}}}
\end{equation*}
for $\gamma:A$, $a,b:\subst{\gamma}{\cftalgf{\cftalg{A}}}$,
$q:\subst{\apply\cftctxext{\gamma}{b}}{\cftalgf{\cftalg{A}}}$ and
$g:\subst{q}{{\apply\cftctxext{\gamma}{b}}{\cftalgt{\cftalg{A}}}}$.
These observations show that the weakening morphism $\cftwk{\cftalg{A}}$ is
indeed an abstraction of the introduction rules for the weakening operation.
\end{rmk}

\subsubsection{Weakening preserves itself}
Let $\cftalg{A}$ be a CFT-algebra in context $\Gamma$ and let
\begin{equation*}
\jhom
  {{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}
  {\ctxwk{\cftalgf{\cftalg{A}}}{\cftalg{F_A}}}
  {\jcomp{}{\cftctxext}{\cftalg{F_A}}}
  {\cfthom{w}}
\end{equation*}
be a CFT-homomorphism. The abstraction of the rules in \autoref{comp-ww} is the
condition that the diagram
\begin{equation}\label{diag:cftwk-cftwk}
\begin{tikzcd}[column sep=10em]
\ctxwk{\cftalgf{\cftalg{A}}}{{\cftalgf{\cftalg{F_A}}}{\cftalg{F_{F_A}}}}
  \ar{d}
    [swap]{ \ctxwk
        {{\cftalgf{\cftalg{A}}}{\cftalgf{\cftalg{F_A}}}}
        {\boldsymbol{\mathcal{F}}_{\cfthom{w}}}
      }
  \ar{r}{\ctxwk{\cftalgf{\cftalg{A}}}{\jcomp{}{\cftctxext}{\cfthom{w}}}}
& \ctxwk{\cftalgf{\cftalg{A}}}{\cftalg{F_{F_{F_A}}}}
  \ar{d}{\jcomp{}{\ctxwk{\cftalgf{\cftalg{A}}}{\cftfamext}}{\boldsymbol{\mathcal{F}}_{\cfthom{w}}}}
  \\
\ctxwk{{\cftalgf{\cftalg{A}}}{\cftalgf{\cftalg{F_A}}}}{\jcomp{}{\cfthomc{\cfthom{w}}}{\cftalg{F_{F_{F_A}}}}}
  \ar{r}[swap]{%
    \jcomp{}
      { \cfthomf{\cfthom{w}}}
      { \jcomp{}
          {\cfthomc{\cfthom{w}}}
          { \jcomp{}
              {\cftctxext}
              { \jcomp{}
                  {\cftctxext}
                  {\cfthom{w}}
                }
            }
        }
    }
& \jcomp{}{\cfthomc{\cfthom{w}}}{\cftalg{F_{F_{F_{F_A}}}}}
\end{tikzcd}
\end{equation}
of CFT-algebras in context 
$ \ctxext
    {{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}
    {\cftalgf{\cftalg{F_A}}}$ %
commutes. In this diagram, it is not immediately obvious that the domain and
codomain of the CFT-homomorphism
$ \jcomp{}
      { \cfthomf{\cfthom{w}}}
      { \jcomp{}
          {\cfthomc{\cfthom{w}}}
          { \jcomp{}
              {\cftctxext}
              { \jcomp{}
                  {\cftctxext}
                  {\cfthom{w}}
                }
            }
        }$ %
from
$ \jcomp{}
      { \cfthomf{\cfthom{w}}}
      { \jcomp{}
          {\cfthomc{\cfthom{w}}}
          { \jcomp{}
              {\cftctxext}
              { \jcomp{}
                  {\cftctxext}
                  {\ctxwk{\cftalgf{\cftalg{A}}}{\cftalg{F_A}}}
                }
            }
        }
$ to
$ \jcomp{}
      { \cfthomf{\cfthom{w}}}
      { \jcomp{}
          {\cfthomc{\cfthom{w}}}
          { \jcomp{}
              {\cftctxext}
              { \jcomp{}
                  {\cftctxext}
                  {\cftalg{F_{F_A}}}
                }
            }
        }
$ are indeed judgmentally equal to the indicated domain and codomain.

\begin{lem}
Let $\cftalg{A}$ be a CFT-algebra in context $\Gamma$ and let
\begin{equation*}
\jhom
  {{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}
  {\ctxwk{\cftalgf{\cftalg{A}}}{\cftalg{F_A}}}
  {\jcomp{}{\cftctxext}{\cftalg{F_A}}}
  {\cfthom{w}}
\end{equation*}
be a homomorphism of CFT-algebras for which the diagram in
\autoref{diag:cftwk-cftwk} commutes judgmentally. Then
we have the judgmental equality
\begin{align*}
& \jcomp{}
  { \subst{q}{{\apply\cftctxext{\gamma}{b}}{\cfthom{w}}}
    }
  { \subst
      {\apply\cftfamext{\gamma}{b}{q}}
      {{a}{{\gamma}{\boldsymbol{\mathcal{F}}_{\cfthom{w}}}}}
    }
  \\
& \jdeq
  \jcomp{}
    { \subst{b}{{a}{{\gamma}{\boldsymbol{\mathcal{F}}_{\cfthom{w}}}}}
      }
    { \subst
        { {q}{{b}{{a}{{\gamma}{\cfthomf{\cfthom{w}}}}}}}
        { {\apply\cftctxext{\apply\cftctxext{\gamma}{a}}{\subst{b}{{a}{{\gamma}{\cfthomc{\cfthom{w}}}}}}}
          {\cfthom{w}}
          }
      }
\end{align*}
of CFT-homomorphisms from $\subst{b}{{\gamma}{\cftalg{F_{F_A}}}}$ to
$ \subst
      { {q}{{b}{{a}{{\gamma}{\cfthomf{\cfthom{w}}}}}}
        }
      { {{b}{{a}{{\gamma}{\cfthomc{\cfthom{w}}}}}}
        {{a}{{\gamma}{\cftalg{F_{F_{F_{F_{A}}}}}}}}
        }$
in context $\Gamma$, for $\gamma:A$, $a,b:\subst{\gamma}{\cftalgf{\cftalg{A}}}$ and
$q:\subst{b}{{\gamma}{\cftalgf{\cftalg{F_A}}}}$.
\end{lem}

\subsubsection{Currying for weakening}
Let $\cftalg{A}$ be a CFT-algebra in context $\Gamma$ and let
\begin{equation*}
\jhom
  {{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}
  {\ctxwk{\cftalgf{\cftalg{A}}}{\cftalg{F_A}}}
  {\jcomp{}{\cftctxext}{\cftalg{F_A}}}
  {\cfthom{w}}
\end{equation*}
be a CFT-homomorphism. The abstraction of the rules in \autoref{comp-ew} is the
condition that the diagram
\begin{equation}\label{eq:cftwk-cftextcurry}
\begin{tikzcd}[column sep=large]
\ctxwk
  {\ctxext{\cftalgf{\cftalg{A}}}{\cftalgf{\cftalg{F_A}}}}
  {\cftalg{F_A}}
  \ar{r}{\ctxwk{\cftalgf{\cftalg{F_A}}}{\cfthom{w}}}
  \ar{dr}[swap]{\jcomp{}{\cftfamext}{\cfthom{w}}}
& \ctxwk{\cftalgf{\cftalg{F_A}}}{\cftalg{F_{F_A}}}
  \ar{d}{\jcomp{}{\cftctxext}{\cfthom{w}}}
  \\
& \cftalg{F_{F_{F_A}}}
\end{tikzcd}
\end{equation}
of CFT-algebras in context 
$\ctxext
    {{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}
    {\cftalgf{\cftalg{F_A}}}
$ %
commutes.

\begin{lem}
Let $\cftalg{A}$ be a CFT-algebra in context gamma with a CFT-homomorphism 
$ \jhom
  {{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}
  {\ctxwk{\cftalgf{\cftalg{A}}}{\cftalg{F_A}}}
  {\jcomp{}{\cftctxext}{\cftalg{F_A}}}
  {\cfthom{w}}
$
satisfying the judgmental equality of \autoref{eq:cftwk-cftextcurry}. Then we
have the judgmental equality
\begin{equation*}
\subst{{p}{{a}{\cftfamext}}}{{\gamma}{\cfthom{w}}}
\jdeq
\jcomp{}
    {\subst{a}{{\gamma}{\cfthom{w}}}}
    {\subst{p}{{\apply\cftctxext{\gamma}{a}}{\cfthom{w}}}}
\end{equation*}
of CFT-homomorphisms from $\subst{\gamma}{\cftalg{F_A}}$ to 
$\subst{p}{{a}{{\gamma}{\cftalg{F_{F_{F_A}}}}}}$ in context $\Gamma$,
for every $\gamma:A$, $a:\subst{\gamma}{\cftalgf{\cftalg{A}}}$ and
$p:\subst{a}{{\gamma}{\cftalgf{\cftalg{F_A}}}}$. 
\end{lem}

\subsubsection{Weakening by the empty family}
\begin{equation}\label{eq:cftwk-cftempcurry}
\jhomeq
  { {\Gamma}{\cftalgc{\cftalg{A}}}
    }
  { \cftalg{F_A}
    }
  { \cftalg{F_A}
    }
  { \subst{\cftempf{\cftalg{A}}}{\cfthom{w}}
    }
  { id_{\cftalg{F_A}}
    }
\end{equation}

\subsubsection{The definition of weakening algebras}\label{sec:cftwkalg-defn}

\begin{defn}
A weakening algebra in context $\Gamma$ is a CFT-algebra $\cftalg{A}$ in context
$\Gamma$ for which there is a CFT-homomorphism
\begin{equation*}
\jhom
  {{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}
  {\ctxwk{\cftalgf{\cftalg{A}}}{\cftalg{F_A}}}
  {\cftalg{F_{F_A}}}
  {\cftwk{\cftalg{A}}}
\end{equation*}
satisfying the judgmental equalities of %
\autoref{diag:cftwk-cftwk,eq:cftwk-cftextcurry,eq:cftwk-cftempcurry}.
\end{defn}

\subsubsection{Derivable properties of weakening algebras}
We should theoremize the following statements:
\begin{enumerate}
\item If $\cftalg{A}$ is a weakening algebra, then so is $\cftalg{F_A}$ if we take
$\jcomp{}{\cftctxext}{\cftwk{\cftalg{A}}}$ as its weakening.
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Projection algebras}
Projection algebras will be weakening algebras with additional terms implementing
the identity terms. We call these algebras projection algebras because the
identity terms can only be formulated in weakening algebras and together with
weakening, the identity terms provide for all the projections. In a weakening
algebra $\cftalg{A}$ in context $\Gamma$, identity terms are implemented by a term
\begin{equation*}
\jterm
  { { {\Gamma}
      {\cftalgc{\cftalg{A}}}
      }
    { \cftalgf{\cftalg{A}}
      }
    }
  {\subst{{\idtm{\cftalgf{\cftalg{A}}}}{\cftwkc{\cftalg{A}}}}{\cftalgt{\cftalg{F_A}}}}
  {\cftidtm{\cftalg{A}}}
\end{equation*}
We will require additionally that identity terms are compatible with weakening.
Thus we will formulate an abstraction of the rule stated in \autoref{comp-wi}.

\begin{equation}
\jtermeq
  { \xi}
  { \xi}
  { \subst
      { \jcomp
          { }
          { \cftctxext}
          { \cftidtm{\cftalg{A}}
            }
        }
      { { { \idtm
              { \jcomp
                  { }
                  { \cftctxext}
                  { \cftalgf{\cftalg{A}}
                    }
                }
            }
            { \jcomp
                { }
                { \cftctxext
                  }
                { \cftwkc{\cftalg{A}}
                  }
              }
          }
        { \jcomp
            { }
            { \jcomp{}{\cftctxext}{\cftfamext}}
            { \cftwkt{\cftalg{A}}}
          }
        }
    }
  { \xi}
\end{equation}

\subsection{Substitution algebras}
Substitution algebras will be CFT-algebras with an additional substitution 
operation. Given a CFT-algebra $\cftalg{A}$ in context $\Gamma$, substitution 
will be a CFT-homomorphism
\begin{equation*}
\jhom
  {{{{\Gamma}{\cftalgc{\cftalg{A}}}}{\cftalgf{\cftalg{A}}}}{\cftalgt{\cftalg{A}}}}
  {\ctxwk{\cftalgt{\cftalg{A}}}{\cftalg{F_{F_A}}}}
  {\cftalg{F_A}}
  {\cftsubst{\cftalg{A}}}
\end{equation*}
We will require additionally that substitution preserves itself. Thus, we will
formulate an abstraction of the rules stated in \autoref{comp-ss}.

\subsection{E-algebras}
E-algebras will be CFT-algebras with a weakening operation, identity terms and
a substitution operation making it a projection algebra and a substitution 
algebra at the same time. Additionally the weakening operation, identity terms
and the substitution operation are all required to be compatible with each
other. Thus, we need to require the abstractions of the rules stated in
\autoref{comp-sw,comp-ws,cancellation-ws,cancellation-i}.

\subsection{Pre-universes}
Pre-universes are internal versions of the theory of contexts, families and
terms. They interpret extension, the empty context, weakening, substitution
and identity terms all at once in a compatible way. Besides the compatibility
properties there will be judgmental equalities analoguous to the cancellation
properties of \autoref{cancellation-ws,cancellation-i}. Pre-universes are to
the theory of contexts, families and terms what internal categories to a
category.
