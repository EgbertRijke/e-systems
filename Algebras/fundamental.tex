\subsection{Semantics of the fundamental structure of dependent type theory}

\begin{defn}
A \emph{fundamental structure} $\stesys$ in $\cat{C}$ consists of a diagram of the form
\begin{equation*}
\begin{tikzcd}
\stesyst
  \ar{d}[swap]{\ebd}
  \\
\stesysf
  \ar{d}[swap]{\eft}
  \\
\stesysc
\end{tikzcd}
\end{equation*}
in $\cat{C}$. In this diagram, $\stesysc$ is the object of \emph{contexts}, $\stesysf$ is
the object of \emph{families}, and $\stesyst$ is the object of \emph{terms}.
\end{defn}

\begin{defn}
A \emph{context of $\stesys$ under an object $X$ of $\cat{C}$} is a morphism $\Gamma:X\to \stesysc$ in
$\cat{C}$. A \emph{family over $\Gamma$ under $X$} is a morphism
$A:X\to (\pullback{X}{\stesysf}{\Gamma}{\eft})$. A 
\emph{term of the family $A$ over $\Gamma$ under $X$}
is a morphism $x:X\to(\pullback{X}{\stesyst}{\Gamma}{\ebd\circ\eft})$.

Contexts, families and terms of $\stesys$ under the terminal object $\mathbf{1}$
are called \emph{contexts, families and terms of $\stesys$}, respectively.
\end{defn}

\begin{lem}
For any object $X$ of $\cat{C}$ and any $\stesys$ in $\cat{C}$, contexts,
families and terms of $\stesys$ under $X$ satisfy all the judgmental equality 
rules stated in \autoref{judgments}.
\end{lem}

\begin{proof}
This follows immediately from the fact that equality on the hom-sets are
equivalence relations.
\end{proof}

\begin{defn}
Let $\stesys'$ and $\stesys$ be fundamental structures in $\cat{C}$. A
\emph{fundamental homomorphism} $f:\stesys'\to\stesys$ is a triple 
$(f_0,f_1,f_t)$ consisting of morphisms
\begin{equation*}
\begin{tikzcd}
\stesyst' 
  \ar{r}{f_t}
  \ar{d}[swap]{\ebd'}
  &
\stesyst
  \ar{d}{\ebd}
  \\
\stesysf'
  \ar{r}{f_1}
  \ar{d}[swap]{\eft'}
  &
\stesysf
  \ar{d}{\eft}
  \\
\stesysc' 
  \ar{r}[swap]{f_0}
  &
\stesysc
\end{tikzcd}
\end{equation*}
such that the indicated squares commute.
\end{defn}

In other words, the category $\mathbf{Fund}(\cat{C})$ of fundamental structures
is the functor category $(0\leftarrow 1\leftarrow t)\to\cat{C}$. 

The definitions of weakening algebra, projection algebra and substitution
algebra (and ultimately the definition of e-systems) will require the
change of base construction. Proving that the definitions are stable under
change of base is therefore a crucial aspect of the development of the theory.
The change of base of fundamental structures is the simplest case.

The following definition provides us with a useful abbreviation to display
diagrams in which both fundamental structures and arbitrary objects are 
involved.

\begin{defn}
Suppose $f:\stesys\to\stesys'$ is a fundamental homomorphism. We say that
a diagram
\begin{equation*}
\begin{tikzcd}
\stesys
  \ar{r}{f}
  \ar{d}[swap]{p}
  &
\stesys'
  \ar{d}{p'}
  \\
X \ar{r}[swap]{g}
  &
Y
\end{tikzcd}
\end{equation*}
commutes if the diagram
\begin{equation*}
\begin{tikzcd}
\stesysc
  \ar{r}{f_0}
  \ar{d}[swap]{p}
  &
\stesysc'
  \ar{d}{p'}
  \\
X \ar{r}[swap]{g}
  &
Y
\end{tikzcd}
\end{equation*}
commutes.
\end{defn}

Thus, our goal of defining the change of base for a fundamental structure
can be restated in the following way: given a fundamental structure 
$\stesys$ and arrows $p:\stesysc\rightarrow X\leftarrow Y:g$, we want to
define a fundamental structure $\cobesys{Y}{\stesys}{g}{p}$ with a 
homomorphism $\pullbackpr{2}{g}{p}: \cobesys{Y}{\stesys}{g}{p}\to\stesys$ and a 
morphism $\pullbackpr{1}{g}{p}: \pullback{Y}{\stesysc}{g}{p}\to Y$ such that for
every diagram
\begin{equation*}
\begin{tikzcd}[column sep=large]
\stesys'
  \ar[bend right=10]{ddr}[swap]{p'}
  \ar[bend left=10]{rrd}{f}
  \ar[dotted]{dr}[near end]{[p',f]}
  \\
  {}&
\cobesys{Y}{\stesys}{g}{p}
  \ar{d}{\pullbackpr{1}{g}{p}}
  \ar{r}[swap]{\pullbackpr{2}{g}{p}}
  &
\stesys
  \ar{d}{p}
  \\
  {}&
Y \ar{r}[swap]{g}
  &
X
\end{tikzcd}
\end{equation*}
of which the outer square commutes, the fundamental homomorphism $[p',f]$ 
exists and is unique with the property that it renders the diagram commutative.

\begin{defn}
Suppose $\stesys$ is a fundamental structure in $\cat{C}$ and that 
$p:\stesysc\rightarrow X\leftarrow Y:g$.
Then we define the \emph{change of base $\cobesys{Y}{\stesys}{g}{p}$ of 
$\stesys$ along $g:Y\to X$} to be the fundamental structure above $Y$ in the 
diagram
\begin{equation*}
\begin{tikzcd}[column sep=7em]
\cobesys{Y}{\stesyst}{g}{p\circ\eft\circ\ebd}
  \ar{r}{\pullbackpr{2}{g}{p\circ\eft\circ\ebd}}
  \ar{d}[swap]{g^\ast(\ebd)}
  &
\stesyst
  \ar{d}{\ebd}
  \\
\cobesys{Y}{\stesysf}{g}{p\circ\eft}
  \ar{r}{\pullbackpr{2}{g}{p\circ\eft}}
  \ar{d}[swap]{g^\ast(\eft)}
  &
\stesysf
  \ar{d}{\eft}
  \\
\cobesys{Y}{\stesysc}{g}{p}
  \ar{r}{\pullbackpr{2}{g}{p}}
  \ar{d}[swap]{\pullbackpr{1}{g}{p}}
  &
\stesysc
  \ar{d}{p}
  \\
Y \ar{r}[swap]{g}
  &
X
\end{tikzcd}
\end{equation*}
The horizontal arrows form a homomorphism of fundamental structures, we will
denote it by $\pullbackpr{2}{g}{p}:\cobesys{Y}{\stesys}{g}{p}\to\stesys$.
\end{defn}
