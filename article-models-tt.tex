\section{Variable-free type theory -- the basic theory}
We have seen in the example of $\UU$ that we will not need to refer to variables
when we are manipulating contexts. In fact, it is more natural not to.
This suggests that there is a presentation
of type theory where contexts do not mention variables. The first small gain is that such a presentation
would not be burdened with comments about variables being bounded or not, or fresh or
not occuring at all.

Perhaps a bigger gain is that we obtain an algebraic theory for categories with
fibrations and sections. 

\subsection{The basic judgments}
The judgments we wish to make are the standad six judgments for ``$\Gamma$ is a context'', ``$A$ is
a type in context $\Gamma$'' and ``$x$ is a term of $A$ in context $\Gamma$'' and the three equality
judgments coming with them.

\begin{align*}
\jctx*{\Gamma} & \jctxeq*{\Gamma}{\Gamma'}\\
\jtype*{\Gamma}{A} & \jtypeeq*{\Gamma}{A}{B}\\
\jterm*{\Gamma}{A}{x} & \jtermeq*{\Gamma}{A}{x}{y}.
\end{align*}

In contrast with standard practise, we don't assume that there is an empty context. The idea is that
if we interpret only the syntax of contexts, types and terms with extension, weakening and
substitution, we do not have a full model of type theory but we still have a 
structure resembling a category and categories need not have terminal objects. Therefore,
the rules that follow will describe only how to manipulate contexts, types and terms.
Of most of the inferences that we give there are two versions: one introducing an operation, the other asserting that the operation in question preserves judgmental equality. 

\subsection{The basic rules for judgmental equality}
The rules for judgmental equality establish that it is an equivalence relation
in all three cases (contexts, types and terms).
\bgroup\small
\begin{align*}
& \inference{\jctx{\Gamma}}{\jctxeq{\Gamma}{\Gamma}} 
& & \inference{\jctxeq{\Gamma}{\Delta}}{\jctxeq{\Delta}{\Gamma}} 
& & \inference{\jctxeq{\Gamma}{\Delta}\qquad\jctxeq{\Delta}{\greek{E}}}{\jctxeq{\Gamma}{\greek{E}}}\\
& \inference{\jtype{\Gamma}{A}}{\jtypeeq{\Gamma}{A}{A}} 
& & \inference{\jtypeeq{\Gamma}{A}{B}}{\jtypeeq{\Gamma}{B}{A}}
& & \inference{\jtypeeq{\Gamma}{A}{B}\qquad\jtypeeq{\Gamma}{B}{C}}{\jtypeeq{\Gamma}{A}{C}}\\
& \inference{\jterm{\Gamma}{A}{x}}{\jtermeq{\Gamma}{A}{x}{x}}
& & \inference{\jtermeq{\Gamma}{A}{x}{y}}{\jtermeq{\Gamma}{A}{y}{x}}
& & \inference{\jtermeq{\Gamma}{A}{x}{y}\qquad\jtermeq{\Gamma}{A}{y}{z}}{\jtermeq{\Gamma}{A}{x}{z}}
\end{align*}
\egroup

The following convertibility rules are responsible for the strictness
of judgmental equality, which sets it apart from equivalences or identifications:

\begin{align*}
& \inference{\jctxeq{\Gamma}{\Delta}\qquad\jtype{\Gamma}{A}}{\jtype{\Delta}{A}}
& & \inference{\jctxeq{\Gamma}{\Delta}\qquad\jtypeeq{\Gamma}{A}{B}}{\jtypeeq{\Delta}{A}{B}}\\
& \inference{\jctxeq{\Gamma}{\Delta}\qquad\jterm{\Gamma}{A}{x}}{\jterm{\Delta}{A}{x}}
& & \inference{\jctxeq{\Gamma}{\Delta}\qquad\jtermeq{\Gamma}{A}{x}{y}}{\jtermeq{\Delta}{A}{x}{y}}\\
& \inference{\jtypeeq{\Gamma}{A}{B}\qquad \jterm{\Gamma}{A}{x}}{\jterm{\Gamma}{B}{x}}
& & \inference{\jtypeeq{\Gamma}{A}{B}\qquad\jtermeq{\Gamma}{A}{x}{y}}{\jtermeq{\Gamma}{B}{x}{y}}
\end{align*}

\subsection{Extension}
We introduce extension which not only extends a context $\Gamma$ and a type
$A$ over it to a context $\ctxext{\Gamma}{A}$, but which also extends a type $A$
in context $\Gamma$ and a family $P$ over it to a type $\ctxext{A}{P}$ in context
$\Gamma$. We do this to ensure that all of type theory can be done in a context.
For instance, we could say (1) that a context in context $\Gamma$ is the same thing
as a type in context $\Gamma$; (2) When $A$ is a context in this sense, a type in
context $A$ is the same thing as a family $P$ over $A$ and (3) when $P$ is a type
in context $A$ in this sense, a term of $P$ keeps its original meaning.

Note that by introducing extension on the level of types and families,
we introduce $\Sigma$-types at a very early stage.
However, we need substitution to make this precise.
\begin{align}
& \inference{\jtype{\Gamma}{A}}{\jctx{\ctxext{\Gamma}{A}}}
& & \inference{\jctxeq{\Gamma}{\Delta}\qquad\jtypeeq{\Gamma}{A}{B}}{\jctxeq{\ctxext{\Gamma}{A}}{\ctxext{\Delta}{B}}}\\
& \inference{\jtype{\ctxext{\Gamma}{A}}{P}}{\jtype{\Gamma}{\ctxext{A}{P}}}
& & \inference{\jtypeeq{\Gamma}{A}{B}\qquad\jtypeeq{\ctxext{\Gamma}{A}}{P}{Q}}{\jtypeeq{\Gamma}{\ctxext{A}{P}}{\ctxext{B}{Q}}}
\end{align}

\subsubsection{Extension is compatible with itself}
The inference rules asserting that extension is compatible with itself assert
that contexts are unstructured lists of type declarations. This rule is
unavoidable if we want that for a type $A$ in context $\Gamma$, a type
in context $A$ is the same thing as a type in context $\ctxext{\Gamma}{A}$. 

\begin{align}
& \inference{\jtype{\Gamma}{A}\qquad\jtype{\ctxext{\Gamma}{A}}{P}}
  {\jctxeq{\ctxext{{\Gamma}{A}}{P}}{\ctxext{\Gamma}{{A}{P}}}}\\
& \inference{\jtype{\ctxext{\Gamma}{A}}{P}\qquad\jtype{\ctxext{{\Gamma}{A}}{P}}{Q}}
  {\jtypeeq{\Gamma}{\ctxext{{A}{P}}{Q}}{\ctxext{A}{{P}{Q}}}}
\end{align}

\subsection{Weakening}
We first define weakening by a context $\Gamma$. Since weakening by $\Gamma$
should in principle be a functor, it acts on contexts, types and terms alike.
Note that it is because of the weakening $\ctxwk{\Gamma}{\Delta}$ of a context
$\Delta$ by $\Gamma$ that we can speak of context morphisms from $\Gamma$ to $\Delta$: they are the terms
of $\ctxwk{\Gamma}{\Delta}$.

In the following inference rules we assume $\jctx{\Gamma}$ and in the rules
asserting a judgmental equality we furthermore assume $\jctxeq{\Gamma}{\Gamma'}$.
\begin{align}
& \inference{\jctx{\Delta}}{\jtype{\Gamma}{\ctxwk{\Gamma}{\Delta}}} 
& & \inference{\jctxeq{\Delta}{\Delta'}}{\jtypeeq{\Gamma}{\ctxwk{\Gamma}{\Delta}}{\ctxwk{\Gamma'}{\Delta'}}}\\
& \inference{\jtype{\Delta}{B}}{\jtype{\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}}{\ctxwk{\Gamma}{B}}}
& & \inference{\jtypeeq{\Delta}{B}{B'}}{\jtypeeq{\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}}{\ctxwk{\Gamma}{B}}{\ctxwk{\Gamma'}{B'}}}\\
& \inference{\jterm{\Delta}{B}{y}}{\jterm{\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}}{\ctxwk{\Gamma}{B}}{\ctxwk{\Gamma}{y}}} 
& & \inference{\jtermeq{\Delta}{B}{y}{y'}}{\jtermeq{\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}}{\ctxwk{\Gamma}{B}}{\ctxwk{\Gamma}{y}}{\ctxwk{\Gamma'}{y'}}} 
\end{align}

A weakening operation is also defined for types. When $A$ and $B$ are both types
 in context $\Gamma$, the weakened type $\ctxwk{A}{B}$ in context $\ctxext{\Gamma}{A}$
 is the family which `doesn't really depend on $A$'. The terms of $\ctxwk{A}{B}$
 are the functions from $A$ to $B$. Likewise, the terms $\ctxwk{A}{y}$ are the
 constant maps at $y$ from $A$ to $B$, for $y:B$.
 
 In the following inference rules we assume that $\jtype{\Gamma}{A}$ and in the
 rules asserting a judgmental equality we assume furthermore that 
 $\jtypeeq{\Gamma}{A}{A'}$.
\begin{align}
& \inference{\jtype{\Gamma}{B}}{\jtype{\ctxext{\Gamma}{A}}{\ctxwk{A}{B}}}
& & \inference{\jtypeeq{\Gamma}{B}{B'}}{\jtypeeq{\ctxext{\Gamma}{A}}{\ctxwk{A}{B}}{\ctxwk{A'}{B'}}}\\
& \inference{\jtype{\ctxext{\Gamma}{B}}{Q}}
{\jtype{\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}}
& & \inference{\jtypeeq{\ctxext{\Gamma}{B}}{Q}{Q'}}
{\jtypeeq{\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}{\ctxwk{A'}{Q'}}}\\
& \inference{\jterm{\Gamma}{B}{y}}{\jterm{\ctxext{\Gamma}{A}}{\ctxwk{A}{B}}{\ctxwk{A}{y}}}
& & \inference{\jtermeq{\Gamma}{B}{y}{y'}}{\jtermeq{\ctxext{\Gamma}{A}}{\ctxwk{A}{B}}{\ctxwk{A}{y}}{\ctxwk{A'}{y'}}}\\
& \inference{\jterm{\ctxext{\Gamma}{B}}{Q}{g}}{\jterm{\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}{\ctxwk{A}{g}}}
& & \inference{\jtermeq{\ctxext{\Gamma}{B}}{Q}{g}{g'}}
{\jtermeq{\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}{\ctxwk{A}{g}}{\ctxwk{A'}{g'}}}
\end{align}

\subsubsection{Weakening is compatible with extension}

The following rules assert the compatibility of extension with weakening: for
every context $\Gamma$ and every type $B$ in context $\Delta$ there is a
judgmental equality $\ctxwk{\Gamma}{\ctxext{\Delta}{B}}\jdeq\ctxext{\ctxwk{\Gamma}{\Delta}}
{\ctxwk{\Gamma}{B}}$. When thinking of terms of $\ctxwk{\Gamma}{\Delta}$ as
functions from $\Gamma$ to $\Delta$, this looks awfully lot like the type
theoretical axiom of choice, of which it seems absurd to ask to hold judgmentally.
But the rule should be there because in ordinary Martin-L\"of type theory
there is no syntax for weakening, i.e.~weakening is invisible. 
And thus both $\ctxwk{\Gamma}{\ctxext{\Delta}{B}}$ 
and $\ctxext{\ctxwk{\Gamma}{\Delta}}{\ctxwk{\Gamma}{B}}$ is the type
$\ctxext{\Delta}{B}$ in context $\Gamma$.

In the following inference rules we assume that $\jctx{\Gamma}$. 

\begin{align}
& \inference
  {\jtype{\Delta}{B}}
  {\jtypeeq{\Gamma}{\ctxwk{\Gamma}{\ctxext{\Delta}{B}}}{\ctxext{\ctxwk{\Gamma}{\Delta}}{\ctxwk{\Gamma}{B}}}}\\
& \inference
  {\jtype{\Delta}{B}\qquad\jtype{\ctxext{\Delta}{B}}{Q}}
  {\jtypeeq
    {\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}}
    {\ctxwk{\Gamma}{\ctxext{B}{Q}}}
    {\ctxext{\ctxwk{\Gamma}{B}}{\ctxwk{\Gamma}{Q}}}}
\end{align}

In the following inference rules we assume that $\jtype{\Gamma}{A}$.

\begin{align}
& \inference
  {\jtype{\ctxext{\Gamma}{B}}{Q}}
  {\jtypeeq{\ctxext{\Gamma}{A}}{\ctxwk{A}{\ctxext{B}{Q}}}{\ctxext{\ctxwk{A}{B}}{\ctxwk{A}{Q}}}}\\
& \inference
  {\jtype{\ctxext{{\Gamma}{B}}{Q}}{R}}
  {\jtypeeq
    {\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}
    {\ctxwk{A}{\ctxext{Q}{R}}}
    {\ctxext{\ctxwk{A}{Q}}{\ctxwk{A}{R}}}}
\end{align}

\subsubsection{Weakening is compatible with itself}
To conclude the rules for weakening, we state judgmental equality rules expressing
that weakening is compatible with itself. These rules state that the following
diagram commutes given any two contexts $\Gamma$ and $\Delta$:
\begin{equation*}
\begin{tikzcd}[column sep=huge]
\jctx{\blank} \ar{r}{\greek{E}\mapsto\ctxwk{\Delta}{E}} \ar{d}[swap]{\greek{E}\mapsto\ctxwk{\Gamma}{E}} & \jtype{\Delta}{\blank} \ar{d}{B\mapsto\ctxwk{\Gamma}{B}}\\
\jtype{\Gamma}{\blank} \ar{r}[swap]{A\mapsto\ctxwk{{\Gamma}{\Delta}}{A}} & \jtype{\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}}{\blank}
\end{tikzcd}
\end{equation*}
There is also a version of this diagram in which all happens in a context. Thus,
we get two sets of inference rules. For weakening by contexts we get:
\begin{align}
& \inference{\jctx{\Gamma}\qquad\jctx{\Delta}\qquad\jctx{\greek{E}}}
          {\jtypeeq{\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}}{\ctxwk{\Gamma}{{\Delta}{\greek{E}}}}
            {\ctxwk{{\Gamma}{\Delta}}{{\Gamma}{\greek{E}}}}}\\
& \inference{\jctx{\Gamma}\qquad\jctx{\Delta}\qquad\jtype{\greek{E}}{C}}
          {\jtypeeq{\ctxext{{\Gamma}{\ctxwk{\Gamma}{\Delta}}}{\ctxwk{{\Gamma}{\Delta}}{{\Gamma}{\greek{E}}}}}
            {\ctxwk{\Gamma}{{\Delta}{C}}}
            {\ctxwk{{\Gamma}{\Delta}}{{\Gamma}{C}}}}\\
& \inference{\jctx{\Gamma}\qquad\jctx{\Delta}\qquad\jterm{\greek{E}}{C}{t}}
          {\jtermeq{\ctxext{{\Gamma}{\ctxwk{\Gamma}{\Delta}}}{\ctxwk{{\Gamma}{\Delta}}{{\Gamma}{\greek{E}}}}}
            {\ctxwk{{\Gamma}{\Delta}}{{\Gamma}{C}}}{\ctxwk{\Gamma}{{\Delta}{t}}}{\ctxwk{{\Gamma}{\Delta}}{{\Gamma}{t}}}}
\end{align}
For weakening by types we get:
\begin{align}
& \inference{\jtype{\Gamma}{A}\qquad\jtype{\Gamma}{B}\qquad\jtype{\Gamma}{C}}
          {\jtypeeq{\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{{B}{C}}}
            {\ctxwk{{A}{B}}{{A}{C}}}}\\
& \inference{\jtype{\Gamma}{A}\qquad\jtype{\Gamma}{B}\qquad\jtype{\ctxext{\Gamma}{C}}{R}}
          {\jtypeeq{\ctxext{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{{A}{B}}{{A}{C}}}}
            {\ctxwk{A}{{B}{R}}}
            {\ctxwk{{A}{B}}{{A}{R}}}}\\
& \inference{\jtype{\Gamma}{A}\qquad\jtype{\Gamma}{B}\qquad\jterm{\Gamma}{R}{t}}
          {\jtermeq{\ctxext{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{{A}{B}}{{A}{C}}}}
            {\ctxwk{{A}{B}}{{A}{R}}}{\ctxwk{A}{{B}{t}}}{\ctxwk{{A}{B}}{{A}{t}}}}
\end{align}

\subsection{Substitution}
Given a family $P$ over $A$ and a term $x$ of $A$, substitution gives a way to
consider the fiber $\subst{x}{P}$ of $P$ at $x$. Also, we get a way to evaluate
terms $f$ of $P$ at $x$. This will give us ways to compose functions too. In
this section, we shall first introduce the operations `substitution of a term $x$'
for types, terms and families. Then we shall explain how substitution interacts
with itself, extension and weakening.

In the rules introducing the various substitutions we assume $\jterm{\Gamma}{A}{x}$;
in the rules introducing the definitional equalities we assume $\jtermeq{\Gamma}{A}{x}{x'}$.

\begin{align}
& \inference{\jtype{\ctxext{\Gamma}{A}}{P}}{\jtype{\Gamma}{\subst{x}{P}}}
& & \inference{\jtypeeq{\ctxext{\Gamma}{A}}{P}{P'}}{\jtypeeq{\Gamma}{\subst{x}{P}}{\subst{x'}{P'}}}\\
& \inference{\jtype{\ctxext{{\Gamma}{A}}{P}}{Q}}{\jtype{\ctxext{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}}
& & \inference{\jtypeeq{\ctxext{{\Gamma}{A}}{P}}{Q}{Q'}}{\jtypeeq{\ctxext{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}{\subst{x'}{Q'}}}\\
& \inference{\jterm{\ctxext{\Gamma}{A}}{P}{f}}{\jterm{\Gamma}{\subst{x}{P}}{\subst{x}{f}}}
& & \inference{\jtermeq{\ctxext{\Gamma}{A}}{P}{f}{f'}}{\jtermeq{\Gamma}{\subst{x}{P}}{\subst{x}{f}}{\subst{x'}{f'}}}\\
& \inference{\jterm{\ctxext{{\Gamma}{A}}{P}}{Q}{g}}{\jterm{\ctxext{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}{\subst{x}{g}}}
& &\inference{\jtermeq{\ctxext{{\Gamma}{A}}{P}}{Q}{g}{g'}}{\jtermeq{\ctxext{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}{\subst{x}{g}}{\subst{x'}{g'}}}
\end{align}

\subsubsection{Substitution is compatible with extension}
Suppose $\jterm{\Gamma}{A}{x}$ in all of the following inference rules.
\begin{align}
& \inference{\jtype{\ctxext{{\Gamma}{A}}{P}}{Q}}
  {\jtypeeq{\Gamma}{\subst{x}{\ctxext{P}{Q}}}{\ctxext{\subst{x}{P}}{\subst{x}{Q}}}}\\
& \inference{\jtype{\ctxext{{{\Gamma}{A}}{P}}{Q}}{R}}
  {\jtypeeq{\ctxext{\Gamma}{\subst{x}{P}}}{\subst{x}{\ctxext{Q}{R}}}{\ctxext{\subst{x}{Q}}{\subst{x}{R}}}}
\end{align}

\subsubsection{Substitution is compatible with weakening}
The rules asserting the compatibility of substitution with weakening assert
that the following diagram commutes for any $\jterm{\Gamma}{A}{x}$ and any
$\jtype{\ctxext{\Gamma}{A}}{P}$:
\begin{equation*}
\begin{tikzcd}[column sep=huge]
\jtype{\ctxext{\Gamma}{A}}{\blank} \ar{d}[swap]{Q\mapsto\subst{x}{Q}} \ar{r}{Q\mapsto\ctxwk{P}{Q}} & \jtype{\ctxext{{\Gamma}{A}}{P}}{\blank} \ar{d}{R\mapsto\subst{x}{R}}\\ 
\jtype{\Gamma}{\blank} \ar{r}[swap]{B\mapsto\ctxwk{\subst{x}{P}}{B}} & \jtype{\ctxext{\Gamma}{\subst{x}{P}}}{\blank}
\end{tikzcd}
\end{equation*}
In the following inference rules we assume that $\jterm{\Gamma}{A}{x}$ and
$\jtype{\ctxext{\Gamma}{A}}{P}$:
\begin{align}
& \inference
    {\jtype{\ctxext{\Gamma}{A}}{Q}}
    {\jtypeeq{\ctxext{\Gamma}{\subst{x}{P}}}{\subst{x}{\ctxwk{P}{Q}}}{\ctxwk{\subst{x}{P}}{\subst{x}{Q}}}}\\
& \inference
    {\jtype{\ctxext{{\Gamma}{A}}{Q}}{R}}
    {\jtypeeq{\ctxext{{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}}{\subst{x}{\ctxwk{P}{R}}}{\ctxwk{\subst{x}{P}}{\subst{x}{R}}}}\\
& \inference
    {\jterm{\ctxext{\Gamma}{A}}{Q}{g}}
    {\jtermeq
      {\ctxext{\Gamma}{\subst{x}{P}}}
      {\subst{x}{\ctxwk{P}{Q}}}
      {\subst{x}{\ctxwk{P}{g}}}
      {\ctxwk{\subst{x}{P}}{\subst{x}{g}}}}\\
& \inference
    {\jterm{\ctxext{{\Gamma}{A}}{Q}}{R}{h}}
    {\jtermeq
      {\ctxext{{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}}
      {\subst{x}{\ctxwk{P}{R}}}
      {\subst{x}{\ctxwk{P}{h}}}
      {\ctxwk{\subst{x}{P}}{\subst{x}{h}}}}
\end{align}

\subsubsection{Substitution is compatible with substitution}

We require that substitution is compatible with itself, which is roughly the
assertion that substitution is associative. However, we cannot just state that
$\subst{x}{{f}{g}}\jdeq\subst{{x}{f}}{g}$ since the expression $\subst{{x}{f}}{g}$
is not well-formed. The term $\subst{x}{f}$ can be substituted in (terms of) families over
$\subst{x}{P}$; the term $\subst{x}{g}$ is such. Therefore, associativity of
substitution takes the form $\subst{x}{{f}{g}}\jdeq\subst{{x}{f}}{{x}{g}}$.

In the following inference rules we assume
$\jterm{\Gamma}{A}{x}$ and $\jterm{\ctxext{\Gamma}{A}}{P}{f}$.

\begin{align}
&\inference{\jtype{\ctxext{{\Gamma}{A}}{P}}{Q}}
{\jtypeeq{\Gamma}{\subst{x}{{f}{Q}}}{\subst{{x}{f}}{{x}{Q}}}}\\
&\inference{\jtype{\ctxext{{{\Gamma}{A}}{P}}{Q}}{R}}
{\jtypeeq{\ctxext{\Gamma}{\subst{x}{{f}{Q}}}}{\subst{x}{{f}{R}}}{\subst{{x}{f}}{{x}{R}}}}\\
&\inference{\jterm{\ctxext{{\Gamma}{A}}{P}}{Q}{g}}
{\jtermeq{\Gamma}{\subst{x}{{f}{Q}}}{\subst{x}{{f}{g}}}{\subst{{x}{f}}{{x}{g}}}}\\
&\inference{\jterm{\ctxext{{{\Gamma}{A}}{P}}{Q}}{R}{h}}
{\jtermeq{\ctxext{\Gamma}{\subst{x}{{f}{Q}}}}{\subst{x}{{f}{R}}}{\subst{x}{{f}{h}}}{\subst{{x}{f}}{{x}{h}}}}
\end{align}

\subsubsection{Weakening is compatible with substitution}
We already have rules for the compatibility of substitution with weakening, but
we still need the rules the other way around, asserting that there is a 
judgmental equality $\ctxwk{A}{\subst{y}{Q}}\jdeq\subst{\ctxwk{A}{y}}{\ctxwk{A}{Q}}$
together with all its variants.

In the following inference rules we assume that $\jtype{\Gamma}{A}$ and that
$\jterm{\Gamma}{B}{y}$.

\begin{align}
& \inference{\jtype{\ctxext{\Gamma}{B}}{Q}}{\jtypeeq{\ctxext{\Gamma}{A}}{\ctxwk{A}{\subst{y}{Q}}}{\subst{\ctxwk{A}{y}}{\ctxwk{A}{Q}}}}\\
& \inference{\jtype{\ctxext{{\Gamma}{B}}{Q}}{R}}{\jtypeeq{\ctxext{{\Gamma}{A}}{\ctxwk{A}{Q}}}{\ctxwk{A}{\subst{y}{R}}}{\subst{\ctxwk{A}{y}}{\ctxwk{A}{R}}}}\\
& \inference{\jterm{\ctxext{\Gamma}{B}}{Q}{g}}{\jtermeq{\ctxext{\Gamma}{A}}{\ctxwk{A}{\subst{y}{Q}}}{\ctxwk{A}{\subst{y}{g}}}{\subst{\ctxwk{A}{y}}{\ctxwk{A}{g}}}}\\
& \inference{\jterm{\ctxext{{\Gamma}{B}}{Q}}{R}{h}}{\jtermeq{\ctxext{{\Gamma}{A}}{\ctxwk{A}{\subst{y}{Q}}}}{\ctxwk{A}{\subst{y}{R}}}{\ctxwk{A}{\subst{y}{h}}}{\subst{\ctxwk{A}{y}}{\ctxwk{A}{h}}}}
\end{align}

\subsection{The defining property of weakening}
The judgmental equalities we're about to describe assert that weakening followed
by substitution leaves everything untouched. Thus, we get that each fiber
$\subst{x}{\ctxwk{A}{B}}$ is just $B$, that $\ctxwk{A}{y}$ is the constant function
mapping everything to $y:B$ and similar properties for families and terms thereof.

\begin{align}
& \inference{\jtype{\Gamma}{A}\qquad\jtype{\Gamma}{B}\qquad\jterm{\Gamma}{A}{x}}{\jtypeeq{\Gamma}{\subst{x}{\ctxwk{A}{B}}}{B}}\\
& \inference{\jtype{\Gamma}{A}\qquad\jtype{\ctxext{\Gamma}{B}}{Q}\qquad\jterm{\Gamma}{A}{x}}{\jtypeeq{\ctxext{\Gamma}{B}}{\subst{x}{\ctxwk{A}{Q}}}{Q}}\\
& \inference{\jterm{\Gamma}{A}{x}\qquad\jterm{\Gamma}{B}{y}}{\jtermeq{\Gamma}{B}{\subst{x}{\ctxwk{A}{y}}}{y}}\\
& \inference{\jterm{\Gamma}{A}{x}\qquad\jterm{\ctxext{\Gamma}{B}}{Q}{g}}{\jtermeq{\ctxext{\Gamma}{B}}{Q}{\subst{x}{\ctxwk{A}{g}}}{g}}
\end{align}

Using the rules of the compatibility of substitution with weakening and of the
compatibility of weakening with itself, we see that we can show
\begin{equation*}
\jtypeeq{\Gamma}{\subst{f}{\ctxwk{\Gamma}{{\Delta}{\greek{E}}}}}{\ctxwk{\Gamma}{E}}
\end{equation*}
for any three contexts $\Gamma$, $\Delta$ and $\greek{E}$ and any $\jhom{\Gamma}{\Delta}{f}$.
It follows that for $\jhom{\Delta}{\greek{E}}{g}$ we have
\begin{equation*}
\jhom{\Gamma}{\greek{E}}{\subst{f}{\ctxwk{\Gamma}{g}}}
\end{equation*}
The term $\jcomp{\Gamma}{f}{g}$ is the composition of $g$ with $f$. We may call
a term $\jhom{\Gamma}{\Delta}{f}$ a morphism from $\Gamma$ to $\Delta$.

\subsection{Terms in the basic type theory}

\subsubsection{Identity functions}
Without a rule explicitly asserting the existence of an identity morphism we don't
get one, hence we do that here. The identity morphism is a term which introduced
in ordinary type theory via the variable rule. The variable rule is a bit more
general: it asserts that
\begin{equation*}
\jterm{\Gamma,\,x_1:A_1,\ldots,\,x_n:A_n}{A_i}{x_i}
\end{equation*}
for every $1\leq i\leq n$. Thus, it establishes the projections. In our setting,
we get the projections from the identity morphisms together with weakening. We
already have weakening, so here it suffices to introduce the identity morphisms.
They are determined by their behavior with respect to substitution combined with
weakening.

\begin{align}
&\inference{\jctx{\Gamma}}{\jterm{\Gamma}{\ctxwk{\Gamma}{\Gamma}}{\idfunc[\Gamma]}}\label{ctxIdFuncForm}\\
&\inference{\jtype{\Gamma}{A}}{\jtypeeq{\Gamma}{\subst{\idfunc[\Gamma]}{\ctxwk{\Gamma}{A}}}{A}}\label{ctxIdFuncPbInvType}\\
&\inference{\jterm{\Gamma}{A}{x}}{\jtermeq{\Gamma}{A}{\subst{\idfunc[\Gamma]}{\ctxwk{\Gamma}{x}}}{x}}\label{ctxIdFuncPbInvTerm}\\
&\inference{\jterm{\Delta}{\ctxwk{\Delta}{\Gamma}}{g}}{\jtermeq{\Delta}{\ctxwk{\Delta}{\Gamma}}{\subst{g}{\ctxwk{\Delta}{\idfunc[\Gamma]}}}{g}}\label{ctxIdFuncSubstInvTerm}
\end{align}

The identity morphisms for types are introduced analogously to the identity
morphisms of contexts, the only difference being that we have a rule asserting
that $\subst{x}{\idfunc[A]}\jdeq x$ for every term $x:A$ in context $\Gamma$.

\begin{align}
& \inference{\jtype{\Gamma}{A}}{\jterm{\ctxext{\Gamma}{A}}{\ctxwk{A}{A}}{\idfunc[A]}}\\
& \inference{\jterm{\Gamma}{A}{x}}{\jtermeq{\Gamma}{A}{\subst{x}{\idfunc[A]}}{x}}\\
& \inference{\jtype{\ctxext{\Gamma}{A}}{P}}{\jtypeeq{\ctxext{\Gamma}{A}}{\subst{\idfunc[A]}{\ctxwk{A}{P}}}{P}}\\
& \inference{\jterm{\ctxext{\Gamma}{A}}{P}{f}}{\jtermeq{\ctxext{\Gamma}{A}}{P}{\subst{\idfunc[A]}{\ctxwk{A}{f}}}{f}} \\
& \inference{\jterm{\ctxext{\Gamma}{B}}{\ctxwk{B}{A}}{g}}{\jtermeq{\ctxext{\Gamma}{B}}{\ctxwk{B}{A}}{\subst{g}{\ctxwk{B}{\idfunc[A]}}}{g}}
\end{align}

Using these rules we can derive that there is a judgmental equality $\jtypeeq{\ctxext{\Gamma}{A}}{\subst{x}{{\idfunc[A]}{B}}}
{\subst{x}{{x}{B}}}$.

The identity functions in combination with weakening give rise to the projections.
We define

\begin{equation*}
\proj A \defeq \ctxwk{A}{\idfunc[\Gamma]}:\ctxwk{A}{{\Gamma}{\Gamma}}.
\end{equation*}

\subsubsection{Inclusions}
In ordinary type theory, there is a rule
\begin{equation*}
\inference{\jterm{\Gamma}{A}{x}\qquad\jtype{\Gamma,\,a:A}{P(a)}}
  {\Gamma,\,u:P(x/a)\vdash x:A, u:P(x/a)}
\end{equation*}
This rule gives the inclusion of the fiber $\subst{x}{P}$ into $\ctxext{A}{P}$.

Thus, we require
\begin{equation}
\inference{\jterm{\Gamma}{A}{x}\qquad\jtype{\ctxext{\Gamma}{A}}{P}}
  {\jterm{\ctxext{\Gamma}{\subst{x}{P}}}{\ctxwk{\subst{x}{P}}{\ctxext{A}{P}}}{\typefont{in}^P_x}}
\end{equation}

The terms $\typefont{in}^P_x$ have the following behavior:

\begin{align}
& \inference
    {\jtype{\ctxext{{\Gamma}{A}}{P}}{Q}}
    {\jtypeeq{\ctxext{\Gamma}{\subst{x}{P}}}{\subst{\typefont{in}^P_x}{\ctxwk{\subst{x}{P}}{Q}}}{\subst{x}{Q}}}\\
& \inference
    {\jterm{\ctxext{{\Gamma}{A}}{P}}{Q}{g}}
    {\jtermeq{\ctxext{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}{\subst{\typefont{in}^P_x}{\ctxwk{\subst{x}{P}}{g}}}{\subst{x}{g}}}
\end{align}
