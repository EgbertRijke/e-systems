\section{The algebraic theory of contexts, families and terms}\label{tt}
In this section we give a description of dependent type theory before type
constructors. Apart from contexts, families and terms -- which provide for the
core of the language of dependent logic -- the basic ingredients
of this theory will be the operations of extension, weakening and substitution
and the identity terms. An empty context (and empty families) are also included
in the theory. The resulting theory can be seen as a manifestation of the 
structure underlying dependent type theory.

We will
formulate the theory of contexts, families and terms in such a way that contexts aren't defined
to be lists of variable declarations. The variable-free (or name-free) approach 
we take here is rather different than those appearing in 
\cite{hofmann1995extensional,TheBook} but it has appeared in the work of Coquand
and in \cite{Dybjer1996}.
The main reason we don't let variable declarations in is that we don't see them 
in the internal models either. This way we also set out to a more algebraic 
approach of type theory and higher category theory. Thirdly, we will not have to
be burdened with superficial comments about variables being bounded or not, or 
fresh or free or not occuring at all.

In our treatment, a context can be the empty context or it can be a binary
planar tree of which `the leaves are (families of) contexts'. 
The judgmental equality relation on contexts is an equivalence relation which 
expresses that binary planar
trees of contexts are judgmentally equal if their leaves are, taking only
(the isomorphism class of) 
the order of the leaves into account \emph{and not the actual shape of the three}.
The intuition behind this equivalence relation is indeed that unstructured
(i.e.~unbracketed) lists such as the lists of variable declarations which
usually appear in type theoretical syntax, may be regarded as contexts.

Besides contexts, families and terms there will also be a notion of `type in
a context'. Only a family of contexts over a context $\Gamma$ is eligible to
be a type in the context $\Gamma$ and we have the intuition that `being a type'
expresses the property of `being an atomic or irreducible family of contexts'.
We will not axiomatize that every context is either judgmentally equal to the
empty context or judgmentally equal to the extension of a context by a type,
although it is certainly worth investigating the class of contexts which fall
under this category.

We will formulate fairly strict rules governing the judgmental equalities,
expressing that extension, weakening and substitution are combatible with
each other in a judgmental manner. This does not, however, diminish the role
of isomorphisms or of homotopies could play in the theory once identity types
are added. Indeed, types could still have non-trivial identity relations and
the category of types in a certain context could genuinely display higher
categorical structure, or so we conjecture.

Much of the rules we state are just compatibility rules of extension, weakening
and substitution with each other. In a way, these rules assert that our contexts
are just structureless lists of contexts and that likewise terms are structureless
lists of terms. They are structureless in the sense that the order in which
they are formed by pairing up is irrelevant. We note that this causes complications
in the traditional way that categorical sematics of type theory is implemented,
where contexts become objects of the category which is supposed to model type
theory. The reason for this is that context extension will not satisfy all the
compatibility rules we're about to state. The first step to resolving this is taking
the types in the empty context as the objects. 

To get the overview of the compatibility rules, we list the sections
where these compatibility rules are described in the following table (in this
table, the
subsection mentioned in row $X$ and column $Y$ consideres the rules of the
operation $Y\circ X$):
\begin{center}
\begin{tabular}{r|ccc}
& extension & weakening & substitution\\
\hline
extension & \autoref{comp-ee} & \autoref{comp-ew} & \\
weakening & \autoref{comp-we} & \autoref{comp-ww} & \autoref{comp-ws}\\
substitution & \autoref{comp-se} & \autoref{comp-sw} & \autoref{comp-ss}
\end{tabular}
\end{center}

\subsection{Judgments and valid inference rules}\label{judgments}
The theory we describe here is a theory of contexts, families of
contexts and terms thereof. The families of contexts are by some authors called
dependent contexts, but they are handled a bit differently here because they
become the primary object of study. Dependent contexts can be types; they could
be seen as atomic or indecomposable dependent contexts.

Thus we make eight kinds of judgments: ``$\Gamma$ is a context'',
``$A$ is a family of contexts over $\Gamma$'', ``$A$ is a type in context $\Gamma$''
and ``$x$ is a term of the family $A$ of contexts over $\Gamma$''. The other four
judgments are for judgmental equality.
\begin{align*}
\jctx*{\Gamma} 
& \jctxeq*{\Gamma}{\Gamma'}
  \\
\jfam*{\Gamma}{A} 
& \jfameq*{\Gamma}{A}{B}
  \\
\jterm*{\Gamma}{A}{x} 
& \jtermeq*{\Gamma}{A}{x}{y}.
\end{align*}

Strictly speaking, we have three different judgmental equalities in play and one
could request for a notational difference to signify that fact. For instance,
we could denote the judgmental equalities of contexts, families and terms by
$\jdeq_c$, $\jdeq_f$ and $\jdeq_t$ respectively. It will, however, always be
clear which of the three kinds of judgmental equality is meant when we assert
a judgmental equality and therefore we shall not bother to make this notational
distinction.

We note that what we call families over contexts
here could also have been named dependent contexts or telescopes, see
\cite{deBruijn1991,hofmann1995extensional}. The term family is in agreement
with the terminology scheme of \cite{TheBook}, though the reader should be
warned that the notion of familie means something slightly different there than
it does here.

The theory of contexts, families and terms shall be described by means of a
declaration of valid inference rules. An inference rule is an expression of the
form
\begin{equation*}
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_n}{\mathcal{J}}
\end{equation*}
where each of $\mathcal{H}_1$, ..., $\mathcal{H}_n$ and $\mathcal{J}$ is 
judgment. The judgments $\mathcal{H}_1$, ..., $\mathcal{H}_n$ are called the
hypotheses and the judgment $\mathcal{J}$ is the conclusion of the inference
rule. The class of valid inference rules is closed under composition. That
means that if
\begin{equation*}
\inference{\mathcal{I}_{1k}\quad\cdots\quad\mathcal{I}_{m_kk}}{\mathcal{H}_k}
\end{equation*}
and
\begin{equation*}
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_n}{\mathcal{J}}
\end{equation*}
are valid inference rules for $1\leq k\leq n$, then
\begin{equation*}
\inference{\mathcal{I}_{11}\quad\cdots\quad\mathcal{I}_{m_11}\quad\cdots\quad\mathcal{I}_{1n}\quad\cdots\quad\mathcal{I}_{m_nn}}{\mathcal{J}}
\end{equation*}
is also a valid inference rule. Also, in a valid inference rule 
duplicated hypotheses may always be contracted and hypotheses may always be 
reordered; the result is still considered a valid inference rule.

\subsection{The basic rules for judgmental equality}
The rules for judgmental equality establish that it is an equivalence relation
in all three cases (contexts, families and terms). Thus, the following inference
rules shall be required to be valid:
\bgroup\small
\begin{align*}
& \inference
  { \jctx{\Gamma}
    }
  { \jctxeq{\Gamma}{\Gamma}
    } 
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      }
    { \jctxeq{\Delta}{\Gamma}
      } 
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jctxeq{\Delta}{\greek{E}}
      }
    { \jctxeq{\Gamma}{\greek{E}}
      }
    \\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{A}{A}
    } 
& & \inference
    { \jfameq{\Gamma}{A}{B}
      }
    { \jfameq{\Gamma}{B}{A}
      }
& & \inference
    { \jfameq{\Gamma}{A}{B}
      \jfameq{\Gamma}{B}{C}
      }
    { \jfameq{\Gamma}{A}{C}
      }
    \\
& \inference
  { \jterm{\Gamma}{A}{x}
    }
  { \jtermeq{\Gamma}{A}{x}{x}
    }
& & \inference
    { \jtermeq{\Gamma}{A}{x}{y}
      }
    { \jtermeq{\Gamma}{A}{y}{x}
      }
& & \inference
    { \jtermeq{\Gamma}{A}{x}{y}
      \jtermeq{\Gamma}{A}{y}{z}
      }
    { \jtermeq{\Gamma}{A}{x}{z}
      }
\end{align*}
\egroup

The following convertibility rules are responsible for the strictness
of judgmental equality, which sets it apart from equivalences or identifications:
\begin{align*}
& \inference
  { \jctxeq{\Gamma}{\Delta}
    \jfam{\Gamma}{A}
    }
  { \jfam{\Delta}{A}
    }
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jfameq{\Gamma}{A}{B}
      }
    { \jfameq{\Delta}{A}{B}
      }
    \\
& \inference
  { \jctxeq{\Gamma}{\Delta}
    \jterm{\Gamma}{A}{x}
    }
  { \jterm{\Delta}{A}{x}
    }
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jtermeq{\Gamma}{A}{x}{y}
      }
    { \jtermeq{\Delta}{A}{x}{y}
      }
    \\
& \inference
  { \jfameq{\Gamma}{A}{B}
    \jterm{\Gamma}{A}{x}
    }
  { \jterm{\Gamma}{B}{x}
    }
& & \inference
    { \jfameq{\Gamma}{A}{B}
      \jtermeq{\Gamma}{A}{x}{y}
      }
    { \jtermeq{\Gamma}{B}{x}{y}
      }
\end{align*}

\subsection{The operations of the theory of contexts, families and terms}

\subsubsection{The empty context}
In the theory of contexts, families and terms we introduce an empty context and,
for every context $\Gamma$, an empty family over $\Gamma$. 
When contexts are viewed as statements, the empty context is the statement that
asserts nothing. Likewise, in any context one can assert nothing and this is
achieved by the empty family. 
Since somebody who states nothing asserts it all right, there is a term of the empty
family over any context. Moreover, any two terms of the empty family are always
judgmentally equal.
\begin{align}
& \inference
  { }
  { \jctx{\emptyc}
    }
  \\
& \inference
  { \jctx{\Gamma}
    }
  { \jfam{\Gamma}{\emptyf[\Gamma]}
    }
  \\
& \inference
  { \jctx{\Gamma}
    }
  { \jterm{\Gamma}{\emptyf[\Gamma]}{\emptytm[\Gamma]}
    }
  \\
& \inference
  { \jterm{\Gamma}{\emptyf[\Gamma]}{x}
    }
  { \jtermeq
      {\Gamma}
      {\emptyf[\Gamma]}
      {x}
      {\emptytm[\Gamma]}
    }
\end{align}

The empty context and the empty families together with the operation of
extension will provide several shortcuts for the rest
of the theory of families and terms. This is (in part) obtained by requiring
that a context is exactly the same thing as a family of contexts over the
empty context and that judgmental equality of contexts is exactly the same
as judgmental equality of families of contexts over the empty context. 

By regarding contexts as families of contexts over the empty context, we
enable ourselves also to speak of terms of contexts. A term of a context
$\Gamma$ is a term of the family $\Gamma$ over the empty context. 
\begin{align}
& \inference
  { \jctx{\Gamma}
    }
  { \jfam{\emptyc}{\Gamma}
    } 
& & \inference
    { \jfam{\emptyc}{\Gamma}
      }
    { \jctx{\Gamma}
      }
    \\
& \inference
  { \jctxeq{\Gamma}{\Delta}
    }
  { \jfameq{\emptyc}{\Gamma}{\Delta}
    }
& & \inference
    { \jfameq{\emptyc}{\Gamma}{\Delta}
      }
    { \jctxeq{\Gamma}{\Delta}
      }
\end{align}

\subsubsection{Extension}
We introduce extension which not only extends a context $\Gamma$ and a family
$A$ over it to a context $\ctxext{\Gamma}{A}$, but which also extends a family $A$
in context $\Gamma$ and a family $P$ over it to a family $\ctxext{A}{P}$ over context
$\Gamma$. We do this to ensure that all of the theory of contexts, families and
terms can be done in a context.
For instance, we could say (1) that a context in context $\Gamma$ is the same thing
as a family over $\Gamma$; (2) When $A$ is a context in this sense, a family over
$A$ is the same thing as a family $P$ over $\ctxext{\Gamma}{A}$ and 
(3) when $P$ is a family over $A$ in this sense, a term of $P$ keeps its original meaning.
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jctx{\ctxext{\Gamma}{A}}
    }
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jfameq{\Gamma}{A}{B}
      }
    { \jctxeq{\ctxext{\Gamma}{A}}{\ctxext{\Delta}{B}}
      }
    \\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfam{\Gamma}{\ctxext{A}{P}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{B} 
      \jfameq{{\Gamma}{A}}{P}{Q}
      }
    { \jfameq{\Gamma}{\ctxext{A}{P}}{\ctxext{B}{Q}}
      }
\end{align}

\subsubsection{Weakening}
When $A$ is a context family over a context $\Gamma$, we wish to define a weakening
operation $\ctxwk{A}{}$. The weakening operation acts on context families $B$ 
over $\Gamma$, terms thereof, context families over $B$ and terms thereof.
It weakens those, which means that it ``adds $A$ to the context''. The context
family $\ctxwk{A}{B}$ can be seen as the constant family $B$ over $\ctxext{\Gamma}{A}$.
Likewise, when $y$ is a term of $B$, the term $\ctxwk{A}{y}$ of $\ctxwk{A}{B}$
can be seen as the constant term with value $y$.
 
 In the following inference rules we assume that $\jfam{\Gamma}{A}$ and in the
 rules asserting a judgmental equality we assume furthermore that 
 $\jfameq{\Gamma}{A}{A'}$.
 \begin{align}
& \inference
  { \jfam{\Gamma}{B}
    }
  { \jfam{{\Gamma}{A}}{\ctxwk{A}{B}}
    }
& & \inference
    { \jfameq{\Gamma}{B}{B'}
      }
    { \jfameq{{\Gamma}{A}}{\ctxwk{A}{B}}{\ctxwk{A'}{B'}}
      }
    \\
& \inference
  { \jfam{{\Gamma}{B}}{Q}
    }
  { \jfam{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}
    }
& & \inference
    { \jfameq{{\Gamma}{B}}{Q}{Q'}
      }
    { \jfameq
        {{{\Gamma}{A}}{\ctxwk{A}{B}}}
        {\ctxwk{A}{Q}}
        {\ctxwk{A'}{Q'}}
      }
    \\
& \inference
  { \jterm{\Gamma}{B}{y}
    }
  { \jterm{{\Gamma}{A}}{\ctxwk{A}{B}}{\ctxwk{A}{y}}
    }
& & \inference
    { \jtermeq{\Gamma}{B}{y}{y'}
      }
    { \jtermeq
        {{\Gamma}{A}}
        {\ctxwk{A}{B}}
        {\ctxwk{A}{y}}
        {\ctxwk{A'}{y'}}
      }
    \\
& \inference
  { \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jterm{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}{\ctxwk{A}{g}}
    }
& & \inference
    { \jtermeq{{\Gamma}{B}}{Q}{g}{g'}
      }
    { \jtermeq
        {{{\Gamma}{A}}{\ctxwk{A}{B}}}
        {\ctxwk{A}{Q}}
        {\ctxwk{A}{g}}
        {\ctxwk{A'}{g'}}
      }
\end{align}

\subsubsection{Substitution}
Given a family $P$ over $A$ and a term $x$ of $A$, substitution gives a way to
consider the fiber $\subst{x}{P}$ of $P$ at $x$. Also, we get a way to evaluate
terms $f$ of $P$ at $x$. This will give us ways to compose functions too. In
this section, we shall first introduce the operations `substitution of a term $x$'
for families $P$ over $\ctxext{\Gamma}{A}$, terms $f$ of those, families $Q$ over
$\ctxext{{\Gamma}{A}}{P}$ and terms $g$ of those. 
Then we shall explain how substitution interacts
with itself, extension and weakening.

In the rules introducing the various substitutions we assume $\jterm{\Gamma}{A}{x}$;
in the rules introducing the definitional equalities we assume $\jtermeq{\Gamma}{A}{x}{x'}$.
\begin{align}
& \inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfam{\Gamma}{\subst{x}{P}}
    }
& & \inference
    { \jfameq{{\Gamma}{A}}{P}{P'}
      }
    { \jfameq{\Gamma}{\subst{x}{P}}{\subst{x'}{P'}}
      }
    \\
& \inference
  { \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfam{{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}
    }
& & \inference
    { \jfameq{{{\Gamma}{A}}{P}}{Q}{Q'}
      }
    { \jfameq{{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}{\subst{x'}{Q'}}
      }
    \\
& \inference
  { \jterm{{\Gamma}{A}}{P}{f}
    }
  { \jterm{\Gamma}{\subst{x}{P}}{\subst{x}{f}}
    }
& & \inference
    { \jtermeq{{\Gamma}{A}}{P}{f}{f'}
      }
    { \jtermeq{\Gamma}{\subst{x}{P}}{\subst{x}{f}}{\subst{x'}{f'}}
      }
    \\
& \inference
  { \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    }
  { \jterm{{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}{\subst{x}{g}}
    }
& & \inference
    { \jtermeq{{{\Gamma}{A}}{P}}{Q}{g}{g'}
      }
    { \jtermeq
        {{\Gamma}{\subst{x}{P}}}
        {\subst{x}{Q}}
        {\subst{x}{g}}
        {\subst{x'}{g'}}
      }
\end{align}

\subsubsection{Identity terms}
Last, but not least, we introduce the identity terms. In combination with
weakening and substitution, identity terms will allow us to speak of projections,
of a variant of extension for terms and of fiber inclusions.

\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \unfoldall{\jhom{\Gamma}{A}{A}{\idtm{A}}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{A'}
      }
    { \unfoldall{\jhomeq{\Gamma}{A}{A}{\idtm{A}}{\idtm{A'}}}
      }
\end{align}

\subsection{The judgmental equalities of the theory of contexts, families and
terms}
In this section we extend the judgmental equality relation in such a way that
the empty context, extension, weakening, substitution and the identity terms
all become compatible with each other. Since we have five operations, there
are going to be $25$ finite sets of rules explaining how each operation is
compatible with each of the operations. In addition to these $25$ finite sets
of compatibility rules, there are also two sets of rules explaining the
cancellation properties of weakening and substitution and of the identity terms.

\subsubsection{The empty context is compatible with itself}\label{comp-00}
Because every context is a family of contexts over the empty context, 
the empty context $\emptyc$ may be considered as a family of contexts over the empty
context. When we do this, we get $\emptyf[\emptyc]$.
\begin{equation}\label{eq:comp-00}
\inference
  { }
  { \jfameq
      {\emptyc}
      {\emptyc}
      {\emptyf[\emptyc]}
    }
\end{equation}
In the future, we shall denote $\emptyf[\Gamma]$ by $\emptyf$. The above rule
guarantees that this will not cause confusion. Likewise, we shall denote
$\emptytm[\Gamma]$ by $\emptytm$.

\subsubsection{Extension is compatible with the empty context}\label{comp-e0}
The following rule asserts that extension by $\emptyc$ leaves the contexts unchanged.
\begin{align}
& \inference
  { \jctx{\Gamma}
    }
  { \jctxeq{\ctxext{\emptyc}{\Gamma}}{\Gamma}
    }
  \label{eq:comp-e0}\\
& \inference
  { \jctx{\Gamma}
    }
  { \jctxeq{\ctxext{\Gamma}{\emptyf}}{\Gamma}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{\ctxext{\emptyf}{A}}{A}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{{A}{\emptyf}}{A}
    }
\end{align}

\subsubsection{Weakening is compatible with the empty context}
The following rules express that when the empty context or context family is
weakened, the result is the empty context family.
\begin{align}
& \inference
  { \jctx{\Gamma}
    }
  { \jfameq{\Gamma}{\ctxwk{\Gamma}{\emptyc}}{\emptyf}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{{\Gamma}{A}}{\ctxwk{A}{\emptyf}}{\emptyf}
    }
\end{align}
Weakening by the empty family $\emptyf$ over a context $\Gamma$ leaves families, 
their terms, families over those families and
terms of those unchanged:
\begin{align}
& \inference
  { \jfam{\Gamma}{B}
    }
  { \jfameq{\Gamma}{\ctxwk{\emptyf}{B}}{B}
    }
  \\
& \inference
  { \jterm{\Gamma}{B}{y}
    }
  { \jtermeq{\Gamma}{B}{\ctxwk{\emptyf}{y}}{y}
    }
  \\
& \inference
  { \jfam{{\Gamma}{B}}{Q}
    }
  { \jfameq{{\Gamma}{B}}{\ctxwk{\emptyf}{Q}}{Q}
    }
  \\
& \inference
  { \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jtermeq{{\Gamma}{B}}{Q}{\ctxwk{\emptyf}{g}}{g}
    }
\end{align}

\subsubsection{Substitution is compatible with the empty context}
The fibers of the empty family are the empty families:
\begin{align}
& \inference
  { \jterm{\Gamma}{A}{x}
    }
  { \jfameq{\Gamma}{\subst{x}{\emptyf}}{\emptyf}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq
      {{\Gamma}{\subst{x}{P}}}
      {\subst{x}{\emptyf}}
      {\emptyf}
    }
\end{align}

The following rules assert that substituting by the term $\jterm{\Gamma}{\emptyf}{\emptytm}$
leaves everything unchanged.
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{\subst{\emptytm}{A}}{A}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    }
  { \jtermeq{\Gamma}{A}{\subst{\emptytm}{x}}{x}
    }
  \\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq{{\Gamma}{A}}{\subst{\emptytm}{P}}{P}
    }
  \\
& \inference
  { \jterm{{\Gamma}{A}}{P}{f}
    }
  { \jtermeq{{\Gamma}{A}}{P}{\subst{\emptytm}{f}}{f}
    }.
\end{align}

\subsubsection{Extension is compatible with itself}\label{comp-ee}
The inference rules asserting that extension is compatible with itself assert
that contexts are unstructured lists of type declarations. This rule is
unavoidable if we want that for a family $A$ in context $\Gamma$, a family over
$A$ is the same thing as a family over $\ctxext{\Gamma}{A}$. 
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{A}}{P}
    }
  { \jctxeq{\ctxext{{\Gamma}{A}}{P}}{\ctxext{\Gamma}{{A}{P}}}
    }
  \\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfameq{\Gamma}{\ctxext{{A}{P}}{Q}}{\ctxext{A}{{P}{Q}}}
    }
\end{align}

\subsubsection{Weakening is compatible with extension}\label{comp-we}

The following rules assert the compatibility of extension with weakening: for
every family $A$ over $\Gamma$ and every family $Q$ over $\ctxext{\Gamma}{B}$
there is a
judgmental equality $\ctxwk{A}{\ctxext{B}{Q}}\jdeq\ctxext{\ctxwk{A}{B}}
{\ctxwk{A}{Q}}$. 

When thinking of terms of $\ctxwk{A}{B}$ as morphisms of families from $A$ to
$B$, this looks already like form of type theoretic choice. It is weaker in that
it is not stated with function types, yet it is stronger in that it states a
judgmental equality between two families. When one makes the weakening operation
notationally invisible -- as is in fact the usual practice in type theory -- the
following compatibility rules become completely obvious.

In the following inference rules we assume that $\jfam{\Gamma}{A}$.
\begin{align}
& \inference
  { \jfam{{{\Gamma}{B}}{Q}}{R}
    }
  { \jfameq
      {\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}
      {\ctxwk{A}{\ctxext{Q}{R}}}
      {\ctxext{\ctxwk{A}{Q}}{\ctxwk{A}{R}}}
    }
\end{align}

\subsubsection{Weakening is compatible with itself}\label{comp-ww}
We state judgmental equality rules expressing
that weakening is compatible with itself. These rules state that the following
diagram commutes given any two families $A$ and $B$ in context $\Gamma$:
\begin{equation*}
\begin{tikzcd}[column sep=huge]
\jfam{\Gamma}{\blank} 
  \ar{r}{C\mapsto\ctxwk{B}{C}} 
  \ar{d}[swap]{C\mapsto\ctxwk{A}{C}} 
& \jfam{{\Gamma}{B}}{\blank} 
  \ar{d}{Q\mapsto\ctxwk{A}{Q}}
  \\
\jfam{{\Gamma}{A}}{\blank} 
  \ar{r}[swap]{P\mapsto\ctxwk{{A}{B}}{P}} 
& \jfam{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\blank}
\end{tikzcd}
\end{equation*}
Thus, we get the following set of inference rules:
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    \jfam{{\Gamma}{C}}{R}
    }
  { \jfameq
      {{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{{A}{B}}{{A}{C}}}}
      {\ctxwk{A}{{B}{R}}}
      {\ctxwk{{A}{B}}{{A}{R}}}
    }
  \label{comp-ww-f}\\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    \jterm{{\Gamma}{C}}{R}{t}
    }
  { \jtermeq
      {{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{{A}{B}}{{A}{C}}}}
      {\ctxwk{{A}{B}}{{A}{R}}}
      {\ctxwk{A}{{B}{t}}}
      {\ctxwk{{A}{B}}{{A}{t}}}
    }
  \label{comp-ww-t}
\end{align}

\subsubsection{Extension is compatible with weakening}\label{comp-ew}
The rules expressing that extension is compatible with weakening assert that
weakening by an extension is the same thing as weakening twice in the
appropriate way.

In the following inference rules we assume that
$\jfam{\Gamma}{A}$ and $\jfam{{\Gamma}{A}}{P}$.
\begin{align}
& \inference
  { \jfam{{\Gamma}{B}}{Q}
    }
  { \jfameq
      {{{{\Gamma}{A}}{P}}{\ctxwk{P}{{A}{B}}}}
      {\ctxwk{\ctxext{A}{P}}{Q}}
      {\ctxwk{P}{{A}{Q}}}
    }
  \label{comp-ew-f}\\
& \inference
  { \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jtermeq
      {{{{\Gamma}{A}}{P}}{\ctxwk{P}{{A}{B}}}}
      {\ctxwk{P}{{A}{Q}}}
      {\ctxwk{\ctxext{A}{P}}{g}}
      {\ctxwk{P}{{A}{g}}}
    } 
  \label{comp-ew-t}
\end{align}

\subsubsection{Substitution is compatible with extension}\label{comp-se}
Suppose $\jterm{\Gamma}{A}{x}$ in all of the following inference rule.
\begin{align}
& \inference
  { \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \jfameq
      {{\Gamma}{\subst{x}{P}}}
      {\subst{x}{\ctxext{Q}{R}}}
      {\ctxext{\subst{x}{Q}}{\subst{x}{R}}}
    }
\end{align}

\subsubsection{Substitution is compatible with weakening}\label{comp-sw}
The rules asserting the compatibility of substitution with weakening assert
that the following diagram commutes for any $\jterm{\Gamma}{A}{x}$ and any
$\jfam{{\Gamma}{A}}{P}$:
\begin{equation*}
\begin{tikzcd}[column sep=huge]
\jfam{{\Gamma}{A}}{\blank} 
  \ar{d}[swap]{Q\mapsto\subst{x}{Q}} 
  \ar{r}{Q\mapsto\ctxwk{P}{Q}} 
& \jfam{{{\Gamma}{A}}{P}}{\blank} 
    \ar{d}{R\mapsto\subst{x}{R}}
  \\ 
\jfam{\Gamma}{\blank} 
  \ar{r}[swap]{B\mapsto\ctxwk{\subst{x}{P}}{B}} 
& \jfam{{\Gamma}{\subst{x}{P}}}{\blank}
\end{tikzcd}
\end{equation*}
We plug in an extra layer of families to cover the most general case at once.
In the following inference rules we assume that $\jterm{\Gamma}{A}{x}$ and
$\jfam{{\Gamma}{A}}{P}$:
\begin{align}
& \inference
  { \jfam{{{\Gamma}{A}}{Q}}{R}
    }
  { \jfameq
      {{{\Gamma}{\subst{x}{P}}}{\subst{x}{\ctxwk{P}{Q}}}}
      {\subst{x}{\ctxwk{P}{R}}}
      {\ctxwk{\subst{x}{P}}{\subst{x}{R}}}
    }
  \label{comp-sw-f}\\
& \inference
  { \jterm{{{\Gamma}{A}}{Q}}{R}{h}
    }
  { \jtermeq
      {\ctxext{{\Gamma}{\subst{x}{P}}}{\subst{x}{\ctxwk{P}{Q}}}}
      {\subst{x}{\ctxwk{P}{R}}}
      {\subst{x}{\ctxwk{P}{h}}}
      {\ctxwk{\subst{x}{P}}{\subst{x}{h}}}
    }
  \label{comp-sw-t}
\end{align}

\subsubsection{Substitution is compatible with substitution}\label{comp-ss}

We require that substitution is compatible with itself, which is roughly the
assertion that substitution is associative. However, we cannot just state that
$\subst{x}{{f}{g}}\jdeq\subst{{x}{f}}{g}$ since the expression $\subst{{x}{f}}{g}$
is not well-formed. The term $\subst{x}{f}$ can be substituted in (terms of) families over
$\subst{x}{P}$; the term $\subst{x}{g}$ is such. Therefore, associativity of
substitution takes the form $\subst{x}{{f}{g}}\jdeq\subst{{x}{f}}{{x}{g}}$.
Note that the term $\subst{{x}{f}}{{x}{g}}$ may be written down more conveniently
as $\subst{x,\subst{x}{f}}{g}$, although we will not do that here.

In the following inference rules we assume
$\jterm{\Gamma}{A}{x}$ and $\jterm{{\Gamma}{A}}{P}{f}$.
\begin{align}
& \inference
  { \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \jfameq
      {{\Gamma}{\subst{x}{{f}{Q}}}}
      {\subst{x}{{f}{R}}}
      {\subst{{x}{f}}{{x}{R}}}
    }
  \label{comp-ss-f}\\
& \inference
  { \jterm{{{{\Gamma}{A}}{P}}{Q}}{R}{h}
    }
  { \jtermeq
      {{\Gamma}{\subst{x}{{f}{Q}}}}
      {\subst{x}{{f}{R}}}
      {\subst{x}{{f}{h}}}
      {\subst{{x}{f}}{{x}{h}}}
    }
  \label{comp-ss-t}
\end{align}

\subsubsection{Weakening is compatible with substitution}\label{comp-ws}
We already have rules for the compatibility of substitution with weakening, but
we still need the rules the other way around, asserting that there is a 
judgmental equality $\ctxwk{A}{\subst{y}{Q}}\jdeq\subst{\ctxwk{A}{y}}{\ctxwk{A}{Q}}$
together with all its variants.

In the following inference rules we assume that $\jfam{\Gamma}{A}$ and that
$\jterm{\Gamma}{B}{y}$.
\begin{align}
& \inference
  { \jfam{{{\Gamma}{B}}{Q}}{R}
    }
  { \jfameq
      {{{\Gamma}{A}}{\ctxwk{A}{\subst{y}{Q}}}}
      {\ctxwk{A}{\subst{y}{R}}}
      {\subst{\ctxwk{A}{y}}{\ctxwk{A}{R}}}
    }
  \label{comp-ws-f}\\
& \inference
  { \jterm{{{\Gamma}{B}}{Q}}{R}{h}
    }
  { \jtermeq
      {{{\Gamma}{A}}{\ctxwk{A}{\subst{y}{Q}}}}
      {\ctxwk{A}{\subst{y}{R}}}
      {\ctxwk{A}{\subst{y}{h}}}
      {\subst{\ctxwk{A}{y}}{\ctxwk{A}{h}}}
    }
  \label{comp-ws-t}
\end{align}

\subsubsection{The cancellation properties of identity terms}
Identity terms are determined by their behavior with respect to substitution combined with
weakening. The identity terms will also be subject to compatibility rules.
\begin{align}
& \inference
  { \jterm{\Gamma}{A}{x}
    }
  { \jtermeq{\Gamma}{A}{\subst{x}{\idtm{A}}}{x}
    }
  \label{idfunc-subst-defn}\\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq{{\Gamma}{A}}{\subst{\idtm{A}}{\ctxwk{A}{P}}}{P}
    }
  \label{idfunc-wk-defn}\\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq
      {{\Gamma}{A}}
      {\subst{\idtm{A}}{\ctxwk{{A}{A}}{P}}}
      {P}
    }
  \label{idfunc-wk-defn2}\\
& \inference
  { \jterm{{\Gamma}{A}}{P}{f}
    }
  { \jtermeq
      {{\Gamma}{A}}
      {P}
      {\subst{\idtm{A}}{\ctxwk{A}{f}}}
      {f}
    }
  \label{idfunc-precomp}\\
& \inference
  { \jterm{{\Gamma}{A}}{P}{f}
    }
  { \jtermeq
      {{\Gamma}{A}}
      {P}
      {\subst{\idtm{A}}{\ctxwk{{A}{A}}{f}}}
      {f}
    }
  \label{idfunc-precomp}\\
& \inference
  { \unfoldall{\jhom{\Gamma}{A}{B}{f}}
    }
  { \unfoldall{\jhomeq{\Gamma}{A}{B}{\jcomp{A}{f}{\idtm{B}}}{f}}
    }
  \label{idfunc-postcomp}
\end{align}

We won't state a compatibility rule stating that the identity term is
compatible with extension because we will be able to prove that. Instead, we
will just state the compatibility rules for the identity term combined with
weakening and with substitution.

The identity term of a weakened family is the weakened identity term:
\begin{equation}\label{idfunc-wk-comp}
\inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    }
  { \unfoldall{\jhomeq
      {{\Gamma}{A}}
      {\ctxwk{A}{B}}
      {\ctxwk{A}{B}}
      {\ctxwk{A}{\idtm{B}}}
      {\idtm{\ctxwk{A}{B}}}
    }}
\end{equation}

The identity term of a substituted family is the substitution of the identity term
\begin{equation}\label{idfunc-subst-comp}
\inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{\Gamma}{A}}{P}
    }
  { \unfoldall{\jhomeq
      {\Gamma}
      {\subst{x}{P}}
      {\subst{x}{P}}
      {\subst{x}{\idtm{P}}}
      {\idtm{\subst{x}{P}}}
    }}
\end{equation}

\subsubsection{The cancellation property of weakening and substitution}
The judgmental equalities we're about to describe assert that substituting a term
in the weakening a thing gives you the thing back. In the case of contexts we get that each fiber
$\subst{x}{\ctxwk{A}{B}}$ is just $B$ and in the case of terms we get 
that $\ctxwk{A}{y}$ is the constant function
mapping everything to $y:B$. Thus, these rules actually establish the weakening
as the weakening. After stating the rules we will describe what it means to
compose context morphisms (terms of weakened contexts).
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    \jterm{\Gamma}{A}{x}
    }
  { \jfameq{{\Gamma}{B}}{\subst{x}{\ctxwk{A}{Q}}}{Q}
    }
  \label{defn-ws-3}\\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jtermeq{{\Gamma}{B}}{Q}{\subst{x}{\ctxwk{A}{g}}}{g}
    }
  \label{defn-ws-4}
\end{align}

\subsection{The possiblity of types in the theory of contexts, families and
terms}
We have deliberately not spoken of types so far because we have taken the point
of view that a type in a context is nothing but a family in that context which
belongs to the class of types. We think of types as \emph{irreducible} families,
i.e.\ families which are neither the empty context nor the extension of two
families which are both not the empty context (in algebraic terminology: which
are both non-trivial). To allow ourselves to speak of types we introduce two
new judgments: the judgment that something is a type and the judgment that two
types are equal.
\begin{align*}
\jtype*{\Gamma}{A} 
& \jtypeeq*{\Gamma}{A}{B}
\end{align*}
But only families of contexts are eligible to be types. If $A$ is a type
in context $\Gamma$, then $A$ is also a family of contexts over $\Gamma$. 
Moreover, two types in context $\Gamma$ are judgmentally equal precisely when they are equal
as context families and if a family $B$ of contexts over $\Gamma$ is
judgmentally equal to a type $A$ in context $\Gamma$, then $B$ is a type in
context $\Gamma$. This is expressed by the following four inference rules:
\begin{align*}
& \inference
  { \jtype{\Gamma}{A}
    }
  { \jfam{\Gamma}{A}
    }
& & \inference
    { \jtypeeq{\Gamma}{A}{B}
      }
    { \jfameq{\Gamma}{A}{B}
      }
    \\
& \inference
  { \jtype{\Gamma}{A}
    \jfameq{\Gamma}{A}{B}
    }
  { \jtype{\Gamma}{B}
    }
& & \inference
    { \jtype{\Gamma}{A}
      \jfameq{\Gamma}{A}{B}
      }
    { \jtypeeq{\Gamma}{A}{B}
      }
\end{align*}
As pointed out at the beginning of this subsection, 
we do not assume that the empty context is a type, that would be like
assuming that the multiplicative unit of a ring is prime. We envision a
categorical interpretation of the theory of contexts, families and terms where 
contexts are interpreted as finite paths of arrows belonging to a predetermined
class. The empty context would be such a path of length $0$ whereas the types
would be such paths of length $1$.

We add rules asserting that a weakened type is again a type that 
substitution preserves the property of being a type:
\begin{align}
& \inference
  { \jfam{\Gamma}{B}
    \jtype{\ctxext{\Gamma}{B}}{Q}
    }
  { \jtype{\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jtype{\ctxext{{\Gamma}{A}}{P}}{Q}
    }
  { \jtype{\ctxext{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}
    }
\end{align}
With only the current rules, the possibility of making the judgment that
something is a type does not add much to the theory of contexts, families and
terms. Nevertheless, when studying models, having an interpretation for the
judgment that something is a type will allow for the possibility to study
conditions such as the one asserting that every family `factorizes' uniquely
as multiple applications of extension to types, analogous to the condition on
unique factorization domains in ring theory. All the tradional models of type
theory should translate to models with such a condition, simply because
traditionally contexts are viewed as lists of variable (and type) declarations.
