\section{The generalized algebraic theory of contexts, families and terms (the E-system)}\label{tt}
In this section we give a description of dependent type theory before type
constructors. Apart from contexts, families and terms -- which provide for the
core of the language of dependent logic -- the basic ingredients
of this theory will be the operations of extension on context and on families, 
and empty context and empty families, weakening, substitution
and the identity terms. The resulting theory can be seen as a manifestation of the 
structure underlying dependent type theory.

We will
formulate the theory of contexts, families and terms in such a way that contexts aren't defined
to be lists of variable declarations. The variable-free (a.k.a.~\emph{name-free}) approach 
we take here is rather different than those appearing in 
\cite{hofmann1995extensional,TheBook} but it has appeared in the work of Coquand
and in \cite{Dybjer1996}.
The main reason we don't let variable declarations in is that we don't see them 
in the internal models either. This way we also set out to a more algebraic 
approach of type theory and higher category theory. Thirdly, we will not have to
be burdened with superficial comments about variables being bounded or not, or 
fresh or free or not occuring at all.

In our treatment, a contexts can be seen as binary
planar trees of which the leaves are (families of) contexts. 
The judgmental equality relation on contexts is an equivalence relation which 
expresses that binary planar
trees of contexts are judgmentally equal if their leaves are, taking only
(the isomorphism class of) 
the order of the leaves into account \emph{and not the actual shape of the three}.
The intuition behind this equivalence relation is indeed that unstructured
(i.e.~unbracketed) lists such as the lists of variable declarations which
usually appear in type theoretical syntax, may be regarded as contexts.

Besides contexts, families and terms there will also be a notion of `type in
a context', which one may assume.
A context is eligible to be a \emph{closed type} and over a context, a family
may be a type. We have the intuition that `being a type'
expresses the property of `being atomic or irreducible'. With a notion of types,
one has the means to require a stratification by which every context is a finite
extension of types starting at a closed type, and every family is likewise a
finite extension of types. The idea behind this is to recover the theory of
\autoref{Garner2014} {\color{red}(and possibly B-systems?)}. We stress that
we will not include axioms asserting such a stratification in the E-system
and we leave discussion on the possibility of a typing judgment until the
end of this section. 

With families of contexts being the principal things of
study, we have added a bit more generality to the theory, compared to the
theory of categories with families presented in \cite{Dybjer1996}. Here are
a couple of reasons for this extra generality:
\begin{enumerate}
\item We want to be very sure that we can interpret all the rules of type theory
in a straightforward manner in any context.
\item We do want do end up with a categorical structure on the contexts, derived
from the theory by requiring that a morphism from $\Gamma$ to $\Delta$ is a
term of the weakening of $\Delta$ by $\Gamma$ in context $\Gamma$. Thus, we
must be able to lift the context $\Delta$ to become a family of contexts over
$\Gamma$ and it is not reasonable to expect that this results in a type.
\item It is very easy in this setting to assert that an operation has an action
on very high levels of families, i.e.~when $F$ is an operation taking things in
context $\Gamma$ to things in context $\Delta$, then it takes a family $A$ in
context $\Gamma$ to $F(A)$ in context $\Delta$; a family $P$ in context
$\ctxext{\Gamma}{A}$ to a family $F(P)$ in context $\ctxext{\Delta}{(F(A))}$,
and so on. The reason it becomes simple is that we don't have to explain what
`and so on' means.
\end{enumerate}

We will formulate fairly strict rules governing the judgmental equalities,
expressing that extension, weakening and substitution are combatible with
each other in a judgmental manner. This does not, however, diminish the role
of isomorphisms or of homotopies could play in the theory once identity types
are added. Indeed, types could still have non-trivial identity relations and
the category of types in a certain context could genuinely display higher
categorical structure, or so we conjecture.

Much of the rules we state are just compatibility rules of extension, weakening
and substitution with each other. In a way, these rules assert that our contexts
are just structureless lists of contexts and that likewise terms are structureless
lists of terms. They are structureless in the sense that the order in which
they are formed by pairing up is irrelevant. We note that this causes complications
in the traditional way that categorical sematics of type theory is implemented,
where contexts become objects of the category which is supposed to model type
theory. The reason for this is that context extension will not satisfy all the
compatibility rules we're about to state. The first step to resolving this is taking
the types in the empty context as the objects. 

\subsection{Judgments and valid inference rules}\label{judgments}
The theory we describe here is a theory of contexts, families of
contexts and terms thereof. The families of contexts are by some authors called
dependent contexts, but they are handled a bit differently here because they
become the primary object of study. Dependent contexts can be types; they could
be seen as atomic or indecomposable dependent contexts.

Thus we make eight kinds of judgments: ``$\Gamma$ is a context'',
``$A$ is a family of contexts over $\Gamma$'', ``$A$ is a type in context $\Gamma$''
and ``$x$ is a term of the family $A$ of contexts over $\Gamma$''. The other four
judgments are for judgmental equality.
\begin{align*}
\jctx*{\Gamma} 
& \jctxeq*{\Gamma}{\Gamma'}
  \\
\jfam*{\Gamma}{A} 
& \jfameq*{\Gamma}{A}{B}
  \\
\jterm*{\Gamma}{A}{x} 
& \jtermeq*{\Gamma}{A}{x}{y}.
\end{align*}

Strictly speaking, we have three different judgmental equalities in play and one
could request for a notational difference to signify that fact. For instance,
we could denote the judgmental equalities of contexts, families and terms by
$\jdeq_c$, $\jdeq_f$ and $\jdeq_t$ respectively. It will, however, always be
clear which of the three kinds of judgmental equality is meant when we assert
a judgmental equality and therefore we shall not bother to make this notational
distinction.

We note that what we call families over contexts
here could also have been named dependent contexts or telescopes, see
\cite{deBruijn1991,hofmann1995extensional}. The term family is in agreement
with the terminology scheme of \cite{TheBook}, though the reader should be
warned that the notion of familie means something slightly different there than
it does here.

The theory of contexts, families and terms shall be described by means of a
declaration of valid inference rules. An inference rule is an expression of the
form
\begin{equation*}
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_n}{\mathcal{J}}
\end{equation*}
where each of $\mathcal{H}_1$, ..., $\mathcal{H}_n$ and $\mathcal{J}$ is 
judgment. The judgments $\mathcal{H}_1$, ..., $\mathcal{H}_n$ are called the
hypotheses and the judgment $\mathcal{J}$ is the conclusion of the inference
rule. When a judgment is the conclusion of a valid inference rule, we also say
that the judgment is valid or well-formed. In fact, the only way to construct
new judgments is via the valid inference rules we describe in this section.

The class of valid inference rules is closed under composition and under
rearranging the hypotheses. That
means that if
\begin{equation*}
\inference{\mathcal{I}_{1k}\quad\cdots\quad\mathcal{I}_{m_kk}}{\mathcal{H}_k}
\end{equation*}
and
\begin{equation*}
\inference{\mathcal{H}_1\quad\cdots\quad\mathcal{H}_n}{\mathcal{J}}
\end{equation*}
are valid inference rules for $1\leq k\leq n$, then
\begin{equation*}
\inference{\mathcal{I}_{11}\quad\cdots\quad\mathcal{I}_{m_11}\quad\cdots\quad\mathcal{I}_{1n}\quad\cdots\quad\mathcal{I}_{m_nn}}{\mathcal{J}}
\end{equation*}
is also a valid inference rule. Also, in a valid inference rule 
duplicated hypotheses may always be contracted and hypotheses may always be 
reordered; the result is still considered a valid inference rule.

\subsection{The basic rules for judgmental equality}
The rules for judgmental equality establish that it is an equivalence relation
in all three cases (contexts, families and terms). Thus, the following inference
rules shall be required to be valid:
\bgroup\small
\begin{align*}
& \inference
  { \jctx{\Gamma}
    }
  { \jctxeq{\Gamma}{\Gamma}
    } 
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      }
    { \jctxeq{\Delta}{\Gamma}
      } 
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jctxeq{\Delta}{\greek{E}}
      }
    { \jctxeq{\Gamma}{\greek{E}}
      }
    \\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{A}{A}
    } 
& & \inference
    { \jfameq{\Gamma}{A}{B}
      }
    { \jfameq{\Gamma}{B}{A}
      }
& & \inference
    { \jfameq{\Gamma}{A}{B}
      \jfameq{\Gamma}{B}{C}
      }
    { \jfameq{\Gamma}{A}{C}
      }
    \\
& \inference
  { \jterm{\Gamma}{A}{x}
    }
  { \jtermeq{\Gamma}{A}{x}{x}
    }
& & \inference
    { \jtermeq{\Gamma}{A}{x}{y}
      }
    { \jtermeq{\Gamma}{A}{y}{x}
      }
& & \inference
    { \jtermeq{\Gamma}{A}{x}{y}
      \jtermeq{\Gamma}{A}{y}{z}
      }
    { \jtermeq{\Gamma}{A}{x}{z}
      }
\end{align*}
\egroup

The following convertibility rules are responsible for the strictness
of judgmental equality, which sets it apart from equivalences or identifications:
\begin{align*}
& \inference
  { \jctxeq{\Gamma}{\Delta}
    \jfam{\Gamma}{A}
    }
  { \jfam{\Delta}{A}
    }
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jfameq{\Gamma}{A}{B}
      }
    { \jfameq{\Delta}{A}{B}
      }
    \\
& \inference
  { \jctxeq{\Gamma}{\Delta}
    \jterm{\Gamma}{A}{x}
    }
  { \jterm{\Delta}{A}{x}
    }
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jtermeq{\Gamma}{A}{x}{y}
      }
    { \jtermeq{\Delta}{A}{x}{y}
      }
    \\
& \inference
  { \jfameq{\Gamma}{A}{B}
    \jterm{\Gamma}{A}{x}
    }
  { \jterm{\Gamma}{B}{x}
    }
& & \inference
    { \jfameq{\Gamma}{A}{B}
      \jtermeq{\Gamma}{A}{x}{y}
      }
    { \jtermeq{\Gamma}{B}{x}{y}
      }
\end{align*}

\subsection{The operations of the theory of contexts, families and terms}
In this subsection we introduce the notions of
extension on context and on families, the empty context and the empty families, 
weakening, 
substitution and identity terms. 

Weakening and substitution are both
operations of the theory of contexts, families and terms and therefore they will
have three levels of actions: on contexts (at the appropriate level), families
and terms.

\begin{comment}
Generally, 
each operation should
have an action on contexts, on families and on terms at the `appropriate level'
and should be compatible with each of the operations we introduce here. In
that will become more practical after the theory of contexts, families and terms
is formulated, this means that when we will write down a type theory that
interprets itself in \autoref{ttmodels}, each of the notions of
extension, empty family, weakening, substitution and identity terms are going to be internalized
as terms of the theory and all terms are going to be compatible with these.
That vague idea will be our guiding light.

So in principle, the introductions of each of the empty context, extension,
weakening, substitution and identity terms should come in three parts. In 
practice, they do not all come in three parts.

Apart from the empty context, there will indeed be an empty family and a term
of the empty family (which will be deemed unique). But extension will
not have an explicit action `at the level of families' since extension
is used to define higher families and the action would have to be trivial
anyway. The empty context and extension provide the essentials of the rest of
the theory in the sense that higher families are families over extensions,
contexts are families over the empty context and the `action on families' of
any operation applied to families over the empty context is the same as the
original operation. Thus, when we have introduced the operations of weakening
and substitution we will see that they also have an `action on the terms of 
contexts'. We will state the relevant judgmental equality rules for the empty
context in this section rather than in the next, since they are required to
state that the action on families of an operation is compatible with the
original operation.
\end{comment}

We note upfront that both context extension and family extension can also be
seen as operations of contexts, families and terms, even though we will not
introduce them as such. The reason is that extension is used to define what it
means to be a family over a family over a context (namely, a family over an
extended context). As such, it will have a trivial action on families and terms
which will not need to be introduced. We will come back to this point in
\autoref{extension}.

\subsubsection{Extension}
\label{extension}
The operations of extension enable one to consider families over
families and higher level families alike. We will need both a context extension
operation and a family extension operation.

The inference rules introducing context and family extension are as follows:
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jctx{\ctxext{\Gamma}{A}}
    }
& & \inference
    { \jctxeq{\Gamma}{\Delta}
      \jfameq{\Gamma}{A}{B}
      }
    { \jctxeq{\ctxext{\Gamma}{A}}{\ctxext{\Delta}{B}}
      }
    \\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfam{\Gamma}{\ctxext{A}{P}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{B} 
      \jfameq{{\Gamma}{A}}{P}{Q}
      }
    { \jfameq{\Gamma}{\ctxext{A}{P}}{\ctxext{B}{Q}}
      }
\end{align}
The extension operation may also be defined to act on families over families
and terms thereof. For instance, When $\jfam{{\Gamma}{A}}{P}$ is a family,
we would get a family $\jfam{{\Gamma}{A}}{{\Gamma}{P}}$ and when
$\jterm{{\Gamma}{A}}{P}{f}$ is a term, we would get a term
$\jterm{{\Gamma}{A}}{{\Gamma}{P}}{\ctxext{\Gamma}{f}}$. Then there would be
axioms stating the judgmental equalities $\ctxext{\Gamma}{P}\jdeq P$ and
$\ctxext{\Gamma}{f}\jdeq f$. Thus, it is of no actual use to introduce the
action of context extension on families and terms.

Nevertheless, the fact that extension \emph{does} act on families
and terms (albeit trivially) reflects in the internal extension term in the type theory of
models of type theory, which is developed in \autoref{ttmodels}. Also, in the
categorical semantics, the extension operation would be the concatenation of
lists of arrows belonging to the class of arrows representing families. Since
families over families are interpreted by lists of those family arrows extending
concateneted lists of family arrows, the action of concatenation of such lists
may be taken to be trivial. The $\Sigma$-functor, which is the version of this
operation on those lists which have length one, acts trivially on morphisms;
another manifestation of the same phenomenon.

In \autoref{extension-on-terms} we will also define an extension operation
on terms, which defines a term $\jterm{\Gamma}{{A}{P}}{\tmext{x}{u}}$ for
every $\jterm{\Gamma}{A}{x}$ and $\jterm{\Gamma}{\subst{x}{P}}{u}$. This
operation is defined by using the substitution operation and identity terms.

\paragraph{Associativity of extension}
\label{comp-ee}
The inference rules asserting that extension is compatible with itself assert
that contexts are unstructured lists of type declarations. This rule is
unavoidable if we want that for a family $A$ in context $\Gamma$, a family over
$A$ is the same thing as a family over $\ctxext{\Gamma}{A}$. 
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{A}}{P}
    }
  { \jctxeq{\ctxext{{\Gamma}{A}}{P}}{\ctxext{\Gamma}{{A}{P}}}
    }
  \\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfameq{\Gamma}{\ctxext{A}{{P}{Q}}}{\ctxext{{A}{P}}{Q}}
    }
  \label{comp-ee-c}
\end{align}
Note that we may take the point of view that extension distributes over
extensions. If we want to extend an extended family $\ctxext{P}{Q}$ over
$\ctxext{\Gamma}{A}$ by the family $A$, the result is the extension of (1)
the extension of $P$ by $A$ and (2) the extension of $Q$ by $A$. The latter is
simply $Q$ since extension acts trivially at the level of families (and terms).

\subsubsection{The empty context and the empty families}
\label{empty}
We introduce an empty context and an family over $\Gamma$ for every context $\Gamma$. 
It has been suggested by some to only include empty families and not an
empty context because an empty context is not necessary, but we do have several
reasons to include them. Having an empty context requires also rules asserting 
that a context is the same thing as a family over the empty context and this
gives the categorical structure on contexts for free once one has it for 
families. The main ingredients that will be missing from the theory once an
empty context is avoided are weakening by a context and identity morphisms from
a context to itself. Including these by hand also requires to formulate all the
compatibility rules involving weakening once more for the cases of weakening by
a context and identity terms at contexts. We prefer to state these rules once
and only once and including an empty context helps in this respect.

We also prefer to have our scheme of compatibility rules as symmetrical as
possible. The structure of type dependency should look exactly the same in the
default case as in any context. In that respect, having an empty family but not
an empty context seems a bit odd. Also, some sets of compatibility rules 
(like the rules stating that extension is compatible with the empty families)
will become assymetrical as a result of not including an empty context. Moreover,
we would eventually like to include a stratification of the theory by means of
a type judgment (asserting that a family in a context $\Gamma$ is a type) and
study closed types (i.e.~types in the empty context). It would be possible to
provide a notion of closed types without having an empty context, but this would
have to be formulated separately and we would have to restate all the rules for
types (if any) for closed types all over again.

One of the main uses of the empty context and the empty families is that we
get the property that the `action on contexts' of an operation is compatible
with its `action on families'.

The empty family over a context $\Gamma$ is introduced by the following rule
inference rule:
\begin{align}
& \inference
  { }
  { \jctx{\emptyc}
    }
  \\
& \inference
  { \jctx{\Gamma}
    }
  { \jfam{\Gamma}{\emptyf[\Gamma]}
    }
  \\
& \inference
  { \jctxeq{\Gamma}{\Gamma'}
    }
  { \jfameq{\Gamma}{\emptyf[\Gamma]}{\emptyf[\Gamma']}
    }
\end{align}

By regarding contexts as families of contexts over the empty context, we
enable ourselves also to speak of terms of contexts. A term of a context
$\Gamma$ is a term of the family $\Gamma$ over the empty context. These ideas
are captured in the following convertibility rules:
\begin{align}
& \inference
  { \jctx{\Gamma}
    }
  { \jfam{\emptyc}{\Gamma}
    } 
& & \inference
    { \jfam{\emptyc}{\Gamma}
      }
    { \jctx{\Gamma}
      }
    \\
& \inference
  { \jctxeq{\Gamma}{\Delta}
    }
  { \jfameq{\emptyc}{\Gamma}{\Delta}
    }
& & \inference
    { \jfameq{\emptyc}{\Gamma}{\Delta}
      }
    { \jctxeq{\Gamma}{\Delta}
      }
\end{align}

The reader may wonder whether the empty family $\emptyf$ always has a
term. This shall follow from the rules stating the compatibility of extension
with the empty families in \autoref{comp-0e} below and from
identity terms (\autoref{identityterms}).
\begin{comment}
When contexts are viewed as statements, the empty context is the statement that
asserts nothing. Likewise, in any context one can assert nothing and this is
achieved by the empty family. 
Since somebody who states nothing asserts it all right, there is a term of the empty
family over any context. Moreover, any two terms of the empty family are always
judgmentally equal.
\begin{align}
& \inference
  { }
  { \jctx{\emptyc}
    }
  \\
& \inference
  { \jctx{\Gamma}
    }
  { \jfam{\Gamma}{\emptyf[\Gamma]}
    }
  \\
& \inference
  { \jctx{\Gamma}
    }
  { \jterm{\Gamma}{\emptyf[\Gamma]}{\emptytm[\Gamma]}
    }
  \\
& \inference
  { \jterm{\Gamma}{\emptyf[\Gamma]}{x}
    }
  { \jtermeq
      {\Gamma}
      {\emptyf[\Gamma]}
      {x}
      {\emptytm[\Gamma]}
    }
  \label{comp-00-t}
\end{align}

The empty context and the empty families together with the operation of
extension will provide several shortcuts for the rest
of the theory of families and terms. This is (in part) obtained by requiring
that a context is exactly the same thing as a family of contexts over the
empty context and that judgmental equality of contexts is exactly the same
as judgmental equality of families of contexts over the empty context. 

\label{comp-00}
Because every context is a family of contexts over the empty context, 
the empty context $\emptyc$ may be considered as a family of contexts over the empty
context. When we do this, we get $\emptyf[\emptyc]$.
\begin{equation}\label{eq:comp-00}
\inference
  { }
  { \jfameq
      {\emptyc}
      {\emptyc}
      {\emptyf[\emptyc]}
    }
\end{equation}
In the future, we shall denote $\emptyf[\Gamma]$ by $\emptyf$. The above rule
guarantees that this will not cause confusion. Likewise, we shall denote
$\emptytm[\Gamma]$ by $\emptytm$.
\end{comment}

\paragraph{Compatibility of extension with the empty context and families}
In the following set of inference rules we state that the empty context and
the empty family are neutral objects for both context extension (the first two
rules) and family extension (the last two rules).
\label{comp-e0}\label{comp-0e}
\begin{align}
& \inference
  { \jctx{\Gamma}
    }
  { \jctxeq{\ctxext{\emptyc}{\Gamma}}{\Gamma}
    }
  \label{comp-0e-c}
  \\
& \inference
  { \jctx{\Gamma}
    }
  { \jctxeq{\ctxext{\Gamma}{\emptyf}}{\Gamma}
    }
  \label{comp-e0-c}\\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{\ctxext{\emptyf}{A}}{A}
    }
  \label{comp-0e-f}
  \\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{{A}{\emptyf}}{A}
    }
  \label{comp-e0-f}
\end{align}

\paragraph{Family extension restricted to the empty context}
Strictly speaking we should have used a different notation for context extension
as for family extension, because the following rule asserting that family extension
in the empty context is the same thing as context extension would look tautological
without a difference. So let us denote, only for the moment, context extension
of $\Gamma$ by $A$ by $(\ctxext{\Gamma}{A})^c$ and family extension of $A$ by
$P$ in context $\Gamma$ by $(\ctxext{A}{P})^\famsym$. 

Note that we may consider a context $\Gamma$ as a family over $\emptyc$ and
a family $\jfam{\Gamma}{A}$ as a family $\jfam{{\emptyc}{\Gamma}}{A}$. 
Therefore we will require the following rule:
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jctxeq{(\ctxext{\Gamma}{A})^c}{(\ctxext{\Gamma}{A})^\famsym}
    }
\end{align}
Note that this rule actually justifies that we have not utilized two different
notations for context extension and family extension.

\subsubsection{Weakening}
\label{weakening}
When $A$ is a family in context $\Gamma$, the operation of weakening by $A$
takes a family $B$ in context $\Gamma$ and provides a family $\ctxwk{A}{B}$
in context $\ctxext{\Gamma}{A}$. The context family $\ctxwk{A}{B}$ can be seen
as the constant family over $\ctxext{\Gamma}{A}$ with value $B$. This idea will
be axiomatized in the cancellation property of weakening and substitution in
\autoref{cancellation-ws}. In \autoref{morphisms} we will take the terms 
$\unfold{\jhom{\Gamma}{A}{B}{f}}$ to be the morphisms of families from $A$ to 
$B$. These will be at the heart of the categorical structure of the theory.

The weakening operation acts on three levels: on contexts, on families and
on terms. The `action on contexts' of weakening is the action we described
above: it takes a family $B$ over $\Gamma$ to a family $\ctxwk{A}{B}$ over
$\ctxext{\Gamma}{A}$; the `action on families' of weakening takes a family
$Q$ over $\ctxext{\Gamma}{B}$ to a family $\ctxwk[\famsym]{A}{Q}$ over
$\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}$; the `action on terms' of weakening takes
a term $g$ of $Q$ to a term $\ctxwk[\tmsym]{A}{g}$ of $\ctxwk[\famsym]{A}{Q}$.
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    }
  { \jfam{{\Gamma}{A}}{\ctxwk{A}{B}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{A'}
      \jfameq{\Gamma}{B}{B'}
      }
    { \jfameq{{\Gamma}{A}}{\ctxwk{A}{B}}{\ctxwk{A'}{B'}}
      }
    \\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    }
  { \jfam{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk[\famsym]{A}{Q}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{A'}
      \jfameq{{\Gamma}{B}}{Q}{Q'}
      }
    { \jfameq
        {{{\Gamma}{A}}{\ctxwk{A}{B}}}
        {\ctxwk[\famsym]{A}{Q}}
        {\ctxwk[\famsym]{A'}{Q'}}
      }
    \\
%& \inference
%  { \jterm{\Gamma}{B}{y}
%    }
%  { \jterm{{\Gamma}{A}}{\ctxwk{A}{B}}{\ctxwk{A}{y}}
%    }
%& & \inference
%    { \jtermeq{\Gamma}{B}{y}{y'}
%      }
%    { \jtermeq
%        {{\Gamma}{A}}
%        {\ctxwk{A}{B}}
%        {\ctxwk{A}{y}}
%        {\ctxwk{A'}{y'}}
%      }
%    \\
& \inference
  { \jfam{\Gamma}{A}
    \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jterm{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk[\famsym]{A}{Q}}{\ctxwk[\tmsym]{A}{g}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{A'}
      \jtermeq{{\Gamma}{B}}{Q}{g}{g'}
      }
    { \jtermeq
        {{{\Gamma}{A}}{\ctxwk{A}{B}}}
        {\ctxwk[\famsym]{A}{Q}}
        {\ctxwk[\tmsym]{A}{g}}
        {\ctxwk[\tmsym]{A'}{g'}}
      }
\end{align}

\paragraph{Weakening of an empty family}
The following inference rules express that when the empty family is
weakened, the result is the empty family.
\label{comp-w0}
\begin{align}
%& \inference
%  { \jctx{\Gamma}
%    }
%  { \jfameq{\Gamma}{\ctxwk{\Gamma}{\emptyc}}{\emptyf}
%    }
%  \\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{{\Gamma}{A}}{\ctxwk{A}{\emptyf}}{\emptyf}
    }
  \label{comp-w0-c}\\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    }
  { \jfameq
    {{{\Gamma}{A}}{\ctxwk{A}{B}}}
    {\ctxwk[\famsym]{A}{\emptyf}}
    {\emptyf}
    }
  \label{comp-w0-f}
\end{align}
\begin{comment}
Note that we do not have to axiomatize the action of weakening
by $A$ on the term of the empty family, because the result will be in the empty 
family and every term in the empty family is judgmentally equal to the term 
$\emptytm$.
\end{comment}

Because a family over $\Gamma$ is the same as a family over 
$\ctxext{\Gamma}{\emptyf}$ we can apply both the action on contexts and the
action on families of weakening to a family $B$ over $\Gamma$. When we apply
the action on families, we obtain a family $\ctxwk[\famsym]{A}{B}$ over the
context $\ctxext{{\Gamma}{A}}{\ctxwk{A}{\emptyf}}$. However, since we have
postulated the judgmental equalities $\ctxwk{A}{\emptyf}\jdeq\emptyf$ and
$\ctxext{{\Gamma}{A}}{\emptyf}\jdeq\ctxext{\Gamma}{A}$, we see that we can
compare $\ctxwk[\famsym]{A}{B}$ with $\ctxwk{A}{B}$. The following inference
rule postulates that these two are judgmentally equal:
\begin{equation}
\inference
{ \jfam{\Gamma}{A}
  \jfam{\Gamma}{B}
  }
{ \jfameq{{\Gamma}{A}}{\ctxwk[\famsym]{A}{B}}{\ctxwk{A}{B}}
  }
\end{equation}
Due to this rule, the action on contexts and the action on families of weakening
are compatible with each other and consequently there can be no possible
confusion when we omit the annotations $\famsym$ and $\tmsym$ alltogether. In
the future, the weakening of a family $Q$ over $\ctxext{\Gamma}{B}$ shall
be denoted just by $\ctxwk{A}{Q}$ and likewise the weakening of a term $g$ of
$Q$ shall be denoted by $\ctxwk{A}{g}$.

Because a family $B$ over $\Gamma$ can be treated as a family by the operation
of weakening, weakening also acts on the terms of $B$. The weakening of a term
$y$ of $B$ by $A$ can be seen as the constant term (or function) of the
family $\ctxwk{A}{B}$.

\paragraph{Weakenings of extensions}
\label{comp-we}
The following rules assert that when an extended family is weakened, the
weakening distributes over the extension factors.
\begin{align}\label{comp-we-f}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{{\Gamma}{B}}{Q}}{R}
    }
  { \jfameq
      {\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}
      {\ctxwk{A}{\ctxext{Q}{R}}}
      {\ctxext{\ctxwk{A}{Q}}{\ctxwk{A}{R}}}
    }
\end{align}
When thinking of terms of $\ctxwk{A}{B}$ as morphisms of families from $A$ to
$B$, this looks already like form of type theoretic choice. It is weaker in that
it is not stated with function types, yet it is stronger in that it states a
judgmental equality between two families.

There is also a version of this property where an extended term is weakened.
This variant is stated and proved in \autoref{comp-we-t}.

\paragraph{Weakening of weakenings}
When a weakened family is weakened even further, the outer weakening distributes
over the `weakening factors'.
\label{comp-ww}
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    \jfam{{\Gamma}{C}}{R}
    }
  { \jfameq
      {{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{{A}{B}}{{A}{C}}}}
      {\ctxwk{A}{{B}{R}}}
      {\ctxwk{{A}{B}}{{A}{R}}}
    }
  \label{comp-ww-f}\\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    \jterm{{\Gamma}{C}}{R}{t}
    }
  { \jtermeq
      {{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{{A}{B}}{{A}{C}}}}
      {\ctxwk{{A}{B}}{{A}{R}}}
      {\ctxwk{A}{{B}{t}}}
      {\ctxwk{{A}{B}}{{A}{t}}}
    }
  \label{comp-ww-t}
\end{align}

\begin{comment}
\subsubsection{Weakening by a context}
Since we have not required that there is an empty context with the property that
a context is the same thing as a family in the empty context, we will have to
explicitly introduce weakening by contexts. Since it will allways be clear
whether something is weakened by a context or by a family, we shall use the
same notation for weakening by contexts as for weakening by families. We shall
have to repeat all the compatibility rules for weakening by families for
weakening by contexts; there is no way around it. It is
actually this sort of inconvenience that has originally led us to include an
empty context and be done with it.

In the following inference rules we assume that we have a context $\Gamma$ and
that $\jctxeq{\Gamma}{\Gamma'}$ in the rules where $\Gamma'$ makes an appearence.
\begin{align}
& \inference
  { \jctx{\Delta}
    }
  { \jfam{\Gamma}{\ctxwk{\Gamma}{\Delta}}
    }
& & \inference
  { \jctxeq{\Delta}{\Delta'}
    }
  { \jfameq{\Gamma}{\ctxwk{\Gamma}{\Delta}}{\ctxwk{\Gamma'}{\Delta'}}
    }
  \\
& \inference
  { \jfam{\Delta}{B}
    }
  { \jfam{\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}}{\ctxwk{\Gamma}{B}}
    }
& & \inference
  { \jfameq{\Delta}{B}{B'}
    }
  { \jfameq
      {\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}}
      {\ctxwk{\Gamma}{B}}
      {\ctxwk{\Gamma'}{B'}}
    }
  \\
& \inference
  { \jterm{\Delta}{B}{y}
    }
  { \jterm
      {\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}}
      {\ctxwk{\Gamma}{B}}
      {\ctxwk{\Gamma}{y}}
    }
& & \inference
  { \jtermeq{\Delta}{B}{y}{y'}
    }
  { \jtermeq
      {\ctxext{\Gamma}{\ctxwk{\Gamma}{\Delta}}}
      {\ctxwk{\Gamma}{B}}
      {\ctxwk{\Gamma}{y}}
      {\ctxwk{\Gamma}{y'}}
    }
\end{align}
Note that we do not employ three different notations for the three different
actions of weakening by a context because there can be no confusion about which
of the three actions is meant. If there were an empty context we should have
distinguished the three as we did for weakening by a family.

We shall have similar compatibility rules for weakening by a context as we did
for weakening by a family.

{\color{red}To do. It will look exactly the same as for weakening by families}
\end{comment}

\subsubsection{Substitution}
\label{substitution}
Given a family $P$ over $A$ and a term $x$ of $A$, substitution gives a way to
consider the \emph{fiber $\subst{x}{P}$ of $P$ at $x$}. As was the case with
weakening, the substitution operation comes in three parts: the `action on
contexts' of substitution is the operation just described; the `action on
families' of substitution takes a family $Q$ over $\ctxext{{\Gamma}{A}}{P}$
to a family $\subst[\famsym]{x}{Q}$ over $\ctxext{\Gamma}{\subst{x}{P}}$; the
`action on terms' of substitution takes a term $g$ of $Q$ over
$\ctxext{{\Gamma}{A}}{P}$ to a term $\subst[\tmsym]{x}{g}$ of 
$\subst[\famsym]{x}{Q}$.
\begin{align}
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{\Gamma}{A}}{P}
    }
  { \jfam{\Gamma}{\subst{x}{P}}
    }
& & \inference
    { \jtermeq{\Gamma}{A}{x}{x'}
      \jfameq{{\Gamma}{A}}{P}{P'}
      }
    { \jfameq{\Gamma}{\subst{x}{P}}{\subst{x'}{P'}}
      }
    \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfam{{\Gamma}{\subst{x}{P}}}{\subst[\famsym]{x}{Q}}
    }
& & \inference
    { \jtermeq{\Gamma}{A}{x}{x'}
      \jfameq{{{\Gamma}{A}}{P}}{Q}{Q'}
      }
    { \jfameq{{\Gamma}{\subst{x}{P}}}{\subst[\famsym]{x}{Q}}{\subst[\famsym]{x'}{Q'}}
      }
    \\
%& \inference
%  { \jterm{{\Gamma}{A}}{P}{f}
%    }
%  { \jterm{\Gamma}{\subst{x}{P}}{\subst{x}{f}}
%    }
%& & \inference
%    { \jtermeq{{\Gamma}{A}}{P}{f}{f'}
%      }
%    { \jtermeq{\Gamma}{\subst{x}{P}}{\subst{x}{f}}{\subst{x'}{f'}}
%      }
%    \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    }
  { \jterm{{\Gamma}{\subst{x}{P}}}{\subst[\famsym]{x}{Q}}{\subst[\tmsym]{x}{g}}
    }
& & \inference
    { \jtermeq{\Gamma}{A}{x}{x'}
      \jtermeq{{{\Gamma}{A}}{P}}{Q}{g}{g'}
      }
    { \jtermeq
        {{\Gamma}{\subst{x}{P}}}
        {\subst[\famsym]{x}{Q}}
        {\subst[\tmsym]{x}{g}}
        {\subst[\tmsym]{x'}{g'}}
      }
\end{align}

\paragraph{Fibers of an empty family}
The following inference rules establish that the fibers of the empty family are 
the empty families:
\label{comp-s0}
\begin{align}
& \inference
  { \jterm{\Gamma}{A}{x}
    }
  { \jfameq{\Gamma}{\subst{x}{\emptyf}}{\emptyf}
    }
  \label{comp-s0-c}
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq
      {{\Gamma}{\subst{x}{P}}}
      {\subst{x}{\emptyf}}
      {\emptyf}
    }
  \label{comp-s0-f}
\end{align}
\begin{comment}
Note again that we do not have to axiomatize the action of substitution by $x$ on the term
of the empty family, because the result will be in the empty family and every
term in the empty family is judgmentally equal to the term $\emptytm$.
\end{comment}

We use the above rule to state the compatibility of the action on families of
substitution with the action on contexts of substitution. Note that a family
$P$ over $\ctxext{\Gamma}{A}$ may be regarded as a family over
$\ctxext{{\Gamma}{A}}{\emptyf}$. Thus, we may consider the family
$\subst[\famsym]{x}{P}$ over $\ctxext{\Gamma}{\subst{x}{\emptyf}}$. Since
$\subst{x}{\emptyf}$ is judgmentally equal to the empty family, we may compare
$\subst[\famsym]{x}{P}$ with $\subst{x}{P}$:
\begin{equation}
\inference
{ \jfam{{\Gamma}{A}}{P}
  }
{ \jfameq{\Gamma}{\subst[\famsym]{x}{P}}{\subst{x}{P}}
  }
\end{equation}
Due to this rule we need not make the annotations $\famsym$ and $\tmsym$ in
the notation for substitution anymore and thus we shall omit them from now on.
Note that because a family $P$ over $\ctxext{\Gamma}{A}$ is eligible for
application of the action on families of substitution, we may also substitute
terms of $P$. Thus, given terms $\jterm{\Gamma}{A}{x}$ and $\jterm{{\Gamma}{A}}{P}{f}$,
we get a term $\jterm{\Gamma}{\subst{x}{P}}{\subst{x}{f}}$, the \emph{value of
$f$ at $x$}.

In \autoref{morphisms} we will use a combination of weakening and substitution
to define composition of morphisms of families. However, we have to rely
on the cancellation rule stated in \autoref{cancellation-ws} before we can
meaningfully state the definition of composition.

\paragraph{Fibers of extensions}
\label{comp-se}
The following inference rule asserts that if we take the fiber of an extended
family at a term $x$ of $A$ in context $\Gamma$, the substitution by $x$
distributes over the factors of the extension.
\begin{align}\label{comp-se-f}
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \jfameq
      {{\Gamma}{\subst{x}{P}}}
      {\subst{x}{\ctxext{Q}{R}}}
      {\ctxext{\subst{x}{Q}}{\subst{x}{R}}}
    }
\end{align}
There is also a version of this statement in which extended terms are considered.
This variant is stated and proved in \autoref{comp-se-t}.

\paragraph{Fibers of weakenings}\label{comp-sw}
Substitutions distribute over weakenings:
\begin{align}
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{\Gamma}{A}}{P}
    \jfam{{{\Gamma}{A}}{Q}}{R}
    }
  { \jfameq
      {{{\Gamma}{\subst{x}{P}}}{\subst{x}{\ctxwk{P}{Q}}}}
      {\subst{x}{\ctxwk{P}{R}}}
      {\ctxwk{\subst{x}{P}}{\subst{x}{R}}}
    }
  \label{comp-sw-f}\\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{\Gamma}{A}}{P}
    \jterm{{{\Gamma}{A}}{Q}}{R}{h}
    }
  { \jtermeq
      {\ctxext{{\Gamma}{\subst{x}{P}}}{\subst{x}{\ctxwk{P}{Q}}}}
      {\subst{x}{\ctxwk{P}{R}}}
      {\subst{x}{\ctxwk{P}{h}}}
      {\ctxwk{\subst{x}{P}}{\subst{x}{h}}}
    }
  \label{comp-sw-t}
\end{align}

\paragraph{Fibers of fibers}
\label{comp-ss}

We require that substitution is compatible with itself, which is roughly the
assertion that substitution is associative. However, we cannot just state that
$\subst{x}{{f}{g}}\jdeq\subst{{x}{f}}{g}$ since the expression $\subst{{x}{f}}{g}$
is not well-formed. The term $\subst{x}{f}$ can be substituted in (terms of) families over
$\subst{x}{P}$; the term $\subst{x}{g}$ is such. Therefore, associativity of
substitution takes the form $\subst{x}{{f}{g}}\jdeq\subst{{x}{f}}{{x}{g}}$.
Note that the term $\subst{{x}{f}}{{x}{g}}$ may be written down more conveniently
as $\subst{x,\subst{x}{f}}{g}$, although we will not do that. In fact, after
we have introduced extension on terms in \autoref{extension-on-terms}, we will 
see that $\subst{{x}{f}}{{x}{g}}\jdeq\subst{\tmext{x}{\subst{x}{f}}}{g}$.

In the following inference rules we assume
$\jterm{\Gamma}{A}{x}$ and $\jterm{{\Gamma}{A}}{P}{f}$.
\begin{align}
& \inference
  { \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \jfameq
      {{\Gamma}{\subst{x}{{f}{Q}}}}
      {\subst{x}{{f}{R}}}
      {\subst{{x}{f}}{{x}{R}}}
    }
  \label{comp-ss-f}\\
& \inference
  { \jterm{{{{\Gamma}{A}}{P}}{Q}}{R}{h}
    }
  { \jtermeq
      {{\Gamma}{\subst{x}{{f}{Q}}}}
      {\subst{x}{{f}{R}}}
      {\subst{x}{{f}{h}}}
      {\subst{{x}{f}}{{x}{h}}}
    }
  \label{comp-ss-t}
\end{align}

\paragraph{Weakenings of fibers}
\label{comp-ws}
We already have rules for the compatibility of substitution with weakening, but
we still need the rules the other way around, asserting that there is a 
judgmental equality $\ctxwk{A}{\subst{y}{Q}}\jdeq\subst{\ctxwk{A}{y}}{\ctxwk{A}{Q}}$
together with all its variants.

In the following inference rules we assume that $\jfam{\Gamma}{A}$ and that
$\jterm{\Gamma}{B}{y}$.
\begin{align}
& \inference
  { \jfam{{{\Gamma}{B}}{Q}}{R}
    }
  { \jfameq
      {{{\Gamma}{A}}{\ctxwk{A}{\subst{y}{Q}}}}
      {\ctxwk{A}{\subst{y}{R}}}
      {\subst{\ctxwk{A}{y}}{\ctxwk{A}{R}}}
    }
  \label{comp-ws-f}\\
& \inference
  { \jterm{{{\Gamma}{B}}{Q}}{R}{h}
    }
  { \jtermeq
      {{{\Gamma}{A}}{\ctxwk{A}{\subst{y}{Q}}}}
      {\ctxwk{A}{\subst{y}{R}}}
      {\ctxwk{A}{\subst{y}{h}}}
      {\subst{\ctxwk{A}{y}}{\ctxwk{A}{h}}}
    }
  \label{comp-ws-t}
\end{align}

\subsubsection{Identity terms}
\label{identityterms}
Last, but not least, we introduce the identity terms. In combination with
weakening and substitution, identity terms will allow us to speak of projections,
of a variant of extension for terms and of fiber inclusions.
The following
inference rules are required to be valid:
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \unfoldall{\jhom{\Gamma}{A}{A}{\idtm{A}}}
    }
& & \inference
    { \jfameq{\Gamma}{A}{A'}
      }
    { \unfoldall{\jhomeq{\Gamma}{A}{A}{\idtm{A}}{\idtm{A'}}}
      }
\end{align}

\begin{comment}
We stress again
that because we have not required there to be an empty context, we need to
explicitly call for identity terms $\idtm{\Gamma}$ of $\ctxwk{\Gamma}{\Gamma}$
in context $\Gamma$ for each context $\Gamma$. Thus, we will also require
the inference rule
\begin{align}
& \inference
  { \jctx{\Gamma}
    }
  { \jterm{\Gamma}{\ctxwk{\Gamma}{\Gamma}}{\idtm{\Gamma}}
    }
& &
  \inference
  { \jctxeq{\Gamma}{\Gamma'}
    }
  { \jtermeq{\Gamma}{\ctxwk{\Gamma}{\Gamma}}{\idtm{\Gamma}}{\idtm{\Gamma'}}
    }
\end{align}
For the following inference rules, there should also be versions of identity
terms at contexts.
\end{comment}

\paragraph{The identity term of an extended family}
The fact that identity terms are compatible with extensions is derived in
\autoref{comp-ie}.

\paragraph{The identity term of a weakened family}
\label{comp-wi}
The identity term of a weakened family is the weakened identity term:
\begin{equation}
\inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    }
  { \unfoldall{\jhomeq
      {{\Gamma}{A}}
      {\ctxwk{A}{B}}
      {\ctxwk{A}{B}}
      {\ctxwk{A}{\idtm{B}}}
      {\idtm{\ctxwk{A}{B}}}
    }}
  \label{comp-wi-t}
\end{equation}

\paragraph{The identity term of a substituted family}
\label{comp-si}
The identity term of a substituted family is the substitution of the identity term
\begin{equation}
\inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{\Gamma}{A}}{P}
    }
  { \unfoldall{\jhomeq
      {\Gamma}
      {\subst{x}{P}}
      {\subst{x}{P}}
      {\subst{x}{\idtm{P}}}
      {\idtm{\subst{x}{P}}}
    }}
  \label{comp-si-t}
\end{equation}

\subsection{Further judgmental equalities of the theory of contexts, families and
terms}
We have already seen that empty families, extension, weakening, substitution
and the identity terms are compatible with each other. There are, however, a
few more judgmental equalities explaining what happens when
\begin{enumerate}
\item something is weakend by the empty family. This is used to consider a term
      $x$ of $A$ in context $\Gamma$ as a morphism from $\emptyf$ to $A$ in
      context $\Gamma$;
\item something is substituted by the term of the empty family;
\item something is weakened by an extended family. This is Currying for weakening;
\item something is first weakened by a family $A$ in context $\Gamma$ and then
      substituted by a term of $A$. This is used to show that composition is
      compatible with itself (i.e. that composition is associative);
\item the identity terms are joining the party. Identity terms are empty contexts
      in certain models, so they should behave accordingly.
\end{enumerate}
In other words, the rules seem to not fit in the scheme that all operations are
compatible with each other, but in fact each of these rules plays a role in
completing the scheme (work out further).

\begin{comment}
In this section we extend the judgmental equality relation in such a way that
the empty context, extension, weakening, substitution and the identity terms
all become compatible with each other. Since we have five operations, there
are going to be $25$ finite sets of rules explaining how each operation is
compatible with each of the operations.

In addition to these $25$ finite sets
of compatibility rules, there are also two sets of rules explaining the
cancellation properties of weakening and substitution and of the identity terms.

A typical compatibility axiom captures the idea that a diagram like
\begin{equation*}
\begin{tikzcd}[column sep=huge]
\jfam{\Gamma}{\blank} 
  \ar{r}{C\mapsto\ctxwk{B}{C}} 
  \ar{d}[swap]{C\mapsto\ctxwk{A}{C}} 
& \jfam{{\Gamma}{B}}{\blank} 
  \ar{d}{Q\mapsto\ctxwk{A}{Q}}
  \\
\jfam{{\Gamma}{A}}{\blank} 
  \ar{r}[swap]{P\mapsto\ctxwk{{A}{B}}{P}} 
& \jfam{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\blank}
\end{tikzcd}
\end{equation*}
in the case of two consecutive weakenings, or
\begin{equation*}
\begin{tikzcd}[column sep=huge]
\jfam{{\Gamma}{A}}{\blank} 
  \ar{d}[swap]{Q\mapsto\subst{x}{Q}} 
  \ar{r}{Q\mapsto\ctxwk{P}{Q}} 
& \jfam{{{\Gamma}{A}}{P}}{\blank} 
    \ar{d}{R\mapsto\subst{x}{R}}
  \\ 
\jfam{\Gamma}{\blank} 
  \ar{r}[swap]{B\mapsto\ctxwk{\subst{x}{P}}{B}} 
& \jfam{{\Gamma}{\subst{x}{P}}}{\blank}
\end{tikzcd}
\end{equation*}
in the case of a combination of weakening and substitution, commutes. We won't
actually draw any of these diagrams in this section, but readers are encouraged
to do so if they think it can help them understanding the axioms. Another thing
one could keep in mind with the axioms that involve weakening is that all of
them become completely obvious when weakening is made notationally invisible.
Of course, we have an explicit notation for weakening on purpuse, but it is the
usual practice of type theorists to make weakening invisible.

The table below indicates where
we can find the axioms of each of the combinations of operators. The reference
at the row of operation $X$ and the column of operation $Y$ refers to the
axiom which explains $Y$ distributes over the arguments of $X$ when $Y$ is
applied after $X$. The empty context has no arguments, whereas extension,
and weakening have two arguments which are both of the family-kind, substitution
has two arguments of which one is a term and the other is a family and
idenitity terms have one argument, a family.
\begin{center}
\begin{tabular}{r|rrrr}
& ext & wk & subst & id\\
\hline
extension & \autoref{comp-ee}* &  & \cmark & \cmark \\
weakening & \autoref{comp-we}* & \autoref{comp-ww} & \autoref{comp-sw} & \autoref{comp-wi} \\
substitution & \autoref{comp-se}* & \autoref{comp-ws} & \autoref{comp-ss} & \autoref{comp-si} \\
identity terms & \cmark & \autoref{comp-wi} & \autoref{comp-si} & \xmark
\end{tabular}
\end{center}
Apart from references to sections where axioms are given, we also see checkmarks,
crosses, marked references and duplicated references in this table. 
The checkmarks indicate that the desired property
can be proved and need not be axiomatized. To clarify those:
\begin{itemize}
\item The identity term of the empty context is the unique term of the empty
family. Recall that we already have axiomatized in \autoref{empty} that every
term of the empty family is judgmentally equal to $\emptytm$.
\item The identity term of an extension can be explained by means of the notion
of \emph{extension on terms}. This notion is defined in \autoref{extension-on-terms}
using only identity terms and substitution. With extension on terms we can
combine a term $\jterm{\Gamma}{A}{x}$ and a term $\jterm{\Gamma}{\subst{x}{P}}{u}$
into a term $\jterm{\Gamma}{{A}{P}}{\tmext{x}{u}}$, which may be seen as the
pair consisting of $x$ and $u$. Since it is a defined notion, we will
be able to derive lots of properties for extension of terms. One of them explains
how we can see the identity term of an extension as the extension of two certain
terms, see \autoref{comp-ie}.
\item Using extension on terms we can also make sense of `fibers at an extension'
because that would exactly be the fiber at an extended term. We will see in
\autoref{comp-es} that, for instance, $\subst{\tmext{x}{u}}{Q}\jdeq\subst{u}{{x}{Q}}$
for any family $\jfam{{{\Gamma}{A}}{P}}{Q}$ and any two terms $\jterm{\Gamma}{A}{x}$
and $\jterm{\Gamma}{\subst{x}{P}}{u}$. That's a form of currying.
\end{itemize}
The spots with a \xmark simply make no sense 
{\color{red}(or do they, when the term model
is better understood (by me)?)}. The marked references point to
axioms which \emph{do} have a variant for terms, but those require the notion
of extension on terms, can be proved and therefore need not be included in our
list of compatibility axioms. In each of these sections, we give a forward
reference to the lemma in which this variant is stated and proved.
\end{comment}

\subsubsection{Weakening by the empty family}
Note that we can also weaken by the empty family over $\Gamma$.
Weakening by the empty family $\emptyf$ over a context $\Gamma$ leaves families, 
their terms, families over those families and terms of those unchanged:
\label{comp-0w}
\begin{align}
& \inference
  { \jfam{\Gamma}{B}
    }
  { \jfameq{\Gamma}{\ctxwk{\emptyf}{B}}{B}
    }
  \label{comp-0w-c}
  \\
& \inference
  { \jfam{{\Gamma}{B}}{Q}
    }
  { \jfameq{{\Gamma}{B}}{\ctxwk{\emptyf}{Q}}{Q}
    }
  \label{comp-0w-f}
  \\
& \inference
  { \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jtermeq{{\Gamma}{B}}{Q}{\ctxwk{\emptyf}{g}}{g}
    }
  \label{comp-0w-t}
\end{align}

\begin{comment}
\subsubsection{Substituting by the term of the empty family}
\label{comp-0s}
The following rules assert that substituting by the term $\jterm{\Gamma}{\emptyf}{\emptytm}$
leaves everything unchanged.
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{\subst{\emptytm}{A}}{A}
    }
  \label{comp-0s-c}
  \\
%& \inference
%  { \jterm{\Gamma}{A}{x}
%    }
%  { \jtermeq{\Gamma}{A}{\subst{\emptytm}{x}}{x}
%    }
%  \\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq{{\Gamma}{A}}{\subst{\emptytm}{P}}{P}
    }
  \label{comp-0s-f}
  \\
& \inference
  { \jterm{{\Gamma}{A}}{P}{f}
    }
  { \jtermeq{{\Gamma}{A}}{P}{\subst{\emptytm}{f}}{f}
    }.
  \label{comp-0s-t}
\end{align}
\end{comment}

\subsubsection{Currying for weakening}
\label{comp-ew}
The rules expressing that extension is compatible with weakening assert that
weakening by an extension is the same thing as weakening twice in the
appropriate way.
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{A}}{P}
    \jfam{{\Gamma}{B}}{Q}
    }
  { \jfameq
      {{{{\Gamma}{A}}{P}}{\ctxwk{P}{{A}{B}}}}
      {\ctxwk{\ctxext{A}{P}}{Q}}
      {\ctxwk{P}{{A}{Q}}}
    }
  \label{comp-ew-f}\\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{A}}{P}
    \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jtermeq
      {{{{\Gamma}{A}}{P}}{\ctxwk{P}{{A}{B}}}}
      {\ctxwk{P}{{A}{Q}}}
      {\ctxwk{\ctxext{A}{P}}{g}}
      {\ctxwk{P}{{A}{g}}}
    } 
  \label{comp-ew-t}
\end{align}

\subsubsection{The cancellation property of weakening and substitution}
\label{cancellation-ws}
The judgmental equalities we're about to describe assert that substituting a term
in the weakening a thing gives you the thing back. In the case of contexts we get that each fiber
$\subst{x}{\ctxwk{A}{B}}$ is just $B$ and in the case of terms we get 
that $\ctxwk{A}{y}$ is the constant function
mapping everything to $y:B$. Thus, these rules actually establish the weakening
as the weakening. After stating the rules we will describe what it means to
compose context morphisms (terms of weakened contexts).
\begin{align}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{\Gamma}{B}}{Q}
    \jterm{\Gamma}{A}{x}
    }
  { \jfameq{{\Gamma}{B}}{\subst{x}{\ctxwk{A}{Q}}}{Q}
    }
  \label{cancellation-ws-f}\\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jterm{{\Gamma}{B}}{Q}{g}
    }
  { \jtermeq{{\Gamma}{B}}{Q}{\subst{x}{\ctxwk{A}{g}}}{g}
    }
  \label{cancellation-ws-t}
\end{align}

\subsubsection{The cancellation properties of identity terms}
\label{cancellation-i}
Identity terms are determined by their behavior with respect to substitution combined with
weakening. The identity terms will also be subject to compatibility rules.
\begin{align}
& \inference
  { \jterm{\Gamma}{A}{x}
    }
  { \jtermeq{\Gamma}{A}{\subst{x}{\idtm{A}}}{x}
    }
  \label{cancellation-si}\\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq{{\Gamma}{A}}{\subst{\idtm{A}}{\ctxwk{A}{P}}}{P}
    }
  \label{idfunc-wk-defn}\\
%An unnecessary rule:
%& \inference
%  { \jfam{{\Gamma}{A}}{P}
%    }
%  { \jfameq
%      {{\Gamma}{A}}
%      {\subst{\idtm{A}}{\ctxwk{{A}{A}}{P}}}
%      {P}
%    }
%  \label{idfunc-wk-defn2}\\
& \inference
  { \jterm{{\Gamma}{A}}{P}{f}
    }
  { \jtermeq
      {{\Gamma}{A}}
      {P}
      {\subst{\idtm{A}}{\ctxwk{A}{f}}}
      {f}
    }
  \label{idfunc-precomp}\\
%An unnecessary rule:
%& \inference
%  { \jterm{{\Gamma}{A}}{P}{f}
%    }
%  { \jtermeq
%      {{\Gamma}{A}}
%      {P}
%      {\subst{\idtm{A}}{\ctxwk{{A}{A}}{f}}}
%      {f}
%    }
%  \label{idfunc-precomp}\\
& \inference
  { \unfoldall{\jhom{\Gamma}{A}{B}{f}}
    }
  { \unfoldall{\jhomeq{\Gamma}{A}{B}{\jcomp{A}{f}{\idtm{B}}}{f}}
    }
  \label{idfunc-postcomp}
\end{align}

\subsection{The possiblity of types in the theory of contexts, families and
terms}
\label{types}
We have deliberately not spoken of types so far because we have taken the point
of view that a type in a context is nothing but a family in that context which
belongs to the class of types. We think of types as \emph{irreducible} families,
i.e.\ families which are neither empty nor the extension of two
families which are both not empty (in algebraic terminology: which
are both non-trivial). To allow ourselves to speak of types we introduce two
new judgments: the judgment that something is a type and the judgment that two
types are equal.
\begin{align*}
\jtype*{\Gamma}{A} 
& \jtypeeq*{\Gamma}{A}{B}
\end{align*}
But only families of contexts are eligible to be types. If $A$ is a type
in context $\Gamma$, then $A$ is also a family of contexts over $\Gamma$. 
Moreover, two types in context $\Gamma$ are judgmentally equal precisely when they are equal
as context families and if a family $B$ of contexts over $\Gamma$ is
judgmentally equal to a type $A$ in context $\Gamma$, then $B$ is a type in
context $\Gamma$. This is expressed by the following four inference rules:
\begin{align*}
& \inference
  { \jtype{\Gamma}{A}
    }
  { \jfam{\Gamma}{A}
    }
& & \inference
    { \jtypeeq{\Gamma}{A}{B}
      }
    { \jfameq{\Gamma}{A}{B}
      }
    \\
& \inference
  { \jtype{\Gamma}{A}
    \jfameq{\Gamma}{A}{B}
    }
  { \jtype{\Gamma}{B}
    }
& & \inference
    { \jtype{\Gamma}{A}
      \jfameq{\Gamma}{A}{B}
      }
    { \jtypeeq{\Gamma}{A}{B}
      }
\end{align*}
As pointed out at the beginning of this subsection, 
we do not assume that the empty family is a type, that would be like
assuming that the multiplicative unit of a ring is prime. We envision a
categorical interpretation of the theory of contexts, families and terms where 
contexts are interpreted as finite paths of arrows belonging to a predetermined
class. The empty family would be such a path of length $0$ whereas the types
would be such paths of length $1$.

We add rules asserting that a weakened type is again a type that 
substitution preserves the property of being a type:
\begin{align}
& \inference
  { \jfam{\Gamma}{B}
    \jtype{\ctxext{\Gamma}{B}}{Q}
    }
  { \jtype{\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{Q}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jtype{\ctxext{{\Gamma}{A}}{P}}{Q}
    }
  { \jtype{\ctxext{\Gamma}{\subst{x}{P}}}{\subst{x}{Q}}
    }
\end{align}
With only the current rules, the possibility of making the judgment that
something is a type does not add much to the theory of contexts, families and
terms. Nevertheless, when studying models, having an interpretation for the
judgment that something is a type will allow for the possibility to study
conditions such as the one asserting that every family `factorizes' uniquely
as multiple applications of extension to types, analogous to the condition on
unique factorization domains in ring theory. All the tradional models of type
theory should translate to models with such a condition, simply because
traditionally contexts are viewed as lists of variable (and type) declarations.
