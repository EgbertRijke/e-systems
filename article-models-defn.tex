\section{Internal models of type theory}
\subsection{Models of type theory without basic constructors}\label{internal-model-contexts}
\begin{defn}\label{defn:premodel}
An internal model $\mfM$ of type theory consists of the following data. 
\begin{enumerate}
\item A type $\tfctx(\mfM)$ of \emph{contexts}.
\item A function $\mftypfunc{\mfM}$ assigning to each context $\Gamma$ of $\mfM$ an internal model
$\mftyp{\mfM}{\Gamma}$ of type theory.
\begin{defn}
The type $\tfctx(\mftyp{\mfM}{\Gamma})$ is denoted by $\mftyp{\mfM}{\Gamma}$. A
term of $\mftyp{\mfM}{\Gamma}$ is called a \emph{type in context $\Gamma$}. To indicate
that $A$ is a type in context $\Gamma$ we also write $\Gamma\vdash A:\mfM$. 
When $P:\mftyp{\mftyp{\mfM}{\Gamma}}{A}$ for some type $A$ in context $\Gamma$, we
also speak of \emph{a family $P$ over $A$ in context $\Gamma$.}
\end{defn}
\item A family $\terms{\blank}:\prd*{\Gamma:\ctx(\mfM)}\mftyp{\mfM}{\Gamma}\to\type$
assigning to every type $A$ in context $\Gamma$ the type $\terms{A}$ of its
terms.
\begin{defn}
When $A$ is a type in context $\Gamma$, we define $\Gamma\vdash x:A$ 
to mean $x:\terms{A}$.
\end{defn}
\item Context extension: a morphism
\begin{equation*}
\tfext^\Gamma:\mftyp{\mfM}{\Gamma}\to\mfM
\end{equation*}
of internal models for every context $\Gamma$.
\begin{defn}
When $A$ is a type in context $\Gamma$, we also denote
the context $\tfext^\Gamma_0(A)$ of $\mfM$ by $\ctxext{\Gamma}{A}$.
We will write
$\ctxext{{\Gamma}{A}}{P}$ for $\ctxext{{\Gamma}{A}}{P}$.
\end{defn}
\item The judgmental equalities:
\begin{align*}
\mftyp{\mftyp{\mfM}{\Gamma}}{A} & \jdeq\mftyp{\mfM}{\ctxext{\Gamma}{A}}\\
\mftyp{\tfext^\Gamma}{A} & \jdeq \modelfont{id}_{\mftyp{\mfM}{\ctxext{\Gamma}{A}}}\\
\terms[{\tfext^\Gamma}]{P} & \jdeq \idfunc[\terms{P}].
\end{align*}
\begin{rmk}
In particular, we will have the judgmental equalities:
\begin{enumerate}
\item When $A$ is a type in context $\Gamma$ we have
\begin{equation*}
\mftyp{\mftyp{\mfM}{\Gamma}}{A}\jdeq\mftyp{\mfM}{\ctxext{\Gamma}{A}},
\end{equation*}
ensuring that a context in the model $\mftyp{\mftyp{\mfM}{\Gamma}}{A}$ is the same thing as a
context in the model $\mftyp{\mfM}{\ctxext{\Gamma}{A}}$.
\item If $Q$ is a family over $P$ where $P$ is a family over $A$ in context $\Gamma$, then
\begin{equation*}
\tfext^{\protect{\mftyp{\mftyp{\mfM}{\Gamma}}{A}}}(P,Q)
\jdeq
\tfext^{\protect{\mftyp{\mfM}{\ctxext{\Gamma}{A}}}}(P,Q)
\end{equation*}
ensuring that twe two possible notion of context extension are the same.
\end{enumerate}
Other judgmental equalities will be required with the ingredients that follow.
We will not list them all.
\end{rmk}
\item Weakening: a morphism
\begin{equation*}
\tfwk^A:\mftyp{\mfM}{\Gamma}\to\mftyp{\mfM}{\ctxext{\Gamma}{A}}
\end{equation*}
of internal models for every type $A$ in context $\Gamma$. When $B$ is a type
in context $\Gamma$, we denote $\tfwk^A(B)$ by $\ctxwk{A}{B}$. 
\item Substitution: a morphism
\begin{equation*}
\tfsubst^x:\mftyp{\mfM}{\ctxext{\Gamma}{A}}\to\mftyp{\mfM}{\Gamma}
\end{equation*}
of internal models for any $x:A$ in context $\Gamma$. When $P$ is a family over $A$ in context
$\Gamma$, we denote $\tfsubst^x(P)$ also by $\subst{x}{P}$. 
\item A judgmental equality
\begin{equation*}
\tfsubst^x\circ\tfwk^A\jdeq\modelfont{id}_{\mftyp{\mfM}{\Gamma}}
\end{equation*}
for any $x:A$ and $B$ in context $\Gamma$.
\item A context $\unit^\mfM:\tfctx(\mfM)$ and a term of type $\isequiv(\ctxext{\unit^\mfM}{\blank})$. We will denote
this equivalence by $e_\unit$. The context $\unit^\mfM$ is also
called the \emph{empty context}.
\begin{defn}
For any context $\Gamma$, type $\terms{\Gamma}$ is defined to mean
$\terms{e_\unit^{-1}(\Gamma)}$. 
\end{defn}
\item A section $\unit^{\blank}:\prd{\Gamma:\ctx(\mfM)}\mftyp{\mfM}{\Gamma}$ assigning
a type $\unit^\Gamma$ in context $\Gamma$ to every context $\Gamma$ and
an identification $\alpha_\unit(\Gamma):\id{\ctxext{\Gamma}{\unit^\Gamma}}{\Gamma}$
for every context $\Gamma$. We also require that there is an identification
$\id{\trans{\alpha_\unit(\Gamma)}{\ctxwk{\unit^\Gamma}{A}}}{A}$ for every
type $A$ in context $\Gamma$.
\item For any type $A$ in context $\Gamma$, a term $\idfunc[A]:\terms{\ctxwk{A}{A}}$
\end{enumerate}
\begin{flushright}
\textsl{End of \autoref{defn:premodel}.}
\end{flushright}
\end{defn}

\begin{defn}
In an internal model $\mfM$ we define
\begin{equation*}
\ctxhom{\Delta}{\Gamma}\defeq \terms{\ctxwk{e_\unit^{-1}(\Delta)}{e_\unit^{-1}(\Gamma)}}
\end{equation*}
\end{defn}

\subsection{Morphisms of internal models}
\begin{defn}\label{defn:premodel-morphism}
A morphism $f:\mfM\to \mfN$ of internal models consists of
\begin{enumerate}
\item a function $\ctx(f):\ctx(\mfM)\to\ctx(\mfN)$. The function $\ctx(f)$ is also
denoted by $f_0$.
\item a morphism $\mftyp{f}{\Gamma}:\mftyp{\mfM}{\Gamma}\to\mftyp{\mfN}{f_0(\Gamma)}$ of internal models for every
$\Gamma:\ctx(M)$.
\item the judgmental equality
\begin{equation*}
\mftyp{\mftyp{f}{\Gamma}}{A}\jdeq\mftyp{f}{\ctxext{\Gamma}{A}}
\end{equation*}
\item a function $\terms[f]{A}:\terms[\mfM]{A}\to\terms[\mfN]{\mftyp{f}{\Gamma}_0(A)}$ for
every type $A$ in context $\Gamma$. 
\item preservation of context extension: 
\begin{align*}
\alpha^f_0 & :\id{f\circ\tfext^\Gamma}{\tfext^{f_0(\Gamma)}\circ\mftyp{f}{\Gamma}}\\
\alpha^f_1 & :\id{\mftyp{f}{\Gamma}_0\circ\tfext^A}{\tfext^{\mftyp{f}{\Gamma}_0(A)}\circ\mftyp{f}{\ctxext{\Gamma}{A}}}.
\end{align*}
\item preservation of weakening: 
\begin{align*}
\beta^f_0 & :\id{\mftyp{f}{\Gamma}\circ\tfwk^\Gamma}{\tfwk^{f_0(\Gamma)}\circ f}\\
\beta^f_1 & :\id{\mftyp{f}{\ctxext{\Gamma}{A}}\circ\tfwk^A}{\tfwk^\protect{\mftyp{f}{\Gamma}_0(A)}\circ\mftyp{f}{\Gamma}}.
\end{align*}
\item preservation of substitution: 
\begin{equation*}
\gamma^f:\id{\mftyp{f}\Gamma_0\circ\tfsubst^x}{\tfsubst^\protect{\terms[f]{A}(x)}\circ\mftyp{f}{\ctxext{\Gamma}{A}}}.
\end{equation*}
\end{enumerate}
\begin{flushright}
\textsl{End of \autoref{defn:premodel-morphism}.}
\end{flushright}
\end{defn}

\begin{defn}
Suppose that $f:\mfM\to\mfN$ and $g:\mfN\to\mfN'$ are morphisms of internal models.
We define the composition $g\circ f:\mfM\to\mfN'$ to be the morphism given by
\begin{enumerate}
\item $(g\circ f)_0\defeq g_0\circ f_0$
\item $\mftypfunc{g\circ f}(\Gamma)\defeq\mftypfunc{g}(f_0(\Gamma))\circ\mftypfunc{f}(\Gamma)$
\item $\terms[g\circ f]{A}\defeq\terms[g]{\mftyp{f}{\Gamma}_0(A)}\circ\terms[f]{A}$.
\item a definition of $\alpha^{g\circ f}_0$ and $\alpha^{g\circ f}_1$.
\item a definition of $\beta^{g\circ f}_0$ and $\beta^{f\circ f}_1$.
\item a definition of $\gamma^{g\circ f}$. 
\end{enumerate}
\end{defn}

\begin{rmk}
The requirement that a morphism of models acts on terms is reminiscent of the requirement
that a functor acts on morphisms. In this fasion, the requirement that a morphism of
models preserves substitution is the counterpart of a functor preserving composition.
\end{rmk}
Context extension, weakening and substitution are required to be such morphims
of models. Thus they must be extended for this purpose.

\begin{description}
\item[Context extension] We will extend context extension to a morphism 
$\tfext(\Gamma):\mftyp{\mfM}{\Gamma}\to M$. Thus, we already have
$\tfext(\Gamma)_0\defeq\ctxext{\Gamma}{\blank}$. We also require 
\begin{align*}
\mftyp{\tfext(\Gamma)}{A} & : \mftyp{\mftyp{\mfM}{\Gamma}}{A}\to \mftyp{\mfM}{\ctxext{\Gamma}{A}}\\
\terms[\tfext(\Gamma)]{P} & : \terms[\mftyp{\mfM}{\Gamma}]{P}\to\terms[\mfM]{\mftyp{\tfext(\Gamma)}{A}_0(P)}
\end{align*}
For both of these we take the identity function.
We require furthermore that context extension preserves context extension,
weakening and substitution:
\begin{enumerate}
\item Extension preserves extension: for every family $P$ over $A$ in context
$\Gamma$ an identification $\id{\ctxext{{\Gamma}{A}}{P}}{\ctxext{\Gamma}{{A}{P}}}$.
\item Extension preserves weakening:
\item Extension preserves substitution:
Because context extension is the identity on the levels of types and terms,
the rules are easier.
\end{enumerate}
\item[Weakening] is a morphism $\tfwk:\mftyp{\mfM}{\Gamma}\to\mftyp{\mfM}{\ctxext{\Gamma}{A}}$, so we must have
\begin{align*}
\tfwk^A_0 & : \mftyp{\mfM}{\Gamma}\to\mftyp{\mfM}{\ctxext{\Gamma}{A}}
\intertext{which is denoted by $\ctxwk{A}{\blank}$,}
\mftypfunc{\tfwk^A} & : \mftyp{\mfM}{\ctxext{\Gamma}{B}}\to\mftyp{\mfM}{\ctxext{{\Gamma}{A}}{\ctxwk{A}{B}}}\\
\terms[\tfwk^A]{B} & : \terms[\mftyp{\mfM}{\Gamma}]{B}\to\terms[\mftyp{\mfM}{\ctxext{\Gamma}{A}}]{\ctxwk{A}{B}}
\end{align*}
for a term $y:B$, the term $\terms[{\tfwk^A}]{B}(y)$ is the constant map from
$A$ to $B$, assigning $y$ to every term of $A$.
\item[Substitution] is a morphism $\tfsubst^x:\mftyp{\mfM}{\ctxext{\Gamma}{A}}
\to\mftyp{\mfM}{\Gamma}$ for every $x:A$ in context $\Gamma$, so we must have
\begin{align*}
\tfsubst^x_0 & : \mftyp{\mfM}{\ctxext{\Gamma}{A}}\to\mftyp{\mfM}{\Gamma}
\intertext{which is denoted by $\subst{x}{\blank}$,}
\mftyp{\tfsubst^x}{P} & : \mftyp{\mfM}{\ctxext{{\Gamma}{A}}{P}}\to\mftyp{\mfM}{\ctxext{\Gamma}{\subst{x}{P}}}\\
\terms[\tfsubst^x]{P} & : \terms{P}\to\terms{\subst{x}{P}}
\end{align*}
The function $\terms[\tfsubst^x]{P}$ is usually denoted by $\tfev(\blank,x)$. 
\end{description}

\begin{comment}
\subsection{The basic type constructors in internal models}

\begin{defn}
\begin{enumerate}
\item A type $\mprd{A}{P}$ for every type $A$ in context $\Gamma$ and every type
$P$ in context $\ctxext{\Gamma}{A}$.
\begin{defn}
Suppose $A$ and $B$ are types in context $\Gamma$. We define
\begin{align*}
A\to B & \defeq\mprd{A}{\ctxwk{A}{B}}.
\intertext{For any two contexts $\Delta$ and $\Gamma$, we define}
\Delta\to\Gamma & \defeq e_\unit^{-1}(\Delta)\to e_\unit^{-1}(\Gamma)
\end{align*}
and furthermore we define $\ctxhom{\Delta}{\Gamma}\defeq\terms{\Delta\to\Gamma}$.
\end{defn}
\item An equivalence $\lambda:\eqv{\terms{P}}{\terms{\mprd{A}{P}}}$ for every
family $P$ over $A$ in context $\Gamma$. When $\ctxext{\Gamma}{A}\vdash 
u:P$, we call $\lambda(u)$ the \emph{$\lambda$-abstraction of $u$.}
\begin{rmk}
Note that we get an equivalence $\eqv{\terms{\unit^\Gamma\to A}}{\terms{A}}$ 
for every type $A$ in context $\Gamma$.
\end{rmk}
\begin{rmk}
Thus we see that $\eqv{\terms{A\to B}}{\terms{\ctxwk{A}{B}}}$
by $\lambda$-abstraction. 
\end{rmk}
%\item A function $\tfev:\terms{\mprd{A}{P}}\to\prd{x:\terms{A}}\terms{\subst{x}{P}}$.
\item A term $\pi^A:\ctxext{\Gamma}{A}\to \Gamma$ for every type $A$ in context
$\Gamma$.
\item A term $\iota^x:\ctxext{\Gamma}{\subst{x}{P}}\to\ctxext{{\Gamma}{A}}{P}$
for every family $P$ of types over $A$ in context $\Gamma$ and every
term $x:A$.
\item A type $A[f]$ in context $\Delta$ for every $f:\ctxhom{\Delta}{\Gamma}$ 
and every type $A$ in context $\Gamma$. {\color{blue}Could this be defined
in terms of the substitution $\subst{x}{P}$ we already have? It seems so. If this is
indeed the case we need either some identifications or we could just omit
this part of the definition.}
\item an identification $\id{B[\pi^A]}{\ctxwk{A}{B}}$ for any two types $A$
and $B$ in context $\Gamma$.
\item A type $\msm{A}{P}$ in context $\Gamma$ for every family $P$ over $A$
in context $\Gamma$, with an equivalence $\pairr{\blank,\blank}:\eqv{\sm{x:\terms{A}}\terms{\subst{x}{P}}}
{\terms{\msm{A}{P}}}$.
\item A family $\idtypevar{A}$ over $\ctxwk{A}{A}$ in context $\ctxext{\Gamma}{A}$ for
every type $A$ in context $\Gamma$ and a term of type.
\begin{rmk}
If $A$ and $B$ are types in context $\Gamma$, we may denote the type 
$\msm{A}{\ctxwk{A}{B}}$ by $A\times B$. By the end of the current definition
there will be an identification $\id{\ctxext{{\Gamma}{A}}{P}}
{\ctxext{\Gamma}{\msm{A}{P}}}$.

There is a term $\delta:\ctxhom{\ctxext{\Gamma}{A}}{\ctxext{{\Gamma}{A}}{\ctxwk{A}{A}}}$
defined by...
\end{rmk}
\item For any family $Q$ over $\idtypevar{A}$ in context $\ctxext{{\Gamma}{A}}{\ctxwk{A}{A}}$ an equivalence
$J:\eqv{\terms{Q}}{}$
\end{enumerate}
\end{defn}

\begingroup
\color{blue}
\subsubsection*{More desiderata}
Some of which hopefully follow from more elegant or general rules, but
this list is to keep them in mind:
\begin{enumerate}
\item $\id{e_\unit^{-1}(\Gamma.A)}{\msm{e_\unit^{-1}(\Gamma)}{\trans{(\eta_\Gamma)}{A}}}$, where
$\eta_\Gamma:\id{\Gamma}{e_\unit(e_\unit^{-1}(\Gamma))}$ is the unit of the
equivalence $e_\unit$.  
\item $\id{(\msm{A}{P}\to B)}{(P\to \ctxwk{A}{B})}$, expressing that $\Sigma$ is
left adjoint to weakening.
\item $\id{(\ctxwk{A}{B}\to P)}{(B\to\mprd{A}{P})}$ expressing that $\Pi$ is
right adjoint to weakening.
\item a term $\Gamma\vdash\idfunc[A]:A\to A$ for every type $A$ in context $\Gamma$.
\item a context $\UU$ for the universe.
\item an identification $\id{\pi^A\circ \pi^P\circ\iota^x}{\pi^{\subst{x}{P}}}$ for every
family $P$ of types over $A$ in context $\Gamma$ and every term $x:A$. In other
words, the diagram
\begin{equation*}
\begin{tikzcd}
\ctxext{{\Gamma}{A}}{P} \ar{r}{\pi^P} & \ctxext{\Gamma}{A} \ar{d}{\pi^A}\\
\ctxext{\Gamma}{\subst{x}{P}} \ar{u}{\iota^x} \ar{r}[swap]{\pi^{\subst{x}{P}}} & \Gamma
\end{tikzcd}
\end{equation*}
should commute.
\end{enumerate}
\endgroup

\begin{desiderata}
We should have a theorem stating that our internal model indeed interprets
the rules of type theory.
\end{desiderata}
\end{comment}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{comment}
\section{Weak $\omega$-groupoids}

\subsection{Trivial cofibrations and weak equivalences of types}
We describe a relation between types that expresses when they are weakly equivalent.
Weak equivalence is introduced because we need a weaker notion of judgmental 
equality which also makes sense when identity types are not present, since that
would allow us to state that context extension, weakening and substitution
commute with each other.

A term $f:\ctxwk{A}{B}$ is a trivial cofibration if it has the
property that for any fibration $Q$ over $B$,
to find a section of $Q$ it suffices to find a section of the fibration
$f^\ast Q$ over $A$. In our type theoretical setting, the rôle of fibrations
is played by families, the rôle of the function type $A\to B$ is played by
$\ctxwk{A}{B}$ and our version of the pullback $f^\ast Q$ is $\subst{f}{\ctxwk{A}{Q}}$.

\begin{defn}
Let $f$ be a term of $\ctxwk{A}{B}$ in context $\Gamma$.
\begin{enumerate}
\item For a family $Q$ over $B$ in context $\Gamma$ we define $f^\ast Q\jdeq\subst{f}{\ctxwk{A}{Q}}$.
\item For a term $g$ of $Q$ in context $\ctxext{\Gamma}{B}$ we define $f^\ast g\jdeq\subst{f}{\ctxwk{A}{g}}$.
\end{enumerate} 
\end{defn}
\begin{rmk}
The type $f^\ast(\ctxwk{B}{C})$ in context $\ctxext{\Gamma}{A}$ is can be viewed as the
type of functions from $A$ to $C$ which factor through $f$. Thus there should be
a function from $f^\ast(\ctxwk{B}{C})$ to $\ctxwk{A}{C}$.
\end{rmk}

\begin{rmk}
Every term $\jterm{\ctxext{\Gamma}{A}}{\ctxwk{A}{B}}{f}$ allows us to infer the following:
\begin{equation*}
\inference{\jtype{\ctxext{\Gamma}{B}}{Q}}{\jtype{\ctxext{\Gamma}{A}}{f^\ast Q}}
\qquad
\inference{\jterm{\ctxext{\Gamma}{B}}{Q}{g}}{\jterm{\ctxext{\Gamma}{A}}{f^\ast Q}{f^\ast g}}
\end{equation*}
\end{rmk}


\begin{defn}
A term $f:\ctxwk{A}{B}$ in context $\ctxext{\Gamma}{A}$ is said to be a trivial
cofibration if we can infer
\begin{equation*}
\inference{\jterm{\ctxext{\Gamma}{A}}{f^\ast Q}{t}}{\jterm{\ctxext{\Gamma}{B}}{Q}{\tilde{t}}}\qquad
\inference{\jterm{\ctxext{\Gamma}{A}}{f^\ast Q}{t}}{\jtermeq{\ctxext{\Gamma}{A}}{f^\ast Q}{f^\ast \tilde{t}}{t}}
\end{equation*}
{\color{red}This statement should be reformulated so that it only involves a single judgment...
but I don't see directly how to do that.}
\end{defn}

We have the following theorem in the type theory of \cite{TheBook}, which supports
our claim that we may indeed speak of a trivial cofibration. 

\begin{thm}
Suppose $f:A\to B$ is a function. Then $f$ is an equivalence if and only if
for every $Q:B\to\type$ and every $g:\prd{x:A}Q(f(x))$ there is a section
$h:\prd{y:B}Q(b)$ with the property that $h\circ f\htpy g$. 
\end{thm}

\begin{proof}
We can first take $Q$ to be the constant family $\lam{y}A$. Furthermore, we may
take $g\defeq\idfunc[A]$. Then we get a term of type
\begin{equation*}
\sm{h:B\to A}h\circ f\htpy \idfunc[A],
\end{equation*}
i.e.~we get a left inverse $h$ for $f$. To show that $h$ is also a right inverse
of $f$, let $Q$ be the family $\lam{y}\id{f(h(y))}{y}$. To find a section of
$Q$, which is the homotopy we aim for, it suffices to find a section of
$Q\circ f$. In other words, we have to show that $\id{f(h(f(x)))}{f(x)}$ for
every $x:A$. This follows from the fact that $h$ is a left inverse for $f$.

The reverse direction is immediate.
\end{proof}

Another approach would be to define $f:\ctxwk{A}{B}$ to be left invertible
if there is a term $\ctxext{{\Gamma}{A}}{P}$

\subsection{Some possibilities}

A weak omega groupoid is a model of type theory with $\Sigma$ and $\idtypevar{}$
in which there is a term of $\terms{A}$ for every type $A$ in context $\Gamma$.
This should work when univalence is around (so that functions can be replaced
by families).

We could also state that for every term $f:\terms{\ctxwk{A}{B}}$ and every
family $Q:\tftyp{\mfM}{\ctxext{\Gamma}{B}}$ there is a function
$\terms{\subst{f}{\ctxwk{A}{Q}}}\to\terms{Q}$ (asserting that $f$ is a trival
cofibration). This should always give that each $f$ is an equivalence and
this should be equivalent to the previous condition when univalence is around.

Another option arises when we see the identity type as an operation on a certain class of
terms. Usually, $\idtypevar{}$ is defined using the class of identity functions.
Let's take the class of all terms instead:
\end{comment}
