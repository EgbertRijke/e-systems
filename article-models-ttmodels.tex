\section{The type theory of models of type theory}
In this section we pursue the idea of what a general model of type theory is by
axiomatizing what you can do with them. We have the following ideas:
\begin{itemize}
\item There are dependent models and sections thereof. Particular instances
  of sections: extension, weakening and substitution (and something for identity
  function?). And like the original
  extension, weakening and substitution, they're going to be compatible with each
  other. Therefore we state our theory of models as an extension of type theory
  without constructors.
\item Type theory without constructors is a model of itself, the canonical model $\mctx$.
\item for any (family of) model(s) $A$, there is the family model $\mfam{A}$ which
  is a family of models over $A$.
\item The terms of $\mctx$ should be precisely contexts. Terms of $\subst{\Gamma}{\mfam{\mctx}}$
  should be families over $\Gamma$.
\item if a model and a family of models over it are given, there is an extended model.
  If we extend $A$ by $\mfam{A}$, we get the Sierpinski model of $A$.
\item Likewise, models can be weakened and substituted and there are identity
  functions.
\item So the theory of models is going to be an extension of this theory with this
  data. The theory we are about to describe can be seen as an elementary theory
  of the category (with families (and terms)) of categories (with families (and terms)).
\item We would also like to remark explicitly that the valid judgments of the original type
  theory become contexts, families or terms, depending on what kind of judgments
  it was. Then, valid inferences of the original type theory become valid
  judgments here. In some sense, the theory we present here is therefore a second
  order theory over the basic theory of types.
\item Martin Escardo and Mike Shulman have been promoting the use of 
  inductive-inductive definitions for internal models. What we're doing here looks
  different, because we're writing down a type theory for internal models, but it
  might not be that different at all. The type theory can be seen as the theory
  of (dependent) algebras over the inductive-inductively defined model and the
  terms of this type theory are the (dependent) algebra homomorphisms. The
  asserted initial object of our type theory is the inductive-inductively defined
  type. 
\end{itemize}

\subsection{The basic ingredients of the type theory of models}
We first introduce the basic ingredients of our abstract theory of models.
\begin{align*}
& \inference
  { }
  { \jctx{\mctx}
    }
  \tag{the canonical model}\\
& \inference
  { \jfam{\mctx}{P}
    }
  { \jterm{\mctx}{P}{i}
    }
  \tag{initiality of $\mctx$}\\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfam{{\Gamma}{A}}{\mfam{A}}
    }
  \tag{families}\\
& \inference
  { \jctx{\Gamma}
    }
  { \jfam{{\Gamma}{\mfam{\Gamma}}}{\mtm{\Gamma}}
    }
  \tag{terms}
\intertext{%
  The following two rules essentially make a start with saying that every term is functorial
  in the apropriate sense (there will be more rules contributing to this vies):}
& \inference
  { \jterm{{\Gamma}{A}}{P}{f}
    }
  { \jhom
      {{\Gamma}{A}}
      {\mfam{A}}
      {\subst{f}{\mfam{P}}}
      {\mfam{f}}
    }
  \\
& \inference
  { \jterm{{\Gamma}{A}}{P}{f}
    }
  { \jfhom
      {{\Gamma}{A}}
      {\mfam{A}}
      {\subst{f}{\mfam{P}}}
      {\mfam{f}}
      {\mtm{A}}
      {\subst{f}{\mtm{P}}}
      {\mtm{f}}
    }
\intertext{%
  When the situation requires clarity --  for instance when extensions
  are involved -- we will write $\mfam{f}^\Gamma$ and $\mtm{f}^\Gamma$ to make
  what we regard as the context explicit.}
\intertext{%
The empty context of a model $A$ is simply a term of $A$:}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jterm{\Gamma}{A}{\tfemp{A}}
    }
  \tag{empty context}\\
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jterm{{{\Gamma}{A}}{\mfam{A}}}{\subst{\tfemp{\mfam{A}}}{\mtm{A}}}{\tft{A}}
    }
\intertext{%
  Extension is going to be a morphism from $\ctxext{A}{\mfam{A}}$ to
  $A$ in context $\Gamma$:}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jhom{\Gamma}{{A}{\mfam{A}}}{A}{\tfext{A}}
    }
  \tag{extension}
\intertext{%
  The action of weakening on families
  is a morphism from $\ctxwk{\mfam{A}}{\mfam{A}}$ to
  $\mfam{\mfam{A}}$ in context $\ctxext{{\Gamma}{A}}{\mfam{A}}$:}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jhom
      {{{\Gamma}{A}}{\mfam{A}}}
      {\ctxwk{\mfam{A}}{\mfam{A}}}
      {\mfam{\mfam{A}}}
      {\tfwk{A}^0}
    }
  \tag{weakening}
\intertext{%
  The action of weakening on terms
  is a morphism from $\ctxwk{\mfam{A}}{\mtm{A}}$ to $\mtm{\mfam{\mfam{A}}}$ over
  $\tfwk{A}^0$ in context $\ctxext{{\Gamma}{A}}{\mfam{A}}$:}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfhom
      {{{\Gamma}{A}}{\mfam{A}}}
      {\ctxwk{\mfam{A}}{\mfam{A}}}
      {\mfam{\mfam{A}}}
      {\tfwk{A}^0}
      {\ctxwk{\mfam{A}}{\mtm{A}}}
      {\mtm{\mfam{\mfam{A}}}}
      {\tfwk{A}^1}
    }
  \tag{weakening}
\intertext{%
  The action of substitution by a term on families
  is going to be a morphism from $\ctxwk{\mtm{A}}{\mfam{\mfam{A}}}$ to 
  $\ctxwk{\mtm{A}}{{\mfam{A}}{\mfam{A}}}$
  in context $\ctxext{{{\Gamma}{A}}{\mfam{A}}}{\mtm{A}}$:}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jhom
      {{{{\Gamma}{A}}{\mfam{A}}}{\mtm{A}}}
      {\ctxwk{\mtm{A}}{\mfam{\mfam{A}}}}
      {\ctxwk{\mtm{A}}{{\mfam{A}}{\mfam{A}}}}
      {\tfsubst{A}^0}
    }
  \tag{substitution}
\intertext{%
  Likewise, the action of substitution by a term on terms of those
  families is going to be a morphism from $\ctxwk{\mtm{A}}{\mtm{\mfam{\mfam{A}}}}$
  to $\ctxwk{\mtm{A}}{{\mfam{A}}{\mtm{A}}}$ over $\tfsubst{A}^0$ in context
  $\ctxext{{{\Gamma}{A}}{\mfam{A}}}{\mtm{A}}$:}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jfhom
      {{{{\Gamma}{A}}{\mfam{A}}}{\mtm{A}}}
      {\ctxwk{\mtm{A}}{\mfam{\mfam{A}}}}
      {\ctxwk{\mtm{A}}{{\mfam{A}}{\mfam{A}}}}
      {\tfsubst{A}^0}
      {\ctxwk{\mtm{A}}{\mtm{\mfam{\mfam{A}}}}}
      {\ctxwk{\mtm{A}}{{\mfam{A}}{\mtm{A}}}}
      {\tfsubst{A}^1}
    }
  \tag{substitution}
\intertext{%
  The identity functions are coded by}
& \inference
  { \jfam{\Gamma}{A}
    }
  { \jterm
      {{{\Gamma}{A}}{\mfam{A}}}
      {\subst{{\idfunc[\mfam{A}]}{\tfwk{A}^0}}{\mtm{\mfam{\mfam{A}}}}}
      {\tfid{A}}
    }
  \tag{identity functions}
\end{align*}
We will call the terms that we introduced here the model constructors.

\subsection{The compatibility rules}
We need to do several things in this section:
\begin{itemize}
\item postulate that ordinary extension, weakening, substitution and identity
functions are compatible with the model constructors.
\item postulate that each of the model constructors is compatible with ordinary
extension, weakening, substitution and identity functions. Actually, we want
that every term of this type theory is compatible with those. I.e.~every term
is a functor/morphism of models. Also the sections.
\item postulate that the model constructors are compatible with each other,
so that they come to model ordinary extension, weakening, substitution and
identity functions respectively.
\item Note that the rules for compatibility with extension are going to explain which
model $\ctxext{A}{P}$ is by telling what the families, the terms, extension,
weakening, substitution and identity functions are. Likewise the rules for
compatibility with weakening and substitution do this for their respective
cases.
\item The easiest set of compatibility rules comes with weakening. The compatibility
rules that deal with substitution are likely going to have to do with the
Yoneda lemma, which we should be able to implement at some point.
\item The model $\subst{\tfemp{A}}{\mtm{A}}$ is going to be initial in the category of
all models over $A$. That means: whenever $P$ is a family over $\subst{\tfemp{A}}
{\mtm{A}}$ there will be a term of $P$. This means in particular that
$\subst{\tfemp{\emptyf}}{\mtm{\emptyf}}$ is going to be $\mctx$.
\end{itemize}

\subsubsection{Families of weakenings}
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    }
  { \jfameq
      {{{\Gamma}{A}}{\ctxwk{A}{B}}}
      {\mfam{\ctxwk{A}{B}}}
      {\ctxwk{A}{\mfam{B}}}
    }.
\end{equation*}

\subsubsection{Terms of weakenings}
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    \jfam{\Gamma}{B}
    }
  { \jfameq
    {{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\mfam{\ctxwk{A}{B}}}}
    {\mtm{\ctxwk{A}{B}}}
    {\ctxwk{A}{\mtm{B}}}
    }
\end{equation*}

\subsubsection{Families over families are families over extensions}
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq
      {{{\Gamma}{A}}{\mfam{A}}}
      {\mfam{\mfam{A}}}
      {\jcomp{{A}{\mfam{A}}}{\tfext{A}}{\mfam{A}}}
    }
\end{equation*}
\emph{(Note: this rule might be a consequence of an explanation of what $\mfam{{A}{P}}$
is in general, but at the moment I don't see how to do this)}

\subsubsection{Terms of families over families are terms of families over extensions}
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq
      {{{{\Gamma}{A}}{\mfam{A}}}{\mfam{\mfam{A}}}}
      {\mtm{\mfam{A}}}
      {\jcomp{}{\tfext{A}}{\mtm{A}}}
      }
\end{equation*}

\subsubsection{Extension acts as the identity on families of families}
The family of which $\tfext{A}$ is a term, is unfolded as
\begin{equation*}
\unfold{\jhom{\Gamma}{{A}{\mfam{A}}}{A}{\tfext{A}}}
\end{equation*}
Because we have the judgmental equality $\ctxext{\Gamma}{{A}{\mfam{A}}}
\jdeq \ctxext{{\Gamma}{A}}{\mfam{A}}$, there is a term
\begin{equation*}
\jhom
  {{{\Gamma}{A}}{\mfam{A}}}
  {\mfam{\mfam{A}}}
  {\subst{\tfext{A}}{\mfam{\ctxwk{\ctxext{A}{\mfam{A}}}{A}}}}
  {\mfam{\tfext{A}}^{\ctxext{\Gamma}{A}}}
\end{equation*}
By the rule asserting that families of families are families of extensions, we
have $\mfam{\mfam{A}}\jdeq\jcomp{}{\tfext{A}}{\mfam{A}}$. By the rule that
families over weakenings are weakenings of families, we have the judgmental
equalities
\begin{equation*}
\subst{\tfext{A}}{\mfam{\ctxwk{\ctxext{A}{\mfam{A}}}{A}}}
\jdeq 
  \unfold{\jcomp{{A}{P}}{\tfext{A}}{\mfam{A}}}
\jdeq 
  \jcomp{{A}{P}}{\tfext{A}}{\mfam{A}}
\end{equation*}
Therefore, we can compare the term $\mfam{\tfext{A}}^{\ctxext{\Gamma}{A}}$
to the identity function $\idfunc[\jcomp{}{\tfext{A}}{\mfam{A}}]$. 
The compatibility
rule for the action of extension on families of families asserts that
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    }
  { \jhomeq
      {{{\Gamma}{A}}{\mfam{A}}}
      {\jcomp{}{\tfext{A}}{\mfam{A}}}
      {\jcomp{}{\tfext{A}}{\mfam{A}}}
      {\mfam{\tfext{A}}^{\ctxext{\Gamma}{A}}}
      {\idfunc[\jcomp{}{\tfext{A}}{\mfam{A}}]}
    }
\end{equation*}
\emph{(Note: this rule might be a consequence of an explanation of what $\mfam{{A}{P}}$
is in general, but at the moment I don't see how to do this)}

\subsubsection{Extension acts as the identity on terms of families of families}
We now investigate the nature of the morphism.
\begin{equation*}
\jfhom
  {{{\Gamma}{A}}{\mfam{A}}}
  {\mfam{\mfam{A}}}
  {\subst{\tfext{A}}{\mfam{\ctxwk{\ctxext{A}{\mfam{A}}}{A}}}}
  {\mfam{\tfext{A}}^{\ctxext{\Gamma}{A}}}
  {\mtm{\mfam{A}}}
  {\subst{\tfext{A}}{\mtm{\ctxwk{\ctxext{A}{\mfam{A}}}{A}}}}
  {\mtm{\tfext{A}}^{\ctxext{\Gamma}{A}}}
\end{equation*}
Note that we have the judgmental equality 
$\mtm{\mfam{A}}\jdeq\jcomp{}{\tfext{A}}{\mtm{A}}$. Likewise, we have the
judgmental equality $\subst{\tfext{A}}{\mtm{\ctxwk{\ctxext{A}{\mfam{A}}}{A}}}
\jdeq\jcomp{}{\tfext{A}}{\mtm{A}}$. Thirdly, we have the judgmental equality
$\mfam{\tfext{A}}^{\ctxext{\Gamma}{A}}\jdeq\idfunc[\jcomp{}{\tfext{A}}{\mfam{A}}]$.
We may combine these three facts with \autoref{hom-over-id-is-hom} to see that
\begin{equation*}
\jhom
  {{{{\Gamma}{A}}{\mfam{A}}}{\jcomp{}{\tfext{A}}}{\mfam{A}}}
  {\jcomp{}{\tfext{A}}{\mtm{A}}}
  {\jcomp{}{\tfext{A}}{\mtm{A}}}
  {\mtm{\tfext{A}}^{\ctxext{\Gamma}{A}}}
\end{equation*}
Now we see that we can require that $\mtm{\tfext{A}}^{\ctxext{\Gamma}{A}}$ is
the identity function on $\jcomp{}{\tfext{A}}{\mtm{A}}$:
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    }
  { \jhomeq
    {{{{\Gamma}{A}}{\mfam{A}}}{\jcomp{}{\tfext{A}}}{\mfam{A}}}
    {\jcomp{}{\tfext{A}}{\mtm{A}}}
    {\jcomp{}{\tfext{A}}{\mtm{A}}}
    {\mtm{\tfext{A}}^{\ctxext{\Gamma}{A}}}
    {\idfunc[\jcomp{}{\tfext{A}}{\mtm{A}}]}
    }
\end{equation*}

\subsubsection{Weakening followed by substitution is the identity}
The weakening morphism $\tfwk{A}^0$ gives a weakened morphism
\begin{equation*}
\jhom
  {{{{\Gamma}{A}}{\mfam{A}}}{\mtm{A}}}
  {\ctxwk{\mtm{A}}{{\mfam{A}}{\mfam{A}}}}
  {\ctxwk{\mtm{A}}{\mfam{\mfam{A}}}}
  {\ctxwk{\mtm{A}}{\tfwk{A}^0}}
\end{equation*}
which can be composed with the morphism $\tfsubst{A}^0$. We require that this
composition is the identity function on $\ctxwk{\mtm{A}}{{\mfam{A}}{\mfam{A}}}$:
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    }
  { \jhomeq
      {{{{\Gamma}{A}}{\mfam{A}}}{\mtm{A}}}
      {\ctxwk{\mtm{A}}{{\mfam{A}}{\mfam{A}}}}
      {\ctxwk{\mtm{A}}{{\mfam{A}}{\mfam{A}}}}
      {\jcomp{}{\ctxwk{\mtm{A}}{\tfwk{A}^0}}{\tfsubst{A}^0}}
      {\idfunc[\ctxwk{\mtm{A}}{{\mfam{A}}{\mfam{A}}}]}
    }
\end{equation*}
Likewise, the weakening morphism $\tfwk{A}^1$ gives a weakened morphism
\begin{equation*}
\jfhom
  {{{{\Gamma}{A}}{\mfam{A}}}{\mtm{A}}}
  {\ctxwk{\mtm{A}}{{\mfam{A}}{\mfam{A}}}}
  {\ctxwk{\mtm{A}}{\mfam{\mfam{A}}}}
  {\ctxwk{\mtm{A}}{\tfwk{A}^0}}
  {\ctxwk{\mtm{A}}{\ctxwk{\mfam{A}}{\mtm{A}}}}
  {\ctxwk{\mtm{A}}{\mtm{\mfam{\mfam{A}}}}}
  {\ctxwk{\mtm{A}}{\tfwk{A}^1}}
\end{equation*}
which can be composed with the the morphism $\tfsubst{A}^1$. We require that
this composition is the identity function on 
$\ctxwk{\mtm{A}}{\ctxwk{\mfam{A}}{\mtm{A}}}$. Note that this composition gives
a morphism over $\jcomp{}{\ctxwk{\mtm{A}}{\tfwk{A}^0}}{\tfsubst{A}^0}$, which
is the identity function on $\ctxwk{\mtm{A}}{{\mfam{A}}{\mfam{A}}}$; so in fact
it is an ordinary morphism in the context
$\ctxext{{{{\Gamma}{A}}{\mfam{A}}}{\mtm{A}}}{\ctxwk{\mtm{A}}{{\mfam{A}}{\mfam{A}}}}$.
Thus the inference rule we require to become valid is:
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    }
  { \jhomeq
      {{{{{\Gamma}{A}}{\mfam{A}}}{\mtm{A}}}{\ctxwk{\mtm{A}}{{\mfam{A}}{\mfam{A}}}}}
      {\ctxwk{\mtm{A}}{\ctxwk{\mfam{A}}{\mtm{A}}}}
      {\ctxwk{\mtm{A}}{\ctxwk{\mfam{A}}{\mtm{A}}}}
      {\jcomp{}{\ctxwk{\mtm{A}}{\tfwk{A}^1}}{\tfsubst{A}^1}}
      {\idfunc[\ctxwk{\mtm{A}}{\ctxwk{\mfam{A}}{\mtm{A}}}]}
    }
\end{equation*}

\subsubsection{Weakening by a family is precomposing with extension}
We seem to need the following rule:
\begin{equation*}
\inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq
      {{{\Gamma}{A}}{\mfam{A}}}
      {\ctxwk{\mfam{A}}{P}}
      {\jcomp{}{\tfext{A}}{P}}
    }
\end{equation*}
I don't know very well how to motivate requiring this rule. Maybe it's provable?

\subsubsection{Families of extensions}

\subsubsection{Terms of families of extensions}

\subsubsection{Terms of extensions}

\subsubsection{Families over the empty context}
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{\Gamma}{\subst{\tfemp{A}}{\mfam{A}}}{A}
    }
\end{equation*}

\subsubsection{Terms of the empty family}
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    }
  { \jfameq{{\Gamma}{A}}{\subst{\tfemp{\mfam{A}}}{\mtm{A}}}{\emptyf[A]}
    }
\end{equation*}

\subsubsection{The empty family over the empty family}
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    }
  { \jtermeq{\Gamma}{A}{\subst{\tfemp{A}}{\tfemp{\mfam{A}}}}{\tfemp{A}}
    }
\end{equation*}

\subsubsection{Extension by the empty family}
To understand the following inference rule, recall that for $\jfam{\Gamma}{A}$
we have the judgmental equalities
\begin{equation*}
\subst{\tfemp{\mfam{A}}}{\ctxwk{\ctxext{A}{\mfam{A}}}{A}}
\jdeq
  \subst{\tfemp{\mfam{A}}}{\ctxwk{\mfam{A}}{{A}{A}}}
\jdeq
  \ctxwk{A}{A}.
\end{equation*}
Therefore, we can postulate:
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    }
  { \jhomeq{\Gamma}{A}{A}{\subst{\tfemp{\mfam{A}}}{\tfext{A}}}{\idfunc[A]}
    }
\end{equation*}

\subsubsection{Extensions of the empty context}
To understand the following inference rule, recall that for $\jfam{\Gamma}{A}$
we have the judgmental equalities
\begin{align*}
\subst{\tfemp{A}}{\ctxwk{\ctxext{A}{\mfam{A}}}{A}}
& \jdeq 
  \subst{\tfemp{A}}{\ctxwk{\mfam{A}}{{A}{A}}}
  \\
& \jdeq 
  \ctxwk{\subst{\tfemp{A}}{\mfam{A}}}{\subst{\tfemp{A}}{\ctxwk{A}{A}}}
  \\
& \jdeq 
  \ctxwk{A}{\subst{\tfemp{A}}{\ctxwk{A}{A}}}
  \\
& \jdeq 
  \ctxwk{A}{A}
\end{align*}
Therefore, we can postulate
\begin{equation*}
\inference
  { \jfam{\Gamma}{A}
    }
  { \jhomeq{\Gamma}{A}{A}{\subst{\tfemp{A}}{\tfext{A}}}{\idfunc[A]}
    }
\end{equation*}

\subsubsection{Weakening by the empty family}

\subsubsection{Weakenings of the empty family}

\subsubsection{Substitutions of the empty family}

\subsubsection{Substitution by the term of the empty family}

\subsection{Compatibility properties of arbitrary terms}
In this subsection we will state the inference rules that assert that every
term $\jterm{{\Gamma}{A}}{P}{f}$ acts functorially. That means, every term
preserves the empty context, extension, weakening, substitution and the
identity functions. Moreover, there will be several inference rules
involving the behavior of $\mfam{f}$ and $\mtm{f}$.

\subsubsection{The action on families of families of a term is the action on
families over extensions}
Let $\jterm{{\Gamma}{A}}{P}{f}$. Then we have the term
\begin{equation*}
\jterm{{{\Gamma}{A}}{\mfam{A}}}{\ctxwk{\mfam{A}}{\subst{f}{\mfam{P}}}}{\mfam{f}}
\end{equation*}
and we have the term
\begin{equation*}
\jterm
  { {{{\Gamma}{A}}{\mfam{A}}}{\mfam{\mfam{A}}}
    }
  { \ctxwk
      {\mfam{\mfam{A}}}
      {\subst{\mfam{f}}{\mfam{\ctxwk{\mfam{A}}{\subst{f}{\mfam{P}}}}}}
    }
  { \mfam{\mfam{f}}
    }.
\end{equation*}
We have the judgmental equality $\mfam{\mfam{A}}\jdeq
\jcomp{}{\tfext{A}}{\mfam{A}}$; in this subsubsection we wish to establish a
similar judgmental equality explaining what $\mfam{\mfam{f}}$ is. Note that
we have the judgmental equalities
\begin{align*}
\ctxwk
  {\mfam{\mfam{A}}}
  {\subst{\mfam{f}}{\mfam{\ctxwk{\mfam{A}}{\subst{f}{\mfam{P}}}}}}
& \jdeq
  \ctxwk
    {\jcomp{}{\tfext{A}}{\mfam{A}}}
    {\subst{\mfam{f}}{\mfam{\ctxwk{\mfam{A}}{\subst{f}{\mfam{P}}}}}}
  \\
& \jdeq
  \ctxwk
    {\unfold{\jcomp{\ctxext{A}{\mfam{A}}}{\tfext{A}}{\mfam{A}}}}
    {\subst{\mfam{f}}{\mfam{\ctxwk{\mfam{A}}{\subst{f}{\mfam{P}}}}}}
  \\
& \jdeq
  \ctxwk
    {\subst{\tfext{A}}{\ctxwk{\mfam{A}}{{A}{\mfam{A}}}}}
    {\subst{\mfam{f}}{\mfam{\ctxwk{\mfam{A}}{\subst{f}{\mfam{P}}}}}}
  \\
& \jdeq
  \ctxwk
    { \subst{\tfext{A}}{\ctxwk{\mfam{A}}{{A}{\mfam{A}}}}
      }
    { \subst
        { \tfext{A}
          }
        { \ctxwk
            {A}
            {\subst{\mfam{f}}{\mfam{\ctxwk{\mfam{A}}{\subst{f}{\mfam{P}}}}}}}
      }
  \\
& \jdeq
  \subst
    { \tfext{A}
      }
    { \ctxwk
        { {\mfam{A}}{{A}{\mfam{A}}}
          }
        { {A}
          {\subst{\mfam{f}}{\mfam{\ctxwk{\mfam{A}}{\subst{f}{\mfam{P}}}}}}
          }
      }
  \\
& \jdeq \unfold{\jcomp{{A}{\mfam{A}}}{\tfext{A}}{\mfam{\ctxwk{\mfam{A}}{\subst{f}{\mfam{P}}}}}}
\end{align*}


\subsubsection{Every term is compatible with the empty context}
\begin{equation*}
\inference
  { \jterm{{\Gamma}{A}}{P}{f}
    }
  { \jtermeq
      {\Gamma}
      {\subst{\tfemp{A}}{P}}
      {\subst{\tfemp{A}}{f}}
      {\tfemp{\subst{\tfemp{A}}{P}}}
    }
\end{equation*}

\subsubsection{The action on families of the action on families of a term is the action
on contexts of that term}
\emph{In this subsubsection we attempted to establish a rule asserting that
$\subst{\tfemp{A}}{\mfam{f}}\jdeq f$ for any $\jterm{{\Gamma}{A}}{P}{f}$. This
is however not true.}

Consider a term $\jterm{{\Gamma}{A}}{P}{f}$. Then we have the term
\begin{equation*}
\jterm
  {{\Gamma}{\subst{\tfemp{A}}{\mfam{A}}}}
  {\subst{\tfemp{A}}{\ctxwk{\mfam{A}}{\subst{f}{\mfam{P}}}}}
  {\subst{\tfemp{A}}{\mfam{f}}}
\end{equation*}
We have required that $\subst{\tfemp{A}}{\mfam{A}}\jdeq A$. Also, we have the
judgmental equalities
\begin{align*}
\subst{\tfemp{A}}{\ctxwk{\mfam{A}}{\subst{f}{\mfam{P}}}}
& \jdeq
  \ctxwk{\subst{\tfemp{A}}{\mfam{A}}}{\subst{\tfemp{A}}{{f}{\mfam{P}}}}
  \\
& \jdeq
  \ctxwk{A}{\subst{{\tfemp{A}}{f}}{{\tfemp{A}}{\mfam{P}}}}
  \\
& \jdeq
  \ctxwk{A}{\subst{\tfemp{\subst{\tfemp{A}}{P}}}{{\tfemp{A}}{\mfam{P}}}}
  \\
& \jdeq
  \ctxwk{A}{\subst{{\tfemp{A}}{\tfemp{P}}}{{\tfemp{A}}{\mfam{P}}}}
  \\
& \jdeq
  \ctxwk{A}{\subst{\tfemp{A}}{{\tfemp{P}}{\mfam{P}}}}
  \\
& \jdeq
  \ctxwk{A}{\subst{\tfemp{A}}{P}}
\end{align*}
If we require also the following inference rule, we would get $\mfam{A}\jdeq
\ctxwk{A}{A}$.
\begin{equation*}
\inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq{{\Gamma}{A}}{P}{\ctxwk{A}{\subst{\tfemp{A}}{P}}}
    }
\end{equation*}
This rule would say that a family $P$ of models over $A$ is determined by the
model $\subst{\tfemp{A}}{P}$ and that the only possible families of models
are the constant families.

\subsubsection{Every term is compatible with extension}
Let $\jterm{{\Gamma}{A}}{P}{f}$. The rule we're about to explain is that $f$
commutes with extension.

We have the morphism
$\jhom{{\Gamma}{A}}{\mfam{A}}{\subst{f}{\mfam{P}}}{\mfam{f}}$. Let's unfold
to remind ourselves what this means:
\begin{equation*}
\unfold{\jhom{{\Gamma}{A}}{\mfam{A}}{\subst{f}{\mfam{P}}}{\mfam{f}}}
\end{equation*}
Now note that we have the judgmental equality
\begin{equation*}
  \ctxwk{\mfam{A}}{\subst{f}{\mfam{P}}}
  \jdeq
  \subst{\ctxwk{\mfam{A}}{f}}{\ctxwk{\mfam{A}}{\mfam{P}}}
\end{equation*}
and we see that we get the term
$ \tmext
    {\ctxwk{\mfam{A}}{P}}
    {\ctxwk{\mfam{A}}{\mfam{P}}}
    {\ctxwk{\mfam{A}}{f}}
    {\mfam{f}}
  $
of the family $\ctxwk{\mfam{A}}{\ctxext{P}{\mfam{P}}}$. We can substitute this
term in the morphism
\begin{equation*}
\jhom
  {{{\Gamma}{A}}{\mfam{A}}}
  {\ctxwk{\mfam{A}}{\ctxext{P}{\mfam{P}}}}
  {\ctxwk{\mfam{A}}{P}}
  {\ctxwk{\mfam{A}}{\tfext{P}}}
\end{equation*}
to obtain the term 
$ \jterm
    {{{\Gamma}{A}}{\mfam{A}}}
    {\ctxwk{\mfam{A}}{P}}
    { \subst
        { \tmext
            {\ctxwk{\mfam{A}}{P}}
            {\ctxwk{\mfam{A}}{\mfam{P}}}
            {\ctxwk{\mfam{A}}{f}}
            {\mfam{f}}
          }
        { \ctxwk{\mfam{A}}{\tfext{P}}
          }
      }.
  $
We can also compose $\tfext{A}$ with $f$ to obtain the term
\begin{equation*}
\jterm{{{\Gamma}{A}}{\mfam{f}}}{\jcomp{}{\tfext{A}}{P}}{\jcomp{}{\tfext{A}}{f}}
\end{equation*}
Note that we have (?) the judgmental equality $\jcomp{}{\tfext{A}}{P}
\jdeq\ctxwk{\mfam{A}}{P}$ and therefore
we can require:
\begin{equation*}
\inference
  { \jterm{{\Gamma}{A}}{P}{f}
    }
  { \jtermeq
       {{{\Gamma}{A}}{\mfam{A}}}
       {\ctxwk{\mfam{A}}{P}}
       { \subst
           { \tmext
               {\ctxwk{\mfam{A}}{P}}
               {\ctxwk{\mfam{A}}{\mfam{P}}}
               {\ctxwk{\mfam{A}}{f}}
               {\mfam{f}}
             }
           { \ctxwk{\mfam{A}}{\tfext{P}}
             }
         }
       {\jcomp{}{\tfext{A}}{f}}
    }
\end{equation*}

\subsubsection{Every term is compatible with weakening}
Let $\jterm{{\Gamma}{A}}{P}{f}$ be a term. We will establish an inference rule
asserting that $f$ commutes with weakening. 

\subsubsection{Every term is compatible with substitution}

\subsubsection{Every term preserves identity}


\section{Pretty type theory}
In this section we will do three things. First we explain basic type theory with
variable names, which we simply call \emph{Pretty Type Theory}. 
Then we will show how every formula in basic type theory without
variable names (shall we call it \emph{Structural Type Theory}?) 
can be interpreted in pretty type theory. Finally, we will show how every formula
in pretty type theory can be interpreted in structural type theory.

Pretty type theory is pretty as the ugly little duckling that grew up. At first, it is actually uglier than
structural type theory because one has to keep track of a variable nobody is
actually interested in. The situation improves when we introduce the operators
of extension and weakening, because from that point onwards one can draw notational
advantages from having the variable around.

Pretty type theory should be such that if you write down two contexts, families
or terms in exactly the same way, then they are the same, and there should be
notational shortcuts for extension, weakening and substitution which make
this interesting.

\subsection{The basic judgments}
The basic judgments of pretty type theory are the same as for structural type
theory. There are judgments for: ``$\Gamma$ is a context'',
``$A(i)$ over $i:\Gamma$ is a family over $\Gamma$'', ``$A(i)$ over $i:\Gamma$ 
is a type in context $\Gamma$''
and ``$x(i)$ is a term of $A(i)$ above $i:\Gamma$''. The other four
judgments are for judgmental equality. 

\begin{align*}
\jvctx*{\Gamma} & \jvctxeq*{\Gamma}{\Gamma'}\\
\jvfam*{i}{\Gamma}{A} & \jvfameq*{i}{\Gamma}{A}{B}\\
\jvtype*{i}{\Gamma}{A} & \jvtypeeq*{i}{\Gamma}{A}{B}\\
\jvterm*{i}{\Gamma}{A}{x} & \jvtermeq*{i}{\Gamma}{A}{x}{y}.
\end{align*}

We have the following basic inference rules that relate types and families:

\begin{small}
\begin{align*}
& \inference
  {\jvtype{i}{\Gamma}{A}}
  {\jvfam{i}{\Gamma}{A}}
& & \inference
    {\jvtypeeq{i}{\Gamma}{A}{B}}
    {\jvfameq{i}{\Gamma}{A}{B}}\\
& \inference
  {\jvtype{i}{\Gamma}{A}
   \jvfameq{i}{\Gamma}{A}{B}}
  {\jvtype{i}{\Gamma}{B}}
& & \inference
    {\jvtype{i}{\Gamma}{A}
     \jvfameq{i}{\Gamma}{A}{B}}
    {\jvtypeeq{i}{\Gamma}{A}{B}}
\end{align*}
\end{small}

\subsection{The basic rules for judgmental equality}
The rules for judgmental equality establish that it is an equivalence relation.
\bgroup\small
\begin{align*}
& \inference
  {\jvctx{\Gamma}}
  {\jvctxeq{\Gamma}{\Gamma}} 
& & \inference
    {\jvctxeq{\Gamma}{\Delta}}
    {\jvctxeq{\Delta}{\Gamma}} 
& & \inference
    {\jvctxeq{\Gamma}{\Delta}
     \jvctxeq{\Delta}{\greek{E}}}
    {\jvctxeq{\Gamma}{\greek{E}}}\\
& \inference
  {\jvfam{i}{\Gamma}{A}}
  {\jvfameq{i}{\Gamma}{A}{A}} 
& & \inference
    {\jvfameq{i}{\Gamma}{A}{B}}
    {\jvfameq{i}{\Gamma}{B}{A}}
& & \inference
    {\jvfameq{i}{\Gamma}{A}{B}
     \jvfameq{i}{\Gamma}{B}{C}}
    {\jvfameq{i}{\Gamma}{A}{C}}\\
& \inference
  {\jvterm{i}{\Gamma}{A}{x}}
  {\jvtermeq{i}{\Gamma}{A}{x}{x}}
& & \inference
    {\jvtermeq{i}{\Gamma}{A}{x}{y}}
    {\jvtermeq{i}{\Gamma}{A}{y}{x}}
& & \inference
    {\jvtermeq{i}{\Gamma}{A}{x}{y}
     \jvtermeq{i}{\Gamma}{A}{y}{z}}
    {\jvtermeq{i}{\Gamma}{A}{x}{z}}
\end{align*}
\egroup

The following convertibility rules are responsible for the strictness
of judgmental equality, which sets it apart from equivalences or identifications:

\begin{align*}
& \inference
  {\jvctxeq{\Gamma}{\Delta}
   \jvfam{i}{\Gamma}{A}}
  {\jvfam{i}{\Delta}{A}}
& & \inference
    {\jvctxeq{\Gamma}{\Delta}
     \jvfameq{i}{\Gamma}{A}{B}}
    {\jvfameq{i}{\Delta}{A}{B}}\\
& \inference
  {\jvctxeq{\Gamma}{\Delta}
   \jvterm{i}{\Gamma}{A}{x}}
  {\jvterm{i}{\Delta}{A}{x}}
& & \inference
    {\jvctxeq{\Gamma}{\Delta}
     \jvtermeq{i}{\Gamma}{A}{x}{y}}
    {\jvtermeq{i}{\Delta}{A}{x}{y}}\\
& \inference
  {\jvfameq{i}{\Gamma}{A}{B}
   \jvterm{i}{\Gamma}{A}{x}}
  {\jvterm{i}{\Gamma}{B}{x}}
& & \inference
    {\jvfameq{i}{\Gamma}{A}{B}
     \jvtermeq{i}{\Gamma}{A}{x}{y}}
    {\jvtermeq{i}{\Gamma}{B}{x}{y}}
\end{align*}

\subsection{The empty context}
The empty context looks a bit strange when we explicitly denote the terms. But
we will not do so anymore after this subsection.

\begin{align}
& \inference
  {}
  {\jctx{\emptyc}}\\
& \inference
  {\jctx{\Gamma}}
  {\jvfam{i}{\Gamma}{\emptyf[\Gamma]}}\\
& \inference
  {\jctx{\Gamma}}
  {\jvterm{i}{\Gamma}{\emptyf[\Gamma]}{\emptytm[\Gamma]}}\\
& \inference
  {\jvterm{i}{\Gamma}{\emptyf[\Gamma]}{x}}
  {\jvtermeq{i}{\Gamma}{\emptyf[\Gamma]}{x}{\emptytm[\Gamma]}}
\end{align}

Moreover, if $\Gamma$ is a context family over the
empty context, then $\Gamma$ is a context and every context is a context
family over the empty context. Note that this allows us to speak
of terms of contexts too.

\begin{align}
& \inference
  {\jctx{\Gamma}}
  {\jvfam{\nameless}{\emptyc}{\Gamma}} 
& & \inference
    {\jvfam{\nameless}{\emptyc}{\Gamma}}
    {\jctx{\Gamma}}\\
& \inference
  {\jctxeq{\Gamma}{\Delta}}
  {\jvfameq{\nameless}{\emptyc}{\Gamma}{\Delta}}
& & \inference
    {\jvfameq{\nameless}{\emptyc}{\Gamma}{\Delta}}
    {\jctxeq{\Gamma}{\Delta}}
\end{align}

\subsubsection{The empty context is compatible with itslef}
The empty context $\emptyc$ may be considered as a family of contexts over the empty
context. When we do this, we get $\emptyf[\emptyc]$.
\begin{equation}
\inference
  {}
  {\jvfameq{\nameless}{\emptyc}{\emptyc}{\emptyf[\emptyc]}}
\end{equation}
In the future, we shall denote $\emptyf[\Gamma]$ by $\emptyf$. The above rule
guarantees that this will not cause confusion. Likewise, we shall denote
$\emptytm[\Gamma]$ by $\emptytm$.

\subsection{Extension}
We introduce extension which not only extends a context $\Gamma$ and a family
$A$ over it to a context $\ctxext{\Gamma}{A}$, but which also extends a family $A$
in context $\Gamma$ and a family $P$ over it to a family $\ctxext{A}{P}$ over context
$\Gamma$. We do this to ensure that all of type theory can be done in a context.
For instance, we could say (1) that a context in context $\Gamma$ is the same thing
as a family over $\Gamma$; (2) When $A$ is a context in this sense, a family over
$A$ is the same thing as a family $P$ over $\ctxext{\Gamma}{A}$ and 
(3) when $P$ is a family over $A$ in this sense, a term of $P$ keeps its original meaning.

\begin{align}
& \inference
  {\jvfam{i}{\Gamma}{A}}
  {\jvfamcombi{{i}{x}}{{\Gamma}{A}}{P}}
& & \inference
    {\jctxeq{\Gamma}{\Delta}
     \jfameq{\Gamma}{A}{B}}
    {\jctxeq{\ctxext{\Gamma}{A}}{\ctxext{\Delta}{B}}}\\
& \inference
  {\jfam{{\Gamma}{A}}{P}}
  {\jfam{\Gamma}{\ctxext{A}{P}}}
& & \inference
    {\jfameq{\Gamma}{A}{B}
     \jfameq{{\Gamma}{A}}{P}{Q}}
    {\jfameq{\Gamma}{\ctxext{A}{P}}{\ctxext{B}{Q}}}
\end{align}

\subsubsection{Extension is compatible with the empty context}
The following rule asserts that extension by $\emptyc$ leaves the contexts unchanged.
\begin{align}
& \inference
  {\jctx{\Gamma}}
  {\jctxeq{\ctxext{\emptyc}{\Gamma}}{\Gamma}}\\
& \inference
  {\jctx{\Gamma}}
  {\jctxeq{\ctxext{\Gamma}{\emptyf}}{\Gamma}}\\
& \inference
  {\jfam{\Gamma}{A}}
  {\jfameq{\Gamma}{\ctxext{\emptyf}{A}}{A}}
\end{align}

\subsubsection{Extension is compatible with itself}\label{comp-ee}
The inference rules asserting that extension is compatible with itself assert
that contexts are unstructured lists of type declarations. This rule is
unavoidable if we want that for a family $A$ in context $\Gamma$, a family over
$A$ is the same thing as a family over $\ctxext{\Gamma}{A}$. 

\begin{align}
& \inference
  {\jfam{\Gamma}{A}
   \jfam{{\Gamma}{A}}{P}}
  {\jctxeq{\ctxext{{\Gamma}{A}}{P}}{\ctxext{\Gamma}{{A}{P}}}}\\
& \inference
  {\jfam{{\Gamma}{A}}{P}
   \jfam{{{\Gamma}{A}}{P}}{Q}}
  {\jfameq{\Gamma}{\ctxext{{A}{P}}{Q}}{\ctxext{A}{{P}{Q}}}}
\end{align}


\section{Chalmers type theory}
In this section we will present the type theory that Coquand and Dybjer are using.
It is a weak type theory (I think), with not so many operations and judgmental equalities.
We will show how every formula of Chalmers type theory can be interpreted in
structural type theory.
