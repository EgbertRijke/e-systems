\section{The dependent function constructor}
As we have done with most everything so far, we will take the point of view that
the dependent function constructor is an operation with an action on contexts,
on families and on terms. When $A$ is a family of contexts over $\Gamma$,
$\mprd{A}{\blank}$ takes things in context $\ctxext{\Gamma}{A}$ to the context
$\Gamma$. It's action on terms restricted to the empty context is usually 
denoted by $\lambda$, so we shall denote the entire action by $\lambda$. As
usual, $\lambda$ is reversed by evaluation. 

The dependent function type constructor not only acts on families $P$ of
contexts over $\ctxext{\Gamma}{A}$, but it also sends families $Q$ of contexts
over $\ctxext{{\Gamma}{A}}{P}$ to families $\mprd[\famsym]{A}{Q}$ over $\ctxext{\Gamma}
{\mprd{A}{P}}$. Moreover, we will also have a version of $\lambda$-abstraction
for terms of such families $Q$.

\begin{align*}
& \inference
    { \jfam{{\Gamma}{A}}{P}
      }
    { \jfam{\Gamma}{\mprd{A}{P}}
      }
& & \inference
      { \jfameq{\Gamma}{A}{A'}
        \jfameq{{\Gamma}{A}}{P}{P'}
        }
      { \jfameq{\Gamma}{\mprd{A}{P}}{\mprd{A'}{P'}}
        }
  \\
& \inference
    { \jfam{{{\Gamma}{A}}{P}}{Q}
      }
    { \jfam{{\Gamma}{\mprd{A}{P}}}{\mprd[\famsym]{A}{Q}}
      }
& & \inference
      { \jfameq{\Gamma}{A}{A'}
        \jfameq{{{\Gamma}{A}}{P}}{Q}{Q'}
        }
      { \jfameq{{\Gamma}{\mprd{A}{P}}}{\mprd[\famsym]{A}{Q}}{\mprd[\famsym]{A'}{Q'}}
        }
  \\
& \inference
    { \jterm{{{\Gamma}{A}}{P}}{Q}{g}
      }
    { \jterm{{\Gamma}{\mprd{A}{P}}}{\mprd[\famsym]{A}{Q}}{\slam{A}{Q}{g}}
      }
& & \inference
      { \jfameq{\Gamma}{A}{A'}
        \jtermeq{{{\Gamma}{A}}{P}}{Q}{g}{g'}
        }
      { \jtermeq{{\Gamma}{\mprd{A}{P}}}{\mprd[\famsym]{A}{Q}}{\slam{A}{Q}{g}}{\slam{A'}{Q}{g'}}
        }
\end{align*}

\begin{defn}
Let $A$ and $B$ be families of contexts over $\Gamma$. Then we define
\begin{equation*}
\jfamdefn{\Gamma}{\jfun{A}{B}}{\sprd{A}{\ctxwk{A}{B}}}.
\end{equation*}
\end{defn}

\subsection{The compatibility rules for the dependent product constructor}
In this subsection we lay out the compatibility rules which we will require
for the dependent product constructor.

\subsubsection{Dependent products are compatible with the empty context}
The empty context can appear in the domain and in the codomain of the dependent
function type constructor. We have the following inference rules explaining
what happens when the empty context appears in the domain:
\begin{align}
& \inference
    { \jfam{\Gamma}{P}
      }
    { \jfameq{\Gamma}{\mprd{\emptyf}{P}}{P}
      }
  \\
& \inference
    { \jfam{{\Gamma}{P}}{Q}
      }
    { \jfameq{{\Gamma}{P}}{\mprd[\famsym]{\emptyf}{Q}}{Q}
      }
  \\
& \inference
    { \jterm{{\Gamma}{P}}{Q}{g}
      }
    { \jtermeq{{\Gamma}{P}}{Q}{\slam{\emptyf}{Q}{g}}{g}
      }
\end{align}
We have the following infernece rules explaining what happens when the empty
context appears in the codomain:
\begin{align}
& \inference
    { \jfam{\Gamma}{A}
      }
    { \jfameq{\Gamma}{\mprd{A}{\emptyf}}{\emptyf}
      }
  \\
& \inference
    { \jfam{{\Gamma}{A}}{P}
      }
    { \jfameq{{\Gamma}{\mprd{A}{P}}}{\mprd[\famsym]{A}{\emptyf}}{\emptyf}
      }
\end{align}
Now we see that we can compare $\mprd{A}{P}$ with $\mprd[\famsym]{A}{P}$ by
seeing $P$ as a family over $\ctxext{{\Gamma}{A}}{\emptyf}$. We will require
the following inference rule to be valid:
\begin{equation}
\inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jfameq{\Gamma}{\mprd{A}{P}}{\mprd[\famsym]{A}{P}}
    }
\end{equation}
This rule will allow us to omit the annotation indicating the action on families,
which we will do from now on. We also note that because the empty family over
$\ctxext{\Gamma}{A}$ is mapped to the empty family over $\Gamma$ by the
dependent function constructor, we obtain the important special cases of
lambda abstraction and evaluation that
\begin{align*}
& \inference
  { \jterm{{\Gamma}{A}}{P}{f}
    }
  { \jterm{\Gamma}{\mprd{A}{P}}{\slam{A}{P}{f}}
    }
\end{align*}
Thus, we retrieve what is originally meant by lambda abstraction.

\subsubsection{Dependent products are compatible with extension}
The following rules describe what happens when a dependent function constructor
is taken over an extension

\begin{align*}
& \inference
  { \jfam{{\Gamma}{A}}{P}
    \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfameq
      {\Gamma}
      {\mprd{\ctxext{A}{P}}{Q}}
      {\mprd{A}{\mprd{P}{Q}}}
    }
  \\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \jfameq
      {{\Gamma}{\mprd{\ctxext{A}{P}}{Q}}}
      {\mprd{\ctxext{A}{P}}{R}}
      {\mprd{A}{\mprd{P}{R}}}
    }
  \\
& \inference
  { \jfam{{\Gamma}{A}}{P}
    \jterm{{{{\Gamma}{A}}{P}}{Q}}{R}{h}
    }
  { \jtermeq
      {{\Gamma}{\mprd{\ctxext{A}{P}}{Q}}}
      {\mprd{\ctxext{A}{P}}{R}}
      {\slam{\ctxext{A}{P}}{R}{h}}
      {\slam{A}{\mprd{P}{R}}{\slam{P}{R}{h}}}
    }
\end{align*}

When the dependent product constructor is applied to an extension, we get the
following:

\begin{align*}
& \inference
  { \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfameq
      {\Gamma}
      {\mprd{A}{\ctxext{P}{Q}}}
      {\ctxext{\mprd{A}{P}}{\mprd{A}{Q}}}
    }
  \\
& \inference
  { \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \jfameq
      {{\Gamma}{\mprd{A}{P}}}
      {\mprd{A}{\ctxext{Q}{R}}}
      {\ctxext{\mprd{A}{Q}}{\mprd{A}{R}}}
    }
\end{align*}
We show in \autoref{lem:slam-ext} that the remaining two properties
involving lambda abstraction and evaluation are derivable.

\subsubsection{Weakening is compatible with the dependent product constructor}

\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{{\Gamma}{B}}{Q}}{R}
    }
  { \jfameq
      {{{\Gamma}{A}}{\ctxwk{A}{B}}}
      {\ctxwk{A}{\mprd{Q}{R}}}
      {\mprd{\ctxwk{A}{Q}}{\ctxwk{A}{R}}}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{{{\Gamma}{B}}{Q}}{R}}{S}
    }
  { \jfameq
      {{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{\mprd{Q}{R}}}}
      {\ctxwk{A}{\mprd{Q}{S}}}
      {\mprd{\ctxwk{A}{Q}}{\ctxwk{A}{S}}}
    }
  \\
& \inference
  { \jfam{\Gamma}{A}
    \jterm{{{{\Gamma}{B}}{Q}}{R}}{S}{k}
    }
  { \jtermeq
      {{{{\Gamma}{A}}{\ctxwk{A}{B}}}{\ctxwk{A}{\mprd{Q}{R}}}}
      {\ctxwk{A}{\mprd{Q}{S}}}
      {\ctxwk{A}{\slam{Q}{S}{k}}}
      {\slam{\ctxwk{A}{Q}}{\ctxwk{A}{S}}{\ctxwk{A}{k}}}
    }
\end{align*}

\subsubsection{Dependent products are taken fiberwise}
The rules explaining that substitution is compatible with the dependent product
constructor assert that dependent products are taken fiberwise (as is usual).

\begin{align*}
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \jfameq
      {{\Gamma}{\subst{x}{P}}}
      {\subst{x}{\mprd{Q}{R}}}
      {\mprd{\subst{x}{Q}}{\subst{x}{R}}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{{{{\Gamma}{A}}{P}}{Q}}{R}}{S}
    }
  { \jfameq
      {{{\Gamma}{\subst{x}{P}}}{\mprd{\subst{x}{Q}}{\subst{x}{R}}}}
      {\subst{x}{\mprd{Q}{S}}}
      {\mprd{\subst{x}{Q}}{\subst{x}{S}}}
    }
  \\
& \inference
  { \jterm{\Gamma}{A}{x}
    \jterm{{{{{\Gamma}{A}}{P}}{Q}}{R}}{S}{k}
    }
  { \jtermeq
      {{{\Gamma}{\subst{x}{P}}}{\mprd{\subst{x}{Q}}{\subst{x}{R}}}}
      {\subst{x}{\mprd{Q}{S}}}
      {\subst{x}{\slam{Q}{S}{k}}}
      {\slam{\subst{x}{Q}}{\subst{x}{S}}{\subst{x}{k}}}
    }
\end{align*}

\subsubsection{The dependent function constructor is compatible with weakening}
\begin{align*}
& \inference
  { \jfam{{{\Gamma}{A}}{P}}{Q}
    \jfam{{{\Gamma}{Q}}{P}}{R}
    }
  { \jfameq
      {{{\Gamma}{\mprd{A}{P}}}{\mprd{A}{Q}}}
      {\mprd{A}{\ctxwk{Q}{R}}}
      {\ctxwk{\mprd{A}{Q}}{\mprd{A}{R}}}
    }
  \\
& \inference
  { \jfam{{{\Gamma}{A}}{P}}{Q}
    \jfam{{{{\Gamma}{P}}{Q}}{R}}{S}
    }
  { \jfameq
      {{{{\Gamma}{\mprd{A}{P}}}{\mprd{A}{Q}}}{\mprd{A}{\ctxwk{Q}{R}}}}
      {\mprd{A}{\ctxwk{Q}{S}}}
      {\ctxwk{\mprd{A}{Q}}{\mprd{A}{S}}}
    }
  \\
& \inference
  { \jfam{{{\Gamma}{A}}{P}}{Q}
    \jterm{{{{\Gamma}{P}}{Q}}{R}}{S}{k}
    }
  { \jtermeq
      {{{{\Gamma}{\mprd{A}{P}}}{\mprd{A}{Q}}}{\mprd{A}{\ctxwk{Q}{R}}}}
      {\mprd{A}{\ctxwk{Q}{S}}}
      {\slam{A}{\ctxwk{Q}{S}}{\ctxwk{Q}{k}}}
      {\ctxwk{\mprd{A}{Q}}{\slam{A}{S}{k}}}
    }
\end{align*}

\subsubsection{The dependent function constructor is compatible with substitution}
\begin{align*}
& \inference
  { \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \jfameq
      {{\Gamma}{\mprd{A}{P}}}
      {\mprd{A}{\subst{g}{R}}}
      {\subst{\slam{A}{Q}{g}}{\mprd{A}{R}}}
    }
  \\
& \inference
  { \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    \jfam{{{{{\Gamma}{A}}{P}}{Q}}{R}}{S}
    }
  { \jfameq
      {{{\Gamma}{\mprd{A}{P}}}{\mprd{A}{\subst{g}{R}}}}
      {\mprd{A}{\subst{g}{S}}}
      {\subst{\slam{A}{Q}{g}}{\mprd{A}{S}}}
    }
  \\
& \inference
  { \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    \jterm{{{{{\Gamma}{A}}{P}}{Q}}{R}}{S}{k}
    }
  { \jtermeq
      {{{\Gamma}{\mprd{A}{P}}}{\mprd{A}{\subst{g}{R}}}}
      {\mprd{A}{\subst{g}{S}}}
      {\slam{A}{\subst{g}{S}}{\subst{g}{k}}}
      {\subst{\slam{A}{Q}{g}}{\slam{A}{S}{k}}}
    }
  \\
& \inference
  { \jterm{{{\Gamma}{A}}{P}}{Q}{g}
    \jterm{{\Gamma}{\mprd{A}{\ctxext{{P}{Q}}{R}}}}{\mprd{A}{S}}{k}
    }
  { \jtermeq
      {{{{\Gamma}{A}}{P}}{\subst{g}{R}}}
      {\subst{g}{S}}
      {\sev{A}{\subst{g}{S}}{\subst{\slam{A}{Q}{g}}{k}}}
      {\subst{g}{\sev{A}{S}{k}}}
    }
\end{align*}

\subsubsection{The dependent function constructor is compatible with the identity terms}
\begin{align*}
& \inference
  { \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jtermeq
      {{{\Gamma}{\mprd{A}{P}}}{\mprd{A}{Q}}}
      {\ctxwk{\mprd{A}{Q}}{\mprd{A}{Q}}}
      {\slam{A}{\ctxwk{Q}{Q}}{\idtm{Q}}}
      {\idtm{\mprd{A}{Q}}}
    }
  \\
& \inference
  { \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jtermeq
      {{{{\Gamma}{A}}{P}}{Q}}
      {\ctxwk{Q}{Q}}
      {\sev{A}{\ctxwk{Q}{Q}}{\idtm{\mprd{A}{Q}}}}
      {\idtm{Q}}
    }
\end{align*}

\subsection{Consequences of the rules for the dependent function constructors}

\begin{lem}\label{lem:slam-ext}
The inference rules asserting that lambda abstraction is compatible with term
extension
\begin{align*}
& \inference
  { \jterm{{{\Gamma}{A}}{P}}{{Q}{R}}{h}
    }
  { \jtermeq
      {{\Gamma}{\mprd{A}{P}}}
      {\mprd{A}{\ctxext{Q}{R}}}
      {\cprojfst{\mprd{A}{Q}}{\mprd{A}{R}}{\slam{A}{\ctxext{Q}{R}}{h}}}
      {\slam{A}{Q}{\cprojfst{Q}{R}{h}}}
    }
  \\
& \inference
  { \jterm{{{\Gamma}{A}}{P}}{{Q}{R}}{h}
    }
  { \jtermeq
      {{\Gamma}{\mprd{A}{P}}}
      {\mprd{A}{\ctxext{Q}{R}}}
      {\cprojfst{\mprd{A}{Q}}{\mprd{A}{R}}{\slam{A}{\ctxext{Q}{R}}{h}}}
      {\slam{A}{R}{\cprojsnd{Q}{R}{h}}}
    }
\intertext{and the inference rules asserting that evaluation is compatible with
term extension}
& \inference
  { \jterm{{\Gamma}{\mprd{A}{P}}}{\mprd{A}{\ctxext{Q}{R}}}{h}
    }
  { \jtermeq
      {{{\Gamma}{A}}{P}}
      {{Q}{R}}
      {\cprojfst{Q}{R}{\sev{A}{\ctxext{Q}{R}}{h}}}
      {\sev{A}{Q}{\cprojfst{\mprd{A}{Q}}{\mprd{A}{R}}{h}}}
    }
  \\
& \inference
  { \jterm{{\Gamma}{\mprd{A}{P}}}{\mprd{A}{\ctxext{Q}{R}}}{h}
    }
  { \jtermeq
      {{{\Gamma}{A}}{P}}
      {{Q}{R}}
      {\cprojsnd{Q}{R}{\sev{A}{\ctxext{Q}{R}}{h}}}
      {\sev{A}{R}{\cprojsnd{\mprd{A}{Q}}{\mprd{A}{R}}{h}}}
    }
\end{align*}
are valid.
\end{lem}

\begin{proof}
We have the judgmental equalities
\begin{align*}
\cprojfst{\mprd{A}{Q}}{\mprd{A}{R}}{\slam{A}{\ctxext{Q}{R}}{h}}
& \jdeq
  \subst{\slam{A}{\ctxext{Q}{R}}{h}}{\ctxwk{\mprd{A}{R}}{\idtm{\mprd{A}{Q}}}}
  \\
& \jdeq 
  \subst{\slam{A}{\ctxext{Q}{R}}{h}}{\ctxwk{\mprd{A}{R}}{\slam{A}{\ctxwk{Q}{Q}}{\idtm{Q}}}}
  \\
& \jdeq
  \subst{\slam{A}{\ctxext{Q}{R}}{h}}{\slam{A}{\ctxwk{R}{{Q}{Q}}}{\ctxwk{R}{\idtm{Q}}}}
  \\
& \jdeq
  \subst{\slam{A}{\ctxext{Q}{R}}{h}}{\slam{A}{\ctxwk{\ctxext{Q}{R}}{Q}}{\ctxwk{R}{\idtm{Q}}}}
  \\
& \jdeq
  \slam{A}{Q}{\subst{h}{\ctxwk{R}{\idtm{Q}}}}
  \\
& \jdeq
  \slam{A}{Q}{\cprojfst{Q}{R}{h}}
\end{align*}
\end{proof}

\begin{rmk}
It follows from these rules that on the projections (i.e.~on the fibrations),
lambda abstraction and evaluation are each other's inverses even though we
have not even postulated that evaluation is a retraction of lambda 
abstraction. Thus, in combination with univalence this should give that
they are homotopically inverse to each other.
\end{rmk}

\subsection{The evaluation term}
Until now we have just introduced the dependent function constructor, but we 
have not treated one of its main characteristic, the evaluation map. Usually
in type theory, evaluation is introduces by a rule like
\begin{equation*}
\inference
    { \jterm{\Gamma}{\mprd{A}{P}}{f}
      }
    { \jterm{{\Gamma}{A}}{P}{\mathsf{ev}(f)}
      }
\end{equation*}
or even a rule like
\begin{equation*}
\inference
    { \jterm{\Gamma}{\mprd{A}{P}}{f}
      \jterm{\Gamma}{A}{x}
      }
    { \jterm{\Gamma}{\subst{x}{P}}{\mathsf{ev}(f,x)}
      }
\end{equation*}
involving a term of $A$. We immediately discard the latter as a viable option.
In the current setting however, there is an even better option than the first. 
We need a better option because given a family 
$\jfam{{{\Gamma}{A}}{P}}{Q}$, we will need to have a family over
$\ctxext{{\Gamma}{\mprd{A}{P}}}{\ctxwk{\mprd{A}{P}}{A}}$ with fibers
$\subst{{x}{\mathsf{ev}(f)}}{{x}{Q}}$ at $f:\mprd{A}{P}$ and $x:A$. In a 
name-free setting, such a family is impossible to obtain when using evaluation
as introduced above. The solution is to introduce evaluation via the rule
\begin{equation}\label{eq:evtm}
\inference
  { \jfam{{\Gamma}{A}}{P}
    }
  { \jterm
      {{{\Gamma}{\mprd{A}{P}}}{\ctxwk{\mprd{A}{P}}{A}}}
      {\ctxwk{\mprd{A}{P}}{P}}
      {\evtm{A}{P}}
    }
\end{equation}
The advantages are as follows:
\begin{enumerate}
\item It matches the categorical notion of locally cartesian closedness, where
the unit and the counit consist of morphisms in the category.
\item We now have the family 
\begin{equation*}
\jfam
  {{{\Gamma}{\mprd{A}{P}}}{\ctxwk{\mprd{A}{P}}{A}}}
  {\subst{\evtm{A}{P}}{\ctxwk{\mprd{A}{P}}{Q}}}
\end{equation*}
Using this family, we hope to find the judgmental equality
\begin{equation*}
\jfameq
  {{\Gamma}{\mprd{A}{P}}}
  {\mprd{A}{Q}}
  {\mprd{\ctxwk{\mprd{A}{P}}{A}}{\subst{\evtm{A}{P}}{\ctxwk{\mprd{A}{P}}{Q}}}}
\end{equation*}
expressing the action on families of the dependent function constructor in terms
of its action on contexts. This is in agreement with the usual approach of
\cite{TheBook}, where no action on families of the dependent function type
constructor is needed. We will also be able to use the family
\begin{equation*}
\jfam
  {{\Gamma}{\mprd{A}{P}}}
  {{\ctxwk{\mprd{A}{P}}{A}}{\subst{\evtm{A}{P}}{\ctxwk{\mprd{A}{P}}{Q}}}}
\end{equation*}
to formulate the compatibility of the dependent function constructor with itself.
\end{enumerate}
Of course, we will also need the following convertibility rule before we 
continue:

\begin{rmk}
It is common practice, for example in \cite{TheBook}, to omit explicit notation
for evaluation. In our setting that would mean that we would denote a term 
$\subst{f}{\evtm{A}{P}}$ of $P$ in context $\ctxext{\Gamma}{A}$ by $f$.
However, since the evaluation term is set to be an actual term of the theory,
it seems to be harmful to the exposition of the theory to copy this practice.
\end{rmk}

\begin{comment}
\subsubsection{Introducing the evaluation operator}
The operation $\ctxev{A}{P}{\blank}$ brings things in context $\ctxext{{\Gamma}{A}}{P}$ to
the context $\ctxext{{\Gamma}{\mprd{A}{P}}}{\ctxwk{\mprd{A}{P}}{A}}$.
\begin{align*}
& \inference
  { \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \jfamdefn
      {{{\Gamma}{\mprd{A}{P}}}{\ctxwk{\mprd{A}{P}}{A}}}
      {\ctxev{A}{P}{Q}}
      {\subst{\evtm{A}{P}}{\ctxwk{\mprd{A}{P}}{Q}}}
    }
  \\
& \inference
  { \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \jfamdefn
      {{{{\Gamma}{\mprd{A}{P}}}{\ctxwk{\mprd{A}{P}}{A}}}{\ctxev{A}{P}{Q}}}
      {\ctxev[\famsym]{A}{P}{R}}
      {\subst{\evtm{A}{P}}{\ctxwk{\mprd{A}{P}}{R}}}
    }
  \\
& \inference
  { \jterm{{{{\Gamma}{A}}{P}}{Q}}{R}{h}
    }
  { \jtermdefn
      {{{{\Gamma}{\mprd{A}{P}}}{\ctxwk{\mprd{A}{P}}{A}}}{\ctxev{A}{P}{Q}}}
      {\ctxev[\famsym]{A}{P}{R}}
      {\ctxev[\tmsym]{A}{P}{h}}
      {\subst{\evtm{A}{P}}{\ctxwk{\mprd{A}{P}}{h}}}
    }
\end{align*}
\end{comment}

\subsubsection{The compatibility rules of the evaluation terms}

\paragraph{Compatibility with the empty context}
The following rule explains that the evaluation term is judgmentally equal to
the identity term when the domain of the dependent function constructor is the
empty family over $\Gamma$.
\begin{align*}
& \inference
    { \jfam{\Gamma}{P}
      }
    { \jtermeq
        {{\Gamma}{P}}
        {\ctxwk{P}{P}}
        {\evtm{\emptyf}{P}}
        {\idtm{P}}
      }
\end{align*}

\paragraph{Currying for the evaluation term}
We have asserted that there is a judgmental equality
\begin{equation*}
\jfameq
      {\Gamma}
      {\mprd{\ctxext{A}{P}}{Q}}
      {\mprd{A}{\mprd{P}{Q}}}
\end{equation*}
for every family $Q$ over $\ctxext{{\Gamma}{A}}{P}$. It follows that we have
the judgmental equalities
\begin{align*}
& \ctxwk{\mprd{A}{\mprd{P}{Q}}}{Q}
  \\
& \jdeq
  \subst
    { \evtm{A}{\mprd{P}{Q}}}
    { \ctxwk
        {{\mprd{A}{\mprd{P}{Q}}}{\mprd{P}{Q}}}
        {{\mprd{A}{\mprd{P}{Q}}}{Q}}
      }
  \\
& \jdeq
  \subst
    { \evtm{A}{\mprd{P}{Q}}}
    { \ctxwk
        {\mprd{A}{\mprd{P}{Q}}}
        {{\mprd{P}{Q}}{Q}}
      }
\end{align*}
Since $\evtm{P}{Q}$ is a term of $\ctxwk{\mprd{P}{Q}}{Q}$ in 
context $\ctxext{{{\Gamma}{A}}{\mprd{P}{Q}}}{\ctxwk{\mprd{P}{Q}}{P}}$ we may
require the following compatibility rule:
\begin{align}
& \inference
  { \jfam{{{\Gamma}{A}}{P}}{Q}
    }
  { \begin{array}{l}
    \ctxext
      {{\Gamma}{\mprd{\ctxext{A}{P}}{Q}}}{\ctxwk{\mprd{\ctxext{A}{P}}{Q}}{\ctxext{A}{P}}}
      \\
    \jtermeq
      {\qquad}
      {\ctxwk{\mprd{\ctxext{A}{P}}{Q}}{Q}}
      {\evtm{\ctxext{A}{P}}{Q}}
      {\subst{\evtm{A}{\mprd{P}{Q}}}{\ctxwk{\mprd{A}{\mprd{P}{Q}}}{\evtm{P}{Q}}}}
    \end{array}
    }
\end{align}
To get a feel for what it says we substitute terms in both expressions involved
in the following lemma.

\begin{lem}
Consider $f:\mprd{\ctxext{A}{P}}{Q}$, $x:A$ and $u:\subst{x}{P}$ be terms in
context $\Gamma$. Then we have the judgmental equality
\begin{equation*}
\jtermeq
  {\Gamma}
  {\subst{u}{{x}{Q}}}
  {\subst{\tmext{x}{u}}{{f}{\evtm{\ctxext{A}{P}}{Q}}}}
  {\subst{u}{{{x}{{f}{\evtm{A}{\mprd{P}{Q}}}}}{\evtm{\subst{x}{P}}{\subst{x}{Q}}}}}
\end{equation*}
is valid.
\end{lem}

\paragraph{Weakening is compatible with the evaluation term}
\begin{align*}
& \inference
  { \jfam{\Gamma}{A}
    \jfam{{{\Gamma}{B}}{Q}}{R}
    }
  { \begin{array}{l}
    \ctxext
        { { { {\Gamma}
              {A}
              }
            { \ctxwk{A}{B}
              }
            }
          { \mprd{\ctxwk{A}{Q}}{\ctxwk{A}{R}}
            }
          }
        { \ctxwk{\mprd{\ctxwk{A}{Q}}{\ctxwk{A}{R}}}{\ctxwk{A}{Q}}
          }
      \\
    \jtermeq
      {\qquad}
      {\ctxwk{\mprd{\ctxwk{A}{Q}}{\ctxwk{A}{R}}}{\ctxwk{A}{R}}}
      {\evtm{\ctxwk{A}{Q}}{\ctxwk{A}{R}}}
      {\ctxwk{A}{\evtm{Q}{R}}}  
    \end{array}
    }
\end{align*}

\paragraph{Substitution is compatible with the evaluation term}
\begin{align*}
& \inference
  { \jterm{\Gamma}{A}{x}
    \jfam{{{{\Gamma}{A}}{P}}{Q}}{R}
    }
  { \begin{array}{l}
    \ctxext
      {{{\Gamma}{\subst{x}{P}}}{\mprd{\subst{x}{Q}}{\subst{x}{R}}}}
      {\ctxwk{\mprd{\subst{x}{Q}}{\subst{x}{R}}}{\subst{x}{Q}}}
      \\
    \jtermeq
      {\qquad}
      {\ctxwk{\mprd{\subst{x}{Q}}{\subst{x}{R}}}{\subst{x}{R}}}
      {\subst{x}{\evtm{Q}{R}}}
      {\evtm{\subst{x}{Q}}{\subst{x}{R}}}
    \end{array}
    }  
\end{align*}

\paragraph{The evaluation term is compatible with weakening}
\begin{align*}
& \inference
  { \jfam{{{\Gamma}{A}}{P}}{Q}
    \jfam{{{{\Gamma}{P}}{Q}}{R}}{S}
    \jterm{{{\Gamma}{\mprd{A}{P}}}{\mprd{A}{R}}}{\mprd{A}{S}}{k}
    }
  { \jtermeq
      {{{{{\Gamma}{A}}{P}}{Q}}{\ctxwk{Q}{R}}}
      {\ctxwk{Q}{S}}
      {\sev{A}{\ctxwk{Q}{S}}{\ctxwk{\mprd{A}{Q}}{k}}}
      {\ctxwk{Q}{\sev{A}{S}{k}}}
    }
\end{align*}

\subsection{Composition of dependent functions}
